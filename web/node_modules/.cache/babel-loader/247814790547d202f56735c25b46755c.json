{"ast":null,"code":"import _regeneratorRuntime from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _objectSpread from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _toConsumableArray from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from'react';// @ts-ignore\nimport{DragDropContext,Droppable,Draggable}from'react-beautiful-dnd';import{renderTimeWithCustomFormat}from'../../../../utils/common';import milestonesPlaceholder from'../../../../assets/images/Job milestones-preview.png';import moment from'moment';import{setShowToast}from'../../../../redux/common/actions';import Button from'@material-ui/core/Button';import Dialog from'@material-ui/core/Dialog';import DialogActions from'@material-ui/core/DialogActions';import DialogContent from'@material-ui/core/DialogContent';import DialogContentText from'@material-ui/core/DialogContentText';import DialogTitle from'@material-ui/core/DialogTitle';import{moengage,mixPanel}from'../../../../services/analyticsTools';import{MoEConstants}from'../../../../utils/constants';import{changeRequest}from'../../../../redux/jobs/actions';import AddEditMile from'./addEditMile';import{withRouter}from'react-router-dom';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var EditMilestone=function EditMilestone(props){var _props$details;var item=props.item,_props$item=props.item,jobId=_props$item.jobId,jobName=_props$item.jobName,milestones=props.details.milestones,history=props.history;var propsMile=Object.freeze(props===null||props===void 0?void 0:(_props$details=props.details)===null||_props$details===void 0?void 0:_props$details.milestones);var jobDetail=Object.freeze(props===null||props===void 0?void 0:props.details);var _useState=useState([]),_useState2=_slicedToArray(_useState,2),stateData=_useState2[0],setStateData=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),stateItems=_useState4[0],setItems=_useState4[1];var _useState5=useState({}),_useState6=_slicedToArray(_useState5,2),editItem=_useState6[0],setEditItems=_useState6[1];var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),open=_React$useState2[0],setOpen=_React$useState2[1];var _React$useState3=React.useState(null),_React$useState4=_slicedToArray(_React$useState3,2),deleteItem=_React$useState4[0],setDeleteItem=_React$useState4[1];var _useState7=useState({add:false,edit:false,editId:'',deleteId:''}),_useState8=_slicedToArray(_useState7,2),itemData=_useState8[0],setItemData=_useState8[1];var _React$useState5=React.useState([]),_React$useState6=_slicedToArray(_React$useState5,2),sortedItems=_React$useState6[0],setSortedItems=_React$useState6[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),toggleItem=_useState10[0],setToggleItem=_useState10[1];var _useState11=useState([]),_useState12=_slicedToArray(_useState11,2),description=_useState12[0],setDescription=_useState12[1];useEffect(function(){if(!(stateData===null||stateData===void 0?void 0:stateData.length)){var filtered=milestones.map(function(item,index){item['count']=index+1;return item;});setStateData(filtered);setItems(filtered);}},[]);var reorder=function reorder(list,source,destination){var startIndex=source.index;var endIndex=destination.index;var findItem=list.find(function(lt,index){return index===endIndex;});console.log({findItem:findItem,list:list,destination:destination,endIndex:endIndex});if(findItem){if([1,2].includes(findItem.status)){return list;}}var result=Array.from(list);var _result$splice=result.splice(startIndex,1),_result$splice2=_slicedToArray(_result$splice,1),removed=_result$splice2[0];result.splice(endIndex,0,removed);console.log({result:result});setDescription(function(prev){return[].concat(_toConsumableArray(prev),['Milestones are rearranged.']);});return result;};var onDragEnd=function onDragEnd(result){var source=result.source,destination=result.destination;// dropped outside the list\nif(!destination){return;}// if (source.droppableId === destination.droppableId) {\nvar reOrderItems=reorder(stateItems,source,destination);setItems(function(prev){return reOrderItems;});};var checkIfValidDates=function checkIfValidDates(item){var isfilter=stateItems.filter(function(item_){if(item_.hasOwnProperty('fromDate')){if(moment(item_===null||item_===void 0?void 0:item_.fromDate).isValid()){item_['fromDate']=moment(item_.fromDate).startOf('day').toDate();item_['toDate']=item_.toDate===''?moment(item_.fromDate).startOf('day').toDate():moment(item_.toDate).startOf('day').toDate();return item_;}}});if(!(isfilter===null||isfilter===void 0?void 0:isfilter.length)){return true;}else{var newarr=isfilter.sort(function(a,b){var start_a=a.fromDate;var end_a=a.toDate;var start_b=b.fromDate;var end_b=b.toDate;if(start_a===start_b){return end_a-end_b;}return start_a-start_b;});var filteredItem=item.filter(function(item_reorder){if(item_reorder.hasOwnProperty('fromDate')){if(moment(item_reorder===null||item_reorder===void 0?void 0:item_reorder.fromDate).isValid()){return item_reorder;}}});setSortedItems(newarr);console.log({newarr:newarr,filteredItem:filteredItem});return JSON.stringify(newarr)===JSON.stringify(filteredItem);}};var checkIfDatesValid=function checkIfDatesValid(){var data=item;var start_selection=data===null||data===void 0?void 0:data.fromDate;var end_selection=null;if(moment(data===null||data===void 0?void 0:data.toDate).isValid()){if(!moment(data===null||data===void 0?void 0:data.toDate).isSame(moment(data===null||data===void 0?void 0:data.fromDate))){end_selection=data===null||data===void 0?void 0:data.toDate;}}var item_find=false;var filteredItem=stateItems;if(filteredItem===null||filteredItem===void 0?void 0:filteredItem.length){filteredItem.forEach(function(item_date){if(item_date.fromDate){var start=moment(item_date.fromDate).isValid()?item_date.fromDate:null;var end=moment(item_date.toDate).isValid()?item_date.toDate:null;if(start&&!end){if(moment(start_selection).isAfter(moment(start))){item_find=true;// true;\n}}if(start_selection&&end_selection&&!end){if(moment(start).isSameOrAfter(moment(start_selection))&&moment(start).isSameOrBefore(moment(end_selection))){item_find=false;}else{item_find=true;}}}});}if(item_find){setShowToast(true,'Please check the milestone dates');return item_find;}return item_find;};var checkOnClick=function checkOnClick(e,index){var edit_item_clone=editItem;edit_item_clone[index]=e.target.checked;setEditItems(function(prev){return _objectSpread(_objectSpread({},prev),edit_item_clone);});};var resetItems=function resetItems(){setItemData(function(prev){return _objectSpread(_objectSpread({},prev),{},{add:false,edit:false,editId:'',deleteId:''});});setEditItems({});};var addNewMile=function addNewMile(item){var state_data=stateItems;if(itemData===null||itemData===void 0?void 0:itemData.edit){// edit\nvar _index=parseInt(itemData.editId);var prev_count=null;if((state_data===null||state_data===void 0?void 0:state_data.length)>1&&_index>0){prev_count=state_data[_index-1].count+1;}else{prev_count=state_data[_index].count;}console.log({item:item,prev_count:prev_count},'---->');state_data[itemData.editId]['isPhotoevidence']=item.isPhotoevidence;state_data[itemData.editId]['milestoneName']=item.milestoneName;state_data[itemData.editId]['recommendedHours']=item.recommendedHours;state_data[itemData.editId]['description']=item.description;state_data[itemData.editId]['status']=item.status;state_data[itemData.editId]['order']=item.order;state_data[_index]['count']=prev_count;state_data[_index]['fromDate']=moment(item.fromDate).isValid()?moment(item.fromDate).toISOString():'';state_data[_index]['toDate']=moment(item.toDate).isValid()?moment(item.toDate).toISOString():'';// setStateData(state_data);\nsetItems(state_data);}else{item['count']=(state_data===null||state_data===void 0?void 0:state_data.length)+1;setItems(function(prev){return[].concat(_toConsumableArray(prev),[item]);});// setStateData((prev: any) => ([...prev, item]));\n}};if((itemData===null||itemData===void 0?void 0:itemData.add)||(itemData===null||itemData===void 0?void 0:itemData.edit)){var filtered=stateData.filter(function(item){if(!(item===null||item===void 0?void 0:item.isDeleteRequest)){return item;}});return/*#__PURE__*/_jsx(AddEditMile,{item:item,milestones:stateItems// filtered={filtered}\n,jobDetail:jobDetail,isSame:JSON.stringify(filtered)===JSON.stringify(stateData),editMile:itemData.editId,addNewMile:addNewMile,resetItems:resetItems});}var removeMilestoneByIndex=function removeMilestoneByIndex(index){var state_data=stateItems;state_data[index]['isDeleteRequest']=true;var count=0;if(state_data===null||state_data===void 0?void 0:state_data.length){var _filtered=state_data.map(function(item){if(!(item===null||item===void 0?void 0:item.isDeleteRequest)){count++;item['count']=count;}return item;});setStateData(_filtered.concat(stateItems));var Items=_filtered.filter(function(item){if(!(item===null||item===void 0?void 0:item.isDeleteRequest)){return item;}});resetItems();// removed length check to update the items.\n// if (Items?.length) {\nsetItems(Items);// }\n}};var checkIfChange=function checkIfChange(){var isTrue=true;if(!(stateItems===null||stateItems===void 0?void 0:stateItems.length)){isTrue=false;}else{stateItems===null||stateItems===void 0?void 0:stateItems.forEach(function(dt){var _dt$description;if(dt===null||dt===void 0?void 0:(_dt$description=dt.description)===null||_dt$description===void 0?void 0:_dt$description.length){isTrue=false;}});stateData===null||stateData===void 0?void 0:stateData.forEach(function(dt){if(dt===null||dt===void 0?void 0:dt.isDeleteRequest){isTrue=false;}});}return isTrue;};var submitData=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _props$details2;var description_string,deletedItems,uniqueValues,filteredItems,filtered,data,response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:description_string=description;deletedItems=[];uniqueValues={};stateData.forEach(function(item){if(item===null||item===void 0?void 0:item.isDeleteRequest){if(item===null||item===void 0?void 0:item.milestoneId){if(uniqueValues[item===null||item===void 0?void 0:item.milestoneId]==undefined){uniqueValues[item===null||item===void 0?void 0:item.milestoneId]=1;deletedItems.push(item);}}//  else {\n//     deletedItems.push(item);\n// }\n}});filteredItems=deletedItems.concat(stateItems);console.log({deletedItems:deletedItems,filteredItems:filteredItems});filtered=filteredItems.map(function(item,index){var _item$description,_data$to_date;var data={\"milestoneId\":(item===null||item===void 0?void 0:item.milestoneId)||'',\"milestone_name\":item===null||item===void 0?void 0:item.milestoneName,\"isPhotoevidence\":item===null||item===void 0?void 0:item.isPhotoevidence,\"from_date\":moment(item===null||item===void 0?void 0:item.fromDate).isValid()?moment(item===null||item===void 0?void 0:item.fromDate).format(\"YYYY-MM-DD\"):'',\"to_date\":moment(item===null||item===void 0?void 0:item.toDate).isValid()?moment(item===null||item===void 0?void 0:item.toDate).format(\"YYYY-MM-DD\"):'',\"recommended_hours\":item===null||item===void 0?void 0:item.recommendedHours,\"description\":item===null||item===void 0?void 0:item.description,\"status\":item===null||item===void 0?void 0:item.status};if((_item$description=item.description)===null||_item$description===void 0?void 0:_item$description.length){description_string.push(item.description);}if(!(data===null||data===void 0?void 0:(_data$to_date=data.to_date)===null||_data$to_date===void 0?void 0:_data$to_date.length)){data===null||data===void 0?true:delete data.to_date;}if((item===null||item===void 0?void 0:item.isDeleteRequest)&&(item===null||item===void 0?void 0:item.status)>-1){data['isDeleteRequest']=true;data['description']=\"\".concat(item===null||item===void 0?void 0:item.milestoneName,\" was deleted.\");description_string.push(\"\".concat(item===null||item===void 0?void 0:item.milestoneName,\" was deleted.\"));}if(!(item===null||item===void 0?void 0:item.milestoneId)){delete data.milestoneId;}data['order']=index+1;return data;}).filter(function(item){if(![1,2,3].includes(item===null||item===void 0?void 0:item.status)){var _item$description2;item===null||item===void 0?true:delete item.status;if(item===null||item===void 0?void 0:(_item$description2=item.description)===null||_item$description2===void 0?void 0:_item$description2.length){item===null||item===void 0?true:delete item.description;}return item;}});data={\"jobId\":item.jobId,\"tradieId\":props===null||props===void 0?void 0:(_props$details2=props.details)===null||_props$details2===void 0?void 0:_props$details2.tradieId,\"milestones\":filtered,\"description\":Array.from(new Set(description_string))};console.log({data:data});_context.next=11;return changeRequest(data);case 11:response=_context.sent;if(response===null||response===void 0?void 0:response.success){moengage.moE_SendEvent(MoEConstants.EDIT_MILESTONES,{timeStamp:moengage.getCurrentTimeStamp()});mixPanel.mixP_SendEvent(MoEConstants.EDIT_MILESTONES,{timeStamp:moengage.getCurrentTimeStamp()});props.history.push('/milestone-request-sent-success');}case 13:case\"end\":return _context.stop();}}},_callee);}));return function submitData(){return _ref.apply(this,arguments);};}();var renderTimeIfExist=function renderTimeIfExist(fromDate,toDate){var time=renderTimeWithCustomFormat(fromDate,moment(fromDate).isSame(moment(toDate))?'':toDate,'',['DD MMM','DD MMM YY']);return time==='Choose'?'':time;};var customRenderElements=function customRenderElements(_ref2){var milestoneName=_ref2.milestoneName,isPhotoevidence=_ref2.isPhotoevidence,recommendedHours=_ref2.recommendedHours,isDeleteRequest=_ref2.isDeleteRequest,fromDate=_ref2.fromDate,toDate=_ref2.toDate,status=_ref2.status,index=_ref2.index,custom_index=_ref2.custom_index;console.log({index:index,custom_index:custom_index});return/*#__PURE__*/_jsx(Draggable,{draggableId:\"\".concat(milestoneName,\"-\").concat(index),index:index,isDragDisabled:![0,4,5,-1].includes(status)?true:false,children:function children(provided,snapshot){return/*#__PURE__*/_jsxs(\"li\",_objectSpread(_objectSpread(_objectSpread({className:![0,4,5,-1].includes(status)?'disable_milstone':'',ref:provided.innerRef},provided.draggableProps),provided.dragHandleProps),{},{style:_objectSpread({},provided.draggableProps.style),children:[editItem[index]?/*#__PURE__*/_jsxs(\"div\",{className:\"edit_delete\",children:[/*#__PURE__*/_jsx(\"span\",{onClick:function onClick(e){e.preventDefault();console.log({index:index});setItemData(function(prev){return _objectSpread(_objectSpread({},prev),{},{edit:true,editId:index,deleteId:''});});},className:\"edit\"}),/*#__PURE__*/_jsx(\"span\",{onClick:function onClick(e){e.preventDefault();setItemData(function(prev){return _objectSpread(_objectSpread({},prev),{},{editId:'',deleteId:index});});},className:\"delete\"})]}):'',/*#__PURE__*/_jsxs(\"div\",{className:\"checkbox_wrap agree_check\",children:[/*#__PURE__*/_jsx(\"input\",{checked:editItem[index],onClick:function onClick(e){if([0,4,5,-1].includes(status)){checkOnClick(e,index);}else{e.preventDefault();}},className:\"filter-type filled-in\",type:\"checkbox\",id:\"milestone\".concat(index)}),console.log({custom_index:custom_index,index:index}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"milestone\".concat(index),children:\"\".concat(custom_index,\". \").concat(milestoneName)}),/*#__PURE__*/_jsxs(\"div\",{className:\"info\",children:[isPhotoevidence?/*#__PURE__*/_jsx(\"span\",{children:'Photo evidence required'}):/*#__PURE__*/_jsx(\"span\",{}),/*#__PURE__*/_jsx(\"span\",{children:renderTimeIfExist(fromDate,toDate)}),/*#__PURE__*/_jsx(\"span\",{children:recommendedHours})]})]})]}),index);}},\"\".concat(index,\"-\").concat(milestoneName));};console.log({stateItems:stateItems},'------>><<-----');var stateItemsEdit=stateItems.filter(function(item){return(item===null||item===void 0?void 0:item.isDeleteRequest)==false;});return/*#__PURE__*/_jsxs(React.Fragment,{children:[/*#__PURE__*/_jsxs(Dialog,{open:toggleItem// onClose={handleClose}\n,\"aria-labelledby\":\"alert-dialog-title\",\"aria-describedby\":\"alert-dialog-description\",children:[/*#__PURE__*/_jsx(DialogTitle,{id:\"alert-dialog-title\",className:\"xs_alert_dialog_title\",children:'Heads Up'}),/*#__PURE__*/_jsx(DialogContent,{children:/*#__PURE__*/_jsx(DialogContentText,{children:'If you go back, you will lose all your changes.'})}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{onClick:function onClick(){setToggleItem(function(prev){return!prev;});},color:\"primary\",children:'Yes'}),/*#__PURE__*/_jsx(Button,{onClick:function onClick(){setToggleItem(function(prev){return!prev;});props.backTab('edit');},color:\"primary\",autoFocus:true,children:'No'})]})]}),/*#__PURE__*/_jsxs(Dialog,{open:(itemData===null||itemData===void 0?void 0:itemData.deleteId)!==''?true:false,onClose:resetItems,\"aria-labelledby\":\"alert-dialog-title\",\"aria-describedby\":\"alert-dialog-description\",children:[/*#__PURE__*/_jsx(DialogTitle,{id:\"alert-dialog-title\",children:\"Are you sure you want to delete the milestone ?\"}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{onClick:function onClick(){removeMilestoneByIndex(itemData===null||itemData===void 0?void 0:itemData.deleteId);},color:\"primary\",autoFocus:true,children:'Yes'}),/*#__PURE__*/_jsx(Button,{onClick:function onClick(){resetItems();},color:\"primary\",children:'No'})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex_row\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex_col_sm_8\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"relate\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){if(checkIfChange()){setToggleItem(function(prev){return!prev;});return;}props.backTab('edit');},className:\"back\"}),/*#__PURE__*/_jsx(\"span\",{className:\"xs_sub_title\",children:jobName||''})]}),/*#__PURE__*/_jsx(\"span\",{className:\"sub_title\",children:'Change Request'}),/*#__PURE__*/_jsx(\"p\",{className:\"commn_para\",children:'You can add/remove/change a milestones here. The changes will be sent to the tradesperson to accept before being implemented'})]})}),console.log({stateItems:stateItems,stateItemsEdit:stateItemsEdit}),/*#__PURE__*/_jsx(\"div\",{className:\"flex_row\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex_col_sm_7\",children:[/*#__PURE__*/_jsx(DragDropContext,{onDragEnd:onDragEnd,children:/*#__PURE__*/_jsx(Droppable,{droppableId:\"milestones\",children:function children(provided,snapshot){return/*#__PURE__*/_jsxs(\"ul\",{ref:provided.innerRef,className:\"milestones\".concat(snapshot.isDraggingOver?' dragging-over':''),children:[(stateItems===null||stateItems===void 0?void 0:stateItems.length)>0&&stateItems.map(function(_ref3,index){var milestoneName=_ref3.milestoneName,isPhotoevidence=_ref3.isPhotoevidence,recommendedHours=_ref3.recommendedHours,isDeleteRequest=_ref3.isDeleteRequest,fromDate=_ref3.fromDate,toDate=_ref3.toDate,status=_ref3.status,count=_ref3.count;return!!isDeleteRequest==false&&customRenderElements({milestoneName:milestoneName,isPhotoevidence:isPhotoevidence,recommendedHours:recommendedHours,isDeleteRequest:isDeleteRequest,fromDate:fromDate,toDate:toDate,status:status,index:index,custom_index:count});}),provided.placeholder,(stateItems===null||stateItems===void 0?void 0:stateItems.length)===0&&/*#__PURE__*/_jsx(\"figure\",{className:\"placeholder_img\",children:/*#__PURE__*/_jsx(\"img\",{src:milestonesPlaceholder,alt:\"milestones-placeholder\"})})]});}})}),!(stateItems===null||stateItems===void 0?void 0:stateItems.length)?/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(\"div\",{className:\"form_field\",children:/*#__PURE__*/_jsx(\"button\",{className:\"fill_btn full_btn btn-effect\",onClick:function onClick(){setItemData({add:true,editId:'',edit:false,deleteId:''});// handleStepComplete({})\n},children:'+ Add milestone'})})}):/*#__PURE__*/_jsxs(React.Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"form_field\",children:/*#__PURE__*/_jsx(\"button\",{className:\"fill_btn fill_grey_btn full_btn btn-effect\",onClick:function onClick(){setItemData({add:true,editId:'',edit:false,deleteId:''});// handleStepComplete({})\n},children:'+ Add milestone'})}),/*#__PURE__*/_jsx(\"div\",{className:\"form_field\",children:/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){var checkIfItem=checkIfDatesValid();console.log({checkIfItem:checkIfItem});if(!checkIfItem){var check=checkIfValidDates(stateItems);console.log({check:check});if(check){submitData();}else{setShowToast(true,\"Please arrange milestone date wise\");}}}// className={`fill_btn full_btn btn-effect`}>\n,className:\"fill_btn full_btn btn-effect \".concat(checkIfChange()?'disable_btn':''),children:'Send to tradesperson'})})]})]})})]});};export default withRouter(EditMilestone);","map":{"version":3,"sources":["/home/appinventiv/Documents/Project/tickt/web/src/pages/builderJobDasboard/components/editMilestones/index.tsx"],"names":["React","useState","useEffect","DragDropContext","Droppable","Draggable","renderTimeWithCustomFormat","milestonesPlaceholder","moment","setShowToast","Button","Dialog","DialogActions","DialogContent","DialogContentText","DialogTitle","moengage","mixPanel","MoEConstants","changeRequest","AddEditMile","withRouter","EditMilestone","props","item","jobId","jobName","milestones","details","history","propsMile","Object","freeze","jobDetail","stateData","setStateData","stateItems","setItems","editItem","setEditItems","open","setOpen","deleteItem","setDeleteItem","add","edit","editId","deleteId","itemData","setItemData","sortedItems","setSortedItems","toggleItem","setToggleItem","description","setDescription","length","filtered","map","index","reorder","list","source","destination","startIndex","endIndex","findItem","find","lt","console","log","includes","status","result","Array","from","splice","removed","prev","onDragEnd","reOrderItems","checkIfValidDates","isfilter","filter","item_","hasOwnProperty","fromDate","isValid","startOf","toDate","newarr","sort","a","b","start_a","end_a","start_b","end_b","filteredItem","item_reorder","JSON","stringify","checkIfDatesValid","data","start_selection","end_selection","isSame","item_find","forEach","item_date","start","end","isAfter","isSameOrAfter","isSameOrBefore","checkOnClick","e","edit_item_clone","target","checked","resetItems","addNewMile","state_data","parseInt","prev_count","count","isPhotoevidence","milestoneName","recommendedHours","order","toISOString","isDeleteRequest","removeMilestoneByIndex","concat","Items","checkIfChange","isTrue","dt","submitData","description_string","deletedItems","uniqueValues","milestoneId","undefined","push","filteredItems","format","to_date","tradieId","Set","response","success","moE_SendEvent","EDIT_MILESTONES","timeStamp","getCurrentTimeStamp","mixP_SendEvent","renderTimeIfExist","time","customRenderElements","custom_index","provided","snapshot","innerRef","draggableProps","dragHandleProps","style","preventDefault","stateItemsEdit","backTab","isDraggingOver","placeholder","checkIfItem","check"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react'\n// @ts-ignore\nimport { DragDropContext, Droppable, Draggable, DropResult } from 'react-beautiful-dnd';\nimport { renderTime, renderTimeWithCustomFormat } from '../../../../utils/common';\nimport milestonesPlaceholder from '../../../../assets/images/Job milestones-preview.png';\nimport moment from 'moment';\nimport { setShowToast } from '../../../../redux/common/actions';\n\nimport Button from '@material-ui/core/Button';\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport DialogContentText from '@material-ui/core/DialogContentText';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport { moengage, mixPanel } from '../../../../services/analyticsTools';\nimport { MoEConstants } from '../../../../utils/constants';\nimport { changeRequest } from '../../../../redux/jobs/actions';\n\nimport AddEditMile from './addEditMile';\n\nimport { withRouter } from 'react-router-dom';\n\nconst EditMilestone = (props: any) => {\n    const { item, item: { jobId, jobName }, details: { milestones }, history } = props;\n\n    const propsMile = Object.freeze(props?.details?.milestones);\n    const jobDetail: any = Object.freeze(props?.details);\n    const [stateData, setStateData] = useState<any>([]);\n    const [stateItems, setItems] = useState<any>([]);\n    const [editItem, setEditItems] = useState<{ [index: string]: any }>({});\n    const [open, setOpen] = React.useState(false);\n    const [deleteItem, setDeleteItem] = React.useState(null);\n    const [itemData, setItemData] = useState({ add: false, edit: false, editId: '', deleteId: '' });\n    const [sortedItems, setSortedItems] = React.useState([]);\n    const [toggleItem, setToggleItem] = useState(false);\n\n    const [description, setDescription] = useState<any>([]);\n\n\n    useEffect(() => {\n        if (!stateData?.length) {\n            let filtered = milestones.map((item: any, index: any) => {\n                item['count'] = index + 1;\n                return item;\n            })\n            setStateData(filtered);\n            setItems(filtered);\n        }\n    }, [])\n\n    const reorder = (list: Array<any>, source: any, destination: any) => {\n        let startIndex = source.index;\n        let endIndex = destination.index;\n\n        let findItem = list.find((lt: any, index: any) => index === endIndex);\n        console.log({ findItem, list, destination, endIndex })\n        if (findItem) {\n            if ([1, 2].includes(findItem.status)) {\n                return list;\n            }\n        }\n\n        const result = Array.from(list);\n        const [removed] = result.splice(startIndex, 1);\n        result.splice(endIndex, 0, removed);\n        console.log({ result })\n        setDescription((prev: any) => ([\n            ...prev,\n            ...['Milestones are rearranged.']\n        ]));\n        return result;\n    };\n\n    const onDragEnd = (result: DropResult) => {\n        const { source, destination } = result;\n        // dropped outside the list\n        if (!destination) {\n            return;\n        }\n\n        // if (source.droppableId === destination.droppableId) {\n        const reOrderItems = reorder(\n            stateItems,\n            source,\n            destination\n        );\n        setItems((prev: any) => (reOrderItems));\n    };\n\n    const checkIfValidDates = (item: any) => {\n\n        let isfilter = stateItems.filter((item_: any) => {\n            if (item_.hasOwnProperty('fromDate')) {\n                if (moment(item_?.fromDate).isValid()) {\n                    item_['fromDate'] = moment(item_.fromDate).startOf('day').toDate()\n                    item_['toDate'] = item_.toDate === '' ? moment(item_.fromDate).startOf('day').toDate() : moment(item_.toDate).startOf('day').toDate()\n                    return item_;\n                }\n            }\n        });\n\n        if (!isfilter?.length) {\n            return true;\n        } else {\n            const newarr: any = isfilter.sort((a: any, b: any) => {\n                let start_a = a.fromDate;\n                let end_a = a.toDate;\n\n                let start_b = b.fromDate;\n                let end_b = b.toDate;\n\n\n                if (start_a === start_b) {\n                    return end_a - end_b;\n                }\n                return start_a - start_b;\n            });\n\n            let filteredItem: any = item.filter((item_reorder: any) => {\n                if (item_reorder.hasOwnProperty('fromDate')) {\n                    if (moment(item_reorder?.fromDate).isValid()) {\n                        return item_reorder;\n                    }\n                }\n            });\n            setSortedItems(newarr);\n            console.log({ newarr, filteredItem });\n            return JSON.stringify(newarr) === JSON.stringify(filteredItem);\n        }\n    }\n\n\n    const checkIfDatesValid = () => {\n        let data = item;\n\n        let start_selection: any = data?.fromDate;\n        let end_selection: any = null;\n        if (moment(data?.toDate).isValid()) {\n            if (!moment(data?.toDate).isSame(moment(data?.fromDate))) {\n                end_selection = data?.toDate;\n            }\n        }\n\n        let item_find: any = false;\n        let filteredItem = stateItems;\n\n        if (filteredItem?.length) {\n            filteredItem.forEach((item_date: any) => {\n                if (item_date.fromDate) {\n                    let start: any = moment(item_date.fromDate).isValid() ? item_date.fromDate : null;\n                    let end: any = moment(item_date.toDate).isValid() ? item_date.toDate : null;\n\n                    if (start && !end) {\n                        if (moment(start_selection).isAfter(moment(start))) {\n                            item_find = true; // true;\n                        }\n                    }\n\n                    if (start_selection && end_selection && !end) {\n                        if (moment(start).isSameOrAfter(moment(start_selection)) && moment(start).isSameOrBefore(moment(end_selection))) {\n                            item_find = false;\n                        } else {\n                            item_find = true\n                        }\n                    }\n                }\n            });\n        }\n\n        if (item_find) {\n            setShowToast(true, 'Please check the milestone dates');\n            return item_find;\n        }\n\n        return item_find;\n    }\n\n    const checkOnClick = (e: any, index: any) => {\n        let edit_item_clone: any = editItem;\n        edit_item_clone[index] = e.target.checked;\n        setEditItems((prev) => ({ ...prev, ...edit_item_clone }));\n    }\n\n    const resetItems = () => {\n        setItemData((prev: any) => ({ ...prev, add: false, edit: false, editId: '', deleteId: '' }));\n        setEditItems({});\n    }\n\n    const addNewMile = (item: any) => {\n        let state_data: any = stateItems;\n        if (itemData?.edit) { // edit\n            let index = parseInt(itemData.editId);\n            let prev_count = null;\n\n            if (state_data?.length > 1 && index > 0) {\n                prev_count = state_data[index - 1].count + 1;\n            } else {\n                prev_count = state_data[index].count;\n            }\n\n            console.log({ item, prev_count }, '---->')\n            state_data[itemData.editId]['isPhotoevidence'] = item.isPhotoevidence;\n            state_data[itemData.editId]['milestoneName'] = item.milestoneName;\n            state_data[itemData.editId]['recommendedHours'] = item.recommendedHours;\n            state_data[itemData.editId]['description'] = item.description;\n            state_data[itemData.editId]['status'] = item.status;\n            state_data[itemData.editId]['order'] = item.order;\n\n\n            state_data[index]['count'] = prev_count;\n\n\n            state_data[index]['fromDate'] = moment(item.fromDate).isValid() ? moment(item.fromDate).toISOString() : '';\n            state_data[index]['toDate'] = moment(item.toDate).isValid() ? moment(item.toDate).toISOString() : '';\n            // setStateData(state_data);\n            setItems(state_data)\n        } else {\n            item['count'] = state_data?.length + 1;\n            setItems((prev: any) => ([...prev, item]));\n            // setStateData((prev: any) => ([...prev, item]));\n        }\n    }\n\n    if (itemData?.add || itemData?.edit) {\n        let filtered = stateData.filter((item: any) => {\n            if (!item?.isDeleteRequest) {\n                return item;\n            }\n        })\n        return (\n            <AddEditMile\n                item={item}\n                milestones={stateItems}\n                // filtered={filtered}\n                jobDetail={jobDetail}\n                isSame={JSON.stringify(filtered) === JSON.stringify(stateData)}\n                editMile={itemData.editId}\n                addNewMile={addNewMile}\n                resetItems={resetItems}\n            />\n        )\n    }\n\n    const removeMilestoneByIndex = (index: any) => {\n        let state_data: any = stateItems;\n        state_data[index]['isDeleteRequest'] = true;\n        let count = 0;\n        if (state_data?.length) {\n            let filtered = state_data.map((item: any) => {\n                if (!item?.isDeleteRequest) {\n                    count++;\n                    item['count'] = count;\n                }\n                return item;\n            });\n            setStateData(filtered.concat(stateItems));\n\n            let Items = filtered.filter((item: any) => {\n                if (!item?.isDeleteRequest) {\n                    return item;\n                }\n            })\n\n            resetItems();\n            // removed length check to update the items.\n            // if (Items?.length) {\n            setItems(Items)\n            // }\n        }\n    }\n\n    const checkIfChange = () => {\n        let isTrue = true;\n        if (!stateItems?.length) {\n            isTrue = false;\n        } else {\n            stateItems?.forEach((dt: any) => {\n                if (dt?.description?.length) {\n                    isTrue = false;\n                }\n            });\n\n            stateData?.forEach((dt: any) => {\n                if (dt?.isDeleteRequest) {\n                    isTrue = false;\n                }\n            });\n        }\n        return isTrue;\n    }\n\n    const submitData = async () => {\n        let description_string = description;\n\n\n        let deletedItems: any = [];\n        let uniqueValues: any = {};\n        stateData.forEach((item: any) => {\n            if (item?.isDeleteRequest) {\n                if (item?.milestoneId) {\n                    if (uniqueValues[item?.milestoneId] == undefined) {\n                        uniqueValues[item?.milestoneId] = 1;\n                        deletedItems.push(item);\n                    }\n                }\n                //  else {\n                //     deletedItems.push(item);\n                // }\n            }\n        });\n\n        let filteredItems: any = deletedItems.concat(stateItems);\n\n        console.log({\n            deletedItems,\n            filteredItems\n        });\n\n        let filtered = filteredItems.map((item: any, index: any) => {\n            let data: any = {\n                \"milestoneId\": item?.milestoneId || '',\n                \"milestone_name\": item?.milestoneName,\n                \"isPhotoevidence\": item?.isPhotoevidence,\n                \"from_date\": moment(item?.fromDate).isValid() ? moment(item?.fromDate).format(\"YYYY-MM-DD\") : '',\n                \"to_date\": moment(item?.toDate).isValid() ? moment(item?.toDate).format(\"YYYY-MM-DD\") : '',\n                \"recommended_hours\": item?.recommendedHours,\n                \"description\": item?.description,\n                \"status\": item?.status,\n            }\n\n            if (item.description?.length) {\n                description_string.push(item.description);\n            }\n\n            if (!data?.to_date?.length) {\n                delete data?.to_date;\n            }\n\n            if (item?.isDeleteRequest && item?.status > -1) {\n                data['isDeleteRequest'] = true;\n                data['description'] = `${item?.milestoneName} was deleted.`;\n                description_string.push(`${item?.milestoneName} was deleted.`);\n            }\n\n            if (!item?.milestoneId) {\n                delete data.milestoneId;\n            }\n            data['order'] = index + 1;\n            return data;\n        }).filter((item: any) => {\n\n            if (![1, 2, 3].includes(item?.status)) {\n                delete item?.status;\n\n                if (item?.description?.length) {\n                    delete item?.description;\n                }\n\n                return item;\n            }\n\n        });\n\n        let data = {\n            \"jobId\": item.jobId,\n            \"tradieId\": props?.details?.tradieId,\n            \"milestones\": filtered,\n            \"description\": Array.from(new Set(description_string))\n        };\n\n        console.log({ data })\n\n        let response: any = await changeRequest(data);\n        if (response?.success) {\n            moengage.moE_SendEvent(MoEConstants.EDIT_MILESTONES, { timeStamp: moengage.getCurrentTimeStamp() });\n            mixPanel.mixP_SendEvent(MoEConstants.EDIT_MILESTONES, { timeStamp: moengage.getCurrentTimeStamp() });\n            props.history.push('/milestone-request-sent-success');\n        }\n    }\n\n    const renderTimeIfExist = (fromDate: string, toDate: string) => {\n        const time = renderTimeWithCustomFormat(\n            fromDate,\n            moment(fromDate).isSame(moment(toDate)) ? '' : toDate,\n            '',\n            ['DD MMM', 'DD MMM YY']\n        )\n        return time === 'Choose' ? '' : time;\n    }\n\n\n    const customRenderElements = ({\n        milestoneName,\n        isPhotoevidence,\n        recommendedHours,\n        isDeleteRequest,\n        fromDate,\n        toDate,\n        status,\n        index,\n        custom_index\n    }: any) => {\n        console.log({\n            index,\n            custom_index\n        })\n        return (\n            <Draggable\n                key={`${index}-${milestoneName}`}\n                draggableId={`${milestoneName}-${index}`}\n                index={index}\n                isDragDisabled={![0, 4, 5, -1].includes(status) ? true : false}\n            >\n                {(provided: any, snapshot: any) => (\n                    <li\n                        key={index}\n                        className={![0, 4, 5, -1].includes(status) ? 'disable_milstone' : ''}\n                        ref={provided.innerRef}\n                        {...provided.draggableProps}\n                        {...provided.dragHandleProps}\n                        style={{\n                            ...provided.draggableProps.style,\n                        }}>\n                        {editItem[index] ? (\n                            <div className=\"edit_delete\">\n                                <span\n                                    onClick={(e) => {\n                                        e.preventDefault();\n                                        console.log({ index })\n                                        setItemData((prev: any) => ({\n                                            ...prev,\n                                            edit: true,\n                                            editId: index,\n                                            deleteId: ''\n                                        }));\n                                    }}\n                                    className=\"edit\">\n                                </span>\n                                <span\n                                    onClick={(e) => {\n                                        e.preventDefault();\n                                        setItemData((prev: any) => ({\n                                            ...prev,\n                                            editId: '',\n                                            deleteId: index\n                                        }));\n                                    }}\n                                    className=\"delete\"></span>\n                            </div>\n                        ) : ''}\n                        <div className=\"checkbox_wrap agree_check\">\n                            <input\n                                checked={editItem[index]}\n                                onClick={(e: any) => {\n                                    if ([0, 4, 5, -1].includes(status)) {\n                                        checkOnClick(e, index)\n                                    } else {\n                                        e.preventDefault();\n                                    }\n                                }}\n                                className=\"filter-type filled-in\"\n                                type=\"checkbox\"\n                                id={`milestone${index}`} />\n                            {console.log({\n                                custom_index,\n                                index\n                            })}\n                            <label htmlFor={`milestone${index}`}>{`${custom_index}. ${milestoneName}`}</label>\n                            <div className=\"info\">\n                                {isPhotoevidence ?\n                                    <span>{'Photo evidence required'}</span>\n                                    : <span></span>}\n                                <span>\n                                    {renderTimeIfExist(fromDate, toDate)}\n                                </span>\n                                <span>\n                                    {recommendedHours}\n                                </span>\n                            </div>\n                        </div>\n                    </li>\n                )}\n            </Draggable>\n        )\n    }\n    console.log({\n        stateItems\n    }, '------>><<-----')\n\n    const stateItemsEdit = stateItems.filter((item: any) => item?.isDeleteRequest == false);\n    return (\n        <React.Fragment>\n\n            <Dialog\n                open={toggleItem}\n                // onClose={handleClose}\n                aria-labelledby=\"alert-dialog-title\"\n                aria-describedby=\"alert-dialog-description\"\n            >\n                <DialogTitle id=\"alert-dialog-title\" className=\"xs_alert_dialog_title\">\n                    {'Heads Up'}\n                </DialogTitle>\n                <DialogContent>\n                    <DialogContentText>\n                        {'If you go back, you will lose all your changes.'}\n                    </DialogContentText>\n                </DialogContent>\n                <DialogActions>\n                    <Button\n                        onClick={() => {\n                            setToggleItem((prev: any) => !prev);\n                        }}\n                        color=\"primary\">\n                        {'Yes'}\n                    </Button>\n                    <Button\n                        onClick={() => {\n                            setToggleItem((prev: any) => !prev);\n                            props.backTab('edit');\n                        }}\n                        color=\"primary\" autoFocus>\n                        {'No'}\n                    </Button>\n                </DialogActions>\n            </Dialog>\n\n            <Dialog\n                open={itemData?.deleteId !== '' ? true : false}\n                onClose={resetItems}\n                aria-labelledby=\"alert-dialog-title\"\n                aria-describedby=\"alert-dialog-description\"\n            >\n                <DialogTitle id=\"alert-dialog-title\">\n                    {\"Are you sure you want to delete the milestone ?\"}\n                </DialogTitle>\n                <DialogActions>\n                    <Button\n                        onClick={() => {\n                            removeMilestoneByIndex(itemData?.deleteId);\n                        }}\n                        color=\"primary\" autoFocus>\n                        {'Yes'}\n                    </Button>\n                    <Button\n                        onClick={() => {\n                            resetItems()\n                        }}\n                        color=\"primary\">\n                        {'No'}\n                    </Button>\n                </DialogActions>\n            </Dialog>\n\n            <div className=\"flex_row\">\n                <div className=\"flex_col_sm_8\">\n                    <div className=\"relate\">\n                        <button\n                            onClick={() => {\n                                if (checkIfChange()) {\n                                    setToggleItem((prev: any) => !prev);\n                                    return\n                                }\n                                props.backTab('edit');\n                            }}\n                            className=\"back\"></button>\n                        <span className=\"xs_sub_title\">\n                            {jobName || ''}\n                        </span>\n                    </div>\n                    <span className=\"sub_title\">\n                        {'Change Request'}\n                    </span>\n                    <p className=\"commn_para\">\n                        {'You can add/remove/change a milestones here. The changes will be sent to the tradesperson to accept before being implemented'}\n                    </p>\n                </div>\n            </div>\n            {console.log({ stateItems, stateItemsEdit })}\n            <div className=\"flex_row\">\n                <div className=\"flex_col_sm_7\">\n                    <DragDropContext onDragEnd={onDragEnd}>\n                        <Droppable droppableId=\"milestones\">\n                            {(provided, snapshot) => (\n                                <ul ref={provided.innerRef}\n                                    className={`milestones${snapshot.isDraggingOver ? ' dragging-over' : ''}`}>\n                                    {stateItems?.length > 0 &&\n                                        stateItems.map(({\n                                            milestoneName,\n                                            isPhotoevidence,\n                                            recommendedHours,\n                                            isDeleteRequest,\n                                            fromDate,\n                                            toDate,\n                                            status,\n                                            count\n                                        }: {\n                                            milestoneName: string,\n                                            isPhotoevidence: boolean,\n                                            fromDate: string,\n                                            toDate: string,\n                                            status: number\n                                            recommendedHours: any,\n                                            isDeleteRequest?: boolean,\n                                            count?: any\n                                        }, index: any) => !!isDeleteRequest == false && (customRenderElements({\n                                            milestoneName,\n                                            isPhotoevidence,\n                                            recommendedHours,\n                                            isDeleteRequest,\n                                            fromDate,\n                                            toDate,\n                                            status,\n                                            index,\n                                            custom_index: count\n                                        })))}\n                                    {provided.placeholder}\n                                    {stateItems?.length === 0 && (\n                                        <figure className=\"placeholder_img\">\n                                            <img\n                                                src={milestonesPlaceholder}\n                                                alt=\"milestones-placeholder\"\n                                            />\n                                        </figure>\n                                    )}\n                                </ul>\n                            )}\n                        </Droppable>\n                    </DragDropContext>\n                    {!stateItems?.length ? (\n                        <>\n                            <div className=\"form_field\">\n                                <button\n                                    className=\"fill_btn full_btn btn-effect\"\n                                    onClick={() => {\n                                        setItemData({ add: true, editId: '', edit: false, deleteId: '' });\n                                        // handleStepComplete({})\n                                    }}>\n                                    {'+ Add milestone'}\n                                </button>\n                            </div>\n                        </>\n                    ) : (\n                        <React.Fragment>\n                            <div className=\"form_field\">\n                                <button className=\"fill_btn fill_grey_btn full_btn btn-effect\"\n                                    onClick={() => {\n                                        setItemData({ add: true, editId: '', edit: false, deleteId: '' });\n                                        // handleStepComplete({})\n                                    }}>\n                                    {'+ Add milestone'}\n                                </button>\n                            </div>\n\n                            <div className=\"form_field\">\n                                <button\n                                    onClick={() => {\n                                        let checkIfItem: boolean = checkIfDatesValid();\n                                        console.log({ checkIfItem })\n                                        if (!checkIfItem) {\n                                            let check: boolean = checkIfValidDates(stateItems);\n                                            console.log({ check })\n                                            if (check) {\n                                                submitData()\n                                            } else {\n                                                setShowToast(true, \"Please arrange milestone date wise\")\n                                            }\n                                        }\n                                    }}\n                                    // className={`fill_btn full_btn btn-effect`}>\n                                    className={`fill_btn full_btn btn-effect ${checkIfChange() ? 'disable_btn' : ''}`}>\n                                    {'Send to tradesperson'}\n                                </button>\n                            </div>\n                        </React.Fragment>\n                    )}\n                </div>\n            </div>\n        </React.Fragment >\n\n    )\n}\n\nexport default withRouter(EditMilestone);"]},"metadata":{},"sourceType":"module"}