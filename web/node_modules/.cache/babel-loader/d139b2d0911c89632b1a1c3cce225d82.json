{"ast":null,"code":"import _toConsumableArray from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from\"react\";import dummy from\"../../assets/images/u_placeholder.jpg\";import chatSearch from\"../../assets/images/search-chat.png\";import menu from\"../../assets/images/menu-line-blue.png\";import close from\"../../assets/images/ic-cancel-blue.png\";import{setLoading,unReadMessageCount}from\"../../redux/common/actions\";import{formatDateTime}from\"../../utils/common\";import noData from\"../../assets/images/no-search-data.png\";import emptyChat from\"../../assets/images/emptyChat.png\";import{auth,createRoom,checkRoomExist,getFirebaseInboxData,stopListeningOfRoom,resetUnreadCounter}from\"../../services/firebase\";import UserMessages from\"./userMessages\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var selectedRoomID=\"\";var isFreshChatRoute=false;var Chat=function Chat(props){var _props$history,_props$history$locati,_props$history2,_props$history2$locat;var _useState=useState(true),_useState2=_slicedToArray(_useState,2),initializing=_useState2[0],setInitializing=_useState2[1];// firebase authenticated user details\nvar _useState3=useState(function(){return auth.currentUser;}),_useState4=_slicedToArray(_useState3,2),user=_useState4[0],setUser=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),inBoxData=_useState6[0],setInBoxData=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),filterInBoxData=_useState8[0],setFilterInBoxData=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),isNoRecords=_useState10[0],setIsNoRecords=_useState10[1];var _useState11=useState({}),_useState12=_slicedToArray(_useState11,2),roomData=_useState12[0],setRoomData=_useState12[1];var _useState13=useState(\"\"),_useState14=_slicedToArray(_useState13,2),roomId=_useState14[0],setRoomId=_useState14[1];var _useState15=useState(\"\"),_useState16=_slicedToArray(_useState15,2),searchQuery=_useState16[0],setSearchQuery=_useState16[1];var _useState17=useState(false),_useState18=_slicedToArray(_useState17,2),searchActive=_useState18[0],setSearchActive=_useState18[1];var _useState19=useState(true),_useState20=_slicedToArray(_useState19,2),isInitialLoader=_useState20[0],setIsInitialLoader=_useState20[1];var _useState21=useState(false),_useState22=_slicedToArray(_useState21,2),isMobInbox=_useState22[0],setIsMobInbox=_useState22[1];var _useState23=useState(),_useState24=_slicedToArray(_useState23,2),unreadMessages=_useState24[0],setUnreadMessages=_useState24[1];var _ref=((_props$history=props.history)===null||_props$history===void 0?void 0:(_props$history$locati=_props$history.location)===null||_props$history$locati===void 0?void 0:_props$history$locati.state)?(_props$history2=props.history)===null||_props$history2===void 0?void 0:(_props$history2$locat=_props$history2.location)===null||_props$history2$locat===void 0?void 0:_props$history2$locat.state:{tradieId:\"\",builderId:\"\",jobName:\"\",jobId:\"\"},tradieId=_ref.tradieId,builderId=_ref.builderId,jobName=_ref.jobName,jobId=_ref.jobId;// console.log('tradieId, builderId, jobName, jobId: ', tradieId, builderId, jobName, jobId);\nuseEffect(function(){//  console.log(\"roomId:: from didmout\", selectedRoomID);\n_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setLoading(true);if(!(tradieId&&builderId&&jobName&&jobId)){_context.next=6;break;}_context.next=4;return setInitialItems();case 4:_context.next=7;break;case 6:isFreshChatRoute=true;case 7:_context.next=9;return getFirebaseInboxData(onUpdateofInbox);case 9:case\"end\":return _context.stop();}}},_callee);}))();return function(){// debugger;\nstopListeningOfRoom(selectedRoomID);selectedRoomID=\"\";};},[]);useEffect(function(){unReadMessageCount(unreadMessages||0);},[unreadMessages]);var setInitialItems=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var roomID;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:roomID=\"\".concat(jobId,\"_\").concat(tradieId,\"_\").concat(builderId);selectedRoomID=roomID;_context2.next=4;return checkRoomExist(roomID);case 4:if(!_context2.sent){_context2.next=8;break;}return _context2.abrupt(\"return\");case 8:_context2.next=10;return createRoom(jobId,tradieId,builderId,jobName);case 10:case\"end\":return _context2.stop();}}},_callee2);}));return function setInitialItems(){return _ref3.apply(this,arguments);};}();var onUpdateofInbox=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(res){var selectedRoomInfo,sortedRes,ress,newRes,_newRes$,itemObj;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0://  console.log(\"roomId::\", selectedRoomID);\nselectedRoomInfo=\"\";sortedRes=res.filter(function(item,index){if(item.hasOwnProperty(\"lastMsg\")||item.roomId===selectedRoomID){if(item.roomId===selectedRoomID&&!isFreshChatRoute){selectedRoomInfo=item;}else{return item;}}});sortedRes===null||sortedRes===void 0?void 0:sortedRes.sort(function(x,y){var _y$lastMsg,_x$lastMsg;return((_y$lastMsg=y.lastMsg)===null||_y$lastMsg===void 0?void 0:_y$lastMsg.messageTimestamp)-((_x$lastMsg=x.lastMsg)===null||_x$lastMsg===void 0?void 0:_x$lastMsg.messageTimestamp);});if(!(sortedRes.length===0&&!selectedRoomInfo)){_context3.next=7;break;}setIsNoRecords(true);if(isInitialLoader){setIsInitialLoader(false);setLoading(false);}return _context3.abrupt(\"return\");case 7:setIsNoRecords(false);if(selectedRoomInfo){ress=_toConsumableArray(sortedRes);ress.unshift(selectedRoomInfo);}// console.log('ress: ', ress, \"sortedRes\", sortedRes, \"res\", res, \"selectedRoomInfo\", selectedRoomInfo);\nnewRes=Array.isArray(ress)&&selectedRoomInfo?ress:sortedRes;setInBoxData(newRes.length===0?[{firstKey:\"emptyRes\"}]:newRes);if(!(newRes.length>0&&selectedRoomID===\"\")){_context3.next=17;break;}selectedRoomID=newRes[0].roomId;setRoomId(newRes[0].roomId);if(newRes[0]&&((_newRes$=newRes[0])===null||_newRes$===void 0?void 0:_newRes$.unreadMessages)>0){newRes[0].unreadMessages=0;resetUnreadCounter(newRes[0].roomId);}setRoomData(newRes[0]);return _context3.abrupt(\"return\");case 17:if(newRes.length>0){itemObj=newRes.find(function(x){return x.roomId==selectedRoomID;});if(itemObj&&(itemObj===null||itemObj===void 0?void 0:itemObj.unreadMessages)>0){itemObj.unreadMessages=0;resetUnreadCounter(itemObj.roomId);}setRoomData(itemObj);}case 18:case\"end\":return _context3.stop();}}},_callee3);}));return function onUpdateofInbox(_x){return _ref4.apply(this,arguments);};}();useEffect(function(){var unsubscribe=auth.onAuthStateChanged(function(user){if(user){setUser(user);setIsMobInbox(false);}else{setUser(false);setIsMobInbox(true);setLoading(false);setIsInitialLoader(false);}if(initializing){setInitializing(false);}});return unsubscribe;},[initializing]);// console.log(props.history, \"history\", roomId, \"roomId\", roomData, \"roomData\", selectedRoomID, \"selectedRoomID\", inBoxData, 'inBoxData');\nvar getRoomDetails=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(item){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:stopListeningOfRoom(selectedRoomID);selectedRoomID=item.roomId;setRoomId(item.roomId);setRoomData(item);resetUnreadCounter(item.roomId);// fetchEquipmentDetail(item.itemId);\ncase 5:case\"end\":return _context4.stop();}}},_callee4);}));return function getRoomDetails(_x2){return _ref5.apply(this,arguments);};}();useEffect(function(){var _inBoxData$;if(searchQuery){var filteredVal=inBoxData.filter(function(item){var _item$oppUserInfo,_item$oppUserInfo$nam,_item$oppUserInfo$nam2;return(_item$oppUserInfo=item.oppUserInfo)===null||_item$oppUserInfo===void 0?void 0:(_item$oppUserInfo$nam=_item$oppUserInfo.name)===null||_item$oppUserInfo$nam===void 0?void 0:(_item$oppUserInfo$nam2=_item$oppUserInfo$nam.toLowerCase())===null||_item$oppUserInfo$nam2===void 0?void 0:_item$oppUserInfo$nam2.includes(searchQuery.toLowerCase());});setFilterInBoxData(filteredVal);}if((inBoxData.length||((_inBoxData$=inBoxData[0])===null||_inBoxData$===void 0?void 0:_inBoxData$[\"firstKey\"])===\"emptyRes\")&&isInitialLoader){var _inBoxData$2;if(((_inBoxData$2=inBoxData[0])===null||_inBoxData$2===void 0?void 0:_inBoxData$2[\"firstKey\"])===\"emptyRes\")setInBoxData([]);setLoading(false);setIsInitialLoader(false);}},[searchQuery,inBoxData]);useEffect(function(){var unreadMessagesCount=0;inBoxData.map(function(item){unreadMessagesCount=unreadMessagesCount+item.unreadMessages;});setUnreadMessages(unreadMessagesCount);},[inBoxData]);return/*#__PURE__*/_jsx(\"div\",{className:\"app_wrapper\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"custom_container\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"mob_side_nav\",onClick:function onClick(){return setIsMobInbox(true);},children:/*#__PURE__*/_jsx(\"img\",{src:menu,alt:\"mob-side-nav\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"f_row chat_wrapr\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"side_nav_col \".concat(isMobInbox?\"active\":\"\"),children:[/*#__PURE__*/_jsx(\"button\",{className:\"close_nav\",onClick:function onClick(){return setIsMobInbox(false);},children:/*#__PURE__*/_jsx(\"img\",{src:close,alt:\"close\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"stick\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"title\",children:\"Chat\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"search_bar \".concat(searchActive?\"active\":\"\"),onClick:function onClick(){setSearchActive(true);},children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Search\",value:searchQuery,onChange:function onChange(e){return setSearchQuery(e.target.value.trimLeft());}}),/*#__PURE__*/_jsx(\"span\",{className:\"detect_icon_ltr\",children:/*#__PURE__*/_jsx(\"img\",{src:chatSearch,alt:\"search\"})})]}),/*#__PURE__*/_jsx(\"ul\",{className:\"chat_list\",children:searchQuery?filterInBoxData.length===0?/*#__PURE__*/_jsx(\"li\",{children:/*#__PURE__*/_jsx(\"a\",{href:\"javascript:void(0)\",className:\"chat\",children:/*#__PURE__*/_jsx(\"div\",{className:\"detail\",children:/*#__PURE__*/_jsx(\"span\",{className:\"inner_title line-1\",children:\"No Record Found\"})})})}):filterInBoxData.map(function(item){var _item$oppUserInfo2,_item$oppUserInfo3,_item$lastMsg,_item$lastMsg2,_item$lastMsg3;return/*#__PURE__*/_jsx(\"li\",{onClick:function onClick(){getRoomDetails(item);},children:/*#__PURE__*/_jsxs(\"a\",{href:\"javascript:void(0)\",className:\"chat \".concat(selectedRoomID===item.roomId?\"active\":\"\"),children:[/*#__PURE__*/_jsx(\"figure\",{className:\"u_img\",children:/*#__PURE__*/_jsx(\"img\",{src:((_item$oppUserInfo2=item.oppUserInfo)===null||_item$oppUserInfo2===void 0?void 0:_item$oppUserInfo2.image)||dummy,alt:\"img\",onError:function onError(e){var _e$target,_e$target2;if(e===null||e===void 0?void 0:(_e$target=e.target)===null||_e$target===void 0?void 0:_e$target.onerror){e.target.onerror=null;}if(e===null||e===void 0?void 0:(_e$target2=e.target)===null||_e$target2===void 0?void 0:_e$target2.src){e.target.src=dummy;}}})}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"inner_title line-1\",children:(_item$oppUserInfo3=item.oppUserInfo)===null||_item$oppUserInfo3===void 0?void 0:_item$oppUserInfo3.name}),/*#__PURE__*/_jsx(\"span\",{className:\"inner_title job line-1\",children:item.jobName}),/*#__PURE__*/_jsx(\"p\",{className:\"commn_para line-1\",children:(_item$lastMsg=item.lastMsg)===null||_item$lastMsg===void 0?void 0:_item$lastMsg.messageText}),((_item$lastMsg2=item.lastMsg)===null||_item$lastMsg2===void 0?void 0:_item$lastMsg2.messageTimestamp)&&/*#__PURE__*/_jsx(\"span\",{className:\"date_time\",children:formatDateTime((_item$lastMsg3=item.lastMsg)===null||_item$lastMsg3===void 0?void 0:_item$lastMsg3.messageTimestamp,\"inboxTime\")}),selectedRoomID===item.roomId?null:item.unreadMessages===0?null:/*#__PURE__*/_jsx(\"span\",{className:\"count\",children:item.unreadMessages})]})]})});}):(inBoxData===null||inBoxData===void 0?void 0:inBoxData.length)>0?inBoxData.map(function(item){var _item$oppUserInfo4,_item$oppUserInfo5,_item$lastMsg4,_item$lastMsg5,_item$lastMsg6,_item$lastMsg7,_item$lastMsg8,_item$lastMsg9;return/*#__PURE__*/_jsx(\"li\",{onClick:function onClick(){getRoomDetails(item);},children:/*#__PURE__*/_jsxs(\"a\",{href:\"javascript:void(0)\",className:\"chat \".concat(selectedRoomID===item.roomId?\"active\":\"\"),children:[/*#__PURE__*/_jsx(\"figure\",{className:\"u_img\",children:/*#__PURE__*/_jsx(\"img\",{src:((_item$oppUserInfo4=item.oppUserInfo)===null||_item$oppUserInfo4===void 0?void 0:_item$oppUserInfo4.image)||dummy,alt:\"img\",onError:function onError(e){var _e$target3,_e$target4;if(e===null||e===void 0?void 0:(_e$target3=e.target)===null||_e$target3===void 0?void 0:_e$target3.onerror){e.target.onerror=null;}if(e===null||e===void 0?void 0:(_e$target4=e.target)===null||_e$target4===void 0?void 0:_e$target4.src){e.target.src=dummy;}}})}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"inner_title line-1\",children:(_item$oppUserInfo5=item.oppUserInfo)===null||_item$oppUserInfo5===void 0?void 0:_item$oppUserInfo5.name}),/*#__PURE__*/_jsx(\"span\",{className:\"inner_title job line-1\",children:item.jobName}),/*#__PURE__*/_jsx(\"p\",{className:\"commn_para line-1\",children:((_item$lastMsg4=item.lastMsg)===null||_item$lastMsg4===void 0?void 0:_item$lastMsg4.messageType)===\"text\"?(_item$lastMsg5=item.lastMsg)===null||_item$lastMsg5===void 0?void 0:_item$lastMsg5.messageText:((_item$lastMsg6=item.lastMsg)===null||_item$lastMsg6===void 0?void 0:_item$lastMsg6.messageType)===\"image\"?/*#__PURE__*/_jsx(\"i\",{style:{color:\"#929292\"},children:\"Photo\"}):((_item$lastMsg7=item.lastMsg)===null||_item$lastMsg7===void 0?void 0:_item$lastMsg7.messageType)===\"video\"?/*#__PURE__*/_jsx(\"i\",{style:{color:\"#929292\"},children:\"Video\"}):\"\"}),((_item$lastMsg8=item.lastMsg)===null||_item$lastMsg8===void 0?void 0:_item$lastMsg8.messageTimestamp)&&/*#__PURE__*/_jsx(\"span\",{className:\"date_time\",children:formatDateTime((_item$lastMsg9=item.lastMsg)===null||_item$lastMsg9===void 0?void 0:_item$lastMsg9.messageTimestamp,\"inboxTime\")}),selectedRoomID===item.roomId?null:item.unreadMessages===0?null:/*#__PURE__*/_jsx(\"span\",{className:\"count\",children:item.unreadMessages})]})]})});}):props.isLoading?null:/*#__PURE__*/_jsx(\"li\",{children:/*#__PURE__*/_jsx(\"a\",{href:\"javascript:void(0)\",className:\"chat\",children:/*#__PURE__*/_jsx(\"div\",{className:\"detail\",children:/*#__PURE__*/_jsxs(\"span\",{className:\"no_record\",children:[/*#__PURE__*/_jsx(\"figure\",{children:/*#__PURE__*/_jsx(\"figure\",{className:\"no_img\",children:/*#__PURE__*/_jsx(\"img\",{src:emptyChat,alt:\"data not found\"})})}),/*#__PURE__*/_jsx(\"span\",{className:\"empty_screen_text\",children:\"You don't have any chat messages yet.\"}),/*#__PURE__*/_jsx(\"span\",{className:\"empty_screen_subtext\",children:\"Connect to your local network\"}),/*#__PURE__*/_jsx(\"button\",{className:\"empty_screen_button\",onClick:function onClick(){return props.history.push(\"/\");},children:\"View Recommended tradespeople\"})]})})})})})]})]}),isInitialLoader?null:!isInitialLoader&&(inBoxData===null||inBoxData===void 0?void 0:inBoxData.length)===0?/*#__PURE__*/_jsx(\"div\",{className:\"detail_col\",children:/*#__PURE__*/_jsx(\"div\",{className:\"flex_row tradies_row\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"no_record\",children:[/*#__PURE__*/_jsx(\"figure\",{className:\"no_img\",children:/*#__PURE__*/_jsx(\"img\",{src:noData,alt:\"data not found\"})}),/*#__PURE__*/_jsx(\"span\",{children:\"No Data Found\"})]})})}):/*#__PURE__*/_jsx(UserMessages,{roomId:selectedRoomID,roomData:roomData,isNoRecords:isNoRecords,history:props.history,isLoading:props.isLoading,inBoxData:inBoxData,setInBoxData:setInBoxData})]})]})});};export default Chat;","map":{"version":3,"sources":["/home/appinventiv/Documents/Project/tickt/web/src/pages/chat/chat.tsx"],"names":["React","useState","useEffect","dummy","chatSearch","menu","close","setLoading","unReadMessageCount","formatDateTime","noData","emptyChat","auth","createRoom","checkRoomExist","getFirebaseInboxData","stopListeningOfRoom","resetUnreadCounter","UserMessages","selectedRoomID","isFreshChatRoute","Chat","props","initializing","setInitializing","currentUser","user","setUser","inBoxData","setInBoxData","filterInBoxData","setFilterInBoxData","isNoRecords","setIsNoRecords","roomData","setRoomData","roomId","setRoomId","searchQuery","setSearchQuery","searchActive","setSearchActive","isInitialLoader","setIsInitialLoader","isMobInbox","setIsMobInbox","unreadMessages","setUnreadMessages","history","location","state","tradieId","builderId","jobName","jobId","setInitialItems","onUpdateofInbox","roomID","res","selectedRoomInfo","sortedRes","filter","item","index","hasOwnProperty","sort","x","y","lastMsg","messageTimestamp","length","ress","unshift","newRes","Array","isArray","firstKey","itemObj","find","unsubscribe","onAuthStateChanged","getRoomDetails","filteredVal","oppUserInfo","name","toLowerCase","includes","unreadMessagesCount","map","e","target","value","trimLeft","image","onerror","src","messageText","messageType","color","isLoading","push"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\n\nimport dummy from \"../../assets/images/u_placeholder.jpg\";\nimport chatSearch from \"../../assets/images/search-chat.png\";\nimport menu from \"../../assets/images/menu-line-blue.png\";\nimport close from \"../../assets/images/ic-cancel-blue.png\";\n\nimport { setLoading, unReadMessageCount } from \"../../redux/common/actions\";\nimport { formatDateTime } from \"../../utils/common\";\nimport noData from \"../../assets/images/no-search-data.png\";\nimport emptyChat from \"../../assets/images/emptyChat.png\";\n\nimport {\n  auth,\n  createRoom,\n  checkRoomExist,\n  getFirebaseInboxData,\n  stopListeningOfRoom,\n  resetUnreadCounter,\n} from \"../../services/firebase\";\n\nimport UserMessages from \"./userMessages\";\n\ninterface PropTypes {\n  builderProfile: any;\n  tradieProfileData: any;\n  isLoading: boolean;\n  history: any;\n}\n\nlet selectedRoomID = \"\";\nlet isFreshChatRoute: boolean = false;\n\nconst Chat = (props: PropTypes) => {\n  const [initializing, setInitializing] = useState<boolean>(true);\n  // firebase authenticated user details\n  const [user, setUser] = useState<any>(() => auth.currentUser);\n  const [inBoxData, setInBoxData] = useState<any>([]);\n  const [filterInBoxData, setFilterInBoxData] = useState<any>([]);\n  const [isNoRecords, setIsNoRecords] = useState<boolean>(false);\n  const [roomData, setRoomData] = useState<any>({});\n  const [roomId, setRoomId] = useState<string>(\"\");\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [searchActive, setSearchActive] = useState(false);\n  const [isInitialLoader, setIsInitialLoader] = useState(true);\n  const [isMobInbox, setIsMobInbox] = useState<boolean>(false);\n  const [unreadMessages, setUnreadMessages] = useState<number>();\n\n  const { tradieId, builderId, jobName, jobId } = props.history?.location?.state\n    ? props.history?.location?.state\n    : { tradieId: \"\", builderId: \"\", jobName: \"\", jobId: \"\" };\n  // console.log('tradieId, builderId, jobName, jobId: ', tradieId, builderId, jobName, jobId);\n\n  useEffect(() => {\n    //  console.log(\"roomId:: from didmout\", selectedRoomID);\n    (async () => {\n      setLoading(true);\n      if (tradieId && builderId && jobName && jobId) {\n        await setInitialItems();\n      } else {\n        isFreshChatRoute = true;\n      }\n      await getFirebaseInboxData(onUpdateofInbox);\n      // debugger;\n    })();\n\n    return () => {\n      // debugger;\n      stopListeningOfRoom(selectedRoomID);\n      selectedRoomID = \"\";\n    };\n  }, []);\n  useEffect(() => {\n    unReadMessageCount(unreadMessages || 0);\n  }, [unreadMessages]);\n\n  const setInitialItems = async () => {\n    const roomID: string = `${jobId}_${tradieId}_${builderId}`;\n    selectedRoomID = roomID;\n    if (await checkRoomExist(roomID)) {\n      //console.log('RoomAlreadyExist: =================>');\n      return;\n    } else {\n      await createRoom(jobId, tradieId, builderId, jobName);\n      // console.log('NewRoomCreated: ============>');\n    }\n  };\n\n  const onUpdateofInbox = async (res: any) => {\n    //  console.log(\"roomId::\", selectedRoomID);\n    let selectedRoomInfo: any = \"\";\n    const sortedRes = res.filter((item: any, index: number) => {\n      if (item.hasOwnProperty(\"lastMsg\") || item.roomId === selectedRoomID) {\n        if (item.roomId === selectedRoomID && !isFreshChatRoute) {\n          selectedRoomInfo = item;\n        } else {\n          return item;\n        }\n      }\n    });\n\n    sortedRes?.sort(function (x: any, y: any) {\n      return y.lastMsg?.messageTimestamp - x.lastMsg?.messageTimestamp;\n    });\n\n    if (sortedRes.length === 0 && !selectedRoomInfo) {\n      setIsNoRecords(true);\n      if (isInitialLoader) {\n        setIsInitialLoader(false);\n        setLoading(false);\n      }\n      return;\n    }\n    setIsNoRecords(false);\n\n    let ress: any;\n    if (selectedRoomInfo) {\n      ress = [...sortedRes];\n      ress.unshift(selectedRoomInfo);\n    }\n    // console.log('ress: ', ress, \"sortedRes\", sortedRes, \"res\", res, \"selectedRoomInfo\", selectedRoomInfo);\n    const newRes = Array.isArray(ress) && selectedRoomInfo ? ress : sortedRes;\n    setInBoxData(newRes.length === 0 ? [{ firstKey: \"emptyRes\" }] : newRes);\n    if (newRes.length > 0 && selectedRoomID === \"\") {\n      selectedRoomID = newRes[0].roomId;\n      setRoomId(newRes[0].roomId);\n      if (newRes[0] && newRes[0]?.unreadMessages > 0) {\n        newRes[0].unreadMessages = 0;\n        resetUnreadCounter(newRes[0].roomId);\n      }\n      setRoomData(newRes[0]);\n      return;\n      // fetchJobDetail(res[0].item?.jobId);\n    }\n\n    if (newRes.length > 0) {\n      let itemObj = newRes.find((x: any) => x.roomId == selectedRoomID);\n\n      if (itemObj && itemObj?.unreadMessages > 0) {\n        itemObj.unreadMessages = 0;\n        resetUnreadCounter(itemObj.roomId);\n      }\n      setRoomData(itemObj);\n    }\n  };\n\n  useEffect(() => {\n    let unsubscribe = auth.onAuthStateChanged((user) => {\n      if (user) {\n        setUser(user);\n        setIsMobInbox(false);\n      } else {\n        setUser(false);\n        setIsMobInbox(true);\n        setLoading(false);\n        setIsInitialLoader(false);\n      }\n      if (initializing) {\n        setInitializing(false);\n      }\n    });\n\n    return unsubscribe;\n  }, [initializing]);\n\n  // console.log(props.history, \"history\", roomId, \"roomId\", roomData, \"roomData\", selectedRoomID, \"selectedRoomID\", inBoxData, 'inBoxData');\n\n  const getRoomDetails = async (item: any) => {\n    stopListeningOfRoom(selectedRoomID);\n    selectedRoomID = item.roomId;\n    setRoomId(item.roomId);\n    setRoomData(item);\n    resetUnreadCounter(item.roomId);\n    // fetchEquipmentDetail(item.itemId);\n  };\n\n  useEffect(() => {\n    if (searchQuery) {\n      let filteredVal = inBoxData.filter((item: any) =>\n        item.oppUserInfo?.name\n          ?.toLowerCase()\n          ?.includes(searchQuery.toLowerCase())\n      );\n      setFilterInBoxData(filteredVal);\n    }\n    if (\n      (inBoxData.length || inBoxData[0]?.[\"firstKey\"] === \"emptyRes\") &&\n      isInitialLoader\n    ) {\n      if (inBoxData[0]?.[\"firstKey\"] === \"emptyRes\") setInBoxData([]);\n      setLoading(false);\n      setIsInitialLoader(false);\n    }\n  }, [searchQuery, inBoxData]);\n\n  useEffect(() => {\n    let unreadMessagesCount: any = 0;\n    inBoxData.map((item: any) => {\n      unreadMessagesCount = unreadMessagesCount + item.unreadMessages;\n    });\n    setUnreadMessages(unreadMessagesCount);\n  }, [inBoxData]);\n\n  return (\n    <div className=\"app_wrapper\">\n      <div className=\"custom_container\">\n        <span className=\"mob_side_nav\" onClick={() => setIsMobInbox(true)}>\n          <img src={menu} alt=\"mob-side-nav\" />\n        </span>\n        <div className=\"f_row chat_wrapr\">\n          <div className={`side_nav_col ${isMobInbox ? \"active\" : \"\"}`}>\n            <button className=\"close_nav\" onClick={() => setIsMobInbox(false)}>\n              <img src={close} alt=\"close\" />\n            </button>\n            <div className=\"stick\">\n              <span className=\"title\">Chat</span>\n\n              <div\n                className={`search_bar ${searchActive ? \"active\" : \"\"}`}\n                onClick={() => {\n                  setSearchActive(true);\n                }}\n              >\n                <input\n                  type=\"text\"\n                  placeholder=\"Search\"\n                  value={searchQuery}\n                  onChange={(e: any) =>\n                    setSearchQuery(e.target.value.trimLeft())\n                  }\n                />\n                <span className=\"detect_icon_ltr\">\n                  <img src={chatSearch} alt=\"search\" />\n                </span>\n              </div>\n              <ul className=\"chat_list\">\n                {searchQuery ? (\n                  filterInBoxData.length === 0 ? (\n                    <li>\n                      <a href=\"javascript:void(0)\" className=\"chat\">\n                        <div className=\"detail\">\n                          <span className=\"inner_title line-1\">\n                            No Record Found\n                          </span>\n                        </div>\n                      </a>\n                    </li>\n                  ) : (\n                    filterInBoxData.map((item: any) => {\n                      return (\n                        <li\n                          onClick={() => {\n                            getRoomDetails(item);\n                          }}\n                        >\n                          <a\n                            href=\"javascript:void(0)\"\n                            className={`chat ${\n                              selectedRoomID === item.roomId ? \"active\" : \"\"\n                            }`}\n                          >\n                            <figure className=\"u_img\">\n                              <img\n                                src={item.oppUserInfo?.image || dummy}\n                                alt=\"img\"\n                                onError={(e: any) => {\n                                  if (e?.target?.onerror) {\n                                    e.target.onerror = null;\n                                  }\n                                  if (e?.target?.src) {\n                                    e.target.src = dummy;\n                                  }\n                                }}\n                              />\n                            </figure>\n                            <div className=\"detail\">\n                              <span className=\"inner_title line-1\">\n                                {item.oppUserInfo?.name}\n                              </span>\n                              <span className=\"inner_title job line-1\">\n                                {item.jobName}\n                              </span>\n                              <p className=\"commn_para line-1\">\n                                {item.lastMsg?.messageText}\n                              </p>\n                              {item.lastMsg?.messageTimestamp && (\n                                <span className=\"date_time\">\n                                  {formatDateTime(\n                                    item.lastMsg?.messageTimestamp,\n                                    \"inboxTime\"\n                                  )}\n                                </span>\n                              )}\n                              {selectedRoomID ===\n                              item.roomId ? null : item.unreadMessages ===\n                                0 ? null : (\n                                <span className=\"count\">\n                                  {item.unreadMessages}\n                                </span>\n                              )}\n                            </div>\n                          </a>\n                        </li>\n                      );\n                    })\n                  )\n                ) : inBoxData?.length > 0 ? (\n                  inBoxData.map((item: any) => {\n                    return (\n                      <li\n                        onClick={() => {\n                          getRoomDetails(item);\n                        }}\n                      >\n                        <a\n                          href=\"javascript:void(0)\"\n                          className={`chat ${\n                            selectedRoomID === item.roomId ? \"active\" : \"\"\n                          }`}\n                        >\n                          <figure className=\"u_img\">\n                            <img\n                              src={item.oppUserInfo?.image || dummy}\n                              alt=\"img\"\n                              onError={(e: any) => {\n                                if (e?.target?.onerror) {\n                                  e.target.onerror = null;\n                                }\n                                if (e?.target?.src) {\n                                  e.target.src = dummy;\n                                }\n                              }}\n                            />\n                          </figure>\n                          <div className=\"detail\">\n                            <span className=\"inner_title line-1\">\n                              {item.oppUserInfo?.name}\n                            </span>\n                            <span className=\"inner_title job line-1\">\n                              {item.jobName}\n                            </span>\n                            <p className=\"commn_para line-1\">\n                              {item.lastMsg?.messageType === \"text\" ? (\n                                item.lastMsg?.messageText\n                              ) : item.lastMsg?.messageType === \"image\" ? (\n                                <i style={{ color: \"#929292\" }}>Photo</i>\n                              ) : item.lastMsg?.messageType === \"video\" ? (\n                                <i style={{ color: \"#929292\" }}>Video</i>\n                              ) : (\n                                \"\"\n                              )}\n                            </p>\n                            {item.lastMsg?.messageTimestamp && (\n                              <span className=\"date_time\">\n                                {formatDateTime(\n                                  item.lastMsg?.messageTimestamp,\n                                  \"inboxTime\"\n                                )}\n                              </span>\n                            )}\n                            {selectedRoomID ===\n                            item.roomId ? null : item.unreadMessages ===\n                              0 ? null : (\n                              <span className=\"count\">\n                                {item.unreadMessages}\n                              </span>\n                            )}\n                          </div>\n                        </a>\n                      </li>\n                    );\n                  })\n                ) : props.isLoading ? null : (\n                  <li>\n                    <a href=\"javascript:void(0)\" className=\"chat\">\n                      <div className=\"detail\">\n                        <span className=\"no_record\">\n                          <figure>\n                            <figure className=\"no_img\">\n                              <img src={emptyChat} alt=\"data not found\" />\n                            </figure>\n                          </figure>\n\n                          <span className=\"empty_screen_text\">\n                            You don't have any chat messages yet.\n                          </span>\n                          <span className=\"empty_screen_subtext\">\n                            Connect to your local network\n                          </span>\n                          <button\n                            className=\"empty_screen_button\"\n                            onClick={() => props.history.push(\"/\")}\n                          >\n                            View Recommended tradespeople\n                          </button>\n                        </span>\n                      </div>\n                    </a>\n                  </li>\n                )}\n              </ul>\n            </div>\n          </div>\n          {/* {(isInitialLoader || inBoxData?.length === 0) ? null : */}\n          {isInitialLoader ? null : !isInitialLoader &&\n            inBoxData?.length === 0 ? (\n            <div className=\"detail_col\">\n              <div className=\"flex_row tradies_row\">\n                <div className=\"no_record\">\n                  <figure className=\"no_img\">\n                    <img src={noData} alt=\"data not found\" />\n                  </figure>\n                  <span>No Data Found</span>\n                </div>\n              </div>\n            </div>\n          ) : (\n            <UserMessages\n              roomId={selectedRoomID}\n              roomData={roomData}\n              isNoRecords={isNoRecords}\n              history={props.history}\n              isLoading={props.isLoading}\n              inBoxData={inBoxData}\n              setInBoxData={setInBoxData}\n            />\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default Chat;\n"]},"metadata":{},"sourceType":"module"}