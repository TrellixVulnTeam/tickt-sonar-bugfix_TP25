{"ast":null,"code":"import _toConsumableArray from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from'react';import dummy from'../../assets/images/u_placeholder.jpg';import chatSearch from'../../assets/images/search-chat.png';import menu from'../../assets/images/menu-line-blue.png';import close from'../../assets/images/ic-cancel-blue.png';import{setLoading}from'../../redux/common/actions';import{formatDateTime}from'../../utils/common';import noData from'../../assets/images/no-search-data.png';import{auth,createRoom,checkRoomExist,getFirebaseInboxData,stopListeningOfRoom,resetUnreadCounter}from'../../services/firebase';import UserMessages from'./userMessages';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var selectedRoomID='';var isFreshChatRoute=false;var Chat=function Chat(props){var _props$history,_props$history$locati,_props$history2,_props$history2$locat;var _useState=useState(true),_useState2=_slicedToArray(_useState,2),initializing=_useState2[0],setInitializing=_useState2[1];// firebase authenticated user details\nvar _useState3=useState(function(){return auth.currentUser;}),_useState4=_slicedToArray(_useState3,2),user=_useState4[0],setUser=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),inBoxData=_useState6[0],setInBoxData=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),filterInBoxData=_useState8[0],setFilterInBoxData=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),isNoRecords=_useState10[0],setIsNoRecords=_useState10[1];var _useState11=useState({}),_useState12=_slicedToArray(_useState11,2),roomData=_useState12[0],setRoomData=_useState12[1];var _useState13=useState(''),_useState14=_slicedToArray(_useState13,2),roomId=_useState14[0],setRoomId=_useState14[1];var _useState15=useState(''),_useState16=_slicedToArray(_useState15,2),searchQuery=_useState16[0],setSearchQuery=_useState16[1];var _useState17=useState(false),_useState18=_slicedToArray(_useState17,2),searchActive=_useState18[0],setSearchActive=_useState18[1];var _useState19=useState(true),_useState20=_slicedToArray(_useState19,2),isInitialLoader=_useState20[0],setIsInitialLoader=_useState20[1];var _useState21=useState(false),_useState22=_slicedToArray(_useState21,2),isMobInbox=_useState22[0],setIsMobInbox=_useState22[1];var _ref=((_props$history=props.history)===null||_props$history===void 0?void 0:(_props$history$locati=_props$history.location)===null||_props$history$locati===void 0?void 0:_props$history$locati.state)?(_props$history2=props.history)===null||_props$history2===void 0?void 0:(_props$history2$locat=_props$history2.location)===null||_props$history2$locat===void 0?void 0:_props$history2$locat.state:{tradieId:'',builderId:'',jobName:'',jobId:''},tradieId=_ref.tradieId,builderId=_ref.builderId,jobName=_ref.jobName,jobId=_ref.jobId;console.log('tradieId, builderId, jobName, jobId: ',tradieId,builderId,jobName,jobId);useEffect(function(){console.log(\"roomId:: from didmout\",selectedRoomID);_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setLoading(true);if(!(tradieId&&builderId&&jobName&&jobId)){_context.next=6;break;}_context.next=4;return setInitialItems();case 4:_context.next=7;break;case 6:isFreshChatRoute=true;case 7:_context.next=9;return getFirebaseInboxData(onUpdateofInbox);case 9:case\"end\":return _context.stop();}}},_callee);}))();return function(){// debugger;\nstopListeningOfRoom(selectedRoomID);selectedRoomID='';};},[]);var setInitialItems=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var roomID;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:roomID=\"\".concat(jobId,\"_\").concat(tradieId,\"_\").concat(builderId);selectedRoomID=roomID;_context2.next=4;return checkRoomExist(roomID);case 4:if(!_context2.sent){_context2.next=9;break;}console.log('RoomAlreadyExist: =================>');return _context2.abrupt(\"return\");case 9:_context2.next=11;return createRoom(jobId,tradieId,builderId,jobName);case 11:console.log('NewRoomCreated: ============>');case 12:case\"end\":return _context2.stop();}}},_callee2);}));return function setInitialItems(){return _ref3.apply(this,arguments);};}();var onUpdateofInbox=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(res){var selectedRoomInfo,sortedRes,ress,newRes,_newRes$,itemObj;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:console.log(\"roomId::\",selectedRoomID);selectedRoomInfo='';sortedRes=res.filter(function(item,index){if(item.hasOwnProperty('lastMsg')||item.roomId===selectedRoomID){if(item.roomId===selectedRoomID&&!isFreshChatRoute){selectedRoomInfo=item;}else{return item;}}});sortedRes===null||sortedRes===void 0?void 0:sortedRes.sort(function(x,y){var _y$lastMsg,_x$lastMsg;return((_y$lastMsg=y.lastMsg)===null||_y$lastMsg===void 0?void 0:_y$lastMsg.messageTimestamp)-((_x$lastMsg=x.lastMsg)===null||_x$lastMsg===void 0?void 0:_x$lastMsg.messageTimestamp);});if(!(sortedRes.length===0&&!selectedRoomInfo)){_context3.next=8;break;}setIsNoRecords(true);if(isInitialLoader){setIsInitialLoader(false);setLoading(false);}return _context3.abrupt(\"return\");case 8:setIsNoRecords(false);if(selectedRoomInfo){ress=_toConsumableArray(sortedRes);ress.unshift(selectedRoomInfo);}console.log('ress: ',ress,\"sortedRes\",sortedRes,\"res\",res,\"selectedRoomInfo\",selectedRoomInfo);newRes=Array.isArray(ress)&&selectedRoomInfo?ress:sortedRes;setInBoxData(newRes.length===0?[{'firstKey':'emptyRes'}]:newRes);if(!(newRes.length>0&&selectedRoomID==='')){_context3.next=19;break;}selectedRoomID=newRes[0].roomId;setRoomId(newRes[0].roomId);if(newRes[0]&&((_newRes$=newRes[0])===null||_newRes$===void 0?void 0:_newRes$.unreadMessages)>0){newRes[0].unreadMessages=0;resetUnreadCounter(newRes[0].roomId);}setRoomData(newRes[0]);return _context3.abrupt(\"return\");case 19:if(newRes.length>0){itemObj=newRes.find(function(x){return x.roomId==selectedRoomID;});if(itemObj&&(itemObj===null||itemObj===void 0?void 0:itemObj.unreadMessages)>0){itemObj.unreadMessages=0;resetUnreadCounter(itemObj.roomId);}setRoomData(itemObj);}case 20:case\"end\":return _context3.stop();}}},_callee3);}));return function onUpdateofInbox(_x){return _ref4.apply(this,arguments);};}();console.log('user: ',user);useEffect(function(){var unsubscribe=auth.onAuthStateChanged(function(user){if(user){setUser(user);setIsMobInbox(false);}else{setUser(false);setIsMobInbox(true);setLoading(false);setIsInitialLoader(false);}if(initializing){setInitializing(false);}});return unsubscribe;},[initializing]);console.log(props.history,\"history\",roomId,\"roomId\",roomData,\"roomData\",selectedRoomID,\"selectedRoomID\",inBoxData,'inBoxData');var getRoomDetails=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(item){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:stopListeningOfRoom(selectedRoomID);selectedRoomID=item.roomId;setRoomId(item.roomId);setRoomData(item);resetUnreadCounter(item.roomId);// fetchEquipmentDetail(item.itemId);\ncase 5:case\"end\":return _context4.stop();}}},_callee4);}));return function getRoomDetails(_x2){return _ref5.apply(this,arguments);};}();useEffect(function(){var _inBoxData$;if(searchQuery){var filteredVal=inBoxData.filter(function(item){var _item$oppUserInfo,_item$oppUserInfo$nam,_item$oppUserInfo$nam2;return(_item$oppUserInfo=item.oppUserInfo)===null||_item$oppUserInfo===void 0?void 0:(_item$oppUserInfo$nam=_item$oppUserInfo.name)===null||_item$oppUserInfo$nam===void 0?void 0:(_item$oppUserInfo$nam2=_item$oppUserInfo$nam.toLowerCase())===null||_item$oppUserInfo$nam2===void 0?void 0:_item$oppUserInfo$nam2.includes(searchQuery.toLowerCase());});setFilterInBoxData(filteredVal);}if((inBoxData.length||((_inBoxData$=inBoxData[0])===null||_inBoxData$===void 0?void 0:_inBoxData$['firstKey'])==='emptyRes')&&isInitialLoader){var _inBoxData$2;if(((_inBoxData$2=inBoxData[0])===null||_inBoxData$2===void 0?void 0:_inBoxData$2['firstKey'])==='emptyRes')setInBoxData([]);setLoading(false);setIsInitialLoader(false);}},[searchQuery,inBoxData]);return/*#__PURE__*/_jsx(\"div\",{className:\"app_wrapper\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"custom_container\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"mob_side_nav\",onClick:function onClick(){return setIsMobInbox(true);},children:/*#__PURE__*/_jsx(\"img\",{src:menu,alt:\"mob-side-nav\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"f_row chat_wrapr\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"side_nav_col \".concat(isMobInbox?'active':''),children:[/*#__PURE__*/_jsx(\"button\",{className:\"close_nav\",onClick:function onClick(){return setIsMobInbox(false);},children:/*#__PURE__*/_jsx(\"img\",{src:close,alt:\"close\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"stick\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"title\",children:\"Chat\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"search_bar \".concat(searchActive?'active':''),onClick:function onClick(){setSearchActive(true);},children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Search\",value:searchQuery,onChange:function onChange(e){return setSearchQuery(e.target.value.trimLeft());}}),/*#__PURE__*/_jsx(\"span\",{className:\"detect_icon_ltr\",children:/*#__PURE__*/_jsx(\"img\",{src:chatSearch,alt:\"search\"})})]}),/*#__PURE__*/_jsx(\"ul\",{className:\"chat_list\",children:searchQuery?filterInBoxData.length===0?/*#__PURE__*/_jsx(\"li\",{children:/*#__PURE__*/_jsx(\"a\",{href:\"javascript:void(0)\",className:\"chat\",children:/*#__PURE__*/_jsx(\"div\",{className:\"detail\",children:/*#__PURE__*/_jsx(\"span\",{className:\"inner_title line-1\",children:\"No Record Found\"})})})}):filterInBoxData.map(function(item){var _item$oppUserInfo2,_item$oppUserInfo3,_item$lastMsg,_item$lastMsg2,_item$lastMsg3;return/*#__PURE__*/_jsx(\"li\",{onClick:function onClick(){getRoomDetails(item);},children:/*#__PURE__*/_jsxs(\"a\",{href:\"javascript:void(0)\",className:\"chat \".concat(selectedRoomID===item.roomId?'active':''),children:[/*#__PURE__*/_jsx(\"figure\",{className:\"u_img\",children:/*#__PURE__*/_jsx(\"img\",{src:((_item$oppUserInfo2=item.oppUserInfo)===null||_item$oppUserInfo2===void 0?void 0:_item$oppUserInfo2.image)||dummy,alt:\"img\",onError:function onError(e){var _e$target,_e$target2;if(e===null||e===void 0?void 0:(_e$target=e.target)===null||_e$target===void 0?void 0:_e$target.onerror){e.target.onerror=null;}if(e===null||e===void 0?void 0:(_e$target2=e.target)===null||_e$target2===void 0?void 0:_e$target2.src){e.target.src=dummy;}}})}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"inner_title line-1\",children:(_item$oppUserInfo3=item.oppUserInfo)===null||_item$oppUserInfo3===void 0?void 0:_item$oppUserInfo3.name}),/*#__PURE__*/_jsx(\"span\",{className:\"inner_title job line-1\",children:item.jobName}),/*#__PURE__*/_jsx(\"p\",{className:\"commn_para line-1\",children:(_item$lastMsg=item.lastMsg)===null||_item$lastMsg===void 0?void 0:_item$lastMsg.messageText}),((_item$lastMsg2=item.lastMsg)===null||_item$lastMsg2===void 0?void 0:_item$lastMsg2.messageTimestamp)&&/*#__PURE__*/_jsx(\"span\",{className:\"date_time\",children:formatDateTime((_item$lastMsg3=item.lastMsg)===null||_item$lastMsg3===void 0?void 0:_item$lastMsg3.messageTimestamp,'inboxTime')}),selectedRoomID===item.roomId?null:item.unreadMessages===0?null:/*#__PURE__*/_jsx(\"span\",{className:\"count\",children:item.unreadMessages})]})]})});}):(inBoxData===null||inBoxData===void 0?void 0:inBoxData.length)>0?inBoxData.map(function(item){var _item$oppUserInfo4,_item$oppUserInfo5,_item$lastMsg4,_item$lastMsg5,_item$lastMsg6,_item$lastMsg7,_item$lastMsg8,_item$lastMsg9;return/*#__PURE__*/_jsx(\"li\",{onClick:function onClick(){getRoomDetails(item);},children:/*#__PURE__*/_jsxs(\"a\",{href:\"javascript:void(0)\",className:\"chat \".concat(selectedRoomID===item.roomId?'active':''),children:[/*#__PURE__*/_jsx(\"figure\",{className:\"u_img\",children:/*#__PURE__*/_jsx(\"img\",{src:((_item$oppUserInfo4=item.oppUserInfo)===null||_item$oppUserInfo4===void 0?void 0:_item$oppUserInfo4.image)||dummy,alt:\"img\",onError:function onError(e){var _e$target3,_e$target4;if(e===null||e===void 0?void 0:(_e$target3=e.target)===null||_e$target3===void 0?void 0:_e$target3.onerror){e.target.onerror=null;}if(e===null||e===void 0?void 0:(_e$target4=e.target)===null||_e$target4===void 0?void 0:_e$target4.src){e.target.src=dummy;}}})}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"inner_title line-1\",children:(_item$oppUserInfo5=item.oppUserInfo)===null||_item$oppUserInfo5===void 0?void 0:_item$oppUserInfo5.name}),/*#__PURE__*/_jsx(\"span\",{className:\"inner_title job line-1\",children:item.jobName}),/*#__PURE__*/_jsx(\"p\",{className:\"commn_para line-1\",children:((_item$lastMsg4=item.lastMsg)===null||_item$lastMsg4===void 0?void 0:_item$lastMsg4.messageType)==='text'?(_item$lastMsg5=item.lastMsg)===null||_item$lastMsg5===void 0?void 0:_item$lastMsg5.messageText:((_item$lastMsg6=item.lastMsg)===null||_item$lastMsg6===void 0?void 0:_item$lastMsg6.messageType)==='image'?/*#__PURE__*/_jsx(\"i\",{style:{color:'#929292'},children:\"Photo\"}):((_item$lastMsg7=item.lastMsg)===null||_item$lastMsg7===void 0?void 0:_item$lastMsg7.messageType)==='video'?/*#__PURE__*/_jsx(\"i\",{style:{color:'#929292'},children:\"Video\"}):''}),((_item$lastMsg8=item.lastMsg)===null||_item$lastMsg8===void 0?void 0:_item$lastMsg8.messageTimestamp)&&/*#__PURE__*/_jsx(\"span\",{className:\"date_time\",children:formatDateTime((_item$lastMsg9=item.lastMsg)===null||_item$lastMsg9===void 0?void 0:_item$lastMsg9.messageTimestamp,'inboxTime')}),selectedRoomID===item.roomId?null:item.unreadMessages===0?null:/*#__PURE__*/_jsx(\"span\",{className:\"count\",children:item.unreadMessages})]})]})});}):props.isLoading?null:/*#__PURE__*/_jsx(\"li\",{children:/*#__PURE__*/_jsx(\"a\",{href:\"javascript:void(0)\",className:\"chat\",children:/*#__PURE__*/_jsx(\"div\",{className:\"detail\",children:/*#__PURE__*/_jsx(\"span\",{className:\"inner_title line-1\",children:\"No Record Found\"})})})})})]})]}),isInitialLoader?null:!isInitialLoader&&(inBoxData===null||inBoxData===void 0?void 0:inBoxData.length)===0?/*#__PURE__*/_jsx(\"div\",{className:\"detail_col\",children:/*#__PURE__*/_jsx(\"div\",{className:\"flex_row tradies_row\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"no_record\",children:[/*#__PURE__*/_jsx(\"figure\",{className:\"no_img\",children:/*#__PURE__*/_jsx(\"img\",{src:noData,alt:\"data not found\"})}),/*#__PURE__*/_jsx(\"span\",{children:\"No Data Found\"})]})})}):/*#__PURE__*/_jsx(UserMessages,{roomId:selectedRoomID,roomData:roomData,isNoRecords:isNoRecords,history:props.history,isLoading:props.isLoading,inBoxData:inBoxData,setInBoxData:setInBoxData})]})]})});};export default Chat;","map":{"version":3,"sources":["/home/appinventiv/Documents/Project/tickt/web/src/pages/chat/chat.tsx"],"names":["React","useState","useEffect","dummy","chatSearch","menu","close","setLoading","formatDateTime","noData","auth","createRoom","checkRoomExist","getFirebaseInboxData","stopListeningOfRoom","resetUnreadCounter","UserMessages","selectedRoomID","isFreshChatRoute","Chat","props","initializing","setInitializing","currentUser","user","setUser","inBoxData","setInBoxData","filterInBoxData","setFilterInBoxData","isNoRecords","setIsNoRecords","roomData","setRoomData","roomId","setRoomId","searchQuery","setSearchQuery","searchActive","setSearchActive","isInitialLoader","setIsInitialLoader","isMobInbox","setIsMobInbox","history","location","state","tradieId","builderId","jobName","jobId","console","log","setInitialItems","onUpdateofInbox","roomID","res","selectedRoomInfo","sortedRes","filter","item","index","hasOwnProperty","sort","x","y","lastMsg","messageTimestamp","length","ress","unshift","newRes","Array","isArray","unreadMessages","itemObj","find","unsubscribe","onAuthStateChanged","getRoomDetails","filteredVal","oppUserInfo","name","toLowerCase","includes","e","target","value","trimLeft","map","image","onerror","src","messageText","messageType","color","isLoading"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\n\nimport dummy from '../../assets/images/u_placeholder.jpg';\nimport chatSearch from '../../assets/images/search-chat.png';\nimport menu from '../../assets/images/menu-line-blue.png';\nimport close from '../../assets/images/ic-cancel-blue.png';\n\nimport { setLoading } from '../../redux/common/actions';\nimport { formatDateTime } from '../../utils/common';\nimport noData from '../../assets/images/no-search-data.png';\n\nimport {\n    auth,\n    createRoom,\n    checkRoomExist,\n    getFirebaseInboxData,\n    stopListeningOfRoom,\n    resetUnreadCounter,\n} from '../../services/firebase';\n\nimport UserMessages from './userMessages';\n\ninterface PropTypes {\n    builderProfile: any,\n    tradieProfileData: any,\n    isLoading: boolean,\n    history: any,\n}\n\nlet selectedRoomID = '';\nlet isFreshChatRoute: boolean = false;\n\nconst Chat = (props: PropTypes) => {\n    const [initializing, setInitializing] = useState<boolean>(true);\n    // firebase authenticated user details\n    const [user, setUser] = useState<any>(() => auth.currentUser);\n    const [inBoxData, setInBoxData] = useState<any>([]);\n    const [filterInBoxData, setFilterInBoxData] = useState<any>([]);\n    const [isNoRecords, setIsNoRecords] = useState<boolean>(false);\n    const [roomData, setRoomData] = useState<any>({});\n    const [roomId, setRoomId] = useState<string>('');\n    const [searchQuery, setSearchQuery] = useState('');\n    const [searchActive, setSearchActive] = useState(false);\n    const [isInitialLoader, setIsInitialLoader] = useState(true);\n    const [isMobInbox, setIsMobInbox] = useState<boolean>(false);\n\n    const { tradieId, builderId, jobName, jobId } = props.history?.location?.state ? props.history?.location?.state : { tradieId: '', builderId: '', jobName: '', jobId: '' };\n    console.log('tradieId, builderId, jobName, jobId: ', tradieId, builderId, jobName, jobId);\n\n    useEffect(() => {\n        console.log(\"roomId:: from didmout\", selectedRoomID);\n        (async () => {\n            setLoading(true);\n            if (tradieId && builderId && jobName && jobId) {\n                await setInitialItems();\n            } else {\n                isFreshChatRoute = true;\n            }\n            await getFirebaseInboxData(onUpdateofInbox);\n            // debugger;\n        })();\n\n        return () => {\n            // debugger;\n            stopListeningOfRoom(selectedRoomID);\n            selectedRoomID = '';\n        }\n    }, []);\n\n    const setInitialItems = async () => {\n        const roomID: string = `${jobId}_${tradieId}_${builderId}`;\n        selectedRoomID = roomID;\n        if (await checkRoomExist(roomID)) {\n            console.log('RoomAlreadyExist: =================>');\n            return;\n        } else {\n            await createRoom(jobId, tradieId, builderId, jobName);\n            console.log('NewRoomCreated: ============>');\n        }\n    }\n\n    const onUpdateofInbox = async (res: any) => {\n        console.log(\"roomId::\", selectedRoomID);\n        let selectedRoomInfo: any = '';\n        const sortedRes = res.filter((item: any, index: number) => {\n            if (item.hasOwnProperty('lastMsg') || item.roomId === selectedRoomID) {\n                if (item.roomId === selectedRoomID && !isFreshChatRoute) {\n                    selectedRoomInfo = item;\n                } else {\n                    return item;\n                }\n            }\n        });\n\n        sortedRes?.sort(function (x: any, y: any) {\n            return y.lastMsg?.messageTimestamp - x.lastMsg?.messageTimestamp;\n        });\n\n        if (sortedRes.length === 0 && !selectedRoomInfo) {\n            setIsNoRecords(true);\n            if (isInitialLoader) {\n                setIsInitialLoader(false);\n                setLoading(false);\n            }\n            return;\n        }\n        setIsNoRecords(false);\n\n        let ress: any;\n        if (selectedRoomInfo) {\n            ress = [...sortedRes];\n            ress.unshift(selectedRoomInfo);\n        }\n        console.log('ress: ', ress, \"sortedRes\", sortedRes, \"res\", res, \"selectedRoomInfo\", selectedRoomInfo);\n        const newRes = (Array.isArray(ress) && selectedRoomInfo) ? ress : sortedRes;\n        setInBoxData(newRes.length === 0 ? [{ 'firstKey': 'emptyRes' }] : newRes);\n        if (newRes.length > 0 && selectedRoomID === '') {\n            selectedRoomID = newRes[0].roomId;\n            setRoomId(newRes[0].roomId);\n            if (newRes[0] && newRes[0]?.unreadMessages > 0) {\n                newRes[0].unreadMessages = 0;\n                resetUnreadCounter(newRes[0].roomId);\n            }\n            setRoomData(newRes[0]);\n            return;\n            // fetchJobDetail(res[0].item?.jobId);\n        }\n\n        if (newRes.length > 0) {\n            let itemObj = newRes.find((x: any) => x.roomId == selectedRoomID);\n\n            if (itemObj && itemObj?.unreadMessages > 0) {\n                itemObj.unreadMessages = 0;\n                resetUnreadCounter(itemObj.roomId);\n            }\n            setRoomData(itemObj);\n        }\n    }\n\n    console.log('user: ', user);\n\n    useEffect(() => {\n        let unsubscribe = auth.onAuthStateChanged(user => {\n            if (user) {\n                setUser(user);\n                setIsMobInbox(false);\n            } else {\n                setUser(false);\n                setIsMobInbox(true);\n                setLoading(false);\n                setIsInitialLoader(false);\n            }\n            if (initializing) {\n                setInitializing(false);\n            }\n        });\n\n        return unsubscribe;\n    }, [initializing]);\n\n    console.log(props.history, \"history\", roomId, \"roomId\", roomData, \"roomData\", selectedRoomID, \"selectedRoomID\", inBoxData, 'inBoxData');\n\n    const getRoomDetails = async (item: any) => {\n        stopListeningOfRoom(selectedRoomID);\n        selectedRoomID = item.roomId;\n        setRoomId(item.roomId);\n        setRoomData(item);\n        resetUnreadCounter(item.roomId);\n        // fetchEquipmentDetail(item.itemId);\n    }\n\n    useEffect(() => {\n        if (searchQuery) {\n            let filteredVal = inBoxData.filter((item: any) => item.oppUserInfo?.name?.toLowerCase()?.includes(searchQuery.toLowerCase()));\n            setFilterInBoxData(filteredVal);\n        }\n        if ((inBoxData.length || inBoxData[0]?.['firstKey'] === 'emptyRes') && isInitialLoader) {\n            if (inBoxData[0]?.['firstKey'] === 'emptyRes') setInBoxData([]);\n            setLoading(false);\n            setIsInitialLoader(false);\n        }\n    }, [searchQuery, inBoxData]);\n\n    return (\n        <div className=\"app_wrapper\">\n            <div className=\"custom_container\">\n                <span className=\"mob_side_nav\" onClick={() => setIsMobInbox(true)}>\n                    <img src={menu} alt=\"mob-side-nav\" />\n                </span>\n                <div className=\"f_row chat_wrapr\">\n                    <div className={`side_nav_col ${isMobInbox ? 'active' : ''}`}>\n                        <button className=\"close_nav\" onClick={() => setIsMobInbox(false)}>\n                            <img src={close} alt=\"close\" />\n                        </button>\n                        <div className=\"stick\">\n                            <span className=\"title\">Chat</span>\n                            <div className={`search_bar ${searchActive ? 'active' : ''}`} onClick={() => { setSearchActive(true) }}>\n                                <input type=\"text\" placeholder=\"Search\" value={searchQuery} onChange={(e: any) => setSearchQuery(e.target.value.trimLeft())} />\n                                <span className=\"detect_icon_ltr\">\n                                    <img src={chatSearch} alt=\"search\" />\n                                </span>\n                            </div>\n                            <ul className=\"chat_list\">\n                                {searchQuery ? filterInBoxData.length === 0 ? (\n                                    <li>\n                                        <a href=\"javascript:void(0)\" className=\"chat\">\n                                            <div className=\"detail\">\n                                                <span className=\"inner_title line-1\">No Record Found</span>\n                                            </div>\n                                        </a>\n                                    </li>\n                                ) : filterInBoxData.map((item: any) => {\n                                    return (\n                                        <li onClick={() => { getRoomDetails(item) }}>\n                                            <a href=\"javascript:void(0)\" className={`chat ${selectedRoomID === item.roomId ? 'active' : ''}`}>\n                                                <figure className=\"u_img\">\n                                                    <img\n                                                        src={item.oppUserInfo?.image || dummy}\n                                                        alt=\"img\"\n                                                        onError={(e: any) => {\n                                                            if (e?.target?.onerror) {\n                                                                e.target.onerror = null;\n                                                            }\n                                                            if (e?.target?.src) {\n                                                                e.target.src = dummy;\n                                                            }\n                                                        }}\n                                                    />\n                                                </figure>\n                                                <div className=\"detail\">\n                                                    <span className=\"inner_title line-1\">{item.oppUserInfo?.name}</span>\n                                                    <span className=\"inner_title job line-1\">{item.jobName}</span>\n                                                    <p className=\"commn_para line-1\">{item.lastMsg?.messageText}</p>\n                                                    {item.lastMsg?.messageTimestamp && <span className=\"date_time\">{formatDateTime(item.lastMsg?.messageTimestamp, 'inboxTime')}</span>}\n                                                    {(selectedRoomID === item.roomId) ? null : item.unreadMessages === 0 ? null : <span className=\"count\">{item.unreadMessages}</span>}\n                                                </div>\n                                            </a>\n                                        </li>\n                                    )\n                                }) : inBoxData?.length > 0 ? inBoxData.map((item: any) => {\n                                    return (\n                                        <li onClick={() => { getRoomDetails(item) }}>\n                                            <a href=\"javascript:void(0)\" className={`chat ${selectedRoomID === item.roomId ? 'active' : ''}`}>\n                                                <figure className=\"u_img\">\n                                                    <img\n                                                        src={item.oppUserInfo?.image || dummy}\n                                                        alt=\"img\"\n                                                        onError={(e: any) => {\n                                                            if (e?.target?.onerror) {\n                                                                e.target.onerror = null;\n                                                            }\n                                                            if (e?.target?.src) {\n                                                                e.target.src = dummy;\n                                                            }\n                                                        }}\n                                                    />\n                                                </figure>\n                                                <div className=\"detail\">\n                                                    <span className=\"inner_title line-1\">{item.oppUserInfo?.name}</span>\n                                                    <span className=\"inner_title job line-1\">{item.jobName}</span>\n                                                    <p className=\"commn_para line-1\">{item.lastMsg?.messageType === 'text' ? item.lastMsg?.messageText : item.lastMsg?.messageType === 'image' ? <i style={{ color: '#929292' }}>Photo</i> : item.lastMsg?.messageType === 'video' ? <i style={{ color: '#929292' }}>Video</i> : ''}</p>\n                                                    {item.lastMsg?.messageTimestamp && <span className=\"date_time\">{formatDateTime(item.lastMsg?.messageTimestamp, 'inboxTime')}</span>}\n                                                    {(selectedRoomID === item.roomId) ? null : item.unreadMessages === 0 ? null : <span className=\"count\">{item.unreadMessages}</span>}\n                                                </div>\n                                            </a>\n                                        </li>\n                                    )\n                                }) : props.isLoading ? null : (\n                                    <li>\n                                        <a href=\"javascript:void(0)\" className=\"chat\">\n                                            <div className=\"detail\">\n                                                <span className=\"inner_title line-1\">No Record Found</span>\n                                            </div>\n                                        </a>\n                                    </li>\n                                )}\n                            </ul>\n                        </div>\n                    </div>\n                    {/* {(isInitialLoader || inBoxData?.length === 0) ? null : */}\n                    {isInitialLoader ? null :\n                        (!isInitialLoader && inBoxData?.length === 0) ?\n                            <div className=\"detail_col\">\n                                <div className=\"flex_row tradies_row\">\n                                    <div className=\"no_record\">\n                                        <figure className=\"no_img\">\n                                            <img src={noData} alt=\"data not found\" />\n                                        </figure>\n                                        <span>No Data Found</span>\n                                    </div>\n                                </div>\n                            </div> :\n                            <UserMessages\n                                roomId={selectedRoomID}\n                                roomData={roomData}\n                                isNoRecords={isNoRecords}\n                                history={props.history}\n                                isLoading={props.isLoading}\n                                inBoxData={inBoxData}\n                                setInBoxData={setInBoxData}\n                            />\n                    }\n                </div>\n            </div>\n        </div >\n    )\n}\n\nexport default Chat;"]},"metadata":{},"sourceType":"module"}