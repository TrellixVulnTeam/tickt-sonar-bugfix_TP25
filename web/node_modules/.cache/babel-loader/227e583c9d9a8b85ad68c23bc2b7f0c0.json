{"ast":null,"code":"import _objectSpread from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import{get}from'lodash';import{setShowToast}from'../redux/common/actions';import storageService from'../utils/storageService';import{urlFor}from'./Urls';import Constants from'../utils/constants';import*as moment from'moment';import'moment-timezone';var NetworkOps=/*#__PURE__*/function(){function NetworkOps(){var _this=this;_classCallCheck(this,NetworkOps);this.postToJson=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(service,data){var JSONData;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;JSONData=JSON.stringify(data);return _context.abrupt(\"return\",_this.postRaw(service,JSONData));case 5:_context.prev=5;_context.t0=_context[\"catch\"](0);throw _context.t0;case 8:case\"end\":return _context.stop();}}},_callee,null,[[0,5]]);}));return function(_x,_x2){return _ref.apply(this,arguments);};}();this.postRaw=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(service,data,options){var request;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return _this.getRequest('POST',options);case 3:request=_context2.sent;request.body=data;return _context2.abrupt(\"return\",_this.wrapperWithOptions(urlFor(service),request));case 8:_context2.prev=8;_context2.t0=_context2[\"catch\"](0);throw _context2.t0;case 11:case\"end\":return _context2.stop();}}},_callee2,null,[[0,8]]);}));return function(_x3,_x4,_x5){return _ref2.apply(this,arguments);};}();this.putToJson=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(service,data){var request;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return _this.getRequest('PUT');case 3:request=_context3.sent;request.body=JSON.stringify(data);return _context3.abrupt(\"return\",_this.wrapperWithOptions(urlFor(service),request));case 8:_context3.prev=8;_context3.t0=_context3[\"catch\"](0);throw _context3.t0;case 11:case\"end\":return _context3.stop();}}},_callee3,null,[[0,8]]);}));return function(_x6,_x7){return _ref3.apply(this,arguments);};}();this.putRaw=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(service,data,options){var request;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.prev=0;_context4.next=3;return _this.getRequest('PUT',options);case 3:request=_context4.sent;request.body=data;return _context4.abrupt(\"return\",_this.wrapperWithOptions(urlFor(service),request));case 8:_context4.prev=8;_context4.t0=_context4[\"catch\"](0);throw _context4.t0;case 11:case\"end\":return _context4.stop();}}},_callee4,null,[[0,8]]);}));return function(_x8,_x9,_x10){return _ref4.apply(this,arguments);};}();this.get=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(service){var request;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.prev=0;_context5.next=3;return _this.getRequest('GET');case 3:request=_context5.sent;_context5.next=6;return _this.wrapperWithOptions(urlFor(service),request);case 6:return _context5.abrupt(\"return\",_context5.sent);case 9:_context5.prev=9;_context5.t0=_context5[\"catch\"](0);throw _context5.t0;case 12:case\"end\":return _context5.stop();}}},_callee5,null,[[0,9]]);}));return function(_x11){return _ref5.apply(this,arguments);};}();this.delete=/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(service,data){var request;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_context6.prev=0;_context6.next=3;return _this.getRequest('DELETE');case 3:request=_context6.sent;request.body=JSON.stringify(data);return _context6.abrupt(\"return\",_this.wrapperWithOptions(urlFor(service),request));case 8:_context6.prev=8;_context6.t0=_context6[\"catch\"](0);throw _context6.t0;case 11:case\"end\":return _context6.stop();}}},_callee6,null,[[0,8]]);}));return function(_x12,_x13){return _ref6.apply(this,arguments);};}();this.getRaw=/*#__PURE__*/function(){var _ref7=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(service){var request;return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:_context7.prev=0;_context7.next=3;return _this.getRequest('GET');case 3:request=_context7.sent;return _context7.abrupt(\"return\",_this.wrapperWithOptions(service,request));case 7:_context7.prev=7;_context7.t0=_context7[\"catch\"](0);throw _context7.t0;case 10:case\"end\":return _context7.stop();}}},_callee7,null,[[0,7]]);}));return function(_x14){return _ref7.apply(this,arguments);};}();}_createClass(NetworkOps,[{key:\"getRequest\",value:function(){var _getRequest=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee8(type,options){var headerOverrides,request,token;return _regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:headerOverrides=get(options,'headerOverrides',{});request={method:type,headers:_objectSpread({'Content-Type':'application/json',Authorization:\"Basic \".concat(Constants.BasicAuthorizationToken),'timezone':moment.tz.guess()},headerOverrides)};//if giving multipart/form-data in Content-Type: giving boundary error\n//if also adding boundary: loader continues from server end \ntoken=storageService.getItem('jwtToken');if(headerOverrides['Content-Type']==='multipart/form-data'){delete request.headers['Content-Type'];}if(token){request.headers=_objectSpread(_objectSpread({},request.headers),{},{Authorization:token,'timezone':moment.tz.guess()// Authorization: `Bearer ${token}`,\n});}return _context8.abrupt(\"return\",request);case 6:case\"end\":return _context8.stop();}}},_callee8);}));function getRequest(_x15,_x16){return _getRequest.apply(this,arguments);}return getRequest;}()},{key:\"wrapperWithOptions\",value:function(){var _wrapperWithOptions=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee9(url,request){var response,res1,res2,err,res;return _regeneratorRuntime.wrap(function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:_context9.prev=0;_context9.next=3;return fetch(url,request);case 3:response=_context9.sent;if(response.ok){_context9.next=25;break;}if(!(response.status===401)){_context9.next=17;break;}if(!storageService.getItem('jwtToken')){_context9.next=15;break;}storageService.clearAll();// alert('Token Expired');\n_context9.next=10;return response.text();case 10:res1=_context9.sent;res2=JSON.parse(res1);setShowToast(true,res2.message||'You\\'ve been logged out');setTimeout(function(){window.location.pathname='/login';},1000);return _context9.abrupt(\"return\");case 15:_context9.next=18;break;case 17:if(response.status===500||response.status===400){console.log('Got 401, now calling logout',response);}case 18:_context9.next=20;return response.json();case 20:err=_context9.sent;console.log('Error -> ',err);throw err;case 25:_context9.next=27;return response.text();case 27:res=_context9.sent;_context9.prev=28;return _context9.abrupt(\"return\",JSON.parse(res));case 32:_context9.prev=32;_context9.t0=_context9[\"catch\"](28);return _context9.abrupt(\"return\",res);case 35:_context9.next=41;break;case 37:_context9.prev=37;_context9.t1=_context9[\"catch\"](0);console.log('Error',_context9.t1);return _context9.abrupt(\"return\",_context9.t1);case 41:case\"end\":return _context9.stop();}}},_callee9,null,[[0,37],[28,32]]);}));function wrapperWithOptions(_x17,_x18){return _wrapperWithOptions.apply(this,arguments);}return wrapperWithOptions;}()}]);return NetworkOps;}();export default new NetworkOps();","map":{"version":3,"sources":["/home/appinventiv/Documents/Project/tickt/web/src/network/NetworkOps.ts"],"names":["get","setShowToast","storageService","urlFor","Constants","moment","NetworkOps","postToJson","service","data","JSONData","JSON","stringify","postRaw","options","getRequest","request","body","wrapperWithOptions","putToJson","putRaw","delete","getRaw","type","headerOverrides","method","headers","Authorization","BasicAuthorizationToken","tz","guess","token","getItem","url","fetch","response","ok","status","clearAll","text","res1","res2","parse","message","setTimeout","window","location","pathname","console","log","json","err","res"],"mappings":"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","sourcesContent":["import { get } from 'lodash';\nimport { setShowToast } from '../redux/common/actions';\nimport storageService from '../utils/storageService';\nimport { urlFor } from './Urls';\nimport Constants from '../utils/constants';\nimport * as moment from 'moment';\nimport 'moment-timezone';\n\nexport interface FetchResponse {\n    status?: number | boolean,\n    status_code?: number\n    message: string,\n    result: any,\n    data: any\n}\n\nclass NetworkOps {\n\n    async getRequest(type: string, options?: object): Promise<any> {\n        const headerOverrides = get(options, 'headerOverrides', {});\n        const request = {\n            method: type,\n            headers: {\n                'Content-Type': 'application/json',\n                Authorization: `Basic ${Constants.BasicAuthorizationToken}`,\n                'timezone': moment.tz.guess(),\n                ...headerOverrides\n            },\n        };\n\n        //if giving multipart/form-data in Content-Type: giving boundary error\n        //if also adding boundary: loader continues from server end \n        const token = storageService.getItem('jwtToken');\n        if (headerOverrides['Content-Type'] === 'multipart/form-data') {\n            delete request.headers['Content-Type'];\n        }\n        if (token) {\n            request.headers = {\n                ...request.headers,\n                Authorization: token,\n                'timezone': moment.tz.guess(),\n                // Authorization: `Bearer ${token}`,\n            }\n        }\n        return request;\n    }\n\n    async wrapperWithOptions(url: string, request: any) {\n        try {\n            const response: any = await fetch(url, request);\n            if (!response.ok) {\n                if (response.status === 401) {\n                    if (storageService.getItem('jwtToken')) {\n                        storageService.clearAll();\n                        // alert('Token Expired');\n                        const res1 = await response.text();\n                        const res2 = JSON.parse(res1);\n                        setShowToast(true, res2.message || 'You\\'ve been logged out');\n                        setTimeout(() => {\n                            window.location.pathname = '/login';\n                        }, 1000);\n                        return;\n                    }\n                }\n                else if (response.status === 500 || response.status === 400) {\n                    console.log('Got 401, now calling logout', response);\n                }\n                const err = await response.json();\n                console.log('Error -> ', err)\n                throw err;\n            }\n            else {\n                const res = await response.text();\n                try {\n                    return JSON.parse(res);\n                }\n                catch {\n                    return res;\n                }\n            }\n        }\n        catch (error) {\n            console.log('Error', error);\n            return error;\n        }\n    }\n\n    postToJson = async (service: string, data: any): Promise<FetchResponse> => {\n        try {\n            const JSONData = JSON.stringify(data);\n            return this.postRaw(service, JSONData)\n        }\n        catch (err) {\n            throw err;\n        }\n    }\n\n    postRaw = async (service: string, data: any, options?: any): Promise<FetchResponse> => {\n        try {\n            const request = await this.getRequest('POST', options);\n            request.body = data;\n            return this.wrapperWithOptions(urlFor(service), request)\n        }\n        catch (err) {\n            throw err;\n        }\n    }\n\n    putToJson = async (service: string, data: any): Promise<FetchResponse> => {\n        try {\n            const request = await this.getRequest('PUT');\n            request.body = JSON.stringify(data);\n            return this.wrapperWithOptions(urlFor(service), request)\n        }\n        catch (err) {\n            throw err;\n        }\n    }\n\n    putRaw = async (service: string, data: any, options?: any): Promise<FetchResponse> => {\n        try {\n            const request = await this.getRequest('PUT', options);\n            request.body = data\n            return this.wrapperWithOptions(urlFor(service), request)\n        }\n        catch (err) {\n            throw err;\n        }\n    }\n\n    get = async (service: any): Promise<FetchResponse> => {\n        try {\n            const request = await this.getRequest('GET');\n            return await this.wrapperWithOptions(urlFor(service), request);\n        }\n        catch (err) {\n            throw err;\n        }\n    }\n\n    delete = async (service: string, data?: any): Promise<FetchResponse> => {\n        try {\n            const request = await this.getRequest('DELETE');\n            request.body = JSON.stringify(data);\n            return this.wrapperWithOptions(urlFor(service), request)\n        }\n        catch (err) {\n            throw err;\n        }\n    }\n\n    getRaw = async (service: string): Promise<any> => {\n        try {\n            const request = await this.getRequest('GET');\n            return this.wrapperWithOptions(service, request)\n        }\n        catch (err) {\n            throw err;\n        }\n    }\n}\n\nexport default new NetworkOps();"]},"metadata":{},"sourceType":"module"}