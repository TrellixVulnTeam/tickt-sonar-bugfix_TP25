{"ast":null,"code":"import _regeneratorRuntime from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useState,useEffect}from'react';import{useLocation,useHistory}from'react-router-dom';import GuestHome from'./guestHome';import TradieHome from'./tradieHome/index';import BuilderHome from'./builderHome/index';import storageService from'../../utils//storageService';import{addFCMNotifToken}from'../../redux/auth/actions';import{requestPermission,updateChatUserDetails}from\"../../services/firebase\";import{jsx as _jsx}from\"react/jsx-runtime\";var Home=function Home(props){var _useState=useState(storageService.getItem('userType')),_useState2=_slicedToArray(_useState,1),userType=_useState2[0];var location=useLocation();var history=useHistory();var setTokenSentToServer=function setTokenSentToServer(sent){storageService.setItem('sentToServer',sent?'1':'0');};useEffect(function(){_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _storageService$getIt,res,data,res2;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(userType===1||userType===2)){_context.next=13;break;}_context.next=3;return requestPermission();case 3:res=_context.sent;data={deviceToken:res===null||res===void 0?void 0:res.deviceToken,//fcm device token\ndeviceId:\"\".concat((_storageService$getIt=storageService.getItem('userInfo'))===null||_storageService$getIt===void 0?void 0:_storageService$getIt.deviceId),deviceType:1};console.log(data.deviceToken,\"---------------diff----------------\",storageService.getItem('fcmToken'));if(!(res===null||res===void 0?void 0:res.success)){_context.next=13;break;}if(!(storageService.getItem('fcmToken')!==data.deviceToken)){_context.next=13;break;}updateChatUserDetails('deviceToken',data.deviceToken);_context.next=11;return addFCMNotifToken(data);case 11:res2=_context.sent;if(res2.success){storageService.setItem(\"fcmToken\",data.deviceToken);setTokenSentToServer(true);}else{setTokenSentToServer(false);}case 13:case\"end\":return _context.stop();}}},_callee);}))();},[]);if(userType===1){return/*#__PURE__*/_jsx(TradieHome,{history:history});}else if(userType===2){return/*#__PURE__*/_jsx(BuilderHome,{history:history});}else{return/*#__PURE__*/_jsx(GuestHome,{});}};export default Home;","map":{"version":3,"sources":["/home/appinventiv/Documents/Project/tickt/web/src/pages/home/home.tsx"],"names":["useState","useEffect","useLocation","useHistory","GuestHome","TradieHome","BuilderHome","storageService","addFCMNotifToken","requestPermission","updateChatUserDetails","Home","props","getItem","userType","location","history","setTokenSentToServer","sent","setItem","res","data","deviceToken","deviceId","deviceType","console","log","success","res2"],"mappings":"yeAAA,OAASA,QAAT,CAAmBC,SAAnB,KAAoC,OAApC,CACA,OAASC,WAAT,CAAsBC,UAAtB,KAAwC,kBAAxC,CACA,MAAOC,CAAAA,SAAP,KAAsB,aAAtB,CACA,MAAOC,CAAAA,UAAP,KAAuB,oBAAvB,CACA,MAAOC,CAAAA,WAAP,KAAwB,qBAAxB,CACA,MAAOC,CAAAA,cAAP,KAA2B,6BAA3B,CACA,OAASC,gBAAT,KAAiC,0BAAjC,CACA,OAASC,iBAAT,CAA4BC,qBAA5B,KAAyD,yBAAzD,C,2CAEA,GAAMC,CAAAA,IAAI,CAAG,QAAPA,CAAAA,IAAO,CAACC,KAAD,CAAgB,CACzB,cAAmBZ,QAAQ,CAACO,cAAc,CAACM,OAAf,CAAuB,UAAvB,CAAD,CAA3B,wCAAOC,QAAP,eACA,GAAMC,CAAAA,QAAa,CAAGb,WAAW,EAAjC,CACA,GAAMc,CAAAA,OAAY,CAAGb,UAAU,EAA/B,CAEA,GAAMc,CAAAA,oBAAoB,CAAG,QAAvBA,CAAAA,oBAAuB,CAACC,IAAD,CAAe,CACxCX,cAAc,CAACY,OAAf,CAAuB,cAAvB,CAAuCD,IAAI,CAAG,GAAH,CAAS,GAApD,EACH,CAFD,CAIAjB,SAAS,CAAC,UAAM,CACZ,wDAAC,gLACOa,QAAQ,GAAK,CAAb,EAAkBA,QAAQ,GAAK,CADtC,iDAE8BL,CAAAA,iBAAiB,EAF/C,QAEaW,GAFb,eAGaC,IAHb,CAGyB,CACdC,WAAW,CAAEF,GAAF,SAAEA,GAAF,iBAAEA,GAAG,CAAEE,WADJ,CACiB;AAC/BC,QAAQ,kCAAKhB,cAAc,CAACM,OAAf,CAAuB,UAAvB,CAAL,gDAAK,sBAAoCU,QAAzC,CAFM,CAGdC,UAAU,CAAE,CAHE,CAHzB,CAQOC,OAAO,CAACC,GAAR,CAAYL,IAAI,CAACC,WAAjB,CAA8B,qCAA9B,CAAqEf,cAAc,CAACM,OAAf,CAAuB,UAAvB,CAArE,EARP,KASWO,GATX,SASWA,GATX,iBASWA,GAAG,CAAEO,OAThB,gCAUepB,cAAc,CAACM,OAAf,CAAuB,UAAvB,IAAuCQ,IAAI,CAACC,WAV3D,2BAWeZ,qBAAqB,CAAC,aAAD,CAAgBW,IAAI,CAACC,WAArB,CAArB,CAXf,uBAYkCd,CAAAA,gBAAgB,CAACa,IAAD,CAZlD,SAYqBO,IAZrB,eAae,GAAIA,IAAI,CAACD,OAAT,CAAkB,CACdpB,cAAc,CAACY,OAAf,CAAuB,UAAvB,CAAmCE,IAAI,CAACC,WAAxC,EACAL,oBAAoB,CAAC,IAAD,CAApB,CACH,CAHD,IAGO,CACHA,oBAAoB,CAAC,KAAD,CAApB,CACH,CAlBhB,uDAAD,KAuBH,CAxBQ,CAwBN,EAxBM,CAAT,CA0BA,GAAIH,QAAQ,GAAK,CAAjB,CAAoB,CAChB,mBAAO,KAAC,UAAD,EAAY,OAAO,CAAEE,OAArB,EAAP,CACH,CAFD,IAEO,IAAIF,QAAQ,GAAK,CAAjB,CAAoB,CACvB,mBAAO,KAAC,WAAD,EAAa,OAAO,CAAEE,OAAtB,EAAP,CACH,CAFM,IAEA,CACH,mBAAO,KAAC,SAAD,IAAP,CACH,CACJ,CA1CD,CA4CA,cAAeL,CAAAA,IAAf","sourcesContent":["import { useState, useEffect } from 'react';\nimport { useLocation, useHistory } from 'react-router-dom';\nimport GuestHome from './guestHome';\nimport TradieHome from './tradieHome/index';\nimport BuilderHome from './builderHome/index';\nimport storageService from '../../utils//storageService';\nimport { addFCMNotifToken } from '../../redux/auth/actions';\nimport { requestPermission, updateChatUserDetails } from \"../../services/firebase\";\n\nconst Home = (props: any) => {\n    const [userType] = useState(storageService.getItem('userType'))\n    const location: any = useLocation();\n    const history: any = useHistory();\n\n    const setTokenSentToServer = (sent: any) => {\n        storageService.setItem('sentToServer', sent ? '1' : '0');\n    }\n\n    useEffect(() => {\n        (async () => {\n            if (userType === 1 || userType === 2) {\n                const res: any = await requestPermission();\n                const data: any = {\n                    deviceToken: res?.deviceToken, //fcm device token\n                    deviceId: `${storageService.getItem('userInfo')?.deviceId}`,\n                    deviceType: 1\n                }\n                console.log(data.deviceToken, \"---------------diff----------------\", storageService.getItem('fcmToken'));\n                if (res?.success) {\n                    if (storageService.getItem('fcmToken') !== data.deviceToken) {\n                        updateChatUserDetails('deviceToken', data.deviceToken);\n                        const res2 = await addFCMNotifToken(data);\n                        if (res2.success) {\n                            storageService.setItem(\"fcmToken\", data.deviceToken);\n                            setTokenSentToServer(true);\n                        } else {\n                            setTokenSentToServer(false);\n                        }\n                    }\n                }\n            }\n        })();\n    }, []);\n\n    if (userType === 1) {\n        return <TradieHome history={history} />\n    } else if (userType === 2) {\n        return <BuilderHome history={history} />\n    } else {\n        return <GuestHome />\n    }\n}\n\nexport default Home;\n"]},"metadata":{},"sourceType":"module"}