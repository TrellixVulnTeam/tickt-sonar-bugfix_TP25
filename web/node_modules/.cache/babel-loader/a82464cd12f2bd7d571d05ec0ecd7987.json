{"ast":null,"code":"import _objectSpread from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _toConsumableArray from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect,useRef}from'react';import{getJobDetails}from'../../redux/jobs/actions';import storageService from'../../utils/storageService';import notFound from'../../assets/images/not-found.png';import chatVideoIcon from'../../assets/images/video@3x.png';import dummy from'../../assets/images/u_placeholder.jpg';import viewMore from'../../assets/images/icon-direction-blue.png';import close from'../../assets/images/ic-cancel-blue.png';import sendMedia from'../../assets/images/ic-media.png';import sendBtn from'../../assets/images/ic-send.png';import loader from'../../assets/images/loader.gif';import{formatDateTime,renderTime}from'../../utils/common';import{setShowToast}from'../../redux/common/actions';import{onFileUpload}from'../../redux/auth/actions';import{getMessagesOfRoom,sendTextMessage,sendImageVideoMessage}from'../../services/firebase';import Constants from'../../utils/constants';//@ts-ignore\nimport FsLightbox from'fslightbox-react';import{moengage,mixPanel}from'../../services/analyticsTools';import{MoEConstants}from'../../utils/constants';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var lastDate='';var docTypes=[\"jpeg\",\"jpg\",\"png\",\"mp4\",\"wmv\",\"avi\"];var UserMessages=function UserMessages(props){var _storageService$getIt,_props$roomData16,_props$roomData16$opp,_props$roomData19,_props$roomData19$opp,_props$roomData21,_props$roomData21$opp,_props$roomData22,_props$roomData22$opp;var divRref=useRef(null);var _useState=useState((_storageService$getIt=storageService.getItem('userInfo'))===null||_storageService$getIt===void 0?void 0:_storageService$getIt._id),_useState2=_slicedToArray(_useState,1),userId=_useState2[0];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),toggle=_useState4[0],setToggle=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),jobDetailLoader=_useState6[0],setJobDetailLoader=_useState6[1];var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),currentJobDetails=_useState8[0],setCurrentJobDetails=_useState8[1];var _useState9=useState(''),_useState10=_slicedToArray(_useState9,2),messageText=_useState10[0],setMessageText=_useState10[1];var _useState11=useState([]),_useState12=_slicedToArray(_useState11,2),messages=_useState12[0],setMessages=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),isDocUploading=_useState14[0],setIsDocUploading=_useState14[1];var _useState15=useState([]),_useState16=_slicedToArray(_useState15,2),itemsMedia=_useState16[0],setItemsMedia=_useState16[1];var _useState17=useState(false),_useState18=_slicedToArray(_useState17,2),toggler=_useState18[0],setToggler=_useState18[1];var _useState19=useState(1),_useState20=_slicedToArray(_useState19,2),selectedSlide=_useState20[0],setSelectSlide=_useState20[1];var _useState21=useState({}),_useState22=_slicedToArray(_useState21,2),fsSlideListner=_useState22[0],setFsSlideListner=_useState22[1];var _useState23=useState(''),_useState24=_slicedToArray(_useState23,2),oppUserFcmToken=_useState24[0],setOppUserFcmToken=_useState24[1];useEffect(function(){if(props.roomId!==''){lastDate='';getMessagesOfRoom(props.roomId,onReceiveOfNewMsg);setSelectSlide(1);setFsSlideListner({});setItemsMedia([]);setCurrentJobDetails(null);setToggle(false);}},[props.roomId]);// }, [props.roomId, props.roomData]);\nconsole.log('props.roomData: ',props.roomData);useEffect(function(){scrollToBottom();});var scrollToBottom=function scrollToBottom(){if(null!==(divRref===null||divRref===void 0?void 0:divRref.current)){var scroll=divRref.current.scrollHeight-divRref.current.clientHeight;// divRref.current.scrollIntoView({ behavior: \"smooth\" })\ndivRref.current.scrollTo(0,scroll);}};var onReceiveOfNewMsg=function onReceiveOfNewMsg(arrmsg){console.log('arrmsg: ',arrmsg);setMessages(arrmsg);};useEffect(function(){var fsSlideObj={};var mediaMsgs=[];var slideCount=1;if(messages.length){mediaMsgs=messages.filter(function(item,index){if(item.messageType==='image'||item.messageType==='video'){fsSlideObj[\"\".concat(index)]=slideCount++;return item;}});setItemsMedia(mediaMsgs);setFsSlideListner(fsSlideObj);}},[messages]);console.log('itemsMedia: ',itemsMedia,\"fsSlideListner\",fsSlideListner);var setInboxToTopWithLastMsg=function setInboxToTopWithLastMsg(lastMsg){var newInboxData=_toConsumableArray(props.inBoxData);var currentIndex=newInboxData.findIndex(function(i){return i.roomId===props.roomId;});newInboxData[currentIndex].lastMsg=lastMsg;newInboxData.splice(currentIndex,1);newInboxData.unshift(props.inBoxData[currentIndex]);props.setInBoxData(newInboxData);console.log('lastMsg: ',lastMsg);console.log('currentIndex: ',currentIndex);console.log('newInboxData: ',newInboxData);};var sendMessage=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _props$roomData,_props$roomData$oppUs,_props$roomData2,_props$roomData2$oppU,_props$roomData3,_props$roomData3$oppU,_props$roomData4,_props$roomData4$oppU,lastMsg,mData;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(messageText&&messageText.trimLeft()!==\"\")){_context.next=7;break;}setMessageText('');_context.next=4;return sendTextMessage(props.roomId,messageText);case 4:lastMsg=_context.sent;if(lastMsg&&((_props$roomData=props.roomData)===null||_props$roomData===void 0?void 0:(_props$roomData$oppUs=_props$roomData.oppUserInfo)===null||_props$roomData$oppUs===void 0?void 0:_props$roomData$oppUs.deviceToken)&&((_props$roomData2=props.roomData)===null||_props$roomData2===void 0?void 0:(_props$roomData2$oppU=_props$roomData2.oppUserInfo)===null||_props$roomData2$oppU===void 0?void 0:_props$roomData2$oppU.deviceType)&&(((_props$roomData3=props.roomData)===null||_props$roomData3===void 0?void 0:(_props$roomData3$oppU=_props$roomData3.oppUserInfo)===null||_props$roomData3$oppU===void 0?void 0:_props$roomData3$oppU.hasOwnProperty('isNotification'))?(_props$roomData4=props.roomData)===null||_props$roomData4===void 0?void 0:(_props$roomData4$oppU=_props$roomData4.oppUserInfo)===null||_props$roomData4$oppU===void 0?void 0:_props$roomData4$oppU.isNotification:true)){sendFCMPushNotificationToOppUser(lastMsg);mData={timeStamp:moengage.getCurrentTimeStamp()};moengage.moE_SendEvent(MoEConstants.CHAT,mData);mixPanel.mixP_SendEvent(MoEConstants.CHAT,mData);}setInboxToTopWithLastMsg(lastMsg);case 7:case\"end\":return _context.stop();}}},_callee);}));return function sendMessage(){return _ref.apply(this,arguments);};}();var handleKeyDown=function handleKeyDown(event){if(event.key==='Enter'){sendMessage();}};var sendImageVideoMsg=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(url,msgType){var _props$roomData5,_props$roomData5$oppU,_props$roomData6,_props$roomData6$oppU,_props$roomData7,_props$roomData7$oppU,_props$roomData8,_props$roomData8$oppU,lastMsg;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!(url&&url!=='')){_context2.next=6;break;}_context2.next=3;return sendImageVideoMessage(props.roomId,url,msgType);case 3:lastMsg=_context2.sent;if(lastMsg&&((_props$roomData5=props.roomData)===null||_props$roomData5===void 0?void 0:(_props$roomData5$oppU=_props$roomData5.oppUserInfo)===null||_props$roomData5$oppU===void 0?void 0:_props$roomData5$oppU.deviceToken)&&((_props$roomData6=props.roomData)===null||_props$roomData6===void 0?void 0:(_props$roomData6$oppU=_props$roomData6.oppUserInfo)===null||_props$roomData6$oppU===void 0?void 0:_props$roomData6$oppU.deviceType)&&(((_props$roomData7=props.roomData)===null||_props$roomData7===void 0?void 0:(_props$roomData7$oppU=_props$roomData7.oppUserInfo)===null||_props$roomData7$oppU===void 0?void 0:_props$roomData7$oppU.hasOwnProperty('isNotification'))?(_props$roomData8=props.roomData)===null||_props$roomData8===void 0?void 0:(_props$roomData8$oppU=_props$roomData8.oppUserInfo)===null||_props$roomData8$oppU===void 0?void 0:_props$roomData8$oppU.isNotification:true)){sendFCMPushNotificationToOppUser(lastMsg);}setInboxToTopWithLastMsg(lastMsg);case 6:setMessageText('');case 7:case\"end\":return _context2.stop();}}},_callee2);}));return function sendImageVideoMsg(_x,_x2){return _ref2.apply(this,arguments);};}();var fetchJobDetail=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(jobId){var res,_res$data,_res$data2,_res$data3,_res$data4,_res$data5,_res$data6,_res$data7,_res$data8,_res$data9,jobInfo;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:setJobDetailLoader(true);_context3.next=3;return getJobDetails(jobId);case 3:res=_context3.sent;if(res.success){jobInfo={jobDescription:((_res$data=res.data)===null||_res$data===void 0?void 0:_res$data.details)||'',jobId:((_res$data2=res.data)===null||_res$data2===void 0?void 0:_res$data2.jobId)||'',jobName:((_res$data3=res.data)===null||_res$data3===void 0?void 0:_res$data3.jobName)||'',amount:((_res$data4=res.data)===null||_res$data4===void 0?void 0:_res$data4.amount)||'',locationName:((_res$data5=res.data)===null||_res$data5===void 0?void 0:_res$data5.locationName)||'',fromDate:((_res$data6=res.data)===null||_res$data6===void 0?void 0:_res$data6.fromDate)||'',toDate:((_res$data7=res.data)===null||_res$data7===void 0?void 0:_res$data7.toDate)||'',duration:((_res$data8=res.data)===null||_res$data8===void 0?void 0:_res$data8.duration)||'',status:((_res$data9=res.data)===null||_res$data9===void 0?void 0:_res$data9.status)||''};setCurrentJobDetails(jobInfo);setJobDetailLoader(false);}case 5:case\"end\":return _context3.stop();}}},_callee3);}));return function fetchJobDetail(_x3){return _ref3.apply(this,arguments);};}();var renderMediaItems=function renderMediaItems(itemsMedia){var sources=[];var types=[];if(itemsMedia.length){itemsMedia.forEach(function(item){if(item.messageType==='video'){sources.push(item.mediaUrl);types.push('video');}if(item.messageType==='image'){sources.push(item.mediaUrl);types.push('image');}});}return{sources:sources,types:types};};var setResDeviceType=function setResDeviceType(deviceType,msg){var _storageService$getIt2,_storageService$getIt3,_storageService$getIt4,_storageService$getIt5,_storageService$getIt6,_msg$messageRoomId,_msg$messageRoomId$sp,_storageService$getIt7,_props$roomData9,_storageService$getIt8,_storageService$getIt9,_storageService$getIt10,_msg$messageRoomId2,_msg$messageRoomId2$s,_storageService$getIt11,_props$roomData10;switch(Number(deviceType)){case 1:return{app_icon:\"https://appinventiv-development.s3.amazonaws.com/1628513615740ic-logo-yellow.png\",title:\"Tickt App\",notificationText:\"\".concat((_storageService$getIt2=storageService.getItem('userInfo'))===null||_storageService$getIt2===void 0?void 0:_storageService$getIt2.userName,\" send you a message\"),senderName:\"\".concat((_storageService$getIt3=storageService.getItem('userInfo'))===null||_storageService$getIt3===void 0?void 0:_storageService$getIt3.userName),messageType:\"\".concat(msg===null||msg===void 0?void 0:msg.messageType),messageText:\"\".concat((msg===null||msg===void 0?void 0:msg.messageType)==='text'?msg===null||msg===void 0?void 0:msg.messageText:''),room_id:msg===null||msg===void 0?void 0:msg.messageRoomId,image:(_storageService$getIt4=storageService.getItem('userInfo'))===null||_storageService$getIt4===void 0?void 0:_storageService$getIt4.user_image,notificationType:25,sound:\"default\"};case 2:return{body:msg===null||msg===void 0?void 0:msg.messageText,messageText:msg===null||msg===void 0?void 0:msg.messageText,sender:{first_name:(_storageService$getIt5=storageService.getItem('userInfo'))===null||_storageService$getIt5===void 0?void 0:_storageService$getIt5.userName,device_token:storageService.getItem('fcmToken'),user_id:(_storageService$getIt6=storageService.getItem('userInfo'))===null||_storageService$getIt6===void 0?void 0:_storageService$getIt6._id,device_type:2},jobId:msg===null||msg===void 0?void 0:(_msg$messageRoomId=msg.messageRoomId)===null||_msg$messageRoomId===void 0?void 0:(_msg$messageRoomId$sp=_msg$messageRoomId.split('_'))===null||_msg$messageRoomId$sp===void 0?void 0:_msg$messageRoomId$sp[0],badge:1,device_type:2,title:(_storageService$getIt7=storageService.getItem('userInfo'))===null||_storageService$getIt7===void 0?void 0:_storageService$getIt7.userName,jobName:(_props$roomData9=props.roomData)===null||_props$roomData9===void 0?void 0:_props$roomData9.jobName,notification_type:50,sound:'default',messageId:msg===null||msg===void 0?void 0:msg.messageId};case 3:return{notification:{body:msg===null||msg===void 0?void 0:msg.messageText,title:(_storageService$getIt8=storageService.getItem('userInfo'))===null||_storageService$getIt8===void 0?void 0:_storageService$getIt8.userName},data:{body:msg===null||msg===void 0?void 0:msg.messageText,messageText:msg===null||msg===void 0?void 0:msg.messageText,sender:{first_name:(_storageService$getIt9=storageService.getItem('userInfo'))===null||_storageService$getIt9===void 0?void 0:_storageService$getIt9.userName,device_token:storageService.getItem('fcmToken'),user_id:(_storageService$getIt10=storageService.getItem('userInfo'))===null||_storageService$getIt10===void 0?void 0:_storageService$getIt10._id,device_type:2},jobId:msg===null||msg===void 0?void 0:(_msg$messageRoomId2=msg.messageRoomId)===null||_msg$messageRoomId2===void 0?void 0:(_msg$messageRoomId2$s=_msg$messageRoomId2.split('_'))===null||_msg$messageRoomId2$s===void 0?void 0:_msg$messageRoomId2$s[0],badge:1,device_type:2,title:(_storageService$getIt11=storageService.getItem('userInfo'))===null||_storageService$getIt11===void 0?void 0:_storageService$getIt11.userName,jobName:(_props$roomData10=props.roomData)===null||_props$roomData10===void 0?void 0:_props$roomData10.jobName,notification_type:50,sound:'default',messageId:msg===null||msg===void 0?void 0:msg.messageId}};default:return;}};var sendFCMPushNotificationToOppUser=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(msg){var _props$roomData11,_props$roomData11$opp,_props$roomData12,_props$roomData12$opp,_props$roomData13,_props$roomData13$opp,_props$roomData14,_props$roomData14$opp,_props$roomData15,_props$roomData15$opp;var data,newData,headers_,response;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:data=setResDeviceType((_props$roomData11=props.roomData)===null||_props$roomData11===void 0?void 0:(_props$roomData11$opp=_props$roomData11.oppUserInfo)===null||_props$roomData11$opp===void 0?void 0:_props$roomData11$opp.deviceType,msg);newData=_objectSpread(_objectSpread(_objectSpread({to:\"\".concat((_props$roomData12=props.roomData)===null||_props$roomData12===void 0?void 0:(_props$roomData12$opp=_props$roomData12.oppUserInfo)===null||_props$roomData12$opp===void 0?void 0:_props$roomData12$opp.deviceToken)},((_props$roomData13=props.roomData)===null||_props$roomData13===void 0?void 0:(_props$roomData13$opp=_props$roomData13.oppUserInfo)===null||_props$roomData13$opp===void 0?void 0:_props$roomData13$opp.deviceType)==1&&{data:data}),((_props$roomData14=props.roomData)===null||_props$roomData14===void 0?void 0:(_props$roomData14$opp=_props$roomData14.oppUserInfo)===null||_props$roomData14$opp===void 0?void 0:_props$roomData14$opp.deviceType)==2&&{notification:data}),((_props$roomData15=props.roomData)===null||_props$roomData15===void 0?void 0:(_props$roomData15$opp=_props$roomData15.oppUserInfo)===null||_props$roomData15$opp===void 0?void 0:_props$roomData15$opp.deviceType)==3&&{notification:data===null||data===void 0?void 0:data.notification,data:data===null||data===void 0?void 0:data.data});headers_={'Content-Type':'application/json','Authorization':Constants.FcmHeaderAuthorizationKey};_context4.next=5;return fetch(\"https://fcm.googleapis.com/fcm/send\",{method:\"POST\",headers:headers_,body:JSON.stringify(newData)});case 5:response=_context4.sent;// const res: any = await response.json();\nif(response.status===200){console.log('Chat push notification send to opposite user: success');}else{console.log('Chat push notification send to opposite user: failure');}case 7:case\"end\":return _context4.stop();}}},_callee4);}));return function sendFCMPushNotificationToOppUser(_x4){return _ref4.apply(this,arguments);};}();var handleUpload=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(e){var _newFile$type,_newFile$type$split$;var maxFileSize,formData,newFile,fileType,selectedFileSize,check_type,res;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:maxFileSize=10;formData=new FormData();newFile=e.target.files[0];fileType=newFile===null||newFile===void 0?void 0:(_newFile$type=newFile.type)===null||_newFile$type===void 0?void 0:(_newFile$type$split$=_newFile$type.split('/')[1])===null||_newFile$type$split$===void 0?void 0:_newFile$type$split$.toLowerCase();selectedFileSize=(newFile===null||newFile===void 0?void 0:newFile.size)/1024/1024;// size in mb\nif([\"mp4\",\"wmv\",\"avi\"].includes(fileType)){maxFileSize=20;}if(!(docTypes.indexOf(fileType)<0||selectedFileSize>maxFileSize)){_context5.next=9;break;}setShowToast(true,\"The file must be in proper format or size\");return _context5.abrupt(\"return\");case 9:formData.append('file',newFile);setIsDocUploading(true);check_type=[\"jpeg\",\"jpg\",\"png\"].includes(fileType)?1:[\"mp4\",\"wmv\",\"avi\"].includes(fileType)?2:null;_context5.next=14;return onFileUpload(formData);case 14:res=_context5.sent;if(res.success&&res.imgUrl){if(check_type===1){sendImageVideoMsg(res.imgUrl,\"image\");}else if(check_type===2){sendImageVideoMsg(res.imgUrl,\"video\");}else{setShowToast(true,\"There is some technical issue\");}setIsDocUploading(false);// setLocalFiles((prev: any) => ({ ...prev, [filesUrl?.length]: URL.createObjectURL(newFile) }));\n}case 16:case\"end\":return _context5.stop();}}},_callee5);}));return function handleUpload(_x5){return _ref5.apply(this,arguments);};}();var renderTextMsg=function renderTextMsg(msg){var curDate=formatDateTime(msg.messageTimestamp,'day');var messageClass=msg.senderId===userId?'message':'message recive_msg';if(lastDate===''||lastDate!==curDate){lastDate=curDate;return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"date_time\",children:/*#__PURE__*/_jsx(\"span\",{children:curDate})}),/*#__PURE__*/_jsx(\"div\",{className:\"\".concat(messageClass),children:/*#__PURE__*/_jsxs(\"p\",{className:\"\".concat(msg.senderId===userId?'mark':''),children:[msg.messageText,/*#__PURE__*/_jsx(\"span\",{className:\"time\",children:formatDateTime(msg.messageTimestamp,\"time\")})]})})]});}else return/*#__PURE__*/_jsx(\"div\",{className:\"\".concat(messageClass),children:/*#__PURE__*/_jsxs(\"p\",{className:\"\".concat(msg.senderId===userId?'mark':''),children:[msg.messageText,/*#__PURE__*/_jsx(\"span\",{className:\"time\",children:formatDateTime(msg.messageTimestamp,\"time\")})]})});};var renderImageMsg=function renderImageMsg(msg,index){var curDate=formatDateTime(msg.messageTimestamp,'day');var messageClass=msg.senderId===userId?'message':'message recive_msg';if(lastDate===''||lastDate!==curDate){lastDate=curDate;return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"date_time\",children:/*#__PURE__*/_jsx(\"span\",{children:curDate})}),/*#__PURE__*/_jsx(\"div\",{className:\"\".concat(messageClass),children:/*#__PURE__*/_jsxs(\"figure\",{className:\"media\",children:[/*#__PURE__*/_jsx(\"img\",{src:msg.mediaUrl||notFound,alt:\"media\",\"async-src\":msg.mediaUrl||notFound,decoding:\"async\",loading:\"lazy\",onError:function onError(e){var _e$target,_e$target2;if(e===null||e===void 0?void 0:(_e$target=e.target)===null||_e$target===void 0?void 0:_e$target.onerror){e.target.onerror=null;}if(e===null||e===void 0?void 0:(_e$target2=e.target)===null||_e$target2===void 0?void 0:_e$target2.src){e.target.src=notFound;}},onClick:function onClick(){setToggler(function(prev){return!prev;});setSelectSlide(fsSlideListner[\"\".concat(index)]);}}),/*#__PURE__*/_jsx(\"span\",{className:\"time\",children:formatDateTime(msg.messageTimestamp,\"time\")})]})})]});}else return/*#__PURE__*/_jsx(\"div\",{className:\"\".concat(messageClass),children:/*#__PURE__*/_jsxs(\"figure\",{className:\"media\",children:[/*#__PURE__*/_jsx(\"img\",{src:msg.mediaUrl||notFound,alt:\"media\",\"async-src\":msg.mediaUrl||notFound,decoding:\"async\",loading:\"lazy\",onError:function onError(e){var _e$target3,_e$target4;if(e===null||e===void 0?void 0:(_e$target3=e.target)===null||_e$target3===void 0?void 0:_e$target3.onerror){e.target.onerror=null;}if(e===null||e===void 0?void 0:(_e$target4=e.target)===null||_e$target4===void 0?void 0:_e$target4.src){e.target.src=notFound;}},onClick:function onClick(){setToggler(function(prev){return!prev;});setSelectSlide(fsSlideListner[\"\".concat(index)]);}}),/*#__PURE__*/_jsx(\"span\",{className:\"time\",children:formatDateTime(msg.messageTimestamp,\"time\")})]})});};var renderVideoMsg=function renderVideoMsg(msg,index){var curDate=formatDateTime(msg.messageTimestamp,'day');var messageClass=msg.senderId===userId?'message':'message recive_msg';if(lastDate===''||lastDate!==curDate){lastDate=curDate;return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"date_time\",children:/*#__PURE__*/_jsx(\"span\",{children:curDate})}),/*#__PURE__*/_jsx(\"div\",{className:\"\".concat(messageClass),children:/*#__PURE__*/_jsxs(\"figure\",{className:\"media media_video \",children:[/*#__PURE__*/_jsx(\"video\",{src:msg.mediaUrl||notFound,poster:chatVideoIcon,onClick:function onClick(){setToggler(function(prev){return!prev;});setSelectSlide(fsSlideListner[\"\".concat(index)]);}}),/*#__PURE__*/_jsx(\"span\",{className:\"time\",children:formatDateTime(msg.messageTimestamp,\"time\")})]})})]});}else return/*#__PURE__*/_jsx(\"div\",{className:\"\".concat(messageClass),children:/*#__PURE__*/_jsxs(\"figure\",{className:\"media media_video \",children:[/*#__PURE__*/_jsx(\"video\",{src:msg.mediaUrl||notFound,poster:chatVideoIcon,onClick:function onClick(){setToggler(function(prev){return!prev;});setSelectSlide(fsSlideListner[\"\".concat(index)]);}}),/*#__PURE__*/_jsx(\"span\",{className:\"time\",children:formatDateTime(msg.messageTimestamp,\"time\")})]})});};var displayMessages=function displayMessages(msg,index){if(index===0)lastDate='';switch(msg.messageType){case\"text\":return renderTextMsg(msg);case\"image\":return renderImageMsg(msg,index);case\"video\":return renderVideoMsg(msg,index);}};var _renderMediaItems=renderMediaItems(itemsMedia),sources=_renderMediaItems.sources,types=_renderMediaItems.types;return props.isNoRecords?/*#__PURE__*/_jsx(\"div\",{className:\"detail_col\",children:/*#__PURE__*/_jsx(\"div\",{className:\"flex_row\",children:/*#__PURE__*/_jsx(\"div\",{})})}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(FsLightbox,{toggler:toggler,slide:selectedSlide,sources:sources,types:types,// disableLocalStorage={true}\nonClose:function onClose(){setSelectSlide(1);}},sources===null||sources===void 0?void 0:sources.length),/*#__PURE__*/_jsx(\"div\",{className:\"detail_col\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex_row\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"chat_col \".concat(toggle?'active':''),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"chat_user\",children:[/*#__PURE__*/_jsx(\"figure\",{className:\"u_img\",children:/*#__PURE__*/_jsx(\"img\",{src:((_props$roomData16=props.roomData)===null||_props$roomData16===void 0?void 0:(_props$roomData16$opp=_props$roomData16.oppUserInfo)===null||_props$roomData16$opp===void 0?void 0:_props$roomData16$opp.image)||dummy,alt:\"user-img\",onError:function onError(e){var _e$target5,_e$target6;if(e===null||e===void 0?void 0:(_e$target5=e.target)===null||_e$target5===void 0?void 0:_e$target5.onerror){e.target.onerror=null;}if(e===null||e===void 0?void 0:(_e$target6=e.target)===null||_e$target6===void 0?void 0:_e$target6.src){e.target.src=dummy;}}})}),/*#__PURE__*/_jsx(\"span\",{className:\"name\",onClick:function onClick(){if(storageService.getItem('userType')===2){var _props$roomData17,_props$roomData17$opp;props.history.push(\"/tradie-info?tradeId=\".concat((_props$roomData17=props.roomData)===null||_props$roomData17===void 0?void 0:(_props$roomData17$opp=_props$roomData17.oppUserInfo)===null||_props$roomData17$opp===void 0?void 0:_props$roomData17$opp.userId,\"&hideInvite=true\"));}else{var _props$roomData18,_props$roomData18$opp;props.history.push(\"/builder-info?builderId=\".concat((_props$roomData18=props.roomData)===null||_props$roomData18===void 0?void 0:(_props$roomData18$opp=_props$roomData18.oppUserInfo)===null||_props$roomData18$opp===void 0?void 0:_props$roomData18$opp.userId));}},children:(_props$roomData19=props.roomData)===null||_props$roomData19===void 0?void 0:(_props$roomData19$opp=_props$roomData19.oppUserInfo)===null||_props$roomData19$opp===void 0?void 0:_props$roomData19$opp.name}),!toggle&&/*#__PURE__*/_jsxs(\"span\",{onClick:function onClick(){var _props$roomData20;setToggle(true);if(currentJobDetails)return;fetchJobDetail((_props$roomData20=props.roomData)===null||_props$roomData20===void 0?void 0:_props$roomData20.jobId);},className:\"view_detail\",children:[\"View Job Details\",/*#__PURE__*/_jsx(\"img\",{src:viewMore,alt:\"view-more\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"message_wrapr\",ref:divRref,children:[messages.length>0&&messages.map(function(msg,index){return displayMessages(msg,index);}),/*#__PURE__*/_jsx(\"div\",{className:\"date_time\",children:((_props$roomData21=props.roomData)===null||_props$roomData21===void 0?void 0:(_props$roomData21$opp=_props$roomData21.oppUserInfo)===null||_props$roomData21$opp===void 0?void 0:_props$roomData21$opp.isBlock)&&/*#__PURE__*/_jsx(\"i\",{style:{color:'#929292'},children:'You can no longer chat with the user'})})]}),!((_props$roomData22=props.roomData)===null||_props$roomData22===void 0?void 0:(_props$roomData22$opp=_props$roomData22.oppUserInfo)===null||_props$roomData22$opp===void 0?void 0:_props$roomData22$opp.isBlock)&&/*#__PURE__*/_jsx(\"div\",{className:\"send_msg\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text_field\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"upload_item\",htmlFor:\"upload_item\",children:/*#__PURE__*/_jsx(\"span\",{className:\"detect_icon_ltr\",children:/*#__PURE__*/_jsx(\"img\",{src:sendMedia,alt:\"media\"})})}),/*#__PURE__*/_jsx(\"input\",{id:\"upload_item\",className:\"hide\",type:\"file\",accept:\"image/png,image/jpg,image/jpeg, video/mp4, video/wmv, video/avi\",onChange:handleUpload,disabled:isDocUploading}),/*#__PURE__*/_jsx(\"textarea\",{placeholder:\"Message..\",onKeyDown:handleKeyDown,value:messageText,onChange:function onChange(e){return setMessageText(e.target.value);}}),/*#__PURE__*/_jsx(\"span\",{className:\"detect_icon\",children:/*#__PURE__*/_jsx(\"img\",{src:sendBtn,alt:\"send\",onClick:sendMessage})})]})})]}),toggle&&jobDetailLoader?/*#__PURE__*/_jsx(\"div\",{className:\"view_detail_col\",children:/*#__PURE__*/_jsx(\"div\",{className:\"no_record\",children:/*#__PURE__*/_jsx(\"figure\",{children:/*#__PURE__*/_jsx(\"img\",{src:loader,alt:\"loader\",width:\"130px\"})})})}):toggle?/*#__PURE__*/_jsxs(\"div\",{className:\"view_detail_col\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"f_spacebw relative\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"title line-2 pr-20\",children:currentJobDetails===null||currentJobDetails===void 0?void 0:currentJobDetails.jobName}),/*#__PURE__*/_jsx(\"span\",{onClick:function onClick(){setToggle(function(prev){return!prev;});},className:\"close\",children:/*#__PURE__*/_jsx(\"img\",{src:close,alt:\"close\"})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"job_info\",children:/*#__PURE__*/_jsxs(\"ul\",{children:[/*#__PURE__*/_jsx(\"li\",{className:\"icon clock\",children:renderTime(currentJobDetails===null||currentJobDetails===void 0?void 0:currentJobDetails.fromDate,currentJobDetails===null||currentJobDetails===void 0?void 0:currentJobDetails.toDate)}),/*#__PURE__*/_jsx(\"li\",{className:\"icon dollar\",children:currentJobDetails===null||currentJobDetails===void 0?void 0:currentJobDetails.amount}),/*#__PURE__*/_jsx(\"li\",{className:\"icon location line-1\",children:currentJobDetails===null||currentJobDetails===void 0?void 0:currentJobDetails.locationName}),/*#__PURE__*/_jsx(\"li\",{className:\"icon calendar\",children:currentJobDetails===null||currentJobDetails===void 0?void 0:currentJobDetails.duration})]})}),/*#__PURE__*/_jsx(\"p\",{className:\"commn_para\",children:currentJobDetails===null||currentJobDetails===void 0?void 0:currentJobDetails.jobDescription}),/*#__PURE__*/_jsx(\"button\",{className:\"fill_btn full_btn btn-effect\",onClick:function onClick(){if(storageService.getItem('userType')===1){props.history.push(\"/job-details-page?jobId=\".concat(currentJobDetails===null||currentJobDetails===void 0?void 0:currentJobDetails.jobId,\"&redirect_from=jobs\"));}else{// let urlEncode: any = window.btoa(`?jobId=${currentJobDetails?.jobId}&status=${currentJobDetails?.status}&edit=true&activeType=active`)\nvar urlEncode=\"?jobId=\".concat(currentJobDetails===null||currentJobDetails===void 0?void 0:currentJobDetails.jobId,\"&status=\").concat(currentJobDetails===null||currentJobDetails===void 0?void 0:currentJobDetails.status,\"&edit=true&activeType=active\");props.history.push(\"/job-detail?\".concat(urlEncode));}},children:\"View Job details\"})]}):null]})})]});};export default UserMessages;","map":{"version":3,"sources":["/home/appinventiv/Documents/Project/tickt/web/src/pages/chat/userMessages.tsx"],"names":["React","useState","useEffect","useRef","getJobDetails","storageService","notFound","chatVideoIcon","dummy","viewMore","close","sendMedia","sendBtn","loader","formatDateTime","renderTime","setShowToast","onFileUpload","getMessagesOfRoom","sendTextMessage","sendImageVideoMessage","Constants","FsLightbox","moengage","mixPanel","MoEConstants","lastDate","docTypes","UserMessages","props","divRref","getItem","_id","userId","toggle","setToggle","jobDetailLoader","setJobDetailLoader","currentJobDetails","setCurrentJobDetails","messageText","setMessageText","messages","setMessages","isDocUploading","setIsDocUploading","itemsMedia","setItemsMedia","toggler","setToggler","selectedSlide","setSelectSlide","fsSlideListner","setFsSlideListner","oppUserFcmToken","setOppUserFcmToken","roomId","onReceiveOfNewMsg","console","log","roomData","scrollToBottom","current","scroll","scrollHeight","clientHeight","scrollTo","arrmsg","fsSlideObj","mediaMsgs","slideCount","length","filter","item","index","messageType","setInboxToTopWithLastMsg","lastMsg","newInboxData","inBoxData","currentIndex","findIndex","i","splice","unshift","setInBoxData","sendMessage","trimLeft","oppUserInfo","deviceToken","deviceType","hasOwnProperty","isNotification","sendFCMPushNotificationToOppUser","mData","timeStamp","getCurrentTimeStamp","moE_SendEvent","CHAT","mixP_SendEvent","handleKeyDown","event","key","sendImageVideoMsg","url","msgType","fetchJobDetail","jobId","res","success","jobInfo","jobDescription","data","details","jobName","amount","locationName","fromDate","toDate","duration","status","renderMediaItems","sources","types","forEach","push","mediaUrl","setResDeviceType","msg","Number","app_icon","title","notificationText","userName","senderName","room_id","messageRoomId","image","user_image","notificationType","sound","body","sender","first_name","device_token","user_id","device_type","split","badge","notification_type","messageId","notification","newData","to","headers_","FcmHeaderAuthorizationKey","fetch","method","headers","JSON","stringify","response","handleUpload","e","maxFileSize","formData","FormData","newFile","target","files","fileType","type","toLowerCase","selectedFileSize","size","includes","indexOf","append","check_type","imgUrl","renderTextMsg","curDate","messageTimestamp","messageClass","senderId","renderImageMsg","onerror","src","prev","renderVideoMsg","displayMessages","isNoRecords","history","name","map","isBlock","color","value","urlEncode"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport { getJobDetails } from '../../redux/jobs/actions';\nimport storageService from '../../utils/storageService';\n\nimport notFound from '../../assets/images/not-found.png';\nimport chatVideoIcon from '../../assets/images/video@3x.png';\nimport dummy from '../../assets/images/u_placeholder.jpg';\nimport viewMore from '../../assets/images/icon-direction-blue.png';\nimport close from '../../assets/images/ic-cancel-blue.png';\nimport sendMedia from '../../assets/images/ic-media.png';\nimport sendBtn from '../../assets/images/ic-send.png';\nimport loader from '../../assets/images/loader.gif';\n\nimport { formatDateTime, renderTime } from '../../utils/common';\nimport { setShowToast } from '../../redux/common/actions';\nimport { onFileUpload } from '../../redux/auth/actions';\nimport {\n    getMessagesOfRoom,\n    sendTextMessage,\n    sendImageVideoMessage,\n} from '../../services/firebase';\n\nimport Constants from '../../utils/constants';\n\n//@ts-ignore\nimport FsLightbox from 'fslightbox-react';\nimport { moengage, mixPanel } from '../../services/analyticsTools';\nimport { MoEConstants } from '../../utils/constants';\ninterface Types {\n    [key: string]: any | string;\n}\n\nlet lastDate = '';\nconst docTypes: Array<any> = [\"jpeg\", \"jpg\", \"png\", \"mp4\", \"wmv\", \"avi\"];\n\nconst UserMessages = (props: any) => {\n    const divRref = useRef<HTMLDivElement>(null);\n    const [userId] = useState<string>(storageService.getItem('userInfo')?._id);\n    const [toggle, setToggle] = useState<boolean>(false);\n    const [jobDetailLoader, setJobDetailLoader] = useState<boolean>(false);\n    const [currentJobDetails, setCurrentJobDetails] = useState<any>(null);\n    const [messageText, setMessageText] = useState<any>('');\n    const [messages, setMessages] = useState<Array<any>>([]);\n    const [isDocUploading, setIsDocUploading] = useState<boolean>(false);\n\n    const [itemsMedia, setItemsMedia] = useState([]);\n    const [toggler, setToggler] = useState(false);\n    const [selectedSlide, setSelectSlide] = useState<any>(1);\n    const [fsSlideListner, setFsSlideListner] = useState<any>({});\n    const [oppUserFcmToken, setOppUserFcmToken] = useState<any>('');\n\n    useEffect(() => {\n        if (props.roomId !== '') {\n            lastDate = '';\n            getMessagesOfRoom(props.roomId, onReceiveOfNewMsg);\n            setSelectSlide(1);\n            setFsSlideListner({});\n            setItemsMedia([]);\n            setCurrentJobDetails(null);\n            setToggle(false);\n        }\n    }, [props.roomId]);\n    // }, [props.roomId, props.roomData]);\n    console.log('props.roomData: ', props.roomData);\n\n    useEffect(() => {\n        scrollToBottom();\n    });\n\n    const scrollToBottom = () => {\n        if (null !== divRref?.current) {\n            const scroll =\n                divRref.current.scrollHeight -\n                divRref.current.clientHeight;\n            // divRref.current.scrollIntoView({ behavior: \"smooth\" })\n            divRref.current.scrollTo(0, scroll);\n        }\n    }\n\n    const onReceiveOfNewMsg = (arrmsg: any) => {\n        console.log('arrmsg: ', arrmsg);\n        setMessages(arrmsg);\n    }\n\n    useEffect(() => {\n        let fsSlideObj: any = {};\n        let mediaMsgs: any = [];\n        let slideCount = 1;\n        if (messages.length) {\n            mediaMsgs = messages.filter((item: any, index: number) => {\n                if (item.messageType === 'image' || item.messageType === 'video') {\n                    fsSlideObj[`${index}`] = slideCount++;\n                    return item;\n                }\n            });\n            setItemsMedia(mediaMsgs);\n            setFsSlideListner(fsSlideObj);\n        }\n    }, [messages]);\n    console.log('itemsMedia: ', itemsMedia, \"fsSlideListner\", fsSlideListner);\n\n    const setInboxToTopWithLastMsg = (lastMsg: any) => {\n        const newInboxData = [...props.inBoxData];\n        const currentIndex = newInboxData.findIndex(i => i.roomId === props.roomId);\n        newInboxData[currentIndex].lastMsg = lastMsg;\n        newInboxData.splice(currentIndex, 1);\n        newInboxData.unshift(props.inBoxData[currentIndex]);\n        props.setInBoxData(newInboxData);\n        console.log('lastMsg: ', lastMsg);\n        console.log('currentIndex: ', currentIndex);\n        console.log('newInboxData: ', newInboxData);\n    }\n\n    const sendMessage = async () => {\n        //setIsLoading(true);\n        if (messageText && messageText.trimLeft() !== \"\") {\n            setMessageText('');\n            const lastMsg: any = await sendTextMessage(props.roomId, messageText);\n            if (lastMsg &&\n                props.roomData?.oppUserInfo?.deviceToken\n                && props.roomData?.oppUserInfo?.deviceType\n                && (props.roomData?.oppUserInfo?.hasOwnProperty('isNotification') ? props.roomData?.oppUserInfo?.isNotification : true)\n            ) {\n                sendFCMPushNotificationToOppUser(lastMsg);\n                const mData = {\n                    timeStamp: moengage.getCurrentTimeStamp(),\n                }\n                moengage.moE_SendEvent(MoEConstants.CHAT, mData);\n                mixPanel.mixP_SendEvent(MoEConstants.CHAT, mData);\n            }\n            setInboxToTopWithLastMsg(lastMsg);\n        }\n    }\n\n    const handleKeyDown = (event: any) => {\n        if (event.key === 'Enter') {\n            sendMessage();\n        }\n    }\n\n    const sendImageVideoMsg = async (url: string, msgType: string) => {\n        //setIsLoading(true);\n        if (url && url !== '') {\n            const lastMsg: any = await sendImageVideoMessage(props.roomId, url, msgType);\n            if (lastMsg\n                && props.roomData?.oppUserInfo?.deviceToken\n                && props.roomData?.oppUserInfo?.deviceType\n                && (props.roomData?.oppUserInfo?.hasOwnProperty('isNotification') ? props.roomData?.oppUserInfo?.isNotification : true)\n            ) {\n                sendFCMPushNotificationToOppUser(lastMsg);\n            }\n            setInboxToTopWithLastMsg(lastMsg);\n        }\n        setMessageText('');\n    }\n\n\n    const fetchJobDetail = async (jobId: any) => {\n        setJobDetailLoader(true);\n        const res = await getJobDetails(jobId);\n        if (res.success) {\n            const jobInfo = {\n                jobDescription: res.data?.details || '',\n                jobId: res.data?.jobId || '',\n                jobName: res.data?.jobName || '',\n                amount: res.data?.amount || '',\n                locationName: res.data?.locationName || '',\n                fromDate: res.data?.fromDate || '',\n                toDate: res.data?.toDate || '',\n                duration: res.data?.duration || '',\n                status: res.data?.status || '',\n            }\n            setCurrentJobDetails(jobInfo);\n            setJobDetailLoader(false);\n        }\n    }\n\n    const renderMediaItems = (itemsMedia: any) => {\n        let sources: any = [];\n        let types: any = [];\n\n        if (itemsMedia.length) {\n            itemsMedia.forEach((item: any) => {\n                if (item.messageType === 'video') {\n                    sources.push(item.mediaUrl);\n                    types.push('video');\n                }\n                if (item.messageType === 'image') {\n                    sources.push(item.mediaUrl);\n                    types.push('image');\n                }\n            })\n        }\n\n        return { sources, types };\n    }\n\n    const setResDeviceType = (deviceType: number, msg: any) => {\n        switch (Number(deviceType)) {\n            case 1:\n                return {\n                    app_icon: \"https://appinventiv-development.s3.amazonaws.com/1628513615740ic-logo-yellow.png\",\n                    title: \"Tickt App\",\n                    notificationText: `${storageService.getItem('userInfo')?.userName} send you a message`,\n                    senderName: `${storageService.getItem('userInfo')?.userName}`,\n                    messageType: `${msg?.messageType}`,\n                    messageText: `${msg?.messageType === 'text' ? msg?.messageText : ''}`,\n                    room_id: msg?.messageRoomId,\n                    image: storageService.getItem('userInfo')?.user_image,\n                    notificationType: 25,\n                    sound: \"default\",\n                }\n            case 2:\n                return {\n                    body: msg?.messageText,\n                    messageText: msg?.messageText,\n                    sender: {\n                        first_name: storageService.getItem('userInfo')?.userName,\n                        device_token: storageService.getItem('fcmToken'),\n                        user_id: storageService.getItem('userInfo')?._id,\n                        device_type: 2,\n                    },\n                    jobId: msg?.messageRoomId?.split('_')?.[0],\n                    badge: 1,\n                    device_type: 2,\n                    title: storageService.getItem('userInfo')?.userName,\n                    jobName: props.roomData?.jobName,\n                    notification_type: 50,\n                    sound: 'default',\n                    messageId: msg?.messageId,\n                }\n            case 3:\n                return {\n                    notification: {\n                        body: msg?.messageText,\n                        title: storageService.getItem('userInfo')?.userName\n                    },\n                    data: {\n                        body: msg?.messageText,\n                        messageText: msg?.messageText,\n                        sender: {\n                            first_name: storageService.getItem('userInfo')?.userName,\n                            device_token: storageService.getItem('fcmToken'),\n                            user_id: storageService.getItem('userInfo')?._id,\n                            device_type: 2,\n                        },\n                        jobId: msg?.messageRoomId?.split('_')?.[0],\n                        badge: 1,\n                        device_type: 2,\n                        title: storageService.getItem('userInfo')?.userName,\n                        jobName: props.roomData?.jobName,\n                        notification_type: 50,\n                        sound: 'default',\n                        messageId: msg?.messageId,\n                    }\n                }\n            default:\n                return;\n        }\n    }\n    const sendFCMPushNotificationToOppUser = async (msg: any) => {\n        let data = setResDeviceType(props.roomData?.oppUserInfo?.deviceType, msg);\n        let newData = {\n            to: `${props.roomData?.oppUserInfo?.deviceToken}`,\n            ...(props.roomData?.oppUserInfo?.deviceType == 1 && { data: data }),\n            ...(props.roomData?.oppUserInfo?.deviceType == 2 && { notification: data }),\n            ...(props.roomData?.oppUserInfo?.deviceType == 3 && { notification: data?.notification, data: data?.data }),\n        };\n\n        const headers_: Types = {\n            'Content-Type': 'application/json',\n            'Authorization': Constants.FcmHeaderAuthorizationKey,\n        }\n        const response: any = await fetch(`https://fcm.googleapis.com/fcm/send`, {\n            method: \"POST\",\n            headers: headers_,\n            body: JSON.stringify(newData)\n        });\n        // const res: any = await response.json();\n        if (response.status === 200) {\n            console.log('Chat push notification send to opposite user: success');\n        } else {\n            console.log('Chat push notification send to opposite user: failure');\n        }\n    }\n\n    const handleUpload = async (e: any) => {\n        let maxFileSize: number = 10;\n        const formData = new FormData();\n        const newFile = e.target.files[0];\n        var fileType = (newFile?.type?.split('/')[1])?.toLowerCase();\n\n        var selectedFileSize = newFile?.size / 1024 / 1024; // size in mb\n        if ([\"mp4\", \"wmv\", \"avi\"].includes(fileType)) {\n            maxFileSize = 20;\n        }\n        if (docTypes.indexOf(fileType) < 0 || (selectedFileSize > maxFileSize)) {\n            setShowToast(true, \"The file must be in proper format or size\")\n            return;\n        }\n\n        formData.append('file', newFile);\n        setIsDocUploading(true);\n        let check_type: any = [\"jpeg\", \"jpg\", \"png\"].includes(fileType) ? 1 : [\"mp4\", \"wmv\", \"avi\"].includes(fileType) ? 2 : null;\n        const res = await onFileUpload(formData);\n        if (res.success && res.imgUrl) {\n            if (check_type === 1) {\n                sendImageVideoMsg(res.imgUrl, \"image\");\n            } else if (check_type === 2) {\n                sendImageVideoMsg(res.imgUrl, \"video\");\n            } else {\n                setShowToast(true, \"There is some technical issue\");\n            }\n            setIsDocUploading(false);\n            // setLocalFiles((prev: any) => ({ ...prev, [filesUrl?.length]: URL.createObjectURL(newFile) }));\n        }\n    }\n\n    const renderTextMsg = (msg: any) => {\n        let curDate = formatDateTime(msg.messageTimestamp, 'day');\n        const messageClass = msg.senderId === userId ? 'message' : 'message recive_msg';\n        if (lastDate === '' || lastDate !== curDate) {\n            lastDate = curDate;\n            return (\n                <>\n                    <div className=\"date_time\">\n                        <span>{curDate}</span>\n                    </div>\n                    <div className={`${messageClass}`}>\n                        <p className={`${msg.senderId === userId ? 'mark' : ''}`}>{msg.messageText}\n                            <span className=\"time\">{formatDateTime(msg.messageTimestamp, \"time\")}</span>\n                        </p>\n                    </div>\n                </>\n            )\n        } else\n            return (\n                <div className={`${messageClass}`}>\n                    <p className={`${msg.senderId === userId ? 'mark' : ''}`}>{msg.messageText}\n                        <span className=\"time\">{formatDateTime(msg.messageTimestamp, \"time\")}</span>\n                    </p>\n                </div>\n            )\n    }\n\n    const renderImageMsg = (msg: any, index: number) => {\n        let curDate = formatDateTime(msg.messageTimestamp, 'day');\n        const messageClass = msg.senderId === userId ? 'message' : 'message recive_msg';\n        if (lastDate === '' || lastDate !== curDate) {\n            lastDate = curDate;\n            return (\n                <>\n                    <div className=\"date_time\">\n                        <span>{curDate}</span>\n                    </div>\n                    <div className={`${messageClass}`}>\n                        <figure className=\"media\">\n                            <img src={msg.mediaUrl || notFound} alt=\"media\"\n                                async-src={msg.mediaUrl || notFound}\n                                decoding=\"async\"\n                                loading=\"lazy\"\n                                onError={(e: any) => {\n                                    if (e?.target?.onerror) {\n                                        e.target.onerror = null;\n                                    }\n                                    if (e?.target?.src) {\n                                        e.target.src = notFound;\n                                    }\n                                }}\n                                onClick={() => {\n                                    setToggler((prev: any) => !prev);\n                                    setSelectSlide(fsSlideListner[`${index}`]);\n                                }} />\n                            <span className=\"time\">{formatDateTime(msg.messageTimestamp, \"time\")}</span>\n                        </figure>\n                    </div>\n                </>\n            )\n        } else\n            return (\n                <div className={`${messageClass}`}>\n                    <figure className=\"media\">\n                        <img src={msg.mediaUrl || notFound} alt=\"media\"\n                            async-src={msg.mediaUrl || notFound}\n                            decoding=\"async\"\n                            loading=\"lazy\"\n                            onError={(e: any) => {\n                                if (e?.target?.onerror) {\n                                    e.target.onerror = null;\n                                }\n                                if (e?.target?.src) {\n                                    e.target.src = notFound;\n                                }\n                            }}\n                            onClick={() => {\n                                setToggler((prev: any) => !prev);\n                                setSelectSlide(fsSlideListner[`${index}`]);\n                            }} />\n                        <span className=\"time\">{formatDateTime(msg.messageTimestamp, \"time\")}</span>\n                    </figure>\n                </div>\n            )\n    }\n\n    const renderVideoMsg = (msg: any, index: number) => {\n        let curDate = formatDateTime(msg.messageTimestamp, 'day');\n        const messageClass = msg.senderId === userId ? 'message' : 'message recive_msg';\n        if (lastDate === '' || lastDate !== curDate) {\n            lastDate = curDate;\n            return (\n                <>\n                    <div className=\"date_time\">\n                        <span>{curDate}</span>\n                    </div>\n                    <div className={`${messageClass}`}>\n                        <figure className=\"media media_video \">\n                            <video src={msg.mediaUrl || notFound}\n                                poster={chatVideoIcon}\n                                onClick={() => {\n                                    setToggler((prev: any) => !prev);\n                                    setSelectSlide(fsSlideListner[`${index}`]);\n                                }}\n                            />\n                            <span className=\"time\">{formatDateTime(msg.messageTimestamp, \"time\")}</span>\n                        </figure>\n                    </div>\n                </>\n            )\n        } else\n            return (\n                <div className={`${messageClass}`}>\n                    <figure className=\"media media_video \">\n                        <video src={msg.mediaUrl || notFound}\n                            poster={chatVideoIcon}\n                            onClick={() => {\n                                setToggler((prev: any) => !prev);\n                                setSelectSlide(fsSlideListner[`${index}`]);\n                            }}\n                        />\n                        <span className=\"time\">{formatDateTime(msg.messageTimestamp, \"time\")}</span>\n                    </figure>\n                </div>\n            )\n    }\n\n    const displayMessages = (msg: any, index: number) => {\n        if (index === 0) lastDate = '';\n        switch (msg.messageType) {\n            case \"text\":\n                return renderTextMsg(msg);\n            case \"image\":\n                return renderImageMsg(msg, index);\n            case \"video\":\n                return renderVideoMsg(msg, index);\n        }\n    }\n\n    const { sources, types } = renderMediaItems(itemsMedia);\n\n    return (props.isNoRecords ? (\n        <div className=\"detail_col\">\n            <div className=\"flex_row\">\n                {/* <div>No Record Found</div> */}\n                <div></div>\n            </div>\n        </div>\n    ) : (\n        <>\n            <FsLightbox\n                toggler={toggler}\n                slide={selectedSlide}\n                sources={sources}\n                types={types}\n                key={sources?.length}\n                // disableLocalStorage={true}\n                onClose={() => {\n                    setSelectSlide(1)\n                }}\n            />\n            <div className=\"detail_col\">\n                <div className=\"flex_row\">\n\n\n                    <div className={`chat_col ${toggle ? 'active' : ''}`}>\n                        <div className=\"chat_user\">\n                            <figure className=\"u_img\">\n                                <img\n                                    src={props.roomData?.oppUserInfo?.image || dummy}\n                                    alt=\"user-img\"\n                                    onError={(e: any) => {\n                                        if (e?.target?.onerror) {\n                                            e.target.onerror = null;\n                                        }\n                                        if (e?.target?.src) {\n                                            e.target.src = dummy;\n                                        }\n                                    }}\n                                />\n                            </figure>\n                            <span className=\"name\"\n                                onClick={() => {\n                                    if (storageService.getItem('userType') === 2) {\n                                        props.history.push(`/tradie-info?tradeId=${props.roomData?.oppUserInfo?.userId}&hideInvite=true`);\n                                    } else {\n                                        props.history.push(`/builder-info?builderId=${props.roomData?.oppUserInfo?.userId}`);\n                                    }\n                                }}>{props.roomData?.oppUserInfo?.name}</span>\n                            {!toggle && <span\n                                onClick={() => {\n                                    setToggle(true);\n                                    if (currentJobDetails) return;\n                                    fetchJobDetail(props.roomData?.jobId);\n                                }}\n                                className=\"view_detail\">View Job Details\n                                <img src={viewMore} alt=\"view-more\" />\n                            </span>}\n                        </div>\n                        <div className=\"message_wrapr\" ref={divRref}>\n                            {messages.length > 0 && messages.map((msg: any, index: number) => {\n                                return (\n                                    displayMessages(msg, index)\n                                )\n                            })}\n                            <div className=\"date_time\">\n                                {props.roomData?.oppUserInfo?.isBlock && < i style={{ color: '#929292' }}>{'You can no longer chat with the user'}</i>}\n                            </div>\n                        </div>\n\n                        {!props.roomData?.oppUserInfo?.isBlock && <div className=\"send_msg\">\n                            <div className=\"text_field\">\n                                <label className=\"upload_item\" htmlFor=\"upload_item\">\n                                    <span className=\"detect_icon_ltr\">\n                                        <img src={sendMedia} alt=\"media\" />\n                                    </span>\n                                </label>\n                                <input\n                                    id=\"upload_item\"\n                                    className=\"hide\"\n                                    type=\"file\"\n                                    accept=\"image/png,image/jpg,image/jpeg, video/mp4, video/wmv, video/avi\"\n                                    onChange={handleUpload}\n                                    disabled={isDocUploading}\n                                />\n                                <textarea placeholder=\"Message..\"\n                                    onKeyDown={handleKeyDown}\n                                    value={messageText} onChange={(e) => setMessageText(e.target.value)} />\n                                <span className=\"detect_icon\">\n                                    <img src={sendBtn} alt=\"send\" onClick={sendMessage} />\n                                </span>\n                            </div>\n                        </div>}\n                    </div>\n\n                    {(toggle && jobDetailLoader) ? (\n                        <div className=\"view_detail_col\">\n                            <div className=\"no_record\">\n                                <figure>\n                                    <img src={loader} alt=\"loader\" width=\"130px\" />\n                                </figure>\n                            </div>\n                        </div>\n                    ) : toggle ? (\n                        <div className=\"view_detail_col\">\n                            <div className=\"f_spacebw relative\">\n                                <span className=\"title line-2 pr-20\">{currentJobDetails?.jobName}</span>\n                                <span\n                                    onClick={() => {\n                                        setToggle((prev) => !prev)\n                                    }}\n                                    className=\"close\">\n                                    <img src={close} alt=\"close\" />\n                                </span>\n                            </div>\n\n                            <div className=\"job_info\">\n                                <ul>\n                                    <li className=\"icon clock\">{renderTime(currentJobDetails?.fromDate, currentJobDetails?.toDate)}</li>\n                                    <li className=\"icon dollar\">{currentJobDetails?.amount}</li>\n                                    <li className=\"icon location line-1\">{currentJobDetails?.locationName}</li>\n                                    <li className=\"icon calendar\">{currentJobDetails?.duration}</li>\n                                </ul>\n                            </div>\n\n                            <p className=\"commn_para\">\n                                {currentJobDetails?.jobDescription}\n                            </p>\n\n                            <button className=\"fill_btn full_btn btn-effect\"\n                                onClick={() => {\n                                    if (storageService.getItem('userType') === 1) {\n                                        props.history.push(`/job-details-page?jobId=${currentJobDetails?.jobId}&redirect_from=jobs`);\n                                    } else {\n                                        // let urlEncode: any = window.btoa(`?jobId=${currentJobDetails?.jobId}&status=${currentJobDetails?.status}&edit=true&activeType=active`)\n                                        let urlEncode: any = `?jobId=${currentJobDetails?.jobId}&status=${currentJobDetails?.status}&edit=true&activeType=active`\n                                        props.history.push(`/job-detail?${urlEncode}`);\n                                    }\n                                }}>View Job details</button>\n                        </div>\n                    ) : null}\n                </div>\n            </div >\n        </>)\n    )\n}\n\nexport default UserMessages;\n"]},"metadata":{},"sourceType":"module"}