{"ast":null,"code":"import _toConsumableArray from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState,useCallback}from'react';import masterIcon from\"../../../../assets/images/mastercard.svg\";import visaIcon from\"../../../../assets/images/visacard.svg\";import check from'../../../../assets/images/checked-2.png';import PaymentDetails from'./paymentDetails';import{withRouter}from'react-router-dom';import dotMenu from'../../../../assets/images/menu-dot.png';import Button from'@material-ui/core/Button';import Dialog from'@material-ui/core/Dialog';import DialogActions from'@material-ui/core/DialogActions';import DialogTitle from'@material-ui/core/DialogTitle';import{getCardList,deleteCard}from'../../../../redux/jobs/actions';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var ConfirmAndPay=function ConfirmAndPay(props){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),toggle=_useState2[0],setToggle=_useState2[1];var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),selected=_useState4[0],setSelected=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),editItem=_useState6[0],setEditItem=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),deleteToggle=_useState8[0],setDeleteToggle=_useState8[1];var _useState9=useState([]),_useState10=_slicedToArray(_useState9,2),paymentDetail=_useState10[0],setPaymentDetail=_useState10[1];var setAfterFetch=function setAfterFetch(filterItems){var _props$toggleDetails;console.log('Here!',{toggle:props===null||props===void 0?void 0:props.toggleDetails});if(props===null||props===void 0?void 0:(_props$toggleDetails=props.toggleDetails)===null||_props$toggleDetails===void 0?void 0:_props$toggleDetails.toggle){var _props$toggleDetails2;setToggle(true);var data=props===null||props===void 0?void 0:(_props$toggleDetails2=props.toggleDetails)===null||_props$toggleDetails2===void 0?void 0:_props$toggleDetails2.data;var exp_date=(data===null||data===void 0?void 0:data.exp_month).toLocaleString('en-US',{minimumIntegerDigits:2,useGrouping:false});var data_={cardId:data===null||data===void 0?void 0:data.cardId,number:\"\".concat(data===null||data===void 0?void 0:data.last4),cardholderName:data===null||data===void 0?void 0:data.name,date:\"\".concat(exp_date,\"/\").concat((data===null||data===void 0?void 0:data.exp_year).toString().substring(2,4)),cvv:'000',cardType:data===null||data===void 0?void 0:data.funding,fetched:true};setEditItem(data_);}};var fetchMyAPI=useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var result,data,filterItems;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return getCardList();case 2:result=_context.sent;data=result.data;filterItems=[];if(data===null||data===void 0?void 0:data.length){filterItems=data.map(function(item){var exp_date=(item===null||item===void 0?void 0:item.exp_month).toLocaleString('en-US',{minimumIntegerDigits:2,useGrouping:false});return{brand:item===null||item===void 0?void 0:item.brand,cardId:item===null||item===void 0?void 0:item.cardId,number:\"\".concat(item===null||item===void 0?void 0:item.last4),cardholderName:item===null||item===void 0?void 0:item.name,date:\"\".concat(exp_date,\"/\").concat((item===null||item===void 0?void 0:item.exp_year).toString().substring(2,4)),cvv:'000',cardType:item===null||item===void 0?void 0:item.funding,fetched:true};});}setPaymentDetail(filterItems);setAfterFetch(filterItems);case 8:case\"end\":return _context.stop();}}},_callee);})),[]);useEffect(function(){fetchMyAPI();},[]);useEffect(function(){if(toggle==false){fetchMyAPI();}},[toggle]);var backToScreen=function backToScreen(){var _props$toggleDetails3;setToggle(false);if(props===null||props===void 0?void 0:(_props$toggleDetails3=props.toggleDetails)===null||_props$toggleDetails3===void 0?void 0:_props$toggleDetails3.data){props.backToScreen();}};var setDetials=function setDetials(data){if(data===null||data===void 0?void 0:data.index){paymentDetail[data===null||data===void 0?void 0:data.index]=data;}else{setPaymentDetail(function(prev){return[].concat(_toConsumableArray(prev),[data]);});}};if(toggle){console.log({editItem:editItem});return/*#__PURE__*/_jsx(PaymentDetails,{jobName:props===null||props===void 0?void 0:props.jobName,editItem:editItem,backToScreen:backToScreen,setDetials:setDetials,hideExtra:props.hideExtra,onSubmitAccept:props.onSubmitAccept});}return/*#__PURE__*/_jsx(\"div\",{className:\"flex_row\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex_col_sm_8\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"relate\",children:[!props.hideExtra?/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){props.backToScreen();},className:\"back\"}):null,/*#__PURE__*/_jsx(\"span\",{className:!props.hideExtra?\"xs_sub_title\":'xs_sub_title mb0',children:props===null||props===void 0?void 0:props.jobName}),/*#__PURE__*/_jsxs(Dialog,{open:deleteToggle,onClose:function onClose(){setDeleteToggle(function(prev){return!prev;});},\"aria-labelledby\":\"alert-dialog-title\",\"aria-describedby\":\"alert-dialog-description\",children:[/*#__PURE__*/_jsx(DialogTitle,{id:\"alert-dialog-title\",children:\"Are you sure you want to delete ?\"}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{onClick:/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(e){var result;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:e.preventDefault();_context2.next=3;return deleteCard({cardId:paymentDetail[selected].cardId});case 3:result=_context2.sent;if(result.success){setDeleteToggle(function(prev){return!prev;});fetchMyAPI();}case 5:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x){return _ref2.apply(this,arguments);};}(),color:\"primary\",autoFocus:true,children:'Yes'}),/*#__PURE__*/_jsx(Button,{onClick:function onClick(){setDeleteToggle(function(prev){return!prev;});},color:\"primary\",children:'No'})]})]}),selected>-1?/*#__PURE__*/_jsxs(\"span\",{className:\"dot_menu\",children:[/*#__PURE__*/_jsx(\"img\",{src:dotMenu,alt:\"edit\"}),/*#__PURE__*/_jsx(\"div\",{className:\"edit_menu\",children:/*#__PURE__*/_jsxs(\"ul\",{children:[/*#__PURE__*/_jsx(\"li\",{onClick:function onClick(){try{console.log({paymentDetail:paymentDetail,selected:selected});var item=paymentDetail.find(function(_,index){console.log({_:_,index:index});if(index==selected){return _;}});item['index']=selected;setEditItem(item);setToggle(true);}catch(err){console.log(err);}},className:\"icon lodge\",children:'Edit'}),/*#__PURE__*/_jsx(\"li\",{onClick:function onClick(){setDeleteToggle(function(prev){return!prev;});},className:\"icon delete\",children:'Delete'})]})})]}):null]}),/*#__PURE__*/_jsx(\"div\",{className:\"form_field\",children:!props.hideExtra?/*#__PURE__*/_jsx(\"span\",{className:\"sub_title\",children:'Confirm and pay'}):/*#__PURE__*/_jsx(\"span\",{className:\"sub_title\",children:'Payment Details'})}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb130\",children:[(paymentDetail===null||paymentDetail===void 0?void 0:paymentDetail.length)?paymentDetail.map(function(item,index){var _item$cardType,_item$cardType2,_item$number,_item$number2;return/*#__PURE__*/_jsxs(\"button\",{onClick:function onClick(){setSelected(index);},className:\"card_btn full_btn\",children:[/*#__PURE__*/_jsx(\"img\",{src:item.brand=='visa'?visaIcon:masterIcon,alt:\"card-icon\",className:\"pos card\"}),\"\".concat((item===null||item===void 0?void 0:(_item$cardType=item.cardType)===null||_item$cardType===void 0?void 0:_item$cardType.charAt(0).toUpperCase())+(item===null||item===void 0?void 0:(_item$cardType2=item.cardType)===null||_item$cardType2===void 0?void 0:_item$cardType2.slice(1)),\" Card\"),' ',/*#__PURE__*/_jsxs(\"span\",{className:\"show_label\",children:[\"XXXX \",(item===null||item===void 0?void 0:item.number).substring((item===null||item===void 0?void 0:(_item$number=item.number)===null||_item$number===void 0?void 0:_item$number.length)-4,item===null||item===void 0?void 0:(_item$number2=item.number)===null||_item$number2===void 0?void 0:_item$number2.length)]}),selected==index?/*#__PURE__*/_jsx(\"img\",{src:check,alt:\"check\",className:\"pos check\"}):null]});}):null,/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){setToggle(true);setEditItem('');},className:\"fill_grey_btn full_btn btn-effect\",children:(paymentDetail===null||paymentDetail===void 0?void 0:paymentDetail.length)?'Add another card':'Add card'})]}),!props.hideExtra?/*#__PURE__*/_jsxs(React.Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form_field\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"payment_note\",children:\"Tickt does not store your payment information.\"}),/*#__PURE__*/_jsx(\"p\",{className:\"commn_para\",children:\"Tickt does not handle payment for jobs, we only facilitate communication between tradespeople and builders. If you have problems receiving your payment, please contact your builder.\"})]}),/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){var _props$dataItem,_props$dataItem$selec,_props$dataItem2,_props$dataItem2$item,_paymentDetail$select;// this will submit the accept request.\nvar index=props===null||props===void 0?void 0:(_props$dataItem=props.dataItem)===null||_props$dataItem===void 0?void 0:(_props$dataItem$selec=_props$dataItem.selectedMilestoneIndex)===null||_props$dataItem$selec===void 0?void 0:_props$dataItem$selec.index;var milestoneAmount=props===null||props===void 0?void 0:(_props$dataItem2=props.dataItem)===null||_props$dataItem2===void 0?void 0:(_props$dataItem2$item=_props$dataItem2.itemDetails.milestones[index])===null||_props$dataItem2$item===void 0?void 0:_props$dataItem2$item.milestoneAmount;console.log({props:props,milestoneAmount:milestoneAmount,index:index},'-------->');props.onSubmitAccept({total:props.total,cardId:(_paymentDetail$select=paymentDetail[selected])===null||_paymentDetail$select===void 0?void 0:_paymentDetail$select.cardId,milestoneAmount:milestoneAmount});},className:\"fill_btn full_btn btn-effect \".concat(!(paymentDetail===null||paymentDetail===void 0?void 0:paymentDetail.length)?'disable_btn':''),children:'Continue'})]}):/*#__PURE__*/_jsx(React.Fragment,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"form_field\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"payment_note\",children:\"Tickt does not store your payment information.\"}),/*#__PURE__*/_jsx(\"p\",{className:\"commn_para\",children:\"Tickt does not handle payment for jobs, we only facilitate communication between tradespeople and builders. If you have problems receiving your payment, please contact your builder.\"})]})})]})});};export default withRouter(ConfirmAndPay);","map":{"version":3,"sources":["/home/appinventiv/Documents/Project/tickt/web/src/pages/builderJobDasboard/components/confirmAndPay/confirmAndPay.tsx"],"names":["React","useEffect","useState","useCallback","check","PaymentDetails","withRouter","dotMenu","Button","Dialog","DialogActions","DialogTitle","getCardList","deleteCard","ConfirmAndPay","props","toggle","setToggle","selected","setSelected","editItem","setEditItem","deleteToggle","setDeleteToggle","paymentDetail","setPaymentDetail","setAfterFetch","filterItems","console","log","toggleDetails","data","exp_date","exp_month","toLocaleString","minimumIntegerDigits","useGrouping","data_","cardId","number","last4","cardholderName","name","date","exp_year","toString","substring","cvv","cardType","funding","fetched","fetchMyAPI","result","length","map","item","brand","backToScreen","setDetials","index","prev","jobName","hideExtra","onSubmitAccept","e","preventDefault","success","find","_","err","visaIcon","masterIcon","charAt","toUpperCase","slice","dataItem","selectedMilestoneIndex","milestoneAmount","itemDetails","milestones","total"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useCallback } from 'react';\nimport masterIcon from '../../../../assets/images/mastercard.svg';\nimport visaIcon from '../../../../assets/images/visacard.svg';\nimport check from '../../../../assets/images/checked-2.png';\n\nimport PaymentDetails from './paymentDetails';\nimport Success from './suceess';\nimport { withRouter } from 'react-router-dom';\n\nimport dotMenu from '../../../../assets/images/menu-dot.png'\n\nimport Button from '@material-ui/core/Button';\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport DialogContentText from '@material-ui/core/DialogContentText';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport { getCardList, deleteCard } from '../../../../redux/jobs/actions'\n\n\n\nconst ConfirmAndPay = (props: any) => {\n    const [toggle, setToggle] = useState(false);\n    const [selected, setSelected] = useState(0);\n    const [editItem, setEditItem] = useState<any>('');\n    const [deleteToggle, setDeleteToggle] = useState(false);\n    const [paymentDetail, setPaymentDetail] = useState<any>([]);\n\n\n    const setAfterFetch = (filterItems: any) => {\n        console.log('Here!', {\n            toggle: props?.toggleDetails\n        })\n        if (props?.toggleDetails?.toggle) {\n            setToggle(true);\n            let data = props?.toggleDetails?.data;\n            let exp_date = (data?.exp_month).toLocaleString('en-US', { minimumIntegerDigits: 2, useGrouping: false })\n            let data_: any = {\n                cardId: data?.cardId,\n                number: `${data?.last4}`,\n                cardholderName: data?.name,\n                date: `${exp_date}/${((data?.exp_year).toString()).substring(2, 4)}`,\n                cvv: '000',\n                cardType: data?.funding,\n                fetched: true\n            }\n\n            setEditItem(data_);\n        }\n    }\n\n    const fetchMyAPI = useCallback(async () => {\n        let result: any = await getCardList();\n        let data: any = result.data;\n        let filterItems: any = []\n        if (data?.length) {\n            filterItems = data.map((item: any) => {\n                let exp_date = (item?.exp_month).toLocaleString('en-US', { minimumIntegerDigits: 2, useGrouping: false })\n                return {\n                    brand: item?.brand,\n                    cardId: item?.cardId,\n                    number: `${item?.last4}`,\n                    cardholderName: item?.name,\n                    date: `${exp_date}/${((item?.exp_year).toString()).substring(2, 4)}`,\n                    cvv: '000',\n                    cardType: item?.funding,\n                    fetched: true\n                }\n            });\n        }\n        setPaymentDetail(filterItems);\n        setAfterFetch(filterItems)\n    }, [])\n\n\n    useEffect(() => {\n        fetchMyAPI();\n    }, [])\n\n    useEffect(() => {\n        if (toggle == false) {\n            fetchMyAPI();\n        }\n    }, [toggle]);\n\n    const backToScreen = () => {\n        setToggle(false);\n        if (props?.toggleDetails?.data) {\n            props.backToScreen();\n        }\n    }\n\n    const setDetials = (data: any) => {\n        if (data?.index) {\n            paymentDetail[data?.index] = data;\n        } else {\n            setPaymentDetail((prev: any) => ([...prev, data]))\n        }\n    }\n\n    if (toggle) {\n        console.log({\n            editItem\n        })\n        return (\n            <PaymentDetails\n                jobName={props?.jobName}\n                editItem={editItem}\n                backToScreen={backToScreen}\n                setDetials={setDetials}\n                hideExtra={props.hideExtra}\n                onSubmitAccept={props.onSubmitAccept}\n            />\n        )\n    }\n\n    return (\n        <div className=\"flex_row\">\n            <div className=\"flex_col_sm_8\">\n                <div className=\"relate\">\n                    {!props.hideExtra ? (\n                        <button\n                            onClick={() => {\n                                props.backToScreen()\n                            }}\n                            className=\"back\"></button>\n                    ) : null}\n                    <span className={!props.hideExtra ? `xs_sub_title` : 'xs_sub_title mb0'}>\n                        {props?.jobName}\n                    </span>\n\n                    <Dialog\n                        open={deleteToggle}\n                        onClose={() => {\n                            setDeleteToggle((prev: any) => !prev)\n                        }}\n                        aria-labelledby=\"alert-dialog-title\"\n                        aria-describedby=\"alert-dialog-description\"\n                    >\n                        <DialogTitle id=\"alert-dialog-title\">\n                            {\"Are you sure you want to delete ?\"}\n                        </DialogTitle>\n                        <DialogActions>\n                            <Button\n                                onClick={async (e) => {\n                                    e.preventDefault();\n                                    let result: any = await deleteCard({ cardId: paymentDetail[selected].cardId })\n                                    if (result.success) {\n                                        setDeleteToggle((prev: any) => !prev)\n                                        fetchMyAPI();\n                                    }\n                                }}\n                                color=\"primary\" autoFocus>\n                                {'Yes'}\n                            </Button>\n                            <Button\n                                onClick={() => {\n                                    setDeleteToggle((prev: any) => !prev)\n                                }}\n\n                                color=\"primary\">\n                                {'No'}\n                            </Button>\n                        </DialogActions>\n                    </Dialog>\n\n                    {(selected > -1) ? (\n                        <span className=\"dot_menu\">\n                            <img src={dotMenu} alt=\"edit\" />\n                            <div className=\"edit_menu\">\n                                <ul>\n                                    <li\n                                        onClick={() => {\n                                            try {\n                                                console.log({\n                                                    paymentDetail,\n                                                    selected\n                                                })\n                                                let item = paymentDetail.find((_: any, index: any) => {\n                                                    console.log({ _, index })\n                                                    if (index == selected) {\n                                                        return _;\n                                                    }\n                                                });\n                                                item['index'] = selected;\n                                                setEditItem(item);\n                                                setToggle(true);\n                                            } catch (err) {\n                                                console.log(err);\n                                            }\n                                        }}\n                                        className=\"icon lodge\">{'Edit'}</li>\n                                    <li\n                                        onClick={() => {\n                                            setDeleteToggle((prev: any) => !prev);\n                                        }}\n                                        className=\"icon delete\">{'Delete'}</li>\n                                </ul>\n                            </div>\n                        </span>\n                    ) : null}\n                </div>\n                <div className=\"form_field\">\n                    {!props.hideExtra ? (\n                        <span className=\"sub_title\">\n                            {'Confirm and pay'}\n                        </span>\n                    ) : (\n                        <span className=\"sub_title\">\n                            {'Payment Details'}\n                        </span>\n                    )}\n                </div>\n                <div className=\"mb130\">\n                    {paymentDetail?.length ?\n                        paymentDetail.map((item: any, index: any) => (\n                            <button\n                                onClick={() => {\n                                    setSelected(index);\n                                }}\n                                className=\"card_btn full_btn\">\n                                <img src={item.brand == 'visa' ? visaIcon : masterIcon} alt=\"card-icon\" className=\"pos card\" />\n                                {/* {item?.cardholderName} */}\n                                {`${item?.cardType?.charAt(0).toUpperCase() + item?.cardType?.slice(1)} Card`}{' '}\n                                <span className=\"show_label\">\n                                    XXXX {(item?.number).substring(item?.number?.length - 4, item?.number?.length)}\n                                </span>\n                                {selected == index ? (\n                                    <img src={check} alt=\"check\" className=\"pos check\" />\n                                ) : null}\n                            </button>\n                        ))\n                        : null}\n\n                    <button\n                        onClick={() => {\n                            setToggle(true);\n                            setEditItem('')\n                        }}\n                        className=\"fill_grey_btn full_btn btn-effect\">\n                        {paymentDetail?.length ? 'Add another card' : 'Add card'}\n                    </button>\n                </div>\n                {!props.hideExtra ? (\n                    <React.Fragment>\n                        <div className=\"form_field\">\n                            <span className=\"payment_note\">\n                                Tickt does not store your payment information.\n                            </span>\n                            <p className=\"commn_para\">\n                                Tickt does not handle payment for jobs, we only facilitate\n                                communication between tradespeople and builders. If you have problems\n                                receiving your payment, please contact your builder.\n                            </p>\n                        </div>\n\n                        <button\n                            onClick={() => {\n                                // this will submit the accept request.\n                                let index = props?.dataItem?.selectedMilestoneIndex?.index;\n                                let milestoneAmount = props?.dataItem?.itemDetails.milestones[index]?.milestoneAmount;\n                                console.log({\n                                    props,\n                                    milestoneAmount,\n                                    index\n                                }, '-------->');\n                                props.onSubmitAccept({\n                                    total: props.total,\n                                    cardId: paymentDetail[selected]?.cardId,\n                                    milestoneAmount\n                                });\n                            }}\n                            className={`fill_btn full_btn btn-effect ${!paymentDetail?.length ? 'disable_btn' : ''}`}>\n                            {'Continue'}\n                        </button>\n                    </React.Fragment>\n                ) : (\n                    <React.Fragment>\n                        <div className=\"form_field\">\n                            <span className=\"payment_note\">\n                                Tickt does not store your payment information.\n                            </span>\n                            <p className=\"commn_para\">\n                                Tickt does not handle payment for jobs, we only facilitate\n                                communication between tradespeople and builders. If you have problems\n                                receiving your payment, please contact your builder.\n                            </p>\n                        </div>\n                    </React.Fragment>\n                )}\n\n            </div>\n        </div>\n    )\n}\n\nexport default withRouter(ConfirmAndPay);\n"]},"metadata":{},"sourceType":"module"}