{"ast":null,"code":"import _objectSpread from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _toConsumableArray from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState}from'react';import close from'../../../assets/images/icon-close-1.png';import addMedia from\"../../../assets/images/add-image.png\";import{onFileUpload}from'../../../redux/auth/actions';import{setShowToast}from'../../../redux/common/actions';import{moengage,mixPanel}from'../../../services/analyticsTools';import{MoEConstants}from'../../../utils/constants';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var imageFormats=[\"jpeg\",\"jpg\",\"png\"];var videoFormats=[\"mp4\",\"wmv\",\"avi\"];var DeclineMilestone=function DeclineMilestone(_ref){var milestoneAcceptOrDecline=_ref.milestoneAcceptOrDecline,toggleBack=_ref.toggleBack,jobId=_ref.jobId,jobName=_ref.jobName,milestoneId=_ref.milestoneId,resetStateLocal=_ref.resetStateLocal;var _useState=useState(''),_useState2=_slicedToArray(_useState,2),reason=_useState2[0],setReason=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),filesUrl=_useState4[0],setFilesUrl=_useState4[1];var _useState5=useState({}),_useState6=_slicedToArray(_useState5,2),localFiles=_useState6[0],setLocalFiles=_useState6[1];var _useState7=useState({}),_useState8=_slicedToArray(_useState7,2),update=_useState8[0],forceUpdate=_useState8[1];var onSubmitDecline=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var data,response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(filesUrl===null||filesUrl===void 0?void 0:filesUrl.length){_context.next=3;break;}setShowToast(true,'Please attach at least one media file');return _context.abrupt(\"return\",true);case 3:data={\"status\":2,\"jobId\":jobId,\"milestoneId\":milestoneId,\"reason\":reason,\"url\":filesUrl.length?filesUrl.map(function(file){return file.link;}):[]};_context.next=6;return milestoneAcceptOrDecline(data);case 6:response=_context.sent;if(response===null||response===void 0?void 0:response.success){moengage.moE_SendEvent(MoEConstants.MILESTONE_DECLINED,{timeStamp:moengage.getCurrentTimeStamp()});mixPanel.mixP_SendEvent(MoEConstants.MILESTONE_DECLINED,{timeStamp:moengage.getCurrentTimeStamp()});resetStateLocal(true);}case 8:case\"end\":return _context.stop();}}},_callee);}));return function onSubmitDecline(){return _ref2.apply(this,arguments);};}();var removeFromItem=function removeFromItem(index){filesUrl.splice(index,1);setFilesUrl(filesUrl);Array.isArray(update)?forceUpdate([]):forceUpdate({});};var onFileChange=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(e){var _newFile$type,_newFile$type$split$;var formData,newFile,filesUrlClone,countVideoFormats,fileType,selectedFileSize,res,link,check_type;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:formData=new FormData();newFile=e.target.files[0];if(!((filesUrl===null||filesUrl===void 0?void 0:filesUrl.length)===6)){_context2.next=5;break;}setShowToast(true,\"Max files upload limit is 6\");return _context2.abrupt(\"return\");case 5:filesUrlClone=filesUrl;countVideoFormats=filesUrlClone.map(function(item){var split_items=item.link.split('.');var format_split_items=split_items[(split_items===null||split_items===void 0?void 0:split_items.length)-1];if(videoFormats.includes(format_split_items)){return format_split_items;}}).filter(function(item){return item!==undefined;});fileType=newFile===null||newFile===void 0?void 0:(_newFile$type=newFile.type)===null||_newFile$type===void 0?void 0:(_newFile$type$split$=_newFile$type.split('/')[1])===null||_newFile$type$split$===void 0?void 0:_newFile$type$split$.toLowerCase();selectedFileSize=(newFile===null||newFile===void 0?void 0:newFile.size)/1024/1024;// size in mib\nif(!(imageFormats.indexOf(fileType)<0||selectedFileSize>10)){_context2.next=12;break;}setShowToast(true,\"The file must be in proper format or size\");return _context2.abrupt(\"return\");case 12:if(!(imageFormats.includes(fileType)&&selectedFileSize>10)){_context2.next=15;break;}// image validations\nsetShowToast(true,\"The image file size must be below 10 mb\");return _context2.abrupt(\"return\");case 15:formData.append('file',newFile);_context2.next=18;return onFileUpload(formData);case 18:res=_context2.sent;if(res.success){link=res.imgUrl;check_type=imageFormats.includes(fileType)?1:2;setFilesUrl(function(prev){return[].concat(_toConsumableArray(prev),[{\"mediaType\":check_type,\"link\":link}]);});setLocalFiles(function(prev){return _objectSpread(_objectSpread({},prev),{},{newFile:newFile});});}case 20:case\"end\":return _context2.stop();}}},_callee2);}));return function onFileChange(_x){return _ref3.apply(this,arguments);};}();var renderbyFileFormat=function renderbyFileFormat(item,index){var split_item_format=item.split('.');var get_split_fromat=split_item_format[split_item_format.length-1];var split_item_name=item.split('/');var get_split_name=split_item_name[split_item_name.length-1];var image_render=null;if(get_split_fromat){if(imageFormats.includes(get_split_fromat)){image_render=/*#__PURE__*/_jsx(\"img\",{title:get_split_name,src:item,alt:\"media\"});}return/*#__PURE__*/_jsxs(\"figure\",{className:\"img_video\",children:[image_render,/*#__PURE__*/_jsx(\"img\",{onClick:function onClick(){removeFromItem(index);},src:close,alt:\"remove\",className:\"remove\"})]});}};var isValidCheck=function isValidCheck(){if(!(reason===null||reason===void 0?void 0:reason.length)||(reason===null||reason===void 0?void 0:reason.length)>250){return true;}return false;};return/*#__PURE__*/_jsx(\"div\",{className:\"flex_row\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex_col_sm_12\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"relate\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:toggleBack,className:\"back\"}),/*#__PURE__*/_jsx(\"span\",{className:\"xs_sub_title\",children:jobName})]}),/*#__PURE__*/_jsx(\"span\",{className:\"sub_title\",children:\"Decline milestone\"}),/*#__PURE__*/_jsx(\"p\",{className:\"commn_para\",children:\"Please write your reason for declining the milestone\"}),/*#__PURE__*/_jsx(\"div\",{className:\"flex_row\",children:/*#__PURE__*/_jsx(\"div\",{className:\"flex_col_sm_7\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"form_field\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form_label\",children:\"Your reason\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"text_field\",children:[/*#__PURE__*/_jsx(\"textarea\",{value:reason,onChange:function onChange(e){setReason(e.target.value.trimLeft());},placeholder:\"Your reason...\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"char_count\",children:['character length: ',(reason===null||reason===void 0?void 0:reason.length)+' / 250']})]}),(reason===null||reason===void 0?void 0:reason.length)>250&&/*#__PURE__*/_jsx(\"span\",{className:\"error_msg\",children:'Maximum 250 characters are allowed.'})]})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"upload_img_video pt-10\",children:[(filesUrl===null||filesUrl===void 0?void 0:filesUrl.length)?filesUrl.map(function(item,index){return renderbyFileFormat(item.link,index);}):null,(filesUrl===null||filesUrl===void 0?void 0:filesUrl.length)<6?/*#__PURE__*/_jsxs(React.Fragment,{children:[/*#__PURE__*/_jsx(\"label\",{className:\"upload_media\",htmlFor:\"upload_img_video\",children:/*#__PURE__*/_jsx(\"img\",{src:addMedia,alt:\"\"})}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\"image/png,image/jpg,image/jpeg,.pdf, .doc, video/mp4, video/wmv, video/avi\",style:{display:\"none\"},onChange:onFileChange,id:\"upload_img_video\"})]}):null]}),/*#__PURE__*/_jsx(\"button\",{onClick:onSubmitDecline,className:\"fill_btn full_btn btn-effect \".concat(isValidCheck()?'disable_btn':''),children:\"Send\"})]})});};export default DeclineMilestone;","map":{"version":3,"sources":["/home/appinventiv/Documents/Project/tickt/web/src/pages/builderJobDasboard/components/declineMilestone.tsx"],"names":["React","useState","close","addMedia","onFileUpload","setShowToast","moengage","mixPanel","MoEConstants","imageFormats","videoFormats","DeclineMilestone","milestoneAcceptOrDecline","toggleBack","jobId","jobName","milestoneId","resetStateLocal","reason","setReason","filesUrl","setFilesUrl","localFiles","setLocalFiles","update","forceUpdate","onSubmitDecline","length","data","map","file","link","response","success","moE_SendEvent","MILESTONE_DECLINED","timeStamp","getCurrentTimeStamp","mixP_SendEvent","removeFromItem","index","splice","Array","isArray","onFileChange","e","formData","FormData","newFile","target","files","filesUrlClone","countVideoFormats","item","split_items","split","format_split_items","includes","filter","undefined","fileType","type","toLowerCase","selectedFileSize","size","indexOf","append","res","imgUrl","check_type","prev","renderbyFileFormat","split_item_format","get_split_fromat","split_item_name","get_split_name","image_render","isValidCheck","value","trimLeft","display"],"mappings":"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","sourcesContent":["import React, { useState } from 'react';\nimport media from '../../../assets/images/portfolio-placeholder.jpg';\nimport close from '../../../assets/images/icon-close-1.png';\nimport addMedia from \"../../../assets/images/add-image.png\";\nimport { onFileUpload } from '../../../redux/auth/actions';\nimport { setShowToast } from '../../../redux/common/actions';\nimport videoThumbnail from '../../../assets/images/add-video.png';\n\nimport { moengage, mixPanel } from '../../../services/analyticsTools';\nimport { MoEConstants } from '../../../utils/constants';\ninterface Props {\n    milestoneAcceptOrDecline: any\n    jobId: any\n    jobName: any,\n    milestoneId: any,\n    toggleBack: () => void,\n    resetStateLocal: any\n}\nconst imageFormats: Array<any> = [\"jpeg\", \"jpg\", \"png\"];\nconst videoFormats: Array<any> = [\"mp4\", \"wmv\", \"avi\"];\n\nconst DeclineMilestone = ({ milestoneAcceptOrDecline, toggleBack, jobId, jobName, milestoneId, resetStateLocal }: Props) => {\n    const [reason, setReason] = useState('');\n    const [filesUrl, setFilesUrl] = useState([] as any);\n    const [localFiles, setLocalFiles] = useState({});\n    const [update, forceUpdate] = useState({});\n\n\n    const onSubmitDecline = async () => {\n\n        if (!filesUrl?.length) {\n            setShowToast(true, 'Please attach at least one media file')\n            return true;\n        }\n\n        let data = {\n            \"status\": 2,\n            \"jobId\": jobId,\n            \"milestoneId\": milestoneId,\n            \"reason\": reason,\n            \"url\": filesUrl.length ? filesUrl.map((file: any) => file.link) : []\n        }\n\n        let response: any = await milestoneAcceptOrDecline(data);\n        if (response?.success) {\n            moengage.moE_SendEvent(MoEConstants.MILESTONE_DECLINED, { timeStamp: moengage.getCurrentTimeStamp() });\n            mixPanel.mixP_SendEvent(MoEConstants.MILESTONE_DECLINED, { timeStamp: moengage.getCurrentTimeStamp() });\n            resetStateLocal(true);\n        }\n    }\n\n    const removeFromItem = (index: any) => {\n        filesUrl.splice(index, 1);\n        setFilesUrl(filesUrl);\n        Array.isArray(update) ? forceUpdate([]) : forceUpdate({});\n    }\n\n    const onFileChange = async (e: any) => {\n        const formData = new FormData();\n        const newFile = e.target.files[0];\n\n        if (filesUrl?.length === 6) {\n            setShowToast(true, \"Max files upload limit is 6\")\n            return;\n        }\n\n        let filesUrlClone: any = filesUrl;\n\n        let countVideoFormats = filesUrlClone.map((item: any) => {\n            let split_items = item.link.split('.');\n\n            let format_split_items = split_items[split_items?.length - 1];\n\n            if (videoFormats.includes(format_split_items)) {\n                return format_split_items;\n            }\n        }).filter((item: any) => item !== undefined);\n\n        var fileType = (newFile?.type?.split('/')[1])?.toLowerCase();\n        var selectedFileSize = newFile?.size / 1024 / 1024; // size in mib\n\n        if (imageFormats.indexOf(fileType) < 0 || (selectedFileSize > 10)) {\n            setShowToast(true, \"The file must be in proper format or size\")\n            return;\n        }\n\n        if (imageFormats.includes(fileType) && selectedFileSize > 10) { // image validations\n            setShowToast(true, \"The image file size must be below 10 mb\")\n            return;\n        }\n\n        formData.append('file', newFile);\n        const res = await onFileUpload(formData)\n        if (res.success) {\n            let link: string = res.imgUrl;\n            let check_type: any = imageFormats.includes(fileType) ? 1 : 2;\n            setFilesUrl((prev: Array<any>) => [...prev, {\n                \"mediaType\": check_type,\n                \"link\": link\n            }]);\n            setLocalFiles((prev: any) => ({ ...prev, newFile }));\n        }\n    }\n\n    const renderbyFileFormat = (item: any, index: any) => {\n        let split_item_format = item.split('.');\n        let get_split_fromat = split_item_format[split_item_format.length - 1];\n\n        let split_item_name = item.split('/');\n        let get_split_name = split_item_name[split_item_name.length - 1];\n        let image_render: any = null;\n        if (get_split_fromat) {\n            if (imageFormats.includes(get_split_fromat)) {\n                image_render = <img title={get_split_name} src={item} alt=\"media\" />\n            }\n            return (\n                <figure className=\"img_video\">\n                    {image_render}\n                    <img\n                        onClick={() => { removeFromItem(index) }}\n                        src={close} alt=\"remove\" className=\"remove\" />\n                    {/* <span style={{ fontSize: '10px' }}>{get_split_name}</span> */}\n                </figure>\n            )\n        }\n    }\n\n\n    const isValidCheck = () => {\n        if (!reason?.length || reason?.length > 250) {\n            return true;\n        }\n\n        return false;\n    }\n\n\n    return (\n        <div className=\"flex_row\">\n            <div className=\"flex_col_sm_12\">\n                <div className=\"relate\">\n                    <button onClick={toggleBack} className=\"back\"></button>\n                    <span className=\"xs_sub_title\">{jobName}</span>\n                </div>\n                <span className=\"sub_title\">Decline milestone</span>\n                <p className=\"commn_para\">Please write your reason for declining the milestone</p>\n                <div className=\"flex_row\">\n                    <div className=\"flex_col_sm_7\">\n                        <div className=\"form_field\">\n                            <label className=\"form_label\">Your reason</label>\n                            <div className=\"text_field\">\n                                <textarea\n                                    value={reason}\n                                    onChange={(e: any) => { setReason((e.target.value).trimLeft()) }}\n                                    placeholder=\"Your reason...\"\n                                ></textarea>\n                                <span className=\"char_count\">{'character length: '}{reason?.length + ' / 250'}</span>\n                            </div>\n                            {reason?.length > 250 && (\n                                <span className=\"error_msg\">{'Maximum 250 characters are allowed.'}</span>\n                            )}\n                        </div>\n                    </div>\n                </div>\n                <div className=\"upload_img_video pt-10\">\n                    {filesUrl?.length ?\n                        filesUrl.map((item: any, index: number) => (renderbyFileFormat(item.link, index)))\n                        : null}\n\n                    {filesUrl?.length < 6 ? (\n                        <React.Fragment>\n                            <label className=\"upload_media\" htmlFor=\"upload_img_video\">\n                                <img src={addMedia} alt=\"\" />\n                            </label>\n\n                            <input\n                                type=\"file\"\n                                accept=\"image/png,image/jpg,image/jpeg,.pdf, .doc, video/mp4, video/wmv, video/avi\"\n                                style={{ display: \"none\" }}\n                                onChange={onFileChange}\n                                id=\"upload_img_video\"\n                            />\n                        </React.Fragment>\n                    ) : null}\n                </div>\n                <button\n                    onClick={onSubmitDecline}\n                    className={`fill_btn full_btn btn-effect ${isValidCheck() ? 'disable_btn' : ''}`}>Send</button>\n            </div>\n        </div>\n    )\n}\n\nexport default DeclineMilestone;\n"]},"metadata":{},"sourceType":"module"}