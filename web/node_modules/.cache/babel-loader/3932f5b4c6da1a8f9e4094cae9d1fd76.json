{"ast":null,"code":"var _jsxFileName = \"/home/appinventiv/Documents/Project/tickt/web/src/pages/chat/chat.tsx\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect } from \"react\";\nimport dummy from \"../../assets/images/u_placeholder.jpg\";\nimport chatSearch from \"../../assets/images/search-chat.png\";\nimport menu from \"../../assets/images/menu-line-blue.png\";\nimport close from \"../../assets/images/ic-cancel-blue.png\";\nimport { setLoading } from \"../../redux/common/actions\";\nimport { formatDateTime } from \"../../utils/common\";\nimport noData from \"../../assets/images/no-search-data.png\";\nimport { auth, createRoom, checkRoomExist, getFirebaseInboxData, stopListeningOfRoom, resetUnreadCounter } from \"../../services/firebase\";\nimport UserMessages from \"./userMessages\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nlet selectedRoomID = \"\";\nlet isFreshChatRoute = false;\n\nconst Chat = props => {\n  _s();\n\n  var _props$history, _props$history$locati, _props$history2, _props$history2$locat;\n\n  const [initializing, setInitializing] = useState(true); // firebase authenticated user details\n\n  const [user, setUser] = useState(() => auth.currentUser);\n  const [inBoxData, setInBoxData] = useState([]);\n  const [filterInBoxData, setFilterInBoxData] = useState([]);\n  const [isNoRecords, setIsNoRecords] = useState(false);\n  const [roomData, setRoomData] = useState({});\n  const [roomId, setRoomId] = useState(\"\");\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [searchActive, setSearchActive] = useState(false);\n  const [isInitialLoader, setIsInitialLoader] = useState(true);\n  const [isMobInbox, setIsMobInbox] = useState(false);\n  const {\n    tradieId,\n    builderId,\n    jobName,\n    jobId\n  } = ((_props$history = props.history) === null || _props$history === void 0 ? void 0 : (_props$history$locati = _props$history.location) === null || _props$history$locati === void 0 ? void 0 : _props$history$locati.state) ? (_props$history2 = props.history) === null || _props$history2 === void 0 ? void 0 : (_props$history2$locat = _props$history2.location) === null || _props$history2$locat === void 0 ? void 0 : _props$history2$locat.state : {\n    tradieId: \"\",\n    builderId: \"\",\n    jobName: \"\",\n    jobId: \"\"\n  }; // console.log('tradieId, builderId, jobName, jobId: ', tradieId, builderId, jobName, jobId);\n\n  useEffect(() => {\n    //  console.log(\"roomId:: from didmout\", selectedRoomID);\n    (async () => {\n      setLoading(true);\n\n      if (tradieId && builderId && jobName && jobId) {\n        await setInitialItems();\n      } else {\n        isFreshChatRoute = true;\n      }\n\n      await getFirebaseInboxData(onUpdateofInbox); // debugger;\n    })();\n\n    return () => {\n      // debugger;\n      stopListeningOfRoom(selectedRoomID);\n      selectedRoomID = \"\";\n    };\n  }, []);\n\n  const setInitialItems = async () => {\n    const roomID = `${jobId}_${tradieId}_${builderId}`;\n    selectedRoomID = roomID;\n\n    if (await checkRoomExist(roomID)) {\n      //console.log('RoomAlreadyExist: =================>');\n      return;\n    } else {\n      await createRoom(jobId, tradieId, builderId, jobName); // console.log('NewRoomCreated: ============>');\n    }\n  };\n\n  const onUpdateofInbox = async res => {\n    //  console.log(\"roomId::\", selectedRoomID);\n    let selectedRoomInfo = \"\";\n    const sortedRes = res.filter((item, index) => {\n      if (item.hasOwnProperty(\"lastMsg\") || item.roomId === selectedRoomID) {\n        if (item.roomId === selectedRoomID && !isFreshChatRoute) {\n          selectedRoomInfo = item;\n        } else {\n          return item;\n        }\n      }\n    });\n    sortedRes === null || sortedRes === void 0 ? void 0 : sortedRes.sort(function (x, y) {\n      var _y$lastMsg, _x$lastMsg;\n\n      return ((_y$lastMsg = y.lastMsg) === null || _y$lastMsg === void 0 ? void 0 : _y$lastMsg.messageTimestamp) - ((_x$lastMsg = x.lastMsg) === null || _x$lastMsg === void 0 ? void 0 : _x$lastMsg.messageTimestamp);\n    });\n\n    if (sortedRes.length === 0 && !selectedRoomInfo) {\n      setIsNoRecords(true);\n\n      if (isInitialLoader) {\n        setIsInitialLoader(false);\n        setLoading(false);\n      }\n\n      return;\n    }\n\n    setIsNoRecords(false);\n    let ress;\n\n    if (selectedRoomInfo) {\n      ress = [...sortedRes];\n      ress.unshift(selectedRoomInfo);\n    } // console.log('ress: ', ress, \"sortedRes\", sortedRes, \"res\", res, \"selectedRoomInfo\", selectedRoomInfo);\n\n\n    const newRes = Array.isArray(ress) && selectedRoomInfo ? ress : sortedRes;\n    setInBoxData(newRes.length === 0 ? [{\n      firstKey: \"emptyRes\"\n    }] : newRes);\n\n    if (newRes.length > 0 && selectedRoomID === \"\") {\n      var _newRes$;\n\n      selectedRoomID = newRes[0].roomId;\n      setRoomId(newRes[0].roomId);\n\n      if (newRes[0] && ((_newRes$ = newRes[0]) === null || _newRes$ === void 0 ? void 0 : _newRes$.unreadMessages) > 0) {\n        newRes[0].unreadMessages = 0;\n        resetUnreadCounter(newRes[0].roomId);\n      }\n\n      setRoomData(newRes[0]);\n      return; // fetchJobDetail(res[0].item?.jobId);\n    }\n\n    if (newRes.length > 0) {\n      let itemObj = newRes.find(x => x.roomId == selectedRoomID);\n\n      if (itemObj && (itemObj === null || itemObj === void 0 ? void 0 : itemObj.unreadMessages) > 0) {\n        itemObj.unreadMessages = 0;\n        resetUnreadCounter(itemObj.roomId);\n      }\n\n      setRoomData(itemObj);\n    }\n  };\n\n  useEffect(() => {\n    let unsubscribe = auth.onAuthStateChanged(user => {\n      if (user) {\n        setUser(user);\n        setIsMobInbox(false);\n      } else {\n        setUser(false);\n        setIsMobInbox(true);\n        setLoading(false);\n        setIsInitialLoader(false);\n      }\n\n      if (initializing) {\n        setInitializing(false);\n      }\n    });\n    return unsubscribe;\n  }, [initializing]);\n\n  const getRoomDetails = async item => {\n    stopListeningOfRoom(selectedRoomID);\n    selectedRoomID = item.roomId;\n    setRoomId(item.roomId);\n    setRoomData(item);\n    resetUnreadCounter(item.roomId); // fetchEquipmentDetail(item.itemId);\n  };\n\n  useEffect(() => {\n    var _inBoxData$;\n\n    if (searchQuery) {\n      let filteredVal = inBoxData.filter(item => {\n        var _item$oppUserInfo, _item$oppUserInfo$nam, _item$oppUserInfo$nam2;\n\n        return (_item$oppUserInfo = item.oppUserInfo) === null || _item$oppUserInfo === void 0 ? void 0 : (_item$oppUserInfo$nam = _item$oppUserInfo.name) === null || _item$oppUserInfo$nam === void 0 ? void 0 : (_item$oppUserInfo$nam2 = _item$oppUserInfo$nam.toLowerCase()) === null || _item$oppUserInfo$nam2 === void 0 ? void 0 : _item$oppUserInfo$nam2.includes(searchQuery.toLowerCase());\n      });\n      setFilterInBoxData(filteredVal);\n    }\n\n    if ((inBoxData.length || ((_inBoxData$ = inBoxData[0]) === null || _inBoxData$ === void 0 ? void 0 : _inBoxData$[\"firstKey\"]) === \"emptyRes\") && isInitialLoader) {\n      var _inBoxData$2;\n\n      if (((_inBoxData$2 = inBoxData[0]) === null || _inBoxData$2 === void 0 ? void 0 : _inBoxData$2[\"firstKey\"]) === \"emptyRes\") setInBoxData([]);\n      setLoading(false);\n      setIsInitialLoader(false);\n    }\n  }, [searchQuery, inBoxData]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"app_wrapper\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"custom_container\",\n      children: [/*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"mob_side_nav\",\n        onClick: () => setIsMobInbox(true),\n        children: /*#__PURE__*/_jsxDEV(\"img\", {\n          src: menu,\n          alt: \"mob-side-nav\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 195,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 194,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"f_row chat_wrapr h-100\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: `side_nav_col ${isMobInbox ? \"active\" : \"\"}`,\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"close_nav\",\n            onClick: () => setIsMobInbox(false),\n            children: /*#__PURE__*/_jsxDEV(\"img\", {\n              src: close,\n              alt: \"close\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 200,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 199,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"stick\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"title\",\n              style: {\n                marginLeft: \"50px\"\n              },\n              children: \"Chat\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 203,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: `search_bar ${searchActive ? \"active\" : \"\"}`,\n              onClick: () => {\n                setSearchActive(true);\n              },\n              children: [/*#__PURE__*/_jsxDEV(\"input\", {\n                type: \"text\",\n                placeholder: \"Search\",\n                value: searchQuery,\n                onChange: e => setSearchQuery(e.target.value.trimLeft())\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 213,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"detect_icon_ltr\",\n                children: /*#__PURE__*/_jsxDEV(\"img\", {\n                  src: chatSearch,\n                  alt: \"search\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 222,\n                  columnNumber: 19\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 221,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 207,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n              className: \"chat_list\",\n              children: searchQuery ? filterInBoxData.length === 0 ? /*#__PURE__*/_jsxDEV(\"li\", {\n                children: /*#__PURE__*/_jsxDEV(\"a\", {\n                  href: \"javascript:void(0)\",\n                  className: \"chat\",\n                  children: /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"detail\",\n                    children: /*#__PURE__*/_jsxDEV(\"span\", {\n                      className: \"inner_title line-1\",\n                      children: \"No Record Found\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 231,\n                      columnNumber: 27\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 230,\n                    columnNumber: 25\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 229,\n                  columnNumber: 23\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 228,\n                columnNumber: 21\n              }, this) : filterInBoxData.map(item => {\n                var _item$oppUserInfo2, _item$oppUserInfo3, _item$lastMsg, _item$lastMsg2, _item$lastMsg3;\n\n                return /*#__PURE__*/_jsxDEV(\"li\", {\n                  onClick: () => {\n                    getRoomDetails(item);\n                  },\n                  children: /*#__PURE__*/_jsxDEV(\"a\", {\n                    href: \"javascript:void(0)\",\n                    className: `chat ${selectedRoomID === item.roomId ? \"active\" : \"\"}`,\n                    children: [/*#__PURE__*/_jsxDEV(\"figure\", {\n                      className: \"u_img\",\n                      children: /*#__PURE__*/_jsxDEV(\"img\", {\n                        src: ((_item$oppUserInfo2 = item.oppUserInfo) === null || _item$oppUserInfo2 === void 0 ? void 0 : _item$oppUserInfo2.image) || dummy,\n                        alt: \"img\",\n                        onError: e => {\n                          var _e$target, _e$target2;\n\n                          if (e === null || e === void 0 ? void 0 : (_e$target = e.target) === null || _e$target === void 0 ? void 0 : _e$target.onerror) {\n                            e.target.onerror = null;\n                          }\n\n                          if (e === null || e === void 0 ? void 0 : (_e$target2 = e.target) === null || _e$target2 === void 0 ? void 0 : _e$target2.src) {\n                            e.target.src = dummy;\n                          }\n                        }\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 252,\n                        columnNumber: 31\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 251,\n                      columnNumber: 29\n                    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                      className: \"detail\",\n                      children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                        className: \"inner_title line-1\",\n                        children: (_item$oppUserInfo3 = item.oppUserInfo) === null || _item$oppUserInfo3 === void 0 ? void 0 : _item$oppUserInfo3.name\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 266,\n                        columnNumber: 31\n                      }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                        className: \"inner_title job line-1\",\n                        children: item.jobName\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 269,\n                        columnNumber: 31\n                      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                        className: \"commn_para line-1\",\n                        children: (_item$lastMsg = item.lastMsg) === null || _item$lastMsg === void 0 ? void 0 : _item$lastMsg.messageText\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 272,\n                        columnNumber: 31\n                      }, this), ((_item$lastMsg2 = item.lastMsg) === null || _item$lastMsg2 === void 0 ? void 0 : _item$lastMsg2.messageTimestamp) && /*#__PURE__*/_jsxDEV(\"span\", {\n                        className: \"date_time\",\n                        children: formatDateTime((_item$lastMsg3 = item.lastMsg) === null || _item$lastMsg3 === void 0 ? void 0 : _item$lastMsg3.messageTimestamp, \"inboxTime\")\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 276,\n                        columnNumber: 33\n                      }, this), selectedRoomID === item.roomId ? null : item.unreadMessages === 0 ? null : /*#__PURE__*/_jsxDEV(\"span\", {\n                        className: \"count\",\n                        children: item.unreadMessages\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 287,\n                        columnNumber: 33\n                      }, this)]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 265,\n                      columnNumber: 29\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 245,\n                    columnNumber: 27\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 240,\n                  columnNumber: 25\n                }, this);\n              }) : (inBoxData === null || inBoxData === void 0 ? void 0 : inBoxData.length) > 0 ? inBoxData.map(item => {\n                var _item$oppUserInfo4, _item$oppUserInfo5, _item$lastMsg4, _item$lastMsg5, _item$lastMsg6, _item$lastMsg7, _item$lastMsg8, _item$lastMsg9;\n\n                return /*#__PURE__*/_jsxDEV(\"li\", {\n                  onClick: () => {\n                    getRoomDetails(item);\n                  },\n                  children: /*#__PURE__*/_jsxDEV(\"a\", {\n                    href: \"javascript:void(0)\",\n                    className: `chat ${selectedRoomID === item.roomId ? \"active\" : \"\"}`,\n                    children: [/*#__PURE__*/_jsxDEV(\"figure\", {\n                      className: \"u_img\",\n                      children: /*#__PURE__*/_jsxDEV(\"img\", {\n                        src: ((_item$oppUserInfo4 = item.oppUserInfo) === null || _item$oppUserInfo4 === void 0 ? void 0 : _item$oppUserInfo4.image) || dummy,\n                        alt: \"img\",\n                        onError: e => {\n                          var _e$target3, _e$target4;\n\n                          if (e === null || e === void 0 ? void 0 : (_e$target3 = e.target) === null || _e$target3 === void 0 ? void 0 : _e$target3.onerror) {\n                            e.target.onerror = null;\n                          }\n\n                          if (e === null || e === void 0 ? void 0 : (_e$target4 = e.target) === null || _e$target4 === void 0 ? void 0 : _e$target4.src) {\n                            e.target.src = dummy;\n                          }\n                        }\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 312,\n                        columnNumber: 29\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 311,\n                      columnNumber: 27\n                    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                      className: \"detail\",\n                      children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                        className: \"inner_title line-1\",\n                        children: (_item$oppUserInfo5 = item.oppUserInfo) === null || _item$oppUserInfo5 === void 0 ? void 0 : _item$oppUserInfo5.name\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 326,\n                        columnNumber: 29\n                      }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                        className: \"inner_title job line-1\",\n                        children: item.jobName\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 329,\n                        columnNumber: 29\n                      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                        className: \"commn_para line-1\",\n                        children: ((_item$lastMsg4 = item.lastMsg) === null || _item$lastMsg4 === void 0 ? void 0 : _item$lastMsg4.messageType) === \"text\" ? (_item$lastMsg5 = item.lastMsg) === null || _item$lastMsg5 === void 0 ? void 0 : _item$lastMsg5.messageText : ((_item$lastMsg6 = item.lastMsg) === null || _item$lastMsg6 === void 0 ? void 0 : _item$lastMsg6.messageType) === \"image\" ? /*#__PURE__*/_jsxDEV(\"i\", {\n                          style: {\n                            color: \"#929292\"\n                          },\n                          children: \"Photo\"\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 336,\n                          columnNumber: 33\n                        }, this) : ((_item$lastMsg7 = item.lastMsg) === null || _item$lastMsg7 === void 0 ? void 0 : _item$lastMsg7.messageType) === \"video\" ? /*#__PURE__*/_jsxDEV(\"i\", {\n                          style: {\n                            color: \"#929292\"\n                          },\n                          children: \"Video\"\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 338,\n                          columnNumber: 33\n                        }, this) : \"\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 332,\n                        columnNumber: 29\n                      }, this), ((_item$lastMsg8 = item.lastMsg) === null || _item$lastMsg8 === void 0 ? void 0 : _item$lastMsg8.messageTimestamp) && /*#__PURE__*/_jsxDEV(\"span\", {\n                        className: \"date_time\",\n                        children: formatDateTime((_item$lastMsg9 = item.lastMsg) === null || _item$lastMsg9 === void 0 ? void 0 : _item$lastMsg9.messageTimestamp, \"inboxTime\")\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 344,\n                        columnNumber: 31\n                      }, this), selectedRoomID === item.roomId ? null : item.unreadMessages === 0 ? null : /*#__PURE__*/_jsxDEV(\"span\", {\n                        className: \"count\",\n                        children: item.unreadMessages\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 354,\n                        columnNumber: 31\n                      }, this)]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 325,\n                      columnNumber: 27\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 305,\n                    columnNumber: 25\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 300,\n                  columnNumber: 23\n                }, this);\n              }) : props.isLoading ? null : /*#__PURE__*/_jsxDEV(\"li\", {\n                children: /*#__PURE__*/_jsxDEV(\"a\", {\n                  href: \"javascript:void(0)\",\n                  className: \"chat\",\n                  children: /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"detail\",\n                    children: /*#__PURE__*/_jsxDEV(\"span\", {\n                      className: \"inner_title line-1\",\n                      children: \"No Record Found\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 367,\n                      columnNumber: 25\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 366,\n                    columnNumber: 23\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 365,\n                  columnNumber: 21\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 364,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 225,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 202,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 198,\n          columnNumber: 11\n        }, this), isInitialLoader ? null : !isInitialLoader && (inBoxData === null || inBoxData === void 0 ? void 0 : inBoxData.length) === 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"detail_col\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex_row tradies_row\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"no_record\",\n              children: [/*#__PURE__*/_jsxDEV(\"figure\", {\n                className: \"no_img\",\n                children: /*#__PURE__*/_jsxDEV(\"img\", {\n                  src: noData,\n                  alt: \"data not found\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 407,\n                  columnNumber: 21\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 406,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                children: \"No Data Found\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 409,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 405,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 404,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 403,\n          columnNumber: 13\n        }, this) : /*#__PURE__*/_jsxDEV(UserMessages, {\n          roomId: selectedRoomID,\n          roomData: roomData,\n          isNoRecords: isNoRecords,\n          history: props.history,\n          isLoading: props.isLoading,\n          inBoxData: inBoxData,\n          setInBoxData: setInBoxData\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 414,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 197,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 193,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 192,\n    columnNumber: 5\n  }, this);\n};\n\n_s(Chat, \"AmzMNa2qO0wRQUtJchWcg4AnQv0=\");\n\n_c = Chat;\nexport default Chat;\n\nvar _c;\n\n$RefreshReg$(_c, \"Chat\");","map":{"version":3,"sources":["/home/appinventiv/Documents/Project/tickt/web/src/pages/chat/chat.tsx"],"names":["React","useState","useEffect","dummy","chatSearch","menu","close","setLoading","formatDateTime","noData","auth","createRoom","checkRoomExist","getFirebaseInboxData","stopListeningOfRoom","resetUnreadCounter","UserMessages","selectedRoomID","isFreshChatRoute","Chat","props","initializing","setInitializing","user","setUser","currentUser","inBoxData","setInBoxData","filterInBoxData","setFilterInBoxData","isNoRecords","setIsNoRecords","roomData","setRoomData","roomId","setRoomId","searchQuery","setSearchQuery","searchActive","setSearchActive","isInitialLoader","setIsInitialLoader","isMobInbox","setIsMobInbox","tradieId","builderId","jobName","jobId","history","location","state","setInitialItems","onUpdateofInbox","roomID","res","selectedRoomInfo","sortedRes","filter","item","index","hasOwnProperty","sort","x","y","lastMsg","messageTimestamp","length","ress","unshift","newRes","Array","isArray","firstKey","unreadMessages","itemObj","find","unsubscribe","onAuthStateChanged","getRoomDetails","filteredVal","oppUserInfo","name","toLowerCase","includes","marginLeft","e","target","value","trimLeft","map","image","onerror","src","messageText","messageType","color","isLoading"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\n\nimport dummy from \"../../assets/images/u_placeholder.jpg\";\nimport chatSearch from \"../../assets/images/search-chat.png\";\nimport menu from \"../../assets/images/menu-line-blue.png\";\nimport close from \"../../assets/images/ic-cancel-blue.png\";\n\nimport { setLoading } from \"../../redux/common/actions\";\nimport { formatDateTime } from \"../../utils/common\";\nimport noData from \"../../assets/images/no-search-data.png\";\nimport emptyChat from \"../../assets/images/emptyChat.png\";\n\nimport {\n  auth,\n  createRoom,\n  checkRoomExist,\n  getFirebaseInboxData,\n  stopListeningOfRoom,\n  resetUnreadCounter,\n} from \"../../services/firebase\";\n\nimport UserMessages from \"./userMessages\";\n\ninterface PropTypes {\n  builderProfile: any;\n  tradieProfileData: any;\n  isLoading: boolean;\n  history: any;\n}\n\nlet selectedRoomID = \"\";\nlet isFreshChatRoute: boolean = false;\n\nconst Chat = (props: PropTypes) => {\n  const [initializing, setInitializing] = useState<boolean>(true);\n  // firebase authenticated user details\n  const [user, setUser] = useState<any>(() => auth.currentUser);\n  const [inBoxData, setInBoxData] = useState<any>([]);\n  const [filterInBoxData, setFilterInBoxData] = useState<any>([]);\n  const [isNoRecords, setIsNoRecords] = useState<boolean>(false);\n  const [roomData, setRoomData] = useState<any>({});\n  const [roomId, setRoomId] = useState<string>(\"\");\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [searchActive, setSearchActive] = useState(false);\n  const [isInitialLoader, setIsInitialLoader] = useState(true);\n  const [isMobInbox, setIsMobInbox] = useState<boolean>(false);\n\n  const { tradieId, builderId, jobName, jobId } = props.history?.location?.state\n    ? props.history?.location?.state\n    : { tradieId: \"\", builderId: \"\", jobName: \"\", jobId: \"\" };\n  // console.log('tradieId, builderId, jobName, jobId: ', tradieId, builderId, jobName, jobId);\n\n  useEffect(() => {\n    //  console.log(\"roomId:: from didmout\", selectedRoomID);\n    (async () => {\n      setLoading(true);\n      if (tradieId && builderId && jobName && jobId) {\n        await setInitialItems();\n      } else {\n        isFreshChatRoute = true;\n      }\n      await getFirebaseInboxData(onUpdateofInbox);\n      // debugger;\n    })();\n\n    return () => {\n      // debugger;\n      stopListeningOfRoom(selectedRoomID);\n      selectedRoomID = \"\";\n    };\n  }, []);\n\n  const setInitialItems = async () => {\n    const roomID: string = `${jobId}_${tradieId}_${builderId}`;\n    selectedRoomID = roomID;\n    if (await checkRoomExist(roomID)) {\n      //console.log('RoomAlreadyExist: =================>');\n      return;\n    } else {\n      await createRoom(jobId, tradieId, builderId, jobName);\n      // console.log('NewRoomCreated: ============>');\n    }\n  };\n\n  const onUpdateofInbox = async (res: any) => {\n    //  console.log(\"roomId::\", selectedRoomID);\n    let selectedRoomInfo: any = \"\";\n    const sortedRes = res.filter((item: any, index: number) => {\n      if (item.hasOwnProperty(\"lastMsg\") || item.roomId === selectedRoomID) {\n        if (item.roomId === selectedRoomID && !isFreshChatRoute) {\n          selectedRoomInfo = item;\n        } else {\n          return item;\n        }\n      }\n    });\n\n    sortedRes?.sort(function (x: any, y: any) {\n      return y.lastMsg?.messageTimestamp - x.lastMsg?.messageTimestamp;\n    });\n\n    if (sortedRes.length === 0 && !selectedRoomInfo) {\n      setIsNoRecords(true);\n      if (isInitialLoader) {\n        setIsInitialLoader(false);\n        setLoading(false);\n      }\n      return;\n    }\n    setIsNoRecords(false);\n\n    let ress: any;\n    if (selectedRoomInfo) {\n      ress = [...sortedRes];\n      ress.unshift(selectedRoomInfo);\n    }\n    // console.log('ress: ', ress, \"sortedRes\", sortedRes, \"res\", res, \"selectedRoomInfo\", selectedRoomInfo);\n    const newRes = Array.isArray(ress) && selectedRoomInfo ? ress : sortedRes;\n    setInBoxData(newRes.length === 0 ? [{ firstKey: \"emptyRes\" }] : newRes);\n    if (newRes.length > 0 && selectedRoomID === \"\") {\n      selectedRoomID = newRes[0].roomId;\n      setRoomId(newRes[0].roomId);\n      if (newRes[0] && newRes[0]?.unreadMessages > 0) {\n        newRes[0].unreadMessages = 0;\n        resetUnreadCounter(newRes[0].roomId);\n      }\n      setRoomData(newRes[0]);\n      return;\n      // fetchJobDetail(res[0].item?.jobId);\n    }\n\n    if (newRes.length > 0) {\n      let itemObj = newRes.find((x: any) => x.roomId == selectedRoomID);\n\n      if (itemObj && itemObj?.unreadMessages > 0) {\n        itemObj.unreadMessages = 0;\n        resetUnreadCounter(itemObj.roomId);\n      }\n      setRoomData(itemObj);\n    }\n  };\n\n  useEffect(() => {\n    let unsubscribe = auth.onAuthStateChanged((user) => {\n      if (user) {\n        setUser(user);\n        setIsMobInbox(false);\n      } else {\n        setUser(false);\n        setIsMobInbox(true);\n        setLoading(false);\n        setIsInitialLoader(false);\n      }\n      if (initializing) {\n        setInitializing(false);\n      }\n    });\n\n    return unsubscribe;\n  }, [initializing]);\n\n\n  const getRoomDetails = async (item: any) => {\n    stopListeningOfRoom(selectedRoomID);\n    selectedRoomID = item.roomId;\n    setRoomId(item.roomId);\n    setRoomData(item);\n    resetUnreadCounter(item.roomId);\n    // fetchEquipmentDetail(item.itemId);\n  };\n\n  useEffect(() => {\n    if (searchQuery) {\n      let filteredVal = inBoxData.filter((item: any) =>\n        item.oppUserInfo?.name\n          ?.toLowerCase()\n          ?.includes(searchQuery.toLowerCase())\n      );\n      setFilterInBoxData(filteredVal);\n    }\n    if (\n      (inBoxData.length || inBoxData[0]?.[\"firstKey\"] === \"emptyRes\") &&\n      isInitialLoader\n    ) {\n      if (inBoxData[0]?.[\"firstKey\"] === \"emptyRes\") setInBoxData([]);\n      setLoading(false);\n      setIsInitialLoader(false);\n    }\n  }, [searchQuery, inBoxData]);\n\n  return (\n    <div className=\"app_wrapper\">\n      <div className=\"custom_container\">\n        <span className=\"mob_side_nav\" onClick={() => setIsMobInbox(true)}>\n          <img src={menu} alt=\"mob-side-nav\" />\n        </span>\n        <div className=\"f_row chat_wrapr h-100\">\n          <div className={`side_nav_col ${isMobInbox ? \"active\" : \"\"}`}>\n            <button className=\"close_nav\" onClick={() => setIsMobInbox(false)}>\n              <img src={close} alt=\"close\" />\n            </button>\n            <div className=\"stick\">\n              <span className=\"title\" style={{ marginLeft: \"50px\" }}>\n                Chat\n              </span>\n\n              <div\n                className={`search_bar ${searchActive ? \"active\" : \"\"}`}\n                onClick={() => {\n                  setSearchActive(true);\n                }}\n              >\n                <input\n                  type=\"text\"\n                  placeholder=\"Search\"\n                  value={searchQuery}\n                  onChange={(e: any) =>\n                    setSearchQuery(e.target.value.trimLeft())\n                  }\n                />\n                <span className=\"detect_icon_ltr\">\n                  <img src={chatSearch} alt=\"search\" />\n                </span>\n              </div>\n              <ul className=\"chat_list\">\n                {searchQuery ? (\n                  filterInBoxData.length === 0 ? (\n                    <li>\n                      <a href=\"javascript:void(0)\" className=\"chat\">\n                        <div className=\"detail\">\n                          <span className=\"inner_title line-1\">\n                            No Record Found\n                          </span>\n                        </div>\n                      </a>\n                    </li>\n                  ) : (\n                    filterInBoxData.map((item: any) => {\n                      return (\n                        <li\n                          onClick={() => {\n                            getRoomDetails(item);\n                          }}\n                        >\n                          <a\n                            href=\"javascript:void(0)\"\n                            className={`chat ${\n                              selectedRoomID === item.roomId ? \"active\" : \"\"\n                            }`}\n                          >\n                            <figure className=\"u_img\">\n                              <img\n                                src={item.oppUserInfo?.image || dummy}\n                                alt=\"img\"\n                                onError={(e: any) => {\n                                  if (e?.target?.onerror) {\n                                    e.target.onerror = null;\n                                  }\n                                  if (e?.target?.src) {\n                                    e.target.src = dummy;\n                                  }\n                                }}\n                              />\n                            </figure>\n                            <div className=\"detail\">\n                              <span className=\"inner_title line-1\">\n                                {item.oppUserInfo?.name}\n                              </span>\n                              <span className=\"inner_title job line-1\">\n                                {item.jobName}\n                              </span>\n                              <p className=\"commn_para line-1\">\n                                {item.lastMsg?.messageText}\n                              </p>\n                              {item.lastMsg?.messageTimestamp && (\n                                <span className=\"date_time\">\n                                  {formatDateTime(\n                                    item.lastMsg?.messageTimestamp,\n                                    \"inboxTime\"\n                                  )}\n                                </span>\n                              )}\n\n                              {selectedRoomID ===\n                              item.roomId ? null : item.unreadMessages ===\n                                0 ? null : (\n                                <span className=\"count\">\n                                  {item.unreadMessages}\n                                </span>\n                              )}\n                            </div>\n                          </a>\n                        </li>\n                      );\n                    })\n                  )\n                ) : inBoxData?.length > 0 ? (\n                  inBoxData.map((item: any) => {\n                    return (\n                      <li\n                        onClick={() => {\n                          getRoomDetails(item);\n                        }}\n                      >\n                        <a\n                          href=\"javascript:void(0)\"\n                          className={`chat ${\n                            selectedRoomID === item.roomId ? \"active\" : \"\"\n                          }`}\n                        >\n                          <figure className=\"u_img\">\n                            <img\n                              src={item.oppUserInfo?.image || dummy}\n                              alt=\"img\"\n                              onError={(e: any) => {\n                                if (e?.target?.onerror) {\n                                  e.target.onerror = null;\n                                }\n                                if (e?.target?.src) {\n                                  e.target.src = dummy;\n                                }\n                              }}\n                            />\n                          </figure>\n                          <div className=\"detail\">\n                            <span className=\"inner_title line-1\">\n                              {item.oppUserInfo?.name}\n                            </span>\n                            <span className=\"inner_title job line-1\">\n                              {item.jobName}\n                            </span>\n                            <p className=\"commn_para line-1\">\n                              {item.lastMsg?.messageType === \"text\" ? (\n                                item.lastMsg?.messageText\n                              ) : item.lastMsg?.messageType === \"image\" ? (\n                                <i style={{ color: \"#929292\" }}>Photo</i>\n                              ) : item.lastMsg?.messageType === \"video\" ? (\n                                <i style={{ color: \"#929292\" }}>Video</i>\n                              ) : (\n                                \"\"\n                              )}\n                            </p>\n                            {item.lastMsg?.messageTimestamp && (\n                              <span className=\"date_time\">\n                                {formatDateTime(\n                                  item.lastMsg?.messageTimestamp,\n                                  \"inboxTime\"\n                                )}\n                              </span>\n                            )}\n                            {selectedRoomID ===\n                            item.roomId ? null : item.unreadMessages ===\n                              0 ? null : (\n                              <span className=\"count\">\n                                {item.unreadMessages}\n                              </span>\n                            )}\n                          </div>\n                        </a>\n                      </li>\n                    );\n                  })\n                ) : props.isLoading ? null : (\n                  <li>\n                    <a href=\"javascript:void(0)\" className=\"chat\">\n                      <div className=\"detail\">\n                        <span className=\"inner_title line-1\">\n                          No Record Found\n                        </span>\n                      </div>\n\n                      {/* <div className=\"detail\">\n                        <span className=\"no_record\">\n                          <figure>\n                            <figure className=\"no_img\">\n                              <img src={emptyChat} alt=\"data not found\" />\n                            </figure>\n                          </figure>\n\n                          <span className=\"empty_screen_text\">\n                            You don't have any chat messages yet.\n                          </span>\n                          <span className=\"empty_screen_subtext\">\n                            Connect to your local network\n                          </span>\n                          <button\n                            className=\"empty_screen_button\"\n                            onClick={() => props.history.push(\"/\")}\n                          >\n                            View Recommended tradespeople\n                          </button>\n                        </span>\n                      </div> */}\n                    </a>\n                  </li>\n                )}\n              </ul>\n            </div>\n          </div>\n          {/* {(isInitialLoader || inBoxData?.length === 0) ? null : */}\n          {isInitialLoader ? null : !isInitialLoader &&\n            inBoxData?.length === 0 ? (\n            <div className=\"detail_col\">\n              <div className=\"flex_row tradies_row\">\n                <div className=\"no_record\">\n                  <figure className=\"no_img\">\n                    <img src={noData} alt=\"data not found\" />\n                  </figure>\n                  <span>No Data Found</span>\n                </div>\n              </div>\n            </div>\n          ) : (\n            <UserMessages\n              roomId={selectedRoomID}\n              roomData={roomData}\n              isNoRecords={isNoRecords}\n              history={props.history}\n              isLoading={props.isLoading}\n              inBoxData={inBoxData}\n              setInBoxData={setInBoxData}\n            />\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default Chat;\n"]},"metadata":{},"sourceType":"module"}