{"ast":null,"code":"import _regeneratorRuntime from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from'react';import ConfirmPay from'./confirmAndPay';import ApproveMilestonePayment from'../addBankDetails/approveMilestonePayment';import{lastUsedCard}from'../../../../redux/jobs/actions';import{setShowToast}from'../../../../redux/common/actions';import{useSelector}from'react-redux';import storageService from\"../../../../utils/storageService\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var FixedRate=function FixedRate(props){var _props$data,_props$data$selectedM,_props$data2,_props$data2$itemDeta;console.log({props:props});var indexMile=props===null||props===void 0?void 0:(_props$data=props.data)===null||_props$data===void 0?void 0:(_props$data$selectedM=_props$data.selectedMilestoneIndex)===null||_props$data$selectedM===void 0?void 0:_props$data$selectedM.index;var milestones=props===null||props===void 0?void 0:(_props$data2=props.data)===null||_props$data2===void 0?void 0:(_props$data2$itemDeta=_props$data2.itemDetails)===null||_props$data2$itemDeta===void 0?void 0:_props$data2$itemDeta.milestones;var selectedItems=milestones[indexMile];var _useState=useState(false),_useState2=_slicedToArray(_useState,2),toggle=_useState2[0],setToggle=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),toggleBankAcc=_useState4[0],setToggleBankAcc=_useState4[1];var _useState5=useState({}),_useState6=_slicedToArray(_useState5,2),lastCard=_useState6[0],setLastCard=_useState6[1];var _useState7=useState({toggle:false,data:null}),_useState8=_slicedToArray(_useState7,2),toggleDetails=_useState8[0],setToggleDetails=_useState8[1];var isLoading=useSelector(function(state){return state.common.isLoading;});var _useState9=useState('1'),_useState10=_slicedToArray(_useState9,2),checkPaymentType=_useState10[0],setCheckPaymentType=_useState10[1];// 1 => credit card; 2 => bank account\nvar backToScreen=function backToScreen(){if(toggle)setToggle(false);if(toggleBankAcc)setToggleBankAcc(false);setToggleDetails({toggle:false,data:null});fetchLastCard();};var fetchLastCard=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return lastUsedCard();case 2:response=_context.sent;if(response===null||response===void 0?void 0:response.success){setLastCard(response.data);}case 4:case\"end\":return _context.stop();}}},_callee);}));return function fetchLastCard(){return _ref.apply(this,arguments);};}();useEffect(function(){fetchLastCard();},[]);useEffect(function(){},[toggle,toggleBankAcc]);if(toggle){return/*#__PURE__*/_jsx(ConfirmPay,{toggleDetails:toggleDetails,jobName:props===null||props===void 0?void 0:props.jobName,dataItem:props===null||props===void 0?void 0:props.data,backToScreen:backToScreen,total:selectedItems===null||selectedItems===void 0?void 0:selectedItems.total,onSubmitAccept:props.onSubmitAccept});}if(toggleBankAcc){var _props$data3,_props$data3$itemDeta,_storageService$getIt,_props$data4,_props$data4$itemDeta,_props$data5,_props$data5$selected,_props$data6,_props$data6$itemDeta,_props$data6$itemDeta2,_props$data6$itemDeta3;return/*#__PURE__*/_jsx(ApproveMilestonePayment,{isAddnewAccount:true,tradieId:props===null||props===void 0?void 0:(_props$data3=props.data)===null||_props$data3===void 0?void 0:(_props$data3$itemDeta=_props$data3.itemDetails)===null||_props$data3$itemDeta===void 0?void 0:_props$data3$itemDeta.tradieId,builderId:((_storageService$getIt=storageService.getItem(\"userInfo\"))===null||_storageService$getIt===void 0?void 0:_storageService$getIt._id)||'',jobName:props===null||props===void 0?void 0:props.jobName,jobId:props===null||props===void 0?void 0:(_props$data4=props.data)===null||_props$data4===void 0?void 0:(_props$data4$itemDeta=_props$data4.itemDetails)===null||_props$data4$itemDeta===void 0?void 0:_props$data4$itemDeta.jobId,milestoneId:props===null||props===void 0?void 0:(_props$data5=props.data)===null||_props$data5===void 0?void 0:(_props$data5$selected=_props$data5.selectedMilestoneIndex)===null||_props$data5$selected===void 0?void 0:_props$data5$selected.milestoneId,milestoneAmount:selectedItems===null||selectedItems===void 0?void 0:selectedItems.milestoneAmount,milestoneTotalAmount:selectedItems===null||selectedItems===void 0?void 0:selectedItems.total,backToScreen:backToScreen,milestoneNumber:indexMile,category:props===null||props===void 0?void 0:(_props$data6=props.data)===null||_props$data6===void 0?void 0:(_props$data6$itemDeta=_props$data6.itemDetails)===null||_props$data6$itemDeta===void 0?void 0:(_props$data6$itemDeta2=_props$data6$itemDeta.categories)===null||_props$data6$itemDeta2===void 0?void 0:(_props$data6$itemDeta3=_props$data6$itemDeta2[0])===null||_props$data6$itemDeta3===void 0?void 0:_props$data6$itemDeta3.trade_name});}var renderItem=function renderItem(_ref2){var title=_ref2.title,value=_ref2.value,bold=_ref2.bold;if(value){return/*#__PURE__*/_jsxs(\"div\",{className:\"f_spacebw\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"form_label\",children:bold?/*#__PURE__*/_jsx(\"b\",{children:title}):title}),/*#__PURE__*/_jsx(\"span\",{className:\"form_label\",children:bold?/*#__PURE__*/_jsx(\"b\",{children:value}):value})]});}return null;};return/*#__PURE__*/_jsx(\"div\",{className:\"flex_row\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex_col_sm_8\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"relate\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){props.toggleBack();},className:\"back\"}),/*#__PURE__*/_jsx(\"span\",{className:\"xs_sub_title\",children:props===null||props===void 0?void 0:props.jobName})]}),/*#__PURE__*/_jsx(\"div\",{className:\"form_field\",children:/*#__PURE__*/_jsx(\"span\",{className:\"sub_title\",children:'Confirm and pay'})}),isLoading?null:/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"payment_details\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"inner_title\",children:\"Milestone payment details\"}),renderItem({title:'Hours worked',value:selectedItems===null||selectedItems===void 0?void 0:selectedItems.hoursWorked}),renderItem({title:'Hours rate',value:selectedItems===null||selectedItems===void 0?void 0:selectedItems.hourlyRate}),renderItem({title:'Milestone amount',value:selectedItems===null||selectedItems===void 0?void 0:selectedItems.milestoneAmount}),renderItem({title:'GST',value:selectedItems===null||selectedItems===void 0?void 0:selectedItems.taxes}),renderItem({title:'Platform fees',value:selectedItems===null||selectedItems===void 0?void 0:selectedItems.platformFees}),renderItem({title:'Total',value:selectedItems===null||selectedItems===void 0?void 0:selectedItems.total,bold:true})]}),!(lastCard===null||lastCard===void 0?void 0:lastCard.last4)?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"mb50\",children:/*#__PURE__*/_jsx(\"button\",{className:\"fill_grey_btn full_btn btn-effect\",onClick:function onClick(){setToggle(true);},children:\"Add card\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"mb50\",children:/*#__PURE__*/_jsx(\"button\",{className:\"fill_grey_btn full_btn btn-effect\",onClick:function onClick(){setToggleBankAcc(true);},children:\"Bank account\"})})]}):/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"view_more agree_check mb50\",children:[/*#__PURE__*/_jsx(\"input\",{onChange:function onChange(){checkPaymentType!=='1'?setCheckPaymentType('1'):setCheckPaymentType('0');},checked:checkPaymentType==='1'?true:false,className:\"filter-type filled-in\",type:\"checkbox\",id:\"creditCard\"}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"creditCard\",children:/*#__PURE__*/_jsxs(\"div\",{onClick:function onClick(){setToggle(true);setToggleDetails({toggle:true,data:lastCard});},style:{cursor:'pointer'},className:\"bank_detail\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"xs_head\",children:\"\".concat(lastCard===null||lastCard===void 0?void 0:lastCard.funding,\" card\")}),/*#__PURE__*/_jsx(\"span\",{className:\"show_label\",children:\"xxxx \".concat(lastCard===null||lastCard===void 0?void 0:lastCard.last4)})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"view_more agree_check mb50\",children:[/*#__PURE__*/_jsx(\"input\",{onChange:function onChange(){checkPaymentType!=='2'?setCheckPaymentType('2'):setCheckPaymentType('0');},checked:checkPaymentType==='2'?true:false,className:\"filter-type filled-in\",type:\"checkbox\",id:\"bankAccount\"}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"bankAccount\",children:/*#__PURE__*/_jsx(\"div\",{style:{cursor:'pointer'},className:\"bank_detail\",onClick:function onClick(){setToggleBankAcc(true);},children:/*#__PURE__*/_jsx(\"span\",{className:\"xs_head\",children:\"Bank account\"})})})]})]}),/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){if(checkPaymentType==='1'){if(!(lastCard===null||lastCard===void 0?void 0:lastCard.last4)){setShowToast(true,'Add card to proceed');return;}setToggle(true);}else if(checkPaymentType==='2'){setToggleBankAcc(true);}},className:\"fill_btn full_btn btn-effect\",children:'Pay'})]})]})});};export default FixedRate;","map":{"version":3,"sources":["/home/appinventiv/Documents/Project/tickt/web/src/pages/builderJobDasboard/components/confirmAndPay/fixedRate.tsx"],"names":["React","useEffect","useState","ConfirmPay","ApproveMilestonePayment","lastUsedCard","setShowToast","useSelector","storageService","FixedRate","props","console","log","indexMile","data","selectedMilestoneIndex","index","milestones","itemDetails","selectedItems","toggle","setToggle","toggleBankAcc","setToggleBankAcc","lastCard","setLastCard","toggleDetails","setToggleDetails","isLoading","state","common","checkPaymentType","setCheckPaymentType","backToScreen","fetchLastCard","response","success","jobName","total","onSubmitAccept","tradieId","getItem","_id","jobId","milestoneId","milestoneAmount","categories","trade_name","renderItem","title","value","bold","toggleBack","hoursWorked","hourlyRate","taxes","platformFees","last4","cursor","funding"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react'\nimport ConfirmPay from './confirmAndPay';\nimport ApproveMilestonePayment from '../addBankDetails/approveMilestonePayment';\nimport { lastUsedCard } from '../../../../redux/jobs/actions';\nimport { setShowToast } from '../../../../redux/common/actions';\nimport { useSelector } from 'react-redux';\nimport storageService from \"../../../../utils/storageService\";\n\nconst FixedRate = (props: any) => {\n    console.log({ props });\n    const indexMile: any = props?.data?.selectedMilestoneIndex?.index;\n    const milestones: any = props?.data?.itemDetails?.milestones;\n    const selectedItems: any = milestones[indexMile];\n    const [toggle, setToggle] = useState(false);\n    const [toggleBankAcc, setToggleBankAcc] = useState(false);\n    const [lastCard, setLastCard] = useState<any>({});\n    const [toggleDetails, setToggleDetails] = useState<any>({ toggle: false, data: null })\n    const isLoading = useSelector((state: any) => state.common.isLoading)\n    const [checkPaymentType, setCheckPaymentType] = useState('1'); // 1 => credit card; 2 => bank account\n\n    const backToScreen = () => {\n        if (toggle) setToggle(false);\n        if (toggleBankAcc) setToggleBankAcc(false);\n        setToggleDetails({ toggle: false, data: null });\n        fetchLastCard();\n    }\n\n    const fetchLastCard = async () => {\n        let response = await lastUsedCard();\n        if (response?.success) {\n            setLastCard(response.data);\n        }\n    }\n\n    useEffect(() => {\n        fetchLastCard();\n    }, [])\n\n    useEffect(() => {\n    }, [toggle, toggleBankAcc])\n\n    if (toggle) {\n        return (\n            <ConfirmPay\n                toggleDetails={toggleDetails}\n                jobName={props?.jobName}\n                dataItem={props?.data}\n                backToScreen={backToScreen}\n                total={selectedItems?.total}\n                onSubmitAccept={props.onSubmitAccept}\n            />\n        )\n    }\n\n    if (toggleBankAcc) {\n        return (\n            <ApproveMilestonePayment\n                isAddnewAccount={true}\n                tradieId={props?.data?.itemDetails?.tradieId}\n                builderId={storageService.getItem(\"userInfo\")?._id || ''}\n                jobName={props?.jobName}\n                jobId={props?.data?.itemDetails?.jobId}\n                milestoneId={props?.data?.selectedMilestoneIndex?.milestoneId}\n                milestoneAmount={selectedItems?.milestoneAmount}\n                milestoneTotalAmount={selectedItems?.total}\n                backToScreen={backToScreen}\n                milestoneNumber={indexMile}\n                category={props?.data?.itemDetails?.categories?.[0]?.trade_name}\n            />\n        )\n    }\n\n    const renderItem = ({ title, value, bold }: any) => {\n        if (value) {\n            return (\n                <div className=\"f_spacebw\">\n                    <span className=\"form_label\">\n                        {bold ? (\n                            <b>{title}</b>\n                        ) : title}\n                    </span>\n                    <span className=\"form_label\">\n                        {bold ? <b>{value}</b> : value}\n                    </span>\n                </div>\n            )\n        }\n        return null;\n    }\n\n    return (\n        <div className=\"flex_row\">\n            <div className=\"flex_col_sm_8\">\n                <div className=\"relate\">\n                    <button\n                        onClick={() => {\n                            props.toggleBack()\n                        }}\n                        className=\"back\"></button>\n                    <span className=\"xs_sub_title\">\n                        {props?.jobName}\n                    </span>\n                </div>\n                <div className=\"form_field\">\n                    <span className=\"sub_title\">\n                        {'Confirm and pay'}\n                    </span>\n                </div>\n                {isLoading ? null : <>\n                    <div className=\"payment_details\">\n                        <span className=\"inner_title\">Milestone payment details</span>\n\n                        {renderItem({\n                            title: 'Hours worked',\n                            value: selectedItems?.hoursWorked\n                        })}\n\n                        {renderItem({\n                            title: 'Hours rate',\n                            value: selectedItems?.hourlyRate\n                        })}\n\n                        {renderItem({\n                            title: 'Milestone amount',\n                            value: selectedItems?.milestoneAmount\n                        })}\n\n                        {renderItem({\n                            title: 'GST',\n                            value: selectedItems?.taxes\n                        })}\n\n                        {renderItem({\n                            title: 'Platform fees',\n                            value: selectedItems?.platformFees\n                        })}\n\n                        {renderItem({\n                            title: 'Total',\n                            value: selectedItems?.total,\n                            bold: true\n                        })}\n\n                    </div>\n                    {!lastCard?.last4 ? (\n                        <>\n                            <div className=\"mb50\">\n                                <button className=\"fill_grey_btn full_btn btn-effect\"\n                                    onClick={() => {\n                                        setToggle(true);\n                                    }}>Add card</button>\n                            </div>\n                            <div className=\"mb50\">\n                                <button className=\"fill_grey_btn full_btn btn-effect\"\n                                    onClick={() => {\n                                        setToggleBankAcc(true);\n                                    }}>Bank account</button>\n                            </div>\n                        </>\n                    ) : (\n                        <div>\n                            <div className=\"view_more agree_check mb50\">\n                                <input\n                                    onChange={() => {\n                                        checkPaymentType !== '1' ? setCheckPaymentType('1') : setCheckPaymentType('0')\n                                    }}\n                                    checked={checkPaymentType === '1' ? true : false}\n                                    className=\"filter-type filled-in\"\n                                    type=\"checkbox\"\n                                    id=\"creditCard\" />\n                                <label htmlFor=\"creditCard\">\n                                    <div\n                                        onClick={() => {\n                                            setToggle(true);\n                                            setToggleDetails({\n                                                toggle: true,\n                                                data: lastCard\n                                            })\n                                        }}\n                                        style={{ cursor: 'pointer' }}\n                                        className=\"bank_detail\">\n                                        <span className=\"xs_head\">{`${lastCard?.funding} card`}</span>\n                                        <span className=\"show_label\">{`xxxx ${lastCard?.last4}`}</span>\n                                        {/* <div className=\"edit_delete\">\n                                    <span className=\"edit\" title=\"Edit\"></span>\n                                </div> */}\n                                    </div>\n                                </label>\n                            </div>\n                            <div className=\"view_more agree_check mb50\">\n                                <input\n                                    onChange={() => {\n                                        checkPaymentType !== '2' ? setCheckPaymentType('2') : setCheckPaymentType('0')\n                                    }}\n                                    checked={checkPaymentType === '2' ? true : false}\n                                    className=\"filter-type filled-in\"\n                                    type=\"checkbox\"\n                                    id=\"bankAccount\" />\n                                <label htmlFor=\"bankAccount\">\n                                    <div\n                                        style={{ cursor: 'pointer' }}\n                                        className=\"bank_detail\"\n                                        onClick={() => {\n                                            setToggleBankAcc(true);\n                                        }}>\n                                        <span className=\"xs_head\">{`Bank account`}</span>\n                                    </div>\n                                </label>\n                            </div>\n                        </div>\n                    )}\n                    <button\n                        onClick={() => {\n                            if (checkPaymentType === '1') {\n                                if (!lastCard?.last4) {\n                                    setShowToast(true, 'Add card to proceed')\n                                    return;\n                                }\n                                setToggle(true);\n                            } else if (checkPaymentType === '2') {\n                                setToggleBankAcc(true);\n                            }\n                        }}\n                        className=\"fill_btn full_btn btn-effect\"\n                    >\n                        {'Pay'}\n                    </button>\n                </>}\n            </div>\n        </div >\n\n    )\n}\n\nexport default FixedRate;\n"]},"metadata":{},"sourceType":"module"}