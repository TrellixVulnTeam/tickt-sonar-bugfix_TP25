{"ast":null,"code":"import _regeneratorRuntime from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _objectSpread from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _asyncToGenerator from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState}from'react';import DeclineMilestone from'./declineMilestone';import{milestoneAcceptOrDecline}from'../../../redux/homeSearch/actions';import FixedRate from'./confirmAndPay/fixedRate';import{withRouter}from'react-router-dom';//@ts-ignore\nimport FsLightbox from'fslightbox-react';//@ts-ignore\nimport{moengage,mixPanel}from'../../../services/analyticsTools';import{MoEConstants}from'../../../utils/constants';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var MilestoneApprove=function MilestoneApprove(props){var backToScreen=props.backToScreen,data=props.data,resetStateLocal=props.resetStateLocal;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isToggle=_useState2[0],setToggle=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),IsToggleAccept=_useState4[0],setToggleAccept=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),toggler=_useState6[0],setToggler=_useState6[1];var _useState7=useState(1),_useState8=_slicedToArray(_useState7,2),selectedSlide=_useState8[0],setSelectSlide=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),loadingTrue=_useState10[0],setLoadingTrue=_useState10[1];if(data){var _data$selectedItem,_data$selectedItem2,_data$selectedMile,_data$selectedMile2,_data$selectedMile3,_data$itemDetails,_data$selectedMilesto;var jobName=data===null||data===void 0?void 0:(_data$selectedItem=data.selectedItem)===null||_data$selectedItem===void 0?void 0:_data$selectedItem.jobName;var jobId=data===null||data===void 0?void 0:(_data$selectedItem2=data.selectedItem)===null||_data$selectedItem2===void 0?void 0:_data$selectedItem2.jobId;var description=data===null||data===void 0?void 0:(_data$selectedMile=data.selectedMile)===null||_data$selectedMile===void 0?void 0:_data$selectedMile.description;var hoursWorked=data===null||data===void 0?void 0:(_data$selectedMile2=data.selectedMile)===null||_data$selectedMile2===void 0?void 0:_data$selectedMile2.hoursWorked;var images=data===null||data===void 0?void 0:(_data$selectedMile3=data.selectedMile)===null||_data$selectedMile3===void 0?void 0:_data$selectedMile3.images;var milestones=data===null||data===void 0?void 0:(_data$itemDetails=data.itemDetails)===null||_data$itemDetails===void 0?void 0:_data$itemDetails.milestones;var index=data===null||data===void 0?void 0:(_data$selectedMilesto=data.selectedMilestoneIndex)===null||_data$selectedMilesto===void 0?void 0:_data$selectedMilesto.index;var item=milestones[index];var onSubmitAccept=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(data){var total,data_,response,_props$data,_props$data$itemDetai,_props$data$itemDetai2,_props$data$itemDetai3,_props$data2,_props$data2$selected,mData1,mData2;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:total=data===null||data===void 0?void 0:data.total;data_={\"status\":1,\"jobId\":jobId,\"milestoneId\":item===null||item===void 0?void 0:item.milestoneId,\"paymentMethodId\":data===null||data===void 0?void 0:data.cardId,\"milestoneAmount\":data===null||data===void 0?void 0:data.milestoneAmount.replace(\"$\",\"\"),\"amount\":total.replace(\"$\",\"\")};_context.next=4;return milestoneAcceptOrDecline(data_);case 4:response=_context.sent;if(response===null||response===void 0?void 0:response.success){mData1={Category:(_props$data=props.data)===null||_props$data===void 0?void 0:(_props$data$itemDetai=_props$data.itemDetails)===null||_props$data$itemDetai===void 0?void 0:(_props$data$itemDetai2=_props$data$itemDetai.categories)===null||_props$data$itemDetai2===void 0?void 0:(_props$data$itemDetai3=_props$data$itemDetai2[0])===null||_props$data$itemDetai3===void 0?void 0:_props$data$itemDetai3.trade_name,timeStamp:moengage.getCurrentTimeStamp()};moengage.moE_SendEvent(MoEConstants.MADE_PAYMENT,mData1);mixPanel.mixP_SendEvent(MoEConstants.MADE_PAYMENT,mData1);mData2=_objectSpread(_objectSpread({},mData1),{},{'Milestone number':((_props$data2=props.data)===null||_props$data2===void 0?void 0:(_props$data2$selected=_props$data2.selectedMilestoneIndex)===null||_props$data2$selected===void 0?void 0:_props$data2$selected.index)+1});moengage.moE_SendEvent(MoEConstants.MILESTONE_CHECKED_AND_APPROVED,mData2);mixPanel.mixP_SendEvent(MoEConstants.MILESTONE_CHECKED_AND_APPROVED,mData2);resetStateLocal();props.history.push('/need-approval-success');}case 6:case\"end\":return _context.stop();}}},_callee);}));return function onSubmitAccept(_x){return _ref.apply(this,arguments);};}();var toggleBack=function toggleBack(){setToggle(false);setToggleAccept(false);};if(IsToggleAccept){return/*#__PURE__*/_jsx(FixedRate,_objectSpread(_objectSpread({},props),{},{jobName:jobName,data:props.data,toggleBack:toggleBack,onSubmitAccept:onSubmitAccept}));}if(isToggle){return/*#__PURE__*/_jsx(DeclineMilestone,{milestoneAcceptOrDecline:milestoneAcceptOrDecline,jobId:jobId,jobName:jobName,toggleBack:toggleBack,resetStateLocal:resetStateLocal,milestoneId:item===null||item===void 0?void 0:item.milestoneId});}var renderFilteredItems=function renderFilteredItems(){var sources=[];var types=[];if(images===null||images===void 0?void 0:images.length){images.forEach(function(item){if((item===null||item===void 0?void 0:item.mediaType)===2){sources.push(item.link);types.push('video');}else if((item===null||item===void 0?void 0:item.mediaType)===1){sources.push(item.link);types.push('image');}else{sources.push(item);types.push('image');}});}return{sources:sources,types:types};};var _renderFilteredItems=renderFilteredItems(),sources=_renderFilteredItems.sources,types=_renderFilteredItems.types;var setItemToggle=function setItemToggle(index){setToggler(function(prev){return!prev;});setSelectSlide(index+1);};return/*#__PURE__*/_jsx(\"div\",{className:\"flex_row\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex_col_sm_8\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"relate\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){backToScreen();},className:\"back\"}),/*#__PURE__*/_jsx(\"span\",{className:\"xs_sub_title\",children:jobName})]}),/*#__PURE__*/_jsx(\"span\",{className:\"sub_title\",children:\"Milestone details\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"xs_sub_title\",children:[item===null||item===void 0?void 0:item.milestoneName,\" complete\"]}),/*#__PURE__*/_jsx(FsLightbox,{toggler:toggler,slide:selectedSlide,sources:sources,types:types}),images&&Array.isArray(images)&&(images===null||images===void 0?void 0:images.length)?/*#__PURE__*/_jsx(\"div\",{className:\"upload_img_video\",children:images.map(function(media_item,index){return/*#__PURE__*/_jsx(\"figure\",{className:\"img_video\",children:(media_item===null||media_item===void 0?void 0:media_item.mediaType)==1?/*#__PURE__*/_jsx(\"img\",{style:{cursor:'pointer'},onClick:function onClick(){setItemToggle(index);},\"async-src\":media_item===null||media_item===void 0?void 0:media_item.link,decoding:\"async\",loading:\"lazy\",src:media_item===null||media_item===void 0?void 0:media_item.link,alt:\"media\"}):(media_item===null||media_item===void 0?void 0:media_item.mediaType)==2?/*#__PURE__*/_jsx(\"video\",{style:{cursor:'pointer'},onClick:function onClick(){setItemToggle(index);},src:media_item===null||media_item===void 0?void 0:media_item.link}):/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(\"img\",{style:{cursor:'pointer'},onClick:function onClick(){setItemToggle(index);},onLoad:function onLoad(){setLoadingTrue(true);},src:media_item,\"async-src\":media_item,decoding:\"async\",loading:\"lazy\",alt:\"media\"})})});})}):null,/*#__PURE__*/_jsxs(\"div\",{className:\"form_field\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"xs_sub_title\",children:\"Description\"}),/*#__PURE__*/_jsx(\"p\",{className:\"commn_para\",children:description||''})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form_field\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"xs_sub_title\",children:\"Hours worked in this milestone\"}),/*#__PURE__*/_jsx(\"span\",{className:\"show_label\",children:\"\".concat(hoursWorked||0,\" hours\")})]}),/*#__PURE__*/_jsx(\"div\",{className:\"form_field\",children:/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){setToggleAccept(true);},className:\"fill_btn full_btn\",children:\"Approve\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"form_field\",children:/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){setToggle(true);},className:\"fill_grey_btn full_btn btn-effect mt-15\",children:'Decline'})})]})});}return null;};export default withRouter(MilestoneApprove);","map":{"version":3,"sources":["/home/appinventiv/Documents/Project/tickt/web/src/pages/builderJobDasboard/components/milestoneApprove.tsx"],"names":["React","useState","DeclineMilestone","milestoneAcceptOrDecline","FixedRate","withRouter","FsLightbox","moengage","mixPanel","MoEConstants","MilestoneApprove","props","backToScreen","data","resetStateLocal","isToggle","setToggle","IsToggleAccept","setToggleAccept","toggler","setToggler","selectedSlide","setSelectSlide","loadingTrue","setLoadingTrue","jobName","selectedItem","jobId","description","selectedMile","hoursWorked","images","milestones","itemDetails","index","selectedMilestoneIndex","item","onSubmitAccept","total","data_","milestoneId","cardId","milestoneAmount","replace","response","success","mData1","Category","categories","trade_name","timeStamp","getCurrentTimeStamp","moE_SendEvent","MADE_PAYMENT","mixP_SendEvent","mData2","MILESTONE_CHECKED_AND_APPROVED","history","push","toggleBack","renderFilteredItems","sources","types","length","forEach","mediaType","link","setItemToggle","prev","milestoneName","Array","isArray","map","media_item","cursor"],"mappings":"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","sourcesContent":["import React, { useState } from 'react'\nimport media from '../../../assets/images/portfolio-placeholder.jpg';\nimport DeclineMilestone from './declineMilestone';\nimport { milestoneAcceptOrDecline } from '../../../redux/homeSearch/actions'\n\nimport FixedRate from './confirmAndPay/fixedRate';\nimport { withRouter } from 'react-router-dom';\n//@ts-ignore\nimport FsLightbox from 'fslightbox-react';\n//@ts-ignore\nimport { moengage, mixPanel } from '../../../services/analyticsTools';\nimport { MoEConstants } from '../../../utils/constants';\n\nconst MilestoneApprove = (props: any) => {\n    const { backToScreen, data, resetStateLocal } = props;\n    const [isToggle, setToggle] = useState(false);\n    const [IsToggleAccept, setToggleAccept] = useState(false);\n    const [toggler, setToggler] = useState(false);\n    const [selectedSlide, setSelectSlide] = useState(1);\n    const [loadingTrue, setLoadingTrue] = useState(false);\n\n    if (data) {\n        let jobName: any = data?.selectedItem?.jobName;\n        let jobId: any = data?.selectedItem?.jobId;\n        let description: any = data?.selectedMile?.description;\n        let hoursWorked: any = data?.selectedMile?.hoursWorked;\n        let images: any = data?.selectedMile?.images;\n        let milestones: any = data?.itemDetails?.milestones;\n        let index: any = data?.selectedMilestoneIndex?.index;\n\n        let item: any = milestones[index];\n\n        const onSubmitAccept = async (data: any) => {\n            let total = data?.total;\n            let data_ = {\n                \"status\": 1,\n                \"jobId\": jobId,\n                \"milestoneId\": item?.milestoneId,\n                \"paymentMethodId\": data?.cardId,\n                \"milestoneAmount\": data?.milestoneAmount.replace(\"$\", \"\"),\n                \"amount\": total.replace(\"$\", \"\")\n            }\n\n            let response: any = await milestoneAcceptOrDecline(data_);\n            if (response?.success) {\n                const mData1 = {\n                    Category: props.data?.itemDetails?.categories?.[0]?.trade_name,\n                    timeStamp: moengage.getCurrentTimeStamp(),\n                }\n                moengage.moE_SendEvent(MoEConstants.MADE_PAYMENT, mData1);\n                mixPanel.mixP_SendEvent(MoEConstants.MADE_PAYMENT, mData1);\n                const mData2 = {\n                    ...mData1,\n                    'Milestone number': props.data?.selectedMilestoneIndex?.index + 1,\n                }\n                moengage.moE_SendEvent(MoEConstants.MILESTONE_CHECKED_AND_APPROVED, mData2);\n                mixPanel.mixP_SendEvent(MoEConstants.MILESTONE_CHECKED_AND_APPROVED, mData2);\n                resetStateLocal();\n                props.history.push('/need-approval-success');\n            }\n        }\n\n        const toggleBack = () => {\n            setToggle(false);\n            setToggleAccept(false);\n        }\n\n        if (IsToggleAccept) {\n            return (\n                <FixedRate\n                    {...props}\n                    jobName={jobName}\n                    data={props.data}\n                    toggleBack={toggleBack}\n                    onSubmitAccept={onSubmitAccept}\n                />\n            )\n        }\n\n\n        if (isToggle) {\n            return (\n                <DeclineMilestone\n                    milestoneAcceptOrDecline={milestoneAcceptOrDecline}\n                    jobId={jobId}\n                    jobName={jobName}\n                    toggleBack={toggleBack}\n                    resetStateLocal={resetStateLocal}\n                    milestoneId={item?.milestoneId}\n                />)\n        }\n\n\n        const renderFilteredItems = () => {\n            let sources: any = [];\n            let types: any = [];\n\n            if (images?.length) {\n                images.forEach((item: any) => {\n                    if (item?.mediaType === 2) {\n                        sources.push(item.link);\n                        types.push('video');\n                    } else if (item?.mediaType === 1) {\n                        sources.push(item.link);\n                        types.push('image');\n                    } else {\n                        sources.push(item);\n                        types.push('image');\n                    }\n                })\n            }\n\n            return { sources, types };\n        }\n\n        const { sources, types } = renderFilteredItems();\n\n        const setItemToggle = (index: any) => {\n            setToggler((prev: boolean) => !prev);\n            setSelectSlide(index + 1);\n        }\n\n        return (\n            <div className=\"flex_row\">\n                <div className=\"flex_col_sm_8\">\n                    <div className=\"relate\">\n                        <button onClick={() => { backToScreen() }} className=\"back\"></button>\n                        <span className=\"xs_sub_title\">\n                            {jobName}\n                        </span>\n                    </div>\n                    <span className=\"sub_title\">Milestone details</span>\n                    <span className=\"xs_sub_title\">{item?.milestoneName} complete</span>\n\n                    <FsLightbox\n                        toggler={toggler}\n                        slide={selectedSlide}\n                        sources={sources}\n                        types={types}\n                    />\n\n\n                    {images && Array.isArray(images) && images?.length ?\n                        <div className=\"upload_img_video\">\n                            {images.map((media_item: any, index: any) => (\n                                <figure className=\"img_video\">\n                                    {media_item?.mediaType == 1 ? (\n                                        <img\n                                            style={{ cursor: 'pointer' }}\n                                            onClick={() => { setItemToggle(index) }}\n                                            async-src={media_item?.link}\n                                            decoding=\"async\"\n                                            loading=\"lazy\"\n                                            src={media_item?.link} alt=\"media\" />\n                                    ) : media_item?.mediaType == 2 ? (\n                                        <video\n                                            style={{ cursor: 'pointer' }}\n                                            onClick={() => { setItemToggle(index) }}\n                                            src={media_item?.link} />\n                                    ) : (\n                                        <>\n                                            <img\n                                                style={{ cursor: 'pointer' }}\n                                                onClick={() => { setItemToggle(index) }}\n                                                onLoad={() => {\n                                                    setLoadingTrue(true)\n                                                }}\n                                                src={media_item}\n                                                async-src={media_item}\n                                                decoding=\"async\"\n                                                loading=\"lazy\"\n                                                alt=\"media\" />\n                                        </>\n                                    )}\n                                </figure>\n                            ))}\n                        </div>\n                        : null}\n\n                    <div className=\"form_field\">\n                        <span className=\"xs_sub_title\">Description</span>\n                        <p className=\"commn_para\">{description || ''}</p>\n                    </div>\n\n                    <div className=\"form_field\">\n                        <span className=\"xs_sub_title\">Hours worked in this milestone</span>\n                        <span className=\"show_label\">{`${hoursWorked || 0} hours`}</span>\n                    </div>\n                    <div className=\"form_field\">\n                        {/* onSubmitAccept */}\n                        <button\n                            onClick={() => {\n                                setToggleAccept(true)\n                            }}\n                            className=\"fill_btn full_btn\">Approve</button>\n                    </div>\n                    <div className=\"form_field\">\n                        <button\n                            onClick={() => { setToggle(true) }}\n                            className=\"fill_grey_btn full_btn btn-effect mt-15\">\n                            {'Decline'}\n                        </button>\n                    </div>\n                </div>\n            </div>\n        )\n    }\n    return null;\n}\n\nexport default withRouter(MilestoneApprove);\n"]},"metadata":{},"sourceType":"module"}