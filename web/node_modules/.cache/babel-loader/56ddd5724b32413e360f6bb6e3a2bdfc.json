{"ast":null,"code":"import _objectSpread from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _toConsumableArray from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState}from\"react\";import close from\"../../../assets/images/icon-close-1.png\";import addMedia from\"../../../assets/images/add-image.png\";import{onFileUpload}from\"../../../redux/auth/actions\";import{setShowToast}from\"../../../redux/common/actions\";import{moengage,mixPanel}from\"../../../services/analyticsTools\";import{MoEConstants}from\"../../../utils/constants\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var imageFormats=[\"jpeg\",\"jpg\",\"png\"];var videoFormats=[\"mp4\",\"wmv\",\"avi\"];var DeclineMilestone=function DeclineMilestone(_ref){var milestoneAcceptOrDecline=_ref.milestoneAcceptOrDecline,toggleBack=_ref.toggleBack,jobId=_ref.jobId,jobName=_ref.jobName,milestoneId=_ref.milestoneId,resetStateLocal=_ref.resetStateLocal;var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),reason=_useState2[0],setReason=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),filesUrl=_useState4[0],setFilesUrl=_useState4[1];var _useState5=useState({}),_useState6=_slicedToArray(_useState5,2),localFiles=_useState6[0],setLocalFiles=_useState6[1];var _useState7=useState({}),_useState8=_slicedToArray(_useState7,2),update=_useState8[0],forceUpdate=_useState8[1];var onSubmitDecline=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var data,response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(filesUrl===null||filesUrl===void 0?void 0:filesUrl.length){_context.next=3;break;}setShowToast(true,\"Please attach at least one media file\");return _context.abrupt(\"return\",true);case 3:data={status:2,jobId:jobId,milestoneId:milestoneId,reason:reason,url:filesUrl.length?filesUrl.map(function(file){return file.link;}):[]};_context.next=6;return milestoneAcceptOrDecline(data);case 6:response=_context.sent;if(response===null||response===void 0?void 0:response.success){moengage.moE_SendEvent(MoEConstants.MILESTONE_DECLINED,{timeStamp:moengage.getCurrentTimeStamp()});mixPanel.mixP_SendEvent(MoEConstants.MILESTONE_DECLINED,{timeStamp:moengage.getCurrentTimeStamp()});resetStateLocal(true);}case 8:case\"end\":return _context.stop();}}},_callee);}));return function onSubmitDecline(){return _ref2.apply(this,arguments);};}();var removeFromItem=function removeFromItem(index){filesUrl.splice(index,1);setFilesUrl(filesUrl);Array.isArray(update)?forceUpdate([]):forceUpdate({});};var onFileChange=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(e){var _newFile$type,_newFile$type$split$;var formData,newFile,filesUrlClone,countVideoFormats,fileType,selectedFileSize,res,link,check_type;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:formData=new FormData();newFile=e.target.files[0];if(!((filesUrl===null||filesUrl===void 0?void 0:filesUrl.length)===6)){_context2.next=5;break;}setShowToast(true,\"Max files upload limit is 6\");return _context2.abrupt(\"return\");case 5:filesUrlClone=filesUrl;countVideoFormats=filesUrlClone.map(function(item){var split_items=item.link.split(\".\");var format_split_items=split_items[(split_items===null||split_items===void 0?void 0:split_items.length)-1];if(videoFormats.includes(format_split_items)){return format_split_items;}}).filter(function(item){return item!==undefined;});fileType=newFile===null||newFile===void 0?void 0:(_newFile$type=newFile.type)===null||_newFile$type===void 0?void 0:(_newFile$type$split$=_newFile$type.split(\"/\")[1])===null||_newFile$type$split$===void 0?void 0:_newFile$type$split$.toLowerCase();selectedFileSize=(newFile===null||newFile===void 0?void 0:newFile.size)/1024/1024;// size in mib\nif(!(imageFormats.indexOf(fileType)<0||selectedFileSize>10)){_context2.next=12;break;}setShowToast(true,\"The file must be in proper format or size\");return _context2.abrupt(\"return\");case 12:if(!(imageFormats.includes(fileType)&&selectedFileSize>10)){_context2.next=15;break;}// image validations\nsetShowToast(true,\"The image file size must be below 10 mb\");return _context2.abrupt(\"return\");case 15:formData.append(\"file\",newFile);_context2.next=18;return onFileUpload(formData);case 18:res=_context2.sent;if(res.success){link=res.imgUrl;check_type=imageFormats.includes(fileType)?1:2;setFilesUrl(function(prev){return[].concat(_toConsumableArray(prev),[{mediaType:check_type,link:link}]);});setLocalFiles(function(prev){return _objectSpread(_objectSpread({},prev),{},{newFile:newFile});});}case 20:case\"end\":return _context2.stop();}}},_callee2);}));return function onFileChange(_x){return _ref3.apply(this,arguments);};}();var renderbyFileFormat=function renderbyFileFormat(item,index){var split_item_format=item.split(\".\");var get_split_fromat=split_item_format[split_item_format.length-1];var split_item_name=item.split(\"/\");var get_split_name=split_item_name[split_item_name.length-1];var image_render=null;if(get_split_fromat){if(imageFormats.includes(get_split_fromat)){image_render=/*#__PURE__*/_jsx(\"img\",{title:get_split_name,src:item,alt:\"media\"});}return/*#__PURE__*/_jsxs(\"figure\",{className:\"img_video\",children:[image_render,/*#__PURE__*/_jsx(\"img\",{onClick:function onClick(){removeFromItem(index);},src:close,alt:\"remove\",className:\"remove\"})]});}};var isValidCheck=function isValidCheck(){if(!(reason===null||reason===void 0?void 0:reason.length)||(reason===null||reason===void 0?void 0:reason.length)>1000){return true;}return false;};return/*#__PURE__*/_jsx(\"div\",{className:\"flex_row\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex_col_sm_12\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"relate\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:toggleBack,className:\"back\"}),/*#__PURE__*/_jsx(\"span\",{className:\"xs_sub_title\",children:jobName})]}),/*#__PURE__*/_jsx(\"span\",{className:\"sub_title\",children:\"Decline milestone\"}),/*#__PURE__*/_jsx(\"p\",{className:\"commn_para\",children:\"Please write your reason for declining the milestone\"}),/*#__PURE__*/_jsx(\"div\",{className:\"flex_row\",children:/*#__PURE__*/_jsx(\"div\",{className:\"flex_col_sm_7\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"form_field\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form_label\",children:\"Your reason\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"text_field\",children:[/*#__PURE__*/_jsx(\"textarea\",{value:reason,onChange:function onChange(e){setReason(e.target.value.trimLeft());},placeholder:\"Your reason...\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"char_count\",children:[\"character length: \",(reason===null||reason===void 0?void 0:reason.length)+\" / 1000\"]})]}),(reason===null||reason===void 0?void 0:reason.length)>1000&&/*#__PURE__*/_jsx(\"span\",{className:\"error_msg\",children:\"Maximum 1000 characters are allowed.\"})]})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"upload_img_video pt-10\",children:[(filesUrl===null||filesUrl===void 0?void 0:filesUrl.length)?filesUrl.map(function(item,index){return renderbyFileFormat(item.link,index);}):null,(filesUrl===null||filesUrl===void 0?void 0:filesUrl.length)<6?/*#__PURE__*/_jsxs(React.Fragment,{children:[/*#__PURE__*/_jsx(\"label\",{className:\"upload_media\",htmlFor:\"upload_img_video\",children:/*#__PURE__*/_jsx(\"img\",{src:addMedia,alt:\"\"})}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\"image/png,image/jpg,image/jpeg,.pdf, .doc, video/mp4, video/wmv, video/avi\",style:{display:\"none\"},onChange:onFileChange,id:\"upload_img_video\"})]}):null]}),/*#__PURE__*/_jsx(\"button\",{onClick:onSubmitDecline,className:\"fill_btn full_btn btn-effect \".concat(isValidCheck()?\"disable_btn\":\"\"),children:\"Send\"})]})});};export default DeclineMilestone;","map":{"version":3,"sources":["/home/appinventiv/Documents/Project/tickt/web/src/pages/builderJobDasboard/components/declineMilestone.tsx"],"names":["React","useState","close","addMedia","onFileUpload","setShowToast","moengage","mixPanel","MoEConstants","imageFormats","videoFormats","DeclineMilestone","milestoneAcceptOrDecline","toggleBack","jobId","jobName","milestoneId","resetStateLocal","reason","setReason","filesUrl","setFilesUrl","localFiles","setLocalFiles","update","forceUpdate","onSubmitDecline","length","data","status","url","map","file","link","response","success","moE_SendEvent","MILESTONE_DECLINED","timeStamp","getCurrentTimeStamp","mixP_SendEvent","removeFromItem","index","splice","Array","isArray","onFileChange","e","formData","FormData","newFile","target","files","filesUrlClone","countVideoFormats","item","split_items","split","format_split_items","includes","filter","undefined","fileType","type","toLowerCase","selectedFileSize","size","indexOf","append","res","imgUrl","check_type","prev","mediaType","renderbyFileFormat","split_item_format","get_split_fromat","split_item_name","get_split_name","image_render","isValidCheck","value","trimLeft","display"],"mappings":"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","sourcesContent":["import React, { useState } from \"react\";\nimport media from \"../../../assets/images/portfolio-placeholder.jpg\";\nimport close from \"../../../assets/images/icon-close-1.png\";\nimport addMedia from \"../../../assets/images/add-image.png\";\nimport { onFileUpload } from \"../../../redux/auth/actions\";\nimport { setShowToast } from \"../../../redux/common/actions\";\nimport videoThumbnail from \"../../../assets/images/add-video.png\";\n\nimport { moengage, mixPanel } from \"../../../services/analyticsTools\";\nimport { MoEConstants } from \"../../../utils/constants\";\ninterface Props {\n  milestoneAcceptOrDecline: any;\n  jobId: any;\n  jobName: any;\n  milestoneId: any;\n  toggleBack: () => void;\n  resetStateLocal: any;\n}\nconst imageFormats: Array<any> = [\"jpeg\", \"jpg\", \"png\"];\nconst videoFormats: Array<any> = [\"mp4\", \"wmv\", \"avi\"];\n\nconst DeclineMilestone = ({\n  milestoneAcceptOrDecline,\n  toggleBack,\n  jobId,\n  jobName,\n  milestoneId,\n  resetStateLocal,\n}: Props) => {\n  const [reason, setReason] = useState(\"\");\n  const [filesUrl, setFilesUrl] = useState([] as any);\n  const [localFiles, setLocalFiles] = useState({});\n  const [update, forceUpdate] = useState({});\n\n  const onSubmitDecline = async () => {\n    if (!filesUrl?.length) {\n      setShowToast(true, \"Please attach at least one media file\");\n      return true;\n    }\n\n    let data = {\n      status: 2,\n      jobId: jobId,\n      milestoneId: milestoneId,\n      reason: reason,\n      url: filesUrl.length ? filesUrl.map((file: any) => file.link) : [],\n    };\n\n    let response: any = await milestoneAcceptOrDecline(data);\n    if (response?.success) {\n      moengage.moE_SendEvent(MoEConstants.MILESTONE_DECLINED, {\n        timeStamp: moengage.getCurrentTimeStamp(),\n      });\n      mixPanel.mixP_SendEvent(MoEConstants.MILESTONE_DECLINED, {\n        timeStamp: moengage.getCurrentTimeStamp(),\n      });\n      resetStateLocal(true);\n    }\n  };\n\n  const removeFromItem = (index: any) => {\n    filesUrl.splice(index, 1);\n    setFilesUrl(filesUrl);\n    Array.isArray(update) ? forceUpdate([]) : forceUpdate({});\n  };\n\n  const onFileChange = async (e: any) => {\n    const formData = new FormData();\n    const newFile = e.target.files[0];\n\n    if (filesUrl?.length === 6) {\n      setShowToast(true, \"Max files upload limit is 6\");\n      return;\n    }\n\n    let filesUrlClone: any = filesUrl;\n\n    let countVideoFormats = filesUrlClone\n      .map((item: any) => {\n        let split_items = item.link.split(\".\");\n\n        let format_split_items = split_items[split_items?.length - 1];\n\n        if (videoFormats.includes(format_split_items)) {\n          return format_split_items;\n        }\n      })\n      .filter((item: any) => item !== undefined);\n\n    var fileType = newFile?.type?.split(\"/\")[1]?.toLowerCase();\n    var selectedFileSize = newFile?.size / 1024 / 1024; // size in mib\n\n    if (imageFormats.indexOf(fileType) < 0 || selectedFileSize > 10) {\n      setShowToast(true, \"The file must be in proper format or size\");\n      return;\n    }\n\n    if (imageFormats.includes(fileType) && selectedFileSize > 10) {\n      // image validations\n      setShowToast(true, \"The image file size must be below 10 mb\");\n      return;\n    }\n\n    formData.append(\"file\", newFile);\n    const res = await onFileUpload(formData);\n    if (res.success) {\n      let link: string = res.imgUrl;\n      let check_type: any = imageFormats.includes(fileType) ? 1 : 2;\n      setFilesUrl((prev: Array<any>) => [\n        ...prev,\n        {\n          mediaType: check_type,\n          link: link,\n        },\n      ]);\n      setLocalFiles((prev: any) => ({ ...prev, newFile }));\n    }\n  };\n\n  const renderbyFileFormat = (item: any, index: any) => {\n    let split_item_format = item.split(\".\");\n    let get_split_fromat = split_item_format[split_item_format.length - 1];\n\n    let split_item_name = item.split(\"/\");\n    let get_split_name = split_item_name[split_item_name.length - 1];\n    let image_render: any = null;\n    if (get_split_fromat) {\n      if (imageFormats.includes(get_split_fromat)) {\n        image_render = <img title={get_split_name} src={item} alt=\"media\" />;\n      }\n      return (\n        <figure className=\"img_video\">\n          {image_render}\n          <img\n            onClick={() => {\n              removeFromItem(index);\n            }}\n            src={close}\n            alt=\"remove\"\n            className=\"remove\"\n          />\n          {/* <span style={{ fontSize: '10px' }}>{get_split_name}</span> */}\n        </figure>\n      );\n    }\n  };\n\n  const isValidCheck = () => {\n    if (!reason?.length || reason?.length > 1000) {\n      return true;\n    }\n\n    return false;\n  };\n\n  return (\n    <div className=\"flex_row\">\n      <div className=\"flex_col_sm_12\">\n        <div className=\"relate\">\n          <button onClick={toggleBack} className=\"back\"></button>\n          <span className=\"xs_sub_title\">{jobName}</span>\n        </div>\n        <span className=\"sub_title\">Decline milestone</span>\n        <p className=\"commn_para\">\n          Please write your reason for declining the milestone\n        </p>\n        <div className=\"flex_row\">\n          <div className=\"flex_col_sm_7\">\n            <div className=\"form_field\">\n              <label className=\"form_label\">Your reason</label>\n              <div className=\"text_field\">\n                <textarea\n                  value={reason}\n                  onChange={(e: any) => {\n                    setReason(e.target.value.trimLeft());\n                  }}\n                  placeholder=\"Your reason...\"\n                ></textarea>\n                <span className=\"char_count\">\n                  {\"character length: \"}\n                  {reason?.length + \" / 1000\"}\n                </span>\n              </div>\n              {reason?.length > 1000 && (\n                <span className=\"error_msg\">\n                  {\"Maximum 1000 characters are allowed.\"}\n                </span>\n              )}\n            </div>\n          </div>\n        </div>\n        <div className=\"upload_img_video pt-10\">\n          {filesUrl?.length\n            ? filesUrl.map((item: any, index: number) =>\n                renderbyFileFormat(item.link, index)\n              )\n            : null}\n\n          {filesUrl?.length < 6 ? (\n            <React.Fragment>\n              <label className=\"upload_media\" htmlFor=\"upload_img_video\">\n                <img src={addMedia} alt=\"\" />\n              </label>\n\n              <input\n                type=\"file\"\n                accept=\"image/png,image/jpg,image/jpeg,.pdf, .doc, video/mp4, video/wmv, video/avi\"\n                style={{ display: \"none\" }}\n                onChange={onFileChange}\n                id=\"upload_img_video\"\n              />\n            </React.Fragment>\n          ) : null}\n        </div>\n        <button\n          onClick={onSubmitDecline}\n          className={`fill_btn full_btn btn-effect ${\n            isValidCheck() ? \"disable_btn\" : \"\"\n          }`}\n        >\n          Send\n        </button>\n      </div>\n    </div>\n  );\n};\n\nexport default DeclineMilestone;\n"]},"metadata":{},"sourceType":"module"}