{"ast":null,"code":"import _objectSpread from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _toConsumableArray from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect,useRef}from\"react\";import{getJobDetails}from\"../../redux/jobs/actions\";import storageService from\"../../utils/storageService\";import notFound from\"../../assets/images/not-found.png\";import chatVideoIcon from\"../../assets/images/video@3x.png\";import dummy from\"../../assets/images/u_placeholder.jpg\";import viewMore from\"../../assets/images/icon-direction-blue.png\";import close from\"../../assets/images/ic-cancel-blue.png\";import sendMedia from\"../../assets/images/ic-media.png\";import sendBtn from\"../../assets/images/ic-send.png\";import loader from\"../../assets/images/loader.gif\";import{formatDateTime,renderTime}from\"../../utils/common\";import{setShowToast}from\"../../redux/common/actions\";import{onFileUpload}from\"../../redux/auth/actions\";import{getMessagesOfRoom,sendTextMessage,sendImageVideoMessage}from\"../../services/firebase\";import Constants from\"../../utils/constants\";//@ts-ignore\nimport FsLightbox from\"fslightbox-react\";import{moengage,mixPanel}from\"../../services/analyticsTools\";import{MoEConstants}from\"../../utils/constants\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var lastDate=\"\";var docTypes=[\"jpeg\",\"jpg\",\"png\",\"mp4\",\"wmv\",\"avi\"];var UserMessages=function UserMessages(props){var _storageService$getIt,_props$roomData16,_props$roomData16$opp,_props$roomData19,_props$roomData19$opp,_props$roomData21,_props$roomData21$opp,_props$roomData22,_props$roomData22$opp;var divRref=useRef(null);var _useState=useState((_storageService$getIt=storageService.getItem(\"userInfo\"))===null||_storageService$getIt===void 0?void 0:_storageService$getIt._id),_useState2=_slicedToArray(_useState,1),userId=_useState2[0];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),toggle=_useState4[0],setToggle=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),jobDetailLoader=_useState6[0],setJobDetailLoader=_useState6[1];var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),currentJobDetails=_useState8[0],setCurrentJobDetails=_useState8[1];var _useState9=useState(\"\"),_useState10=_slicedToArray(_useState9,2),messageText=_useState10[0],setMessageText=_useState10[1];var _useState11=useState([]),_useState12=_slicedToArray(_useState11,2),messages=_useState12[0],setMessages=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),isDocUploading=_useState14[0],setIsDocUploading=_useState14[1];var _useState15=useState([]),_useState16=_slicedToArray(_useState15,2),itemsMedia=_useState16[0],setItemsMedia=_useState16[1];var _useState17=useState(false),_useState18=_slicedToArray(_useState17,2),toggler=_useState18[0],setToggler=_useState18[1];var _useState19=useState(1),_useState20=_slicedToArray(_useState19,2),selectedSlide=_useState20[0],setSelectSlide=_useState20[1];var _useState21=useState({}),_useState22=_slicedToArray(_useState21,2),fsSlideListner=_useState22[0],setFsSlideListner=_useState22[1];var _useState23=useState(\"\"),_useState24=_slicedToArray(_useState23,2),oppUserFcmToken=_useState24[0],setOppUserFcmToken=_useState24[1];useEffect(function(){if(props.roomId!==\"\"){lastDate=\"\";getMessagesOfRoom(props.roomId,onReceiveOfNewMsg);setSelectSlide(1);setFsSlideListner({});setItemsMedia([]);setCurrentJobDetails(null);setToggle(false);}},[props.roomId]);// }, [props.roomId, props.roomData]);\n//console.log('props.roomData: ', props.roomData);\nuseEffect(function(){scrollToBottom();});var scrollToBottom=function scrollToBottom(){if(null!==(divRref===null||divRref===void 0?void 0:divRref.current)){var scroll=divRref.current.scrollHeight-divRref.current.clientHeight;// divRref.current.scrollIntoView({ behavior: \"smooth\" })\ndivRref.current.scrollTo(0,scroll);}};var onReceiveOfNewMsg=function onReceiveOfNewMsg(arrmsg){// console.log('arrmsg: ', arrmsg);\nsetMessages(arrmsg);};useEffect(function(){var fsSlideObj={};var mediaMsgs=[];var slideCount=1;if(messages.length){mediaMsgs=messages.filter(function(item,index){if(item.messageType===\"image\"||item.messageType===\"video\"){fsSlideObj[\"\".concat(index)]=slideCount++;return item;}});setItemsMedia(mediaMsgs);setFsSlideListner(fsSlideObj);}},[messages]);// console.log('itemsMedia: ', itemsMedia, \"fsSlideListner\", fsSlideListner);\nvar setInboxToTopWithLastMsg=function setInboxToTopWithLastMsg(lastMsg){var newInboxData=_toConsumableArray(props.inBoxData);var currentIndex=newInboxData.findIndex(function(i){return i.roomId===props.roomId;});newInboxData[currentIndex].lastMsg=lastMsg;newInboxData.splice(currentIndex,1);newInboxData.unshift(props.inBoxData[currentIndex]);props.setInBoxData(newInboxData);// console.log('lastMsg: ', lastMsg);\n// console.log('currentIndex: ', currentIndex);\n// console.log('newInboxData: ', newInboxData);\n};var sendMessage=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _props$roomData,_props$roomData$oppUs,_props$roomData2,_props$roomData2$oppU,_props$roomData3,_props$roomData3$oppU,_props$roomData4,_props$roomData4$oppU,lastMsg,mData;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(messageText&&messageText.trimLeft()!==\"\")){_context.next=7;break;}setMessageText(\"\");_context.next=4;return sendTextMessage(props.roomId,messageText);case 4:lastMsg=_context.sent;if(lastMsg&&((_props$roomData=props.roomData)===null||_props$roomData===void 0?void 0:(_props$roomData$oppUs=_props$roomData.oppUserInfo)===null||_props$roomData$oppUs===void 0?void 0:_props$roomData$oppUs.deviceToken)&&((_props$roomData2=props.roomData)===null||_props$roomData2===void 0?void 0:(_props$roomData2$oppU=_props$roomData2.oppUserInfo)===null||_props$roomData2$oppU===void 0?void 0:_props$roomData2$oppU.deviceType)&&(((_props$roomData3=props.roomData)===null||_props$roomData3===void 0?void 0:(_props$roomData3$oppU=_props$roomData3.oppUserInfo)===null||_props$roomData3$oppU===void 0?void 0:_props$roomData3$oppU.hasOwnProperty(\"isNotification\"))?(_props$roomData4=props.roomData)===null||_props$roomData4===void 0?void 0:(_props$roomData4$oppU=_props$roomData4.oppUserInfo)===null||_props$roomData4$oppU===void 0?void 0:_props$roomData4$oppU.isNotification:true)){sendFCMPushNotificationToOppUser(lastMsg);mData={timeStamp:moengage.getCurrentTimeStamp()};moengage.moE_SendEvent(MoEConstants.CHAT,mData);mixPanel.mixP_SendEvent(MoEConstants.CHAT,mData);}setInboxToTopWithLastMsg(lastMsg);case 7:case\"end\":return _context.stop();}}},_callee);}));return function sendMessage(){return _ref.apply(this,arguments);};}();var handleKeyDown=function handleKeyDown(event){if(!event.shiftKey&&event.key===\"Enter\"){event.preventDefault();sendMessage();setMessageText(\"\");}};var sendImageVideoMsg=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(url,msgType){var _props$roomData5,_props$roomData5$oppU,_props$roomData6,_props$roomData6$oppU,_props$roomData7,_props$roomData7$oppU,_props$roomData8,_props$roomData8$oppU,lastMsg;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!(url&&url!==\"\")){_context2.next=6;break;}_context2.next=3;return sendImageVideoMessage(props.roomId,url,msgType);case 3:lastMsg=_context2.sent;if(lastMsg&&((_props$roomData5=props.roomData)===null||_props$roomData5===void 0?void 0:(_props$roomData5$oppU=_props$roomData5.oppUserInfo)===null||_props$roomData5$oppU===void 0?void 0:_props$roomData5$oppU.deviceToken)&&((_props$roomData6=props.roomData)===null||_props$roomData6===void 0?void 0:(_props$roomData6$oppU=_props$roomData6.oppUserInfo)===null||_props$roomData6$oppU===void 0?void 0:_props$roomData6$oppU.deviceType)&&(((_props$roomData7=props.roomData)===null||_props$roomData7===void 0?void 0:(_props$roomData7$oppU=_props$roomData7.oppUserInfo)===null||_props$roomData7$oppU===void 0?void 0:_props$roomData7$oppU.hasOwnProperty(\"isNotification\"))?(_props$roomData8=props.roomData)===null||_props$roomData8===void 0?void 0:(_props$roomData8$oppU=_props$roomData8.oppUserInfo)===null||_props$roomData8$oppU===void 0?void 0:_props$roomData8$oppU.isNotification:true)){sendFCMPushNotificationToOppUser(lastMsg);}setInboxToTopWithLastMsg(lastMsg);case 6:setMessageText(\"\");case 7:case\"end\":return _context2.stop();}}},_callee2);}));return function sendImageVideoMsg(_x,_x2){return _ref2.apply(this,arguments);};}();var fetchJobDetail=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(jobId){var res,_res$data,_res$data2,_res$data3,_res$data4,_res$data5,_res$data6,_res$data7,_res$data8,_res$data9,jobInfo;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:setJobDetailLoader(true);_context3.next=3;return getJobDetails(jobId);case 3:res=_context3.sent;if(res.success){jobInfo={jobDescription:((_res$data=res.data)===null||_res$data===void 0?void 0:_res$data.details)||\"\",jobId:((_res$data2=res.data)===null||_res$data2===void 0?void 0:_res$data2.jobId)||\"\",jobName:((_res$data3=res.data)===null||_res$data3===void 0?void 0:_res$data3.jobName)||\"\",amount:((_res$data4=res.data)===null||_res$data4===void 0?void 0:_res$data4.amount)||\"\",locationName:((_res$data5=res.data)===null||_res$data5===void 0?void 0:_res$data5.locationName)||\"\",fromDate:((_res$data6=res.data)===null||_res$data6===void 0?void 0:_res$data6.fromDate)||\"\",toDate:((_res$data7=res.data)===null||_res$data7===void 0?void 0:_res$data7.toDate)||\"\",duration:((_res$data8=res.data)===null||_res$data8===void 0?void 0:_res$data8.duration)||\"\",status:((_res$data9=res.data)===null||_res$data9===void 0?void 0:_res$data9.status)||\"\"};setCurrentJobDetails(jobInfo);setJobDetailLoader(false);}case 5:case\"end\":return _context3.stop();}}},_callee3);}));return function fetchJobDetail(_x3){return _ref3.apply(this,arguments);};}();var renderMediaItems=function renderMediaItems(itemsMedia){var sources=[];var types=[];if(itemsMedia.length){itemsMedia.forEach(function(item){if(item.messageType===\"video\"){sources.push(item.mediaUrl);types.push(\"video\");}if(item.messageType===\"image\"){sources.push(item.mediaUrl);types.push(\"image\");}});}return{sources:sources,types:types};};var setResDeviceType=function setResDeviceType(deviceType,msg){var _storageService$getIt2,_storageService$getIt3,_storageService$getIt4,_storageService$getIt5,_storageService$getIt6,_msg$messageRoomId,_msg$messageRoomId$sp,_storageService$getIt7,_props$roomData9,_storageService$getIt8,_storageService$getIt9,_storageService$getIt10,_msg$messageRoomId2,_msg$messageRoomId2$s,_storageService$getIt11,_props$roomData10;switch(Number(deviceType)){case 1:return{app_icon:\"https://appinventiv-development.s3.amazonaws.com/1628513615740ic-logo-yellow.png\",title:\"Tickt App\",notificationText:\"\".concat((_storageService$getIt2=storageService.getItem(\"userInfo\"))===null||_storageService$getIt2===void 0?void 0:_storageService$getIt2.userName,\" send you a message\"),senderName:\"\".concat((_storageService$getIt3=storageService.getItem(\"userInfo\"))===null||_storageService$getIt3===void 0?void 0:_storageService$getIt3.userName),messageType:\"\".concat(msg===null||msg===void 0?void 0:msg.messageType),messageText:\"\".concat((msg===null||msg===void 0?void 0:msg.messageType)===\"text\"?msg===null||msg===void 0?void 0:msg.messageText:\"\"),room_id:msg===null||msg===void 0?void 0:msg.messageRoomId,image:(_storageService$getIt4=storageService.getItem(\"userInfo\"))===null||_storageService$getIt4===void 0?void 0:_storageService$getIt4.user_image,notificationType:25,sound:\"default\"};case 2:return{body:msg===null||msg===void 0?void 0:msg.messageText,messageText:msg===null||msg===void 0?void 0:msg.messageText,sender:{first_name:(_storageService$getIt5=storageService.getItem(\"userInfo\"))===null||_storageService$getIt5===void 0?void 0:_storageService$getIt5.userName,device_token:storageService.getItem(\"fcmToken\"),user_id:(_storageService$getIt6=storageService.getItem(\"userInfo\"))===null||_storageService$getIt6===void 0?void 0:_storageService$getIt6._id,device_type:2},jobId:msg===null||msg===void 0?void 0:(_msg$messageRoomId=msg.messageRoomId)===null||_msg$messageRoomId===void 0?void 0:(_msg$messageRoomId$sp=_msg$messageRoomId.split(\"_\"))===null||_msg$messageRoomId$sp===void 0?void 0:_msg$messageRoomId$sp[0],badge:1,device_type:2,title:(_storageService$getIt7=storageService.getItem(\"userInfo\"))===null||_storageService$getIt7===void 0?void 0:_storageService$getIt7.userName,jobName:(_props$roomData9=props.roomData)===null||_props$roomData9===void 0?void 0:_props$roomData9.jobName,notification_type:50,sound:\"default\",messageId:msg===null||msg===void 0?void 0:msg.messageId};case 3:return{notification:{body:msg===null||msg===void 0?void 0:msg.messageText,title:(_storageService$getIt8=storageService.getItem(\"userInfo\"))===null||_storageService$getIt8===void 0?void 0:_storageService$getIt8.userName},data:{body:msg===null||msg===void 0?void 0:msg.messageText,messageText:msg===null||msg===void 0?void 0:msg.messageText,sender:{first_name:(_storageService$getIt9=storageService.getItem(\"userInfo\"))===null||_storageService$getIt9===void 0?void 0:_storageService$getIt9.userName,device_token:storageService.getItem(\"fcmToken\"),user_id:(_storageService$getIt10=storageService.getItem(\"userInfo\"))===null||_storageService$getIt10===void 0?void 0:_storageService$getIt10._id,device_type:2},jobId:msg===null||msg===void 0?void 0:(_msg$messageRoomId2=msg.messageRoomId)===null||_msg$messageRoomId2===void 0?void 0:(_msg$messageRoomId2$s=_msg$messageRoomId2.split(\"_\"))===null||_msg$messageRoomId2$s===void 0?void 0:_msg$messageRoomId2$s[0],badge:1,device_type:2,title:(_storageService$getIt11=storageService.getItem(\"userInfo\"))===null||_storageService$getIt11===void 0?void 0:_storageService$getIt11.userName,jobName:(_props$roomData10=props.roomData)===null||_props$roomData10===void 0?void 0:_props$roomData10.jobName,notification_type:50,sound:\"default\",messageId:msg===null||msg===void 0?void 0:msg.messageId}};default:return;}};var sendFCMPushNotificationToOppUser=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(msg){var _props$roomData11,_props$roomData11$opp,_props$roomData12,_props$roomData12$opp,_props$roomData13,_props$roomData13$opp,_props$roomData14,_props$roomData14$opp,_props$roomData15,_props$roomData15$opp;var data,newData,headers_,response;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:data=setResDeviceType((_props$roomData11=props.roomData)===null||_props$roomData11===void 0?void 0:(_props$roomData11$opp=_props$roomData11.oppUserInfo)===null||_props$roomData11$opp===void 0?void 0:_props$roomData11$opp.deviceType,msg);newData=_objectSpread(_objectSpread(_objectSpread({to:\"\".concat((_props$roomData12=props.roomData)===null||_props$roomData12===void 0?void 0:(_props$roomData12$opp=_props$roomData12.oppUserInfo)===null||_props$roomData12$opp===void 0?void 0:_props$roomData12$opp.deviceToken)},((_props$roomData13=props.roomData)===null||_props$roomData13===void 0?void 0:(_props$roomData13$opp=_props$roomData13.oppUserInfo)===null||_props$roomData13$opp===void 0?void 0:_props$roomData13$opp.deviceType)==1&&{data:data}),((_props$roomData14=props.roomData)===null||_props$roomData14===void 0?void 0:(_props$roomData14$opp=_props$roomData14.oppUserInfo)===null||_props$roomData14$opp===void 0?void 0:_props$roomData14$opp.deviceType)==2&&{notification:data}),((_props$roomData15=props.roomData)===null||_props$roomData15===void 0?void 0:(_props$roomData15$opp=_props$roomData15.oppUserInfo)===null||_props$roomData15$opp===void 0?void 0:_props$roomData15$opp.deviceType)==3&&{notification:data===null||data===void 0?void 0:data.notification,data:data===null||data===void 0?void 0:data.data});headers_={\"Content-Type\":\"application/json\",Authorization:Constants.FcmHeaderAuthorizationKey};_context4.next=5;return fetch(\"https://fcm.googleapis.com/fcm/send\",{method:\"POST\",headers:headers_,body:JSON.stringify(newData)});case 5:response=_context4.sent;// const res: any = await response.json();\nif(response.status===200){console.log(\"Chat push notification send to opposite user: success\");}else{console.log(\"Chat push notification send to opposite user: failure\");}case 7:case\"end\":return _context4.stop();}}},_callee4);}));return function sendFCMPushNotificationToOppUser(_x4){return _ref4.apply(this,arguments);};}();var handleUpload=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(e){var _newFile$type,_newFile$type$split$;var maxFileSize,formData,newFile,fileType,selectedFileSize,check_type,res;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:maxFileSize=10;formData=new FormData();newFile=e.target.files[0];fileType=newFile===null||newFile===void 0?void 0:(_newFile$type=newFile.type)===null||_newFile$type===void 0?void 0:(_newFile$type$split$=_newFile$type.split(\"/\")[1])===null||_newFile$type$split$===void 0?void 0:_newFile$type$split$.toLowerCase();selectedFileSize=(newFile===null||newFile===void 0?void 0:newFile.size)/1024/1024;// size in mb\nif([\"mp4\",\"wmv\",\"avi\"].includes(fileType)){maxFileSize=20;}if(!(docTypes.indexOf(fileType)<0||selectedFileSize>maxFileSize)){_context5.next=9;break;}setShowToast(true,\"The file must be in proper format or size\");return _context5.abrupt(\"return\");case 9:formData.append(\"file\",newFile);setIsDocUploading(true);check_type=[\"jpeg\",\"jpg\",\"png\"].includes(fileType)?1:[\"mp4\",\"wmv\",\"avi\"].includes(fileType)?2:null;_context5.next=14;return onFileUpload(formData);case 14:res=_context5.sent;if(res.success&&res.imgUrl){if(check_type===1){sendImageVideoMsg(res.imgUrl,\"image\");}else if(check_type===2){sendImageVideoMsg(res.imgUrl,\"video\");}else{setShowToast(true,\"There is some technical issue\");}setIsDocUploading(false);// setLocalFiles((prev: any) => ({ ...prev, [filesUrl?.length]: URL.createObjectURL(newFile) }));\n}case 16:case\"end\":return _context5.stop();}}},_callee5);}));return function handleUpload(_x5){return _ref5.apply(this,arguments);};}();var renderTextMsg=function renderTextMsg(msg){var curDate=formatDateTime(msg.messageTimestamp,\"day\");var messageClass=msg.senderId===userId?\"message\":\"message recive_msg\";if(lastDate===\"\"||lastDate!==curDate){lastDate=curDate;return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"date_time\",children:/*#__PURE__*/_jsx(\"span\",{children:curDate})}),/*#__PURE__*/_jsx(\"div\",{className:\"\".concat(messageClass),children:/*#__PURE__*/_jsxs(\"p\",{className:\"\".concat(msg.senderId===userId?\"mark\":\"\"),children:[msg.messageText,/*#__PURE__*/_jsx(\"span\",{className:\"time\",children:formatDateTime(msg.messageTimestamp,\"time\")})]})})]});}else return/*#__PURE__*/_jsx(\"div\",{className:\"\".concat(messageClass),children:/*#__PURE__*/_jsxs(\"p\",{className:\"\".concat(msg.senderId===userId?\"mark\":\"\"),children:[msg.messageText,/*#__PURE__*/_jsx(\"span\",{className:\"time\",children:formatDateTime(msg.messageTimestamp,\"time\")})]})});};var renderImageMsg=function renderImageMsg(msg,index){var curDate=formatDateTime(msg.messageTimestamp,\"day\");var messageClass=msg.senderId===userId?\"message\":\"message recive_msg\";if(lastDate===\"\"||lastDate!==curDate){lastDate=curDate;return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"date_time\",children:/*#__PURE__*/_jsx(\"span\",{children:curDate})}),/*#__PURE__*/_jsx(\"div\",{className:\"\".concat(messageClass),children:/*#__PURE__*/_jsxs(\"figure\",{className:\"media\",children:[/*#__PURE__*/_jsx(\"img\",{src:msg.mediaUrl||notFound,alt:\"media\",\"async-src\":msg.mediaUrl||notFound,decoding:\"async\",loading:\"lazy\",onError:function onError(e){var _e$target,_e$target2;if(e===null||e===void 0?void 0:(_e$target=e.target)===null||_e$target===void 0?void 0:_e$target.onerror){e.target.onerror=null;}if(e===null||e===void 0?void 0:(_e$target2=e.target)===null||_e$target2===void 0?void 0:_e$target2.src){e.target.src=notFound;}},onClick:function onClick(){setToggler(function(prev){return!prev;});setSelectSlide(fsSlideListner[\"\".concat(index)]);}}),/*#__PURE__*/_jsx(\"span\",{className:\"time\",children:formatDateTime(msg.messageTimestamp,\"time\")})]})})]});}else return/*#__PURE__*/_jsx(\"div\",{className:\"\".concat(messageClass),children:/*#__PURE__*/_jsxs(\"figure\",{className:\"media\",children:[/*#__PURE__*/_jsx(\"img\",{src:msg.mediaUrl||notFound,alt:\"media\",\"async-src\":msg.mediaUrl||notFound,decoding:\"async\",loading:\"lazy\",onError:function onError(e){var _e$target3,_e$target4;if(e===null||e===void 0?void 0:(_e$target3=e.target)===null||_e$target3===void 0?void 0:_e$target3.onerror){e.target.onerror=null;}if(e===null||e===void 0?void 0:(_e$target4=e.target)===null||_e$target4===void 0?void 0:_e$target4.src){e.target.src=notFound;}},onClick:function onClick(){setToggler(function(prev){return!prev;});setSelectSlide(fsSlideListner[\"\".concat(index)]);}}),/*#__PURE__*/_jsx(\"span\",{className:\"time\",children:formatDateTime(msg.messageTimestamp,\"time\")})]})});};var renderVideoMsg=function renderVideoMsg(msg,index){var curDate=formatDateTime(msg.messageTimestamp,\"day\");var messageClass=msg.senderId===userId?\"message\":\"message recive_msg\";if(lastDate===\"\"||lastDate!==curDate){lastDate=curDate;return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"date_time\",children:/*#__PURE__*/_jsx(\"span\",{children:curDate})}),/*#__PURE__*/_jsx(\"div\",{className:\"\".concat(messageClass),children:/*#__PURE__*/_jsxs(\"figure\",{className:\"media media_video \",children:[/*#__PURE__*/_jsx(\"video\",{src:msg.mediaUrl||notFound,poster:chatVideoIcon,onClick:function onClick(){setToggler(function(prev){return!prev;});setSelectSlide(fsSlideListner[\"\".concat(index)]);}}),/*#__PURE__*/_jsx(\"span\",{className:\"time\",children:formatDateTime(msg.messageTimestamp,\"time\")})]})})]});}else return/*#__PURE__*/_jsx(\"div\",{className:\"\".concat(messageClass),children:/*#__PURE__*/_jsxs(\"figure\",{className:\"media media_video \",children:[/*#__PURE__*/_jsx(\"video\",{src:msg.mediaUrl||notFound,poster:chatVideoIcon,onClick:function onClick(){setToggler(function(prev){return!prev;});setSelectSlide(fsSlideListner[\"\".concat(index)]);}}),/*#__PURE__*/_jsx(\"span\",{className:\"time\",children:formatDateTime(msg.messageTimestamp,\"time\")})]})});};var displayMessages=function displayMessages(msg,index){if(index===0)lastDate=\"\";switch(msg.messageType){case\"text\":return renderTextMsg(msg);case\"image\":return renderImageMsg(msg,index);case\"video\":return renderVideoMsg(msg,index);}};var _renderMediaItems=renderMediaItems(itemsMedia),sources=_renderMediaItems.sources,types=_renderMediaItems.types;return props.isNoRecords?/*#__PURE__*/_jsx(\"div\",{className:\"detail_col\",children:/*#__PURE__*/_jsx(\"div\",{className:\"flex_row\",children:/*#__PURE__*/_jsx(\"div\",{})})}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(FsLightbox,{toggler:toggler,slide:selectedSlide,sources:sources,types:types,// disableLocalStorage={true}\nonClose:function onClose(){setSelectSlide(1);}},sources===null||sources===void 0?void 0:sources.length),/*#__PURE__*/_jsx(\"div\",{className:\"detail_col\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex_row\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"chat_col \".concat(toggle?\"active\":\"\"),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"chat_user\",children:[/*#__PURE__*/_jsx(\"figure\",{className:\"u_img\",children:/*#__PURE__*/_jsx(\"img\",{src:((_props$roomData16=props.roomData)===null||_props$roomData16===void 0?void 0:(_props$roomData16$opp=_props$roomData16.oppUserInfo)===null||_props$roomData16$opp===void 0?void 0:_props$roomData16$opp.image)||dummy,alt:\"user-img\",onError:function onError(e){var _e$target5,_e$target6;if(e===null||e===void 0?void 0:(_e$target5=e.target)===null||_e$target5===void 0?void 0:_e$target5.onerror){e.target.onerror=null;}if(e===null||e===void 0?void 0:(_e$target6=e.target)===null||_e$target6===void 0?void 0:_e$target6.src){e.target.src=dummy;}}})}),/*#__PURE__*/_jsx(\"span\",{className:\"name\",onClick:function onClick(){if(storageService.getItem(\"userType\")===2){var _props$roomData17,_props$roomData17$opp;props.history.push(\"/tradie-info?tradeId=\".concat((_props$roomData17=props.roomData)===null||_props$roomData17===void 0?void 0:(_props$roomData17$opp=_props$roomData17.oppUserInfo)===null||_props$roomData17$opp===void 0?void 0:_props$roomData17$opp.userId,\"&hideInvite=true\"));}else{var _props$roomData18,_props$roomData18$opp;props.history.push(\"/builder-info?builderId=\".concat((_props$roomData18=props.roomData)===null||_props$roomData18===void 0?void 0:(_props$roomData18$opp=_props$roomData18.oppUserInfo)===null||_props$roomData18$opp===void 0?void 0:_props$roomData18$opp.userId));}},children:(_props$roomData19=props.roomData)===null||_props$roomData19===void 0?void 0:(_props$roomData19$opp=_props$roomData19.oppUserInfo)===null||_props$roomData19$opp===void 0?void 0:_props$roomData19$opp.name}),!toggle&&/*#__PURE__*/_jsxs(\"span\",{onClick:function onClick(){var _props$roomData20;setToggle(true);if(currentJobDetails)return;fetchJobDetail((_props$roomData20=props.roomData)===null||_props$roomData20===void 0?void 0:_props$roomData20.jobId);},className:\"view_detail\",children:[\"View Job Details\",/*#__PURE__*/_jsx(\"img\",{src:viewMore,alt:\"view-more\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"message_wrapr\",ref:divRref,children:[messages.length>0&&messages.map(function(msg,index){return displayMessages(msg,index);}),/*#__PURE__*/_jsx(\"div\",{className:\"date_time\",children:((_props$roomData21=props.roomData)===null||_props$roomData21===void 0?void 0:(_props$roomData21$opp=_props$roomData21.oppUserInfo)===null||_props$roomData21$opp===void 0?void 0:_props$roomData21$opp.isBlock)&&/*#__PURE__*/_jsx(\"i\",{style:{color:\"#929292\"},children:\"You can no longer chat with the user\"})})]}),!((_props$roomData22=props.roomData)===null||_props$roomData22===void 0?void 0:(_props$roomData22$opp=_props$roomData22.oppUserInfo)===null||_props$roomData22$opp===void 0?void 0:_props$roomData22$opp.isBlock)&&/*#__PURE__*/_jsx(\"div\",{className:\"send_msg\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text_field\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"upload_item\",htmlFor:\"upload_item\",children:/*#__PURE__*/_jsx(\"span\",{className:\"detect_icon_ltr\",children:/*#__PURE__*/_jsx(\"img\",{src:sendMedia,alt:\"media\"})})}),/*#__PURE__*/_jsx(\"input\",{id:\"upload_item\",className:\"hide\",type:\"file\",accept:\"image/png,image/jpg,image/jpeg, video/mp4, video/wmv, video/avi\",onChange:handleUpload,disabled:isDocUploading}),/*#__PURE__*/_jsx(\"textarea\",{placeholder:\"Message..\",onKeyDown:handleKeyDown,value:messageText,onChange:function onChange(e){return setMessageText(e.target.value);}}),/*#__PURE__*/_jsx(\"span\",{className:\"detect_icon\",children:/*#__PURE__*/_jsx(\"img\",{src:sendBtn,alt:\"send\",onClick:sendMessage})})]})})]}),toggle&&jobDetailLoader?/*#__PURE__*/_jsx(\"div\",{className:\"view_detail_col\",children:/*#__PURE__*/_jsx(\"div\",{className:\"no_record\",children:/*#__PURE__*/_jsx(\"figure\",{children:/*#__PURE__*/_jsx(\"img\",{src:loader,alt:\"loader\",width:\"130px\"})})})}):toggle?/*#__PURE__*/_jsxs(\"div\",{className:\"view_detail_col\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"f_spacebw relative\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"title line-2 pr-20\",children:currentJobDetails===null||currentJobDetails===void 0?void 0:currentJobDetails.jobName}),/*#__PURE__*/_jsx(\"span\",{onClick:function onClick(){setToggle(function(prev){return!prev;});},className:\"close\",children:/*#__PURE__*/_jsx(\"img\",{src:close,alt:\"close\"})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"job_info\",children:/*#__PURE__*/_jsxs(\"ul\",{children:[/*#__PURE__*/_jsx(\"li\",{className:\"icon clock\",children:renderTime(currentJobDetails===null||currentJobDetails===void 0?void 0:currentJobDetails.fromDate,currentJobDetails===null||currentJobDetails===void 0?void 0:currentJobDetails.toDate)}),/*#__PURE__*/_jsx(\"li\",{className:\"icon dollar\",children:currentJobDetails===null||currentJobDetails===void 0?void 0:currentJobDetails.amount}),/*#__PURE__*/_jsx(\"li\",{className:\"icon location line-1\",children:currentJobDetails===null||currentJobDetails===void 0?void 0:currentJobDetails.locationName}),/*#__PURE__*/_jsx(\"li\",{className:\"icon calendar\",children:currentJobDetails===null||currentJobDetails===void 0?void 0:currentJobDetails.duration})]})}),/*#__PURE__*/_jsx(\"p\",{className:\"commn_para\",children:currentJobDetails===null||currentJobDetails===void 0?void 0:currentJobDetails.jobDescription}),/*#__PURE__*/_jsx(\"button\",{className:\"fill_btn full_btn btn-effect\",onClick:function onClick(){if(storageService.getItem(\"userType\")===1){props.history.push(\"/job-details-page?jobId=\".concat(currentJobDetails===null||currentJobDetails===void 0?void 0:currentJobDetails.jobId,\"&redirect_from=jobs\"));}else{// let urlEncode: any = window.btoa(`?jobId=${currentJobDetails?.jobId}&status=${currentJobDetails?.status}&edit=true&activeType=active`)\nvar urlEncode=\"?jobId=\".concat(currentJobDetails===null||currentJobDetails===void 0?void 0:currentJobDetails.jobId,\"&status=\").concat(currentJobDetails===null||currentJobDetails===void 0?void 0:currentJobDetails.status,\"&edit=true&activeType=active\");props.history.push(\"/job-detail?\".concat(urlEncode));}},children:\"View Job details\"})]}):null]})})]});};export default UserMessages;","map":{"version":3,"sources":["/home/appinventiv/Documents/Project/tickt/web/src/pages/chat/userMessages.tsx"],"names":["React","useState","useEffect","useRef","getJobDetails","storageService","notFound","chatVideoIcon","dummy","viewMore","close","sendMedia","sendBtn","loader","formatDateTime","renderTime","setShowToast","onFileUpload","getMessagesOfRoom","sendTextMessage","sendImageVideoMessage","Constants","FsLightbox","moengage","mixPanel","MoEConstants","lastDate","docTypes","UserMessages","props","divRref","getItem","_id","userId","toggle","setToggle","jobDetailLoader","setJobDetailLoader","currentJobDetails","setCurrentJobDetails","messageText","setMessageText","messages","setMessages","isDocUploading","setIsDocUploading","itemsMedia","setItemsMedia","toggler","setToggler","selectedSlide","setSelectSlide","fsSlideListner","setFsSlideListner","oppUserFcmToken","setOppUserFcmToken","roomId","onReceiveOfNewMsg","scrollToBottom","current","scroll","scrollHeight","clientHeight","scrollTo","arrmsg","fsSlideObj","mediaMsgs","slideCount","length","filter","item","index","messageType","setInboxToTopWithLastMsg","lastMsg","newInboxData","inBoxData","currentIndex","findIndex","i","splice","unshift","setInBoxData","sendMessage","trimLeft","roomData","oppUserInfo","deviceToken","deviceType","hasOwnProperty","isNotification","sendFCMPushNotificationToOppUser","mData","timeStamp","getCurrentTimeStamp","moE_SendEvent","CHAT","mixP_SendEvent","handleKeyDown","event","shiftKey","key","preventDefault","sendImageVideoMsg","url","msgType","fetchJobDetail","jobId","res","success","jobInfo","jobDescription","data","details","jobName","amount","locationName","fromDate","toDate","duration","status","renderMediaItems","sources","types","forEach","push","mediaUrl","setResDeviceType","msg","Number","app_icon","title","notificationText","userName","senderName","room_id","messageRoomId","image","user_image","notificationType","sound","body","sender","first_name","device_token","user_id","device_type","split","badge","notification_type","messageId","notification","newData","to","headers_","Authorization","FcmHeaderAuthorizationKey","fetch","method","headers","JSON","stringify","response","console","log","handleUpload","e","maxFileSize","formData","FormData","newFile","target","files","fileType","type","toLowerCase","selectedFileSize","size","includes","indexOf","append","check_type","imgUrl","renderTextMsg","curDate","messageTimestamp","messageClass","senderId","renderImageMsg","onerror","src","prev","renderVideoMsg","displayMessages","isNoRecords","history","name","map","isBlock","color","value","urlEncode"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\nimport { getJobDetails } from \"../../redux/jobs/actions\";\nimport storageService from \"../../utils/storageService\";\n\nimport notFound from \"../../assets/images/not-found.png\";\nimport chatVideoIcon from \"../../assets/images/video@3x.png\";\nimport dummy from \"../../assets/images/u_placeholder.jpg\";\nimport viewMore from \"../../assets/images/icon-direction-blue.png\";\nimport close from \"../../assets/images/ic-cancel-blue.png\";\nimport sendMedia from \"../../assets/images/ic-media.png\";\nimport sendBtn from \"../../assets/images/ic-send.png\";\nimport loader from \"../../assets/images/loader.gif\";\n\nimport { formatDateTime, renderTime } from \"../../utils/common\";\nimport { setShowToast } from \"../../redux/common/actions\";\nimport { onFileUpload } from \"../../redux/auth/actions\";\nimport {\n  getMessagesOfRoom,\n  sendTextMessage,\n  sendImageVideoMessage,\n} from \"../../services/firebase\";\n\nimport Constants from \"../../utils/constants\";\n\n//@ts-ignore\nimport FsLightbox from \"fslightbox-react\";\nimport { moengage, mixPanel } from \"../../services/analyticsTools\";\nimport { MoEConstants } from \"../../utils/constants\";\ninterface Types {\n  [key: string]: any | string;\n}\n\nlet lastDate = \"\";\nconst docTypes: Array<any> = [\"jpeg\", \"jpg\", \"png\", \"mp4\", \"wmv\", \"avi\"];\n\nconst UserMessages = (props: any) => {\n  const divRref = useRef<HTMLDivElement>(null);\n  const [userId] = useState<string>(storageService.getItem(\"userInfo\")?._id);\n  const [toggle, setToggle] = useState<boolean>(false);\n  const [jobDetailLoader, setJobDetailLoader] = useState<boolean>(false);\n  const [currentJobDetails, setCurrentJobDetails] = useState<any>(null);\n  const [messageText, setMessageText] = useState<any>(\"\");\n  const [messages, setMessages] = useState<Array<any>>([]);\n  const [isDocUploading, setIsDocUploading] = useState<boolean>(false);\n\n  const [itemsMedia, setItemsMedia] = useState([]);\n  const [toggler, setToggler] = useState(false);\n  const [selectedSlide, setSelectSlide] = useState<any>(1);\n  const [fsSlideListner, setFsSlideListner] = useState<any>({});\n  const [oppUserFcmToken, setOppUserFcmToken] = useState<any>(\"\");\n\n  useEffect(() => {\n    if (props.roomId !== \"\") {\n      lastDate = \"\";\n      getMessagesOfRoom(props.roomId, onReceiveOfNewMsg);\n      setSelectSlide(1);\n      setFsSlideListner({});\n      setItemsMedia([]);\n      setCurrentJobDetails(null);\n      setToggle(false);\n    }\n  }, [props.roomId]);\n  // }, [props.roomId, props.roomData]);\n  //console.log('props.roomData: ', props.roomData);\n\n  useEffect(() => {\n    scrollToBottom();\n  });\n\n  const scrollToBottom = () => {\n    if (null !== divRref?.current) {\n      const scroll =\n        divRref.current.scrollHeight - divRref.current.clientHeight;\n      // divRref.current.scrollIntoView({ behavior: \"smooth\" })\n      divRref.current.scrollTo(0, scroll);\n    }\n  };\n\n  const onReceiveOfNewMsg = (arrmsg: any) => {\n    // console.log('arrmsg: ', arrmsg);\n    setMessages(arrmsg);\n  };\n\n  useEffect(() => {\n    let fsSlideObj: any = {};\n    let mediaMsgs: any = [];\n    let slideCount = 1;\n    if (messages.length) {\n      mediaMsgs = messages.filter((item: any, index: number) => {\n        if (item.messageType === \"image\" || item.messageType === \"video\") {\n          fsSlideObj[`${index}`] = slideCount++;\n          return item;\n        }\n      });\n      setItemsMedia(mediaMsgs);\n      setFsSlideListner(fsSlideObj);\n    }\n  }, [messages]);\n  // console.log('itemsMedia: ', itemsMedia, \"fsSlideListner\", fsSlideListner);\n\n  const setInboxToTopWithLastMsg = (lastMsg: any) => {\n    const newInboxData = [...props.inBoxData];\n    const currentIndex = newInboxData.findIndex(\n      (i) => i.roomId === props.roomId\n    );\n    newInboxData[currentIndex].lastMsg = lastMsg;\n    newInboxData.splice(currentIndex, 1);\n    newInboxData.unshift(props.inBoxData[currentIndex]);\n    props.setInBoxData(newInboxData);\n    // console.log('lastMsg: ', lastMsg);\n    // console.log('currentIndex: ', currentIndex);\n    // console.log('newInboxData: ', newInboxData);\n  };\n\n  const sendMessage = async () => {\n    //setIsLoading(true);\n    if (messageText && messageText.trimLeft() !== \"\") {\n      setMessageText(\"\");\n      const lastMsg: any = await sendTextMessage(props.roomId, messageText);\n      if (\n        lastMsg &&\n        props.roomData?.oppUserInfo?.deviceToken &&\n        props.roomData?.oppUserInfo?.deviceType &&\n        (props.roomData?.oppUserInfo?.hasOwnProperty(\"isNotification\")\n          ? props.roomData?.oppUserInfo?.isNotification\n          : true)\n      ) {\n        sendFCMPushNotificationToOppUser(lastMsg);\n        const mData = {\n          timeStamp: moengage.getCurrentTimeStamp(),\n        };\n        moengage.moE_SendEvent(MoEConstants.CHAT, mData);\n        mixPanel.mixP_SendEvent(MoEConstants.CHAT, mData);\n      }\n      setInboxToTopWithLastMsg(lastMsg);\n    }\n  };\n\n  const handleKeyDown = (event: any) => {\n    if (!event.shiftKey && event.key === \"Enter\") {\n      event.preventDefault();\n      sendMessage();\n      setMessageText(\"\");\n    }\n  };\n\n  const sendImageVideoMsg = async (url: string, msgType: string) => {\n    //setIsLoading(true);\n    if (url && url !== \"\") {\n      const lastMsg: any = await sendImageVideoMessage(\n        props.roomId,\n        url,\n        msgType\n      );\n      if (\n        lastMsg &&\n        props.roomData?.oppUserInfo?.deviceToken &&\n        props.roomData?.oppUserInfo?.deviceType &&\n        (props.roomData?.oppUserInfo?.hasOwnProperty(\"isNotification\")\n          ? props.roomData?.oppUserInfo?.isNotification\n          : true)\n      ) {\n        sendFCMPushNotificationToOppUser(lastMsg);\n      }\n      setInboxToTopWithLastMsg(lastMsg);\n    }\n    setMessageText(\"\");\n  };\n\n  const fetchJobDetail = async (jobId: any) => {\n    setJobDetailLoader(true);\n    const res = await getJobDetails(jobId);\n    if (res.success) {\n      const jobInfo = {\n        jobDescription: res.data?.details || \"\",\n        jobId: res.data?.jobId || \"\",\n        jobName: res.data?.jobName || \"\",\n        amount: res.data?.amount || \"\",\n        locationName: res.data?.locationName || \"\",\n        fromDate: res.data?.fromDate || \"\",\n        toDate: res.data?.toDate || \"\",\n        duration: res.data?.duration || \"\",\n        status: res.data?.status || \"\",\n      };\n      setCurrentJobDetails(jobInfo);\n      setJobDetailLoader(false);\n    }\n  };\n\n  const renderMediaItems = (itemsMedia: any) => {\n    let sources: any = [];\n    let types: any = [];\n\n    if (itemsMedia.length) {\n      itemsMedia.forEach((item: any) => {\n        if (item.messageType === \"video\") {\n          sources.push(item.mediaUrl);\n          types.push(\"video\");\n        }\n        if (item.messageType === \"image\") {\n          sources.push(item.mediaUrl);\n          types.push(\"image\");\n        }\n      });\n    }\n\n    return { sources, types };\n  };\n\n  const setResDeviceType = (deviceType: number, msg: any) => {\n    switch (Number(deviceType)) {\n      case 1:\n        return {\n          app_icon:\n            \"https://appinventiv-development.s3.amazonaws.com/1628513615740ic-logo-yellow.png\",\n          title: \"Tickt App\",\n          notificationText: `${\n            storageService.getItem(\"userInfo\")?.userName\n          } send you a message`,\n          senderName: `${storageService.getItem(\"userInfo\")?.userName}`,\n          messageType: `${msg?.messageType}`,\n          messageText: `${msg?.messageType === \"text\" ? msg?.messageText : \"\"}`,\n          room_id: msg?.messageRoomId,\n          image: storageService.getItem(\"userInfo\")?.user_image,\n          notificationType: 25,\n          sound: \"default\",\n        };\n      case 2:\n        return {\n          body: msg?.messageText,\n          messageText: msg?.messageText,\n          sender: {\n            first_name: storageService.getItem(\"userInfo\")?.userName,\n            device_token: storageService.getItem(\"fcmToken\"),\n            user_id: storageService.getItem(\"userInfo\")?._id,\n            device_type: 2,\n          },\n          jobId: msg?.messageRoomId?.split(\"_\")?.[0],\n          badge: 1,\n          device_type: 2,\n          title: storageService.getItem(\"userInfo\")?.userName,\n          jobName: props.roomData?.jobName,\n          notification_type: 50,\n          sound: \"default\",\n          messageId: msg?.messageId,\n        };\n      case 3:\n        return {\n          notification: {\n            body: msg?.messageText,\n            title: storageService.getItem(\"userInfo\")?.userName,\n          },\n          data: {\n            body: msg?.messageText,\n            messageText: msg?.messageText,\n            sender: {\n              first_name: storageService.getItem(\"userInfo\")?.userName,\n              device_token: storageService.getItem(\"fcmToken\"),\n              user_id: storageService.getItem(\"userInfo\")?._id,\n              device_type: 2,\n            },\n            jobId: msg?.messageRoomId?.split(\"_\")?.[0],\n            badge: 1,\n            device_type: 2,\n            title: storageService.getItem(\"userInfo\")?.userName,\n            jobName: props.roomData?.jobName,\n            notification_type: 50,\n            sound: \"default\",\n            messageId: msg?.messageId,\n          },\n        };\n      default:\n        return;\n    }\n  };\n  const sendFCMPushNotificationToOppUser = async (msg: any) => {\n    let data = setResDeviceType(props.roomData?.oppUserInfo?.deviceType, msg);\n    let newData = {\n      to: `${props.roomData?.oppUserInfo?.deviceToken}`,\n      ...(props.roomData?.oppUserInfo?.deviceType == 1 && { data: data }),\n      ...(props.roomData?.oppUserInfo?.deviceType == 2 && {\n        notification: data,\n      }),\n      ...(props.roomData?.oppUserInfo?.deviceType == 3 && {\n        notification: data?.notification,\n        data: data?.data,\n      }),\n    };\n\n    const headers_: Types = {\n      \"Content-Type\": \"application/json\",\n      Authorization: Constants.FcmHeaderAuthorizationKey,\n    };\n    const response: any = await fetch(`https://fcm.googleapis.com/fcm/send`, {\n      method: \"POST\",\n      headers: headers_,\n      body: JSON.stringify(newData),\n    });\n    // const res: any = await response.json();\n    if (response.status === 200) {\n      console.log(\"Chat push notification send to opposite user: success\");\n    } else {\n      console.log(\"Chat push notification send to opposite user: failure\");\n    }\n  };\n\n  const handleUpload = async (e: any) => {\n    let maxFileSize: number = 10;\n    const formData = new FormData();\n    const newFile = e.target.files[0];\n    var fileType = newFile?.type?.split(\"/\")[1]?.toLowerCase();\n\n    var selectedFileSize = newFile?.size / 1024 / 1024; // size in mb\n    if ([\"mp4\", \"wmv\", \"avi\"].includes(fileType)) {\n      maxFileSize = 20;\n    }\n    if (docTypes.indexOf(fileType) < 0 || selectedFileSize > maxFileSize) {\n      setShowToast(true, \"The file must be in proper format or size\");\n      return;\n    }\n\n    formData.append(\"file\", newFile);\n    setIsDocUploading(true);\n    let check_type: any = [\"jpeg\", \"jpg\", \"png\"].includes(fileType)\n      ? 1\n      : [\"mp4\", \"wmv\", \"avi\"].includes(fileType)\n      ? 2\n      : null;\n    const res = await onFileUpload(formData);\n    if (res.success && res.imgUrl) {\n      if (check_type === 1) {\n        sendImageVideoMsg(res.imgUrl, \"image\");\n      } else if (check_type === 2) {\n        sendImageVideoMsg(res.imgUrl, \"video\");\n      } else {\n        setShowToast(true, \"There is some technical issue\");\n      }\n      setIsDocUploading(false);\n      // setLocalFiles((prev: any) => ({ ...prev, [filesUrl?.length]: URL.createObjectURL(newFile) }));\n    }\n  };\n\n  const renderTextMsg = (msg: any) => {\n    let curDate = formatDateTime(msg.messageTimestamp, \"day\");\n    const messageClass =\n      msg.senderId === userId ? \"message\" : \"message recive_msg\";\n    if (lastDate === \"\" || lastDate !== curDate) {\n      lastDate = curDate;\n      return (\n        <>\n          <div className=\"date_time\">\n            <span>{curDate}</span>\n          </div>\n          <div className={`${messageClass}`}>\n            <p className={`${msg.senderId === userId ? \"mark\" : \"\"}`}>\n              {msg.messageText}\n              <span className=\"time\">\n                {formatDateTime(msg.messageTimestamp, \"time\")}\n              </span>\n            </p>\n          </div>\n        </>\n      );\n    } else\n      return (\n        <div className={`${messageClass}`}>\n          <p className={`${msg.senderId === userId ? \"mark\" : \"\"}`}>\n            {msg.messageText}\n            <span className=\"time\">\n              {formatDateTime(msg.messageTimestamp, \"time\")}\n            </span>\n          </p>\n        </div>\n      );\n  };\n\n  const renderImageMsg = (msg: any, index: number) => {\n    let curDate = formatDateTime(msg.messageTimestamp, \"day\");\n    const messageClass =\n      msg.senderId === userId ? \"message\" : \"message recive_msg\";\n    if (lastDate === \"\" || lastDate !== curDate) {\n      lastDate = curDate;\n      return (\n        <>\n          <div className=\"date_time\">\n            <span>{curDate}</span>\n          </div>\n          <div className={`${messageClass}`}>\n            <figure className=\"media\">\n              <img\n                src={msg.mediaUrl || notFound}\n                alt=\"media\"\n                async-src={msg.mediaUrl || notFound}\n                decoding=\"async\"\n                loading=\"lazy\"\n                onError={(e: any) => {\n                  if (e?.target?.onerror) {\n                    e.target.onerror = null;\n                  }\n                  if (e?.target?.src) {\n                    e.target.src = notFound;\n                  }\n                }}\n                onClick={() => {\n                  setToggler((prev: any) => !prev);\n                  setSelectSlide(fsSlideListner[`${index}`]);\n                }}\n              />\n              <span className=\"time\">\n                {formatDateTime(msg.messageTimestamp, \"time\")}\n              </span>\n            </figure>\n          </div>\n        </>\n      );\n    } else\n      return (\n        <div className={`${messageClass}`}>\n          <figure className=\"media\">\n            <img\n              src={msg.mediaUrl || notFound}\n              alt=\"media\"\n              async-src={msg.mediaUrl || notFound}\n              decoding=\"async\"\n              loading=\"lazy\"\n              onError={(e: any) => {\n                if (e?.target?.onerror) {\n                  e.target.onerror = null;\n                }\n                if (e?.target?.src) {\n                  e.target.src = notFound;\n                }\n              }}\n              onClick={() => {\n                setToggler((prev: any) => !prev);\n                setSelectSlide(fsSlideListner[`${index}`]);\n              }}\n            />\n            <span className=\"time\">\n              {formatDateTime(msg.messageTimestamp, \"time\")}\n            </span>\n          </figure>\n        </div>\n      );\n  };\n\n  const renderVideoMsg = (msg: any, index: number) => {\n    let curDate = formatDateTime(msg.messageTimestamp, \"day\");\n    const messageClass =\n      msg.senderId === userId ? \"message\" : \"message recive_msg\";\n    if (lastDate === \"\" || lastDate !== curDate) {\n      lastDate = curDate;\n      return (\n        <>\n          <div className=\"date_time\">\n            <span>{curDate}</span>\n          </div>\n          <div className={`${messageClass}`}>\n            <figure className=\"media media_video \">\n              <video\n                src={msg.mediaUrl || notFound}\n                poster={chatVideoIcon}\n                onClick={() => {\n                  setToggler((prev: any) => !prev);\n                  setSelectSlide(fsSlideListner[`${index}`]);\n                }}\n              />\n              <span className=\"time\">\n                {formatDateTime(msg.messageTimestamp, \"time\")}\n              </span>\n            </figure>\n          </div>\n        </>\n      );\n    } else\n      return (\n        <div className={`${messageClass}`}>\n          <figure className=\"media media_video \">\n            <video\n              src={msg.mediaUrl || notFound}\n              poster={chatVideoIcon}\n              onClick={() => {\n                setToggler((prev: any) => !prev);\n                setSelectSlide(fsSlideListner[`${index}`]);\n              }}\n            />\n            <span className=\"time\">\n              {formatDateTime(msg.messageTimestamp, \"time\")}\n            </span>\n          </figure>\n        </div>\n      );\n  };\n\n  const displayMessages = (msg: any, index: number) => {\n    if (index === 0) lastDate = \"\";\n    switch (msg.messageType) {\n      case \"text\":\n        return renderTextMsg(msg);\n      case \"image\":\n        return renderImageMsg(msg, index);\n      case \"video\":\n        return renderVideoMsg(msg, index);\n    }\n  };\n\n  const { sources, types } = renderMediaItems(itemsMedia);\n\n  return props.isNoRecords ? (\n    <div className=\"detail_col\">\n      <div className=\"flex_row\">\n        {/* <div>No Record Found</div> */}\n        <div></div>\n      </div>\n    </div>\n  ) : (\n    <>\n      <FsLightbox\n        toggler={toggler}\n        slide={selectedSlide}\n        sources={sources}\n        types={types}\n        key={sources?.length}\n        // disableLocalStorage={true}\n        onClose={() => {\n          setSelectSlide(1);\n        }}\n      />\n      <div className=\"detail_col\">\n        <div className=\"flex_row\">\n          <div className={`chat_col ${toggle ? \"active\" : \"\"}`}>\n            <div className=\"chat_user\">\n              <figure className=\"u_img\">\n                <img\n                  src={props.roomData?.oppUserInfo?.image || dummy}\n                  alt=\"user-img\"\n                  onError={(e: any) => {\n                    if (e?.target?.onerror) {\n                      e.target.onerror = null;\n                    }\n                    if (e?.target?.src) {\n                      e.target.src = dummy;\n                    }\n                  }}\n                />\n              </figure>\n              <span\n                className=\"name\"\n                onClick={() => {\n                  if (storageService.getItem(\"userType\") === 2) {\n                    props.history.push(\n                      `/tradie-info?tradeId=${props.roomData?.oppUserInfo?.userId}&hideInvite=true`\n                    );\n                  } else {\n                    props.history.push(\n                      `/builder-info?builderId=${props.roomData?.oppUserInfo?.userId}`\n                    );\n                  }\n                }}\n              >\n                {props.roomData?.oppUserInfo?.name}\n              </span>\n              {!toggle && (\n                <span\n                  onClick={() => {\n                    setToggle(true);\n                    if (currentJobDetails) return;\n                    fetchJobDetail(props.roomData?.jobId);\n                  }}\n                  className=\"view_detail\"\n                >\n                  View Job Details\n                  <img src={viewMore} alt=\"view-more\" />\n                </span>\n              )}\n            </div>\n            <div className=\"message_wrapr\" ref={divRref}>\n              {messages.length > 0 &&\n                messages.map((msg: any, index: number) => {\n                  return displayMessages(msg, index);\n                })}\n              <div className=\"date_time\">\n                {props.roomData?.oppUserInfo?.isBlock && (\n                  <i style={{ color: \"#929292\" }}>\n                    {\"You can no longer chat with the user\"}\n                  </i>\n                )}\n              </div>\n            </div>\n\n            {!props.roomData?.oppUserInfo?.isBlock && (\n              <div className=\"send_msg\">\n                <div className=\"text_field\">\n                  <label className=\"upload_item\" htmlFor=\"upload_item\">\n                    <span className=\"detect_icon_ltr\">\n                      <img src={sendMedia} alt=\"media\" />\n                    </span>\n                  </label>\n                  <input\n                    id=\"upload_item\"\n                    className=\"hide\"\n                    type=\"file\"\n                    accept=\"image/png,image/jpg,image/jpeg, video/mp4, video/wmv, video/avi\"\n                    onChange={handleUpload}\n                    disabled={isDocUploading}\n                  />\n                  <textarea\n                    placeholder=\"Message..\"\n                    onKeyDown={handleKeyDown}\n                    value={messageText}\n                    onChange={(e) => setMessageText(e.target.value)}\n                  />\n                  <span className=\"detect_icon\">\n                    <img src={sendBtn} alt=\"send\" onClick={sendMessage} />\n                  </span>\n                </div>\n              </div>\n            )}\n          </div>\n\n          {toggle && jobDetailLoader ? (\n            <div className=\"view_detail_col\">\n              <div className=\"no_record\">\n                <figure>\n                  <img src={loader} alt=\"loader\" width=\"130px\" />\n                </figure>\n              </div>\n            </div>\n          ) : toggle ? (\n            <div className=\"view_detail_col\">\n              <div className=\"f_spacebw relative\">\n                <span className=\"title line-2 pr-20\">\n                  {currentJobDetails?.jobName}\n                </span>\n                <span\n                  onClick={() => {\n                    setToggle((prev) => !prev);\n                  }}\n                  className=\"close\"\n                >\n                  <img src={close} alt=\"close\" />\n                </span>\n              </div>\n\n              <div className=\"job_info\">\n                <ul>\n                  <li className=\"icon clock\">\n                    {renderTime(\n                      currentJobDetails?.fromDate,\n                      currentJobDetails?.toDate\n                    )}\n                  </li>\n                  <li className=\"icon dollar\">{currentJobDetails?.amount}</li>\n                  <li className=\"icon location line-1\">\n                    {currentJobDetails?.locationName}\n                  </li>\n                  <li className=\"icon calendar\">\n                    {currentJobDetails?.duration}\n                  </li>\n                </ul>\n              </div>\n\n              <p className=\"commn_para\">{currentJobDetails?.jobDescription}</p>\n\n              <button\n                className=\"fill_btn full_btn btn-effect\"\n                onClick={() => {\n                  if (storageService.getItem(\"userType\") === 1) {\n                    props.history.push(\n                      `/job-details-page?jobId=${currentJobDetails?.jobId}&redirect_from=jobs`\n                    );\n                  } else {\n                    // let urlEncode: any = window.btoa(`?jobId=${currentJobDetails?.jobId}&status=${currentJobDetails?.status}&edit=true&activeType=active`)\n                    let urlEncode: any = `?jobId=${currentJobDetails?.jobId}&status=${currentJobDetails?.status}&edit=true&activeType=active`;\n                    props.history.push(`/job-detail?${urlEncode}`);\n                  }\n                }}\n              >\n                View Job details\n              </button>\n            </div>\n          ) : null}\n        </div>\n      </div>\n    </>\n  );\n};\n\nexport default UserMessages;\n"]},"metadata":{},"sourceType":"module"}