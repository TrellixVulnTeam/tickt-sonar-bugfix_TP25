{"ast":null,"code":"import _regeneratorRuntime from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _defineProperty from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _toConsumableArray from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _asyncToGenerator from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useState}from'react';import{onFileUpload}from'../../../../redux/auth/actions';import{setShowToast}from'../../../../redux/common/actions';import{tradieCancelJob}from'../../../../redux/jobs/actions';//@ts-ignore\nimport FsLightbox from'fslightbox-react';import{JobCancelReasons}from'../../../../utils/common';import{moengage,mixPanel}from'../../../../services/analyticsTools';import{MoEConstants}from'../../../../utils/constants';import close from'../../../../assets/images/icon-close-1.png';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var imageFormats=[\"jpeg\",\"jpg\",\"png\"];var LodgeDispute=function LodgeDispute(props){var _props$item=props.item,jobId=_props$item.jobId,jobName=_props$item.jobName,history=props.history;var _useState=useState({reason:0,detail:'',upload:[]}),_useState2=_slicedToArray(_useState,2),stateData=_useState2[0],setStateData=_useState2[1];var _useState3=useState({reason:'',detail:'',upload:''}),_useState4=_slicedToArray(_useState3,2),errorData=_useState4[0],setErrorData=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),filesUrl=_useState6[0],setFilesUrl=_useState6[1];var _useState7=useState({}),_useState8=_slicedToArray(_useState7,2),localFiles=_useState8[0],setLocalFiles=_useState8[1];var _useState9=useState({}),_useState10=_slicedToArray(_useState9,2),update=_useState10[0],forceUpdate=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),toggler=_useState12[0],setToggler=_useState12[1];var _useState13=useState(1),_useState14=_slicedToArray(_useState13,2),selectedSlide=_useState14[0],setSelectSlide=_useState14[1];var reason=stateData.reason,detail=stateData.detail,upload=stateData.upload;var isValid=function isValid(_ref){var name=_ref.name,value=_ref.value,title=_ref.title;if(name==='reason'){return value===0?\"\".concat(title,\" is required.\"):'';}return!(value===null||value===void 0?void 0:value.length)?\"\".concat(title,\" is required.\"):'';};var checkErrors=function checkErrors(){var error_1=isValid({name:'reason',value:reason,title:'Reason'});var error_2=isValid({name:'detail',value:detail,title:'Detail'});// if (!error_1?.length && !error_2?.length) {\nif(!(error_1===null||error_1===void 0?void 0:error_1.length)){return false;}return true;};var removeFromItem=function removeFromItem(index){filesUrl.splice(index,1);setFilesUrl(filesUrl);Array.isArray(update)?forceUpdate([]):forceUpdate({});};var onFileChange=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var _newFile$type,_newFile$type$split$;var formData,newFile,fileType,selectedFileSize,res,link,check_type;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:formData=new FormData();newFile=e.target.files[0];if(!((filesUrl===null||filesUrl===void 0?void 0:filesUrl.length)===6)){_context.next=5;break;}setShowToast(true,\"Max files upload limit is 6\");return _context.abrupt(\"return\");case 5:fileType=newFile===null||newFile===void 0?void 0:(_newFile$type=newFile.type)===null||_newFile$type===void 0?void 0:(_newFile$type$split$=_newFile$type.split('/')[1])===null||_newFile$type$split$===void 0?void 0:_newFile$type$split$.toLowerCase();selectedFileSize=(newFile===null||newFile===void 0?void 0:newFile.size)/1024/1024;// size in mib\nif(!(imageFormats.indexOf(fileType)<0||selectedFileSize>10)){_context.next=10;break;}setShowToast(true,\"The file must be in proper format or size\");return _context.abrupt(\"return\");case 10:if(!(imageFormats.includes(fileType)&&selectedFileSize>10)){_context.next=13;break;}// image validations\nsetShowToast(true,\"The image file size must be below 10 mb\");return _context.abrupt(\"return\");case 13:formData.append('file',newFile);_context.next=16;return onFileUpload(formData);case 16:res=_context.sent;if(res.success){link=res.imgUrl;check_type=1;setFilesUrl(function(prev){return[].concat(_toConsumableArray(prev),[{\"mediaType\":check_type,\"link\":link}]);});setLocalFiles(function(prev){return _objectSpread(_objectSpread({},prev),{},_defineProperty({},filesUrl===null||filesUrl===void 0?void 0:filesUrl.length,URL.createObjectURL(newFile)));});}case 18:case\"end\":return _context.stop();}}},_callee);}));return function onFileChange(_x){return _ref2.apply(this,arguments);};}();var setItemToggle=function setItemToggle(index){setToggler(function(prev){return!prev;});setSelectSlide(index+1);};var renderbyFileFormat=function renderbyFileFormat(item,index){var split_item_format=item.split('.');var get_split_fromat=split_item_format[split_item_format.length-1];var split_item_name=item.split('/');var get_split_name=split_item_name[split_item_name.length-1];var image_render=null;if(get_split_fromat){if(imageFormats.includes(get_split_fromat)){image_render=/*#__PURE__*/_jsx(\"img\",{onClick:function onClick(){setItemToggle(index);},title:get_split_name,src:item,alt:\"media\"});}return/*#__PURE__*/_jsxs(\"figure\",{className:\"img_video\",children:[image_render,/*#__PURE__*/_jsx(\"img\",{onClick:function onClick(){removeFromItem(index);},src:close,alt:\"remove\",className:\"remove\"})]});}};var handleSubmit=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var data,response,mData;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:data={jobId:jobId,reason:reason,note:detail};if(!data.note)delete data.note;_context2.next=4;return tradieCancelJob(data);case 4:response=_context2.sent;if(response===null||response===void 0?void 0:response.success){mData={timeStamp:moengage.getCurrentTimeStamp()};moengage.moE_SendEvent(MoEConstants.CANCEL_JOB,mData);mixPanel.mixP_SendEvent(MoEConstants.CANCEL_JOB,mData);history.push('/cancel-job-success');}case 6:case\"end\":return _context2.stop();}}},_callee2);}));return function handleSubmit(){return _ref3.apply(this,arguments);};}();var commonRenderValues=function commonRenderValues(_ref4){var id=_ref4.id;return/*#__PURE__*/_jsxs(\"div\",{className:\"checkbox_wrap agree_check\",children:[/*#__PURE__*/_jsx(\"input\",{value:reason,onClick:function onClick(){setStateData(function(prev){return _objectSpread(_objectSpread({},prev),{},{reason:id});});},checked:reason===id,name:\"Reason\",className:\"filter-type filled-in\",type:\"checkbox\",id:\"reason\".concat(id)}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"reason\".concat(id),children:JobCancelReasons(id)})]});};var renderFilteredItems=function renderFilteredItems(){var sources=[];var types=[];if(filesUrl===null||filesUrl===void 0?void 0:filesUrl.length){filesUrl.forEach(function(item){if((item===null||item===void 0?void 0:item.mediaType)===1){sources.push(item.link);types.push('image');}});}return{sources:sources,types:types};};var _renderFilteredItems=renderFilteredItems(),sources=_renderFilteredItems.sources,types=_renderFilteredItems.types;return/*#__PURE__*/_jsx(\"div\",{className:\"detail_col\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex_row\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex_col_sm_8\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"relate\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){props.backTab('cancel');},className:\"back\"}),/*#__PURE__*/_jsx(\"span\",{className:\"xs_sub_title\",children:jobName||''})]}),/*#__PURE__*/_jsx(\"span\",{className:\"sub_title\",children:'Your reason for canceling job'}),/*#__PURE__*/_jsx(\"p\",{className:\"commn_para\",children:'Let the builder and Tickt know why you are cancelling the job.'}),/*#__PURE__*/_jsx(FsLightbox,{toggler:toggler,slide:selectedSlide,sources:sources,types:types}),/*#__PURE__*/_jsxs(\"div\",{className:\"reason_wrap\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"f_spacebw\",children:[commonRenderValues({id:1}),commonRenderValues({id:2})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"f_spacebw\",children:[commonRenderValues({id:3}),commonRenderValues({id:4})]}),/*#__PURE__*/_jsx(\"div\",{className:\"f_spacebw\",children:commonRenderValues({id:5})})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex_col_sm_9\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form_field\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form_label\",children:\"Add note (optional)\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text_field\",children:/*#__PURE__*/_jsx(\"textarea\",{value:detail,onChange:function onChange(e){setStateData(function(prev){return _objectSpread(_objectSpread({},prev),{},{detail:e.target.value});});},placeholder:\"It\\u2019s really bad work, because...\",maxLength:250})}),/*#__PURE__*/_jsx(\"span\",{className:\"error_msg\",children:errorData.detail})]}),/*#__PURE__*/_jsx(\"button\",{onClick:handleSubmit,className:\"fill_btn full_btn btn-effect \".concat(checkErrors()?'disable_btn':''),children:'Send'})]})]})});};export default LodgeDispute;","map":{"version":3,"sources":["/home/appinventiv/Documents/Project/tickt/web/src/pages/jobDashboard/components/cancelJobs/cancelJob.tsx"],"names":["useState","onFileUpload","setShowToast","tradieCancelJob","FsLightbox","JobCancelReasons","moengage","mixPanel","MoEConstants","close","imageFormats","LodgeDispute","props","item","jobId","jobName","history","reason","detail","upload","stateData","setStateData","errorData","setErrorData","filesUrl","setFilesUrl","localFiles","setLocalFiles","update","forceUpdate","toggler","setToggler","selectedSlide","setSelectSlide","isValid","name","value","title","length","checkErrors","error_1","error_2","removeFromItem","index","splice","Array","isArray","onFileChange","e","formData","FormData","newFile","target","files","fileType","type","split","toLowerCase","selectedFileSize","size","indexOf","includes","append","res","success","link","imgUrl","check_type","prev","URL","createObjectURL","setItemToggle","renderbyFileFormat","split_item_format","get_split_fromat","split_item_name","get_split_name","image_render","handleSubmit","data","note","response","mData","timeStamp","getCurrentTimeStamp","moE_SendEvent","CANCEL_JOB","mixP_SendEvent","push","commonRenderValues","id","renderFilteredItems","sources","types","forEach","mediaType","backTab"],"mappings":"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","sourcesContent":["import { useState } from 'react';\nimport { onFileUpload } from '../../../../redux/auth/actions';\nimport { setShowToast } from '../../../../redux/common/actions';\nimport { tradieCancelJob } from '../../../../redux/jobs/actions';\n//@ts-ignore\nimport FsLightbox from 'fslightbox-react';\nimport { JobCancelReasons } from '../../../../utils/common';\nimport { moengage, mixPanel } from '../../../../services/analyticsTools';\nimport { MoEConstants } from '../../../../utils/constants';\n\nimport close from '../../../../assets/images/icon-close-1.png';\n\nconst imageFormats: Array<any> = [\"jpeg\", \"jpg\", \"png\"];\n\ninterface PropTypes {\n    item: any,\n    history: any,\n    backTab: (data: string) => void,\n}\n\nconst LodgeDispute = (props: PropTypes) => {\n    const { item: { jobId, jobName }, history } = props;\n    const [stateData, setStateData] = useState({ reason: 0, detail: '', upload: [] });\n    const [errorData, setErrorData] = useState({ reason: '', detail: '', upload: '' });\n    const [filesUrl, setFilesUrl] = useState([] as any);\n    const [localFiles, setLocalFiles] = useState({});\n\n    const [update, forceUpdate] = useState({});\n    const [toggler, setToggler] = useState(false);\n    const [selectedSlide, setSelectSlide] = useState(1);\n\n\n    const { reason, detail, upload } = stateData;\n\n    const isValid = ({ name, value, title }: any) => {\n        if (name === 'reason') {\n            return value === 0 ? `${title} is required.` : '';\n        }\n        return !value?.length ? `${title} is required.` : '';\n    }\n\n    const checkErrors = () => {\n        let error_1 = isValid({ name: 'reason', value: reason, title: 'Reason' });\n        let error_2 = isValid({ name: 'detail', value: detail, title: 'Detail' });\n\n        // if (!error_1?.length && !error_2?.length) {\n        if (!error_1?.length) {\n            return false;\n        }\n        return true;\n    }\n\n    const removeFromItem = (index: any) => {\n        filesUrl.splice(index, 1);\n        setFilesUrl(filesUrl);\n        Array.isArray(update) ? forceUpdate([]) : forceUpdate({});\n    }\n\n    const onFileChange = async (e: any) => {\n        const formData = new FormData();\n        const newFile = e.target.files[0];\n\n        if (filesUrl?.length === 6) {\n            setShowToast(true, \"Max files upload limit is 6\")\n            return;\n        }\n\n        var fileType = (newFile?.type?.split('/')[1])?.toLowerCase();\n        var selectedFileSize = newFile?.size / 1024 / 1024; // size in mib\n\n        if (imageFormats.indexOf(fileType) < 0 || (selectedFileSize > 10)) {\n            setShowToast(true, \"The file must be in proper format or size\")\n            return;\n        }\n\n        if (imageFormats.includes(fileType) && selectedFileSize > 10) { // image validations\n            setShowToast(true, \"The image file size must be below 10 mb\")\n            return;\n        }\n\n        formData.append('file', newFile);\n        const res = await onFileUpload(formData)\n        if (res.success) {\n            let link: string = res.imgUrl;\n            let check_type: any = 1;\n            setFilesUrl((prev: Array<any>) => [...prev, {\n                \"mediaType\": check_type,\n                \"link\": link\n            }]);\n            setLocalFiles((prev: any) => ({ ...prev, [filesUrl?.length]: URL.createObjectURL(newFile) }));\n        }\n    }\n\n    const setItemToggle = (index: any) => {\n        setToggler((prev: boolean) => !prev);\n        setSelectSlide(index + 1);\n    }\n\n    const renderbyFileFormat = (item: any, index: any) => {\n        let split_item_format = item.split('.');\n        let get_split_fromat = split_item_format[split_item_format.length - 1];\n\n        let split_item_name = item.split('/');\n        let get_split_name = split_item_name[split_item_name.length - 1];\n        let image_render: any = null;\n        if (get_split_fromat) {\n            if (imageFormats.includes(get_split_fromat)) {\n                image_render = <img onClick={() => { setItemToggle(index) }} title={get_split_name} src={item} alt=\"media\" />\n            }\n            return (\n                <figure className=\"img_video\">\n                    {image_render}\n                    <img\n                        onClick={() => { removeFromItem(index) }}\n                        src={close} alt=\"remove\" className=\"remove\" />\n                    {/* <span style={{ fontSize: '10px' }}>{get_split_name}</span> */}\n                </figure>\n            )\n        }\n    }\n\n    const handleSubmit = async () => {\n        let data: any = {\n            jobId: jobId,\n            reason: reason,\n            note: detail,\n        }\n        if (!data.note) delete data.note;\n        let response: any = await tradieCancelJob(data);\n        if (response?.success) {\n            const mData = {\n                timeStamp: moengage.getCurrentTimeStamp(),\n            }\n            moengage.moE_SendEvent(MoEConstants.CANCEL_JOB, mData);\n            mixPanel.mixP_SendEvent(MoEConstants.CANCEL_JOB, mData);\n            history.push('/cancel-job-success');\n        }\n    }\n\n\n    const commonRenderValues = ({ id }: any) => {\n        return (\n            <div className=\"checkbox_wrap agree_check\">\n                <input\n                    value={reason}\n                    onClick={() => { setStateData((prev: any) => ({ ...prev, reason: id })) }}\n                    checked={reason === id}\n                    name=\"Reason\" className=\"filter-type filled-in\" type=\"checkbox\" id={`reason${id}`} />\n                <label htmlFor={`reason${id}`}>\n                    {JobCancelReasons(id)}\n                </label>\n            </div>\n        )\n    }\n\n    const renderFilteredItems = () => {\n        let sources: any = [];\n        let types: any = [];\n\n        if (filesUrl?.length) {\n            filesUrl.forEach((item: any) => {\n                if (item?.mediaType === 1) {\n                    sources.push(item.link);\n                    types.push('image');\n                }\n            })\n        }\n\n        return { sources, types };\n    }\n\n    const { sources, types } = renderFilteredItems();\n    return (\n        <div className=\"detail_col\">\n            <div className=\"flex_row\">\n                <div className=\"flex_col_sm_8\">\n                    <div className=\"relate\">\n                        <button\n                            onClick={() => { props.backTab('cancel') }}\n                            className=\"back\"></button>\n                        <span className=\"xs_sub_title\">\n                            {jobName || ''}\n                        </span>\n                    </div>\n\n                    <span className=\"sub_title\">\n                        {'Your reason for canceling job'}\n                    </span>\n                    <p className=\"commn_para\">\n                        {'Let the builder and Tickt know why you are cancelling the job.'}\n                    </p>\n\n                    <FsLightbox\n                        toggler={toggler}\n                        slide={selectedSlide}\n                        sources={sources}\n                        types={types}\n                    />\n\n                    <div className=\"reason_wrap\">\n                        <div className=\"f_spacebw\">\n                            {commonRenderValues({ id: 1 })}\n                            {commonRenderValues({ id: 2 })}\n                        </div>\n\n                        <div className=\"f_spacebw\">\n                            {commonRenderValues({ id: 3 })}\n                            {commonRenderValues({ id: 4 })}\n                        </div>\n\n                        <div className=\"f_spacebw\">\n                            {commonRenderValues({ id: 5 })}\n                        </div>\n                    </div>\n\n                </div>\n\n                <div className=\"flex_col_sm_9\">\n                    <div className=\"form_field\">\n                        <label className=\"form_label\">Add note (optional)</label>\n                        <div className=\"text_field\">\n                            <textarea\n                                value={detail}\n                                onChange={(e: any) => {\n                                    setStateData((prev: any) => ({ ...prev, detail: e.target.value }))\n                                }}\n                                placeholder=\"It’s really bad work, because...\"\n                                maxLength={250}\n                            />\n                        </div>\n                        <span className=\"error_msg\">\n                            {errorData.detail}\n                        </span>\n                    </div>\n                    <button\n                        onClick={handleSubmit}\n                        className={`fill_btn full_btn btn-effect ${checkErrors() ? 'disable_btn' : ''}`}>\n                        {'Send'}\n                    </button>\n                </div>\n            </div>\n        </div>\n    )\n}\n\nexport default LodgeDispute;"]},"metadata":{},"sourceType":"module"}