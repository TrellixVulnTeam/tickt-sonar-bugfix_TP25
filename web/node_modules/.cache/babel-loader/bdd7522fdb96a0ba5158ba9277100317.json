{"ast":null,"code":"import _objectSpread from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _defineProperty from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _regeneratorRuntime from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from'react';import dummy from'../../../assets/images/u_placeholder.jpg';import editIconBlue from'../../../assets/images/ic-edit-blue.png';import more from'../../../assets/images/icon-direction-right.png';import MilestoneApprove from'./milestoneApprove';import{withRouter}from'react-router-dom';import{getMilestoneList,getMilestoneDetails}from'../../../redux/homeSearch/actions';import{renderTime}from'../../../utils/common';import EditMilestones from'./editMilestones/index';import CancelJobs from'./cancelJobs/cancelJob';import LodgeDispute from'./lodgeDispute/lodgeDispute';import storageService from'../../../utils/storageService';import noDataFound from'../../../assets/images/no-search-data.png';import SeeDetailsComponents from'./seeDetails';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var MarkMilestones=function MarkMilestones(props){var _item_details$milesto,_item_details$milesto2,_dataItems,_item_details$tradie,_item_details$tradie2,_item_details$tradie3,_item_details$tradie4;var resetStateLocal=props===null||props===void 0?void 0:props.resetStateLocal;var listData=props===null||props===void 0?void 0:props.listData;var selectedIndex=props===null||props===void 0?void 0:props.selectedIndex;var enableEditMilestone=props===null||props===void 0?void 0:props.enableEditMilestone;var enableLodgeDispute=props===null||props===void 0?void 0:props.enableLodgeDispute;var enableCancelJob=props===null||props===void 0?void 0:props.enableCancelJob;var pathname=\"\".concat(props.location.pathname).concat(props.location.search);var _useState=useState(pathname),_useState2=_slicedToArray(_useState,2),page=_useState2[0],setPage=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),enableApprove=_useState4[0],setEnableApprove=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),itemDetails=_useState6[0],setDetails=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),showError=_useState8[0],setShowError=_useState8[1];var _useState9=useState(null),_useState10=_slicedToArray(_useState9,2),selectedMilestoneIndex=_useState10[0],setMilestoneIndex=_useState10[1];var _useState11=useState(null),_useState12=_slicedToArray(_useState11,2),selectedMile=_useState12[0],setMilestone=_useState12[1];var _useState13=useState({}),_useState14=_slicedToArray(_useState13,2),expandItem=_useState14[0],setExpandItem=_useState14[1];var _useState15=useState(false),_useState16=_slicedToArray(_useState15,2),toggleSeeDetails=_useState16[0],setSeeDetails=_useState16[1];var _useState17=useState({edit:false,cancel:false,lodge:false}),_useState18=_slicedToArray(_useState17,2),toggleItem=_useState18[0],setToggleItem=_useState18[1];var backToScreen=function backToScreen(){preFetch();setEnableApprove(false);setSeeDetails(false);};var selectedItem=null;if(listData===null||listData===void 0?void 0:listData.length){selectedItem=listData[selectedIndex];}useEffect(function(){var UrlParams=new URLSearchParams(props.location.search);var isForce=UrlParams.get('force');var active=UrlParams.get('active');var jobId=UrlParams.get('jobId');var markMilestone=UrlParams.get('markMilestone');if(isForce){props.history.replace(\"\".concat(props.location.pathname,\"?active=\").concat(active,\"&jobId=\").concat(jobId,\"&markMilestone=\").concat(markMilestone));props.recallHeaderNotification(true);preFetch();}},[props]);useEffect(function(){fetchMilestoneDetail();},[selectedMilestoneIndex]);var fetchMilestoneDetail=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var milestoneId,jobId,response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(selectedMilestoneIndex&&Object.keys(selectedMilestoneIndex).length)){_context.next=8;break;}milestoneId=selectedMilestoneIndex.milestoneId,jobId=selectedMilestoneIndex.jobId;if(!(milestoneId&&jobId)){_context.next=8;break;}_context.next=5;return getMilestoneDetails({milestoneId:milestoneId,jobId:jobId});case 5:response=_context.sent;console.log({response:response});if(response.success){setMilestone(response.data);if((selectedMilestoneIndex===null||selectedMilestoneIndex===void 0?void 0:selectedMilestoneIndex.type)===\"detail\"){setSeeDetails(true);}else{setEnableApprove(true);}}case 8:case\"end\":return _context.stop();}}},_callee);}));return function fetchMilestoneDetail(){return _ref.apply(this,arguments);};}();useEffect(function(){preFetch();},[]);useEffect(function(){if(Object.keys(expandItem).length===0){preFetch();}},[expandItem]);useEffect(function(){if(enableEditMilestone){setToggleItem({edit:true,cancel:false,lodge:false});}if(enableLodgeDispute){setToggleItem({edit:false,cancel:false,lodge:true});}if(enableCancelJob){setToggleItem({edit:false,cancel:true,lodge:false});}},[enableEditMilestone,enableLodgeDispute,enableCancelJob]);var classChecks=function classChecks(isActive,isPrevDone){if(isActive===1&&isPrevDone===false){return'active';}else if(isActive===2&&isPrevDone===false){return'check';}else if(isActive===1&&isPrevDone===2){return'active';}else if(isActive===2&&isPrevDone===2){return'check';}else{return'disable';}};var preFetch=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var _selectedItem;var jobId,res,_res$data,_res$data$milestones,_res$data2,_res$data2$milestones;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:jobId=(_selectedItem=selectedItem)===null||_selectedItem===void 0?void 0:_selectedItem.jobId;if(!(getMilestoneList&&jobId)){_context2.next=6;break;}_context2.next=4;return getMilestoneList(jobId);case 4:res=_context2.sent;if(res.success){if(res===null||res===void 0?void 0:(_res$data=res.data)===null||_res$data===void 0?void 0:(_res$data$milestones=_res$data.milestones)===null||_res$data$milestones===void 0?void 0:_res$data$milestones.length){res===null||res===void 0?void 0:(_res$data2=res.data)===null||_res$data2===void 0?void 0:(_res$data2$milestones=_res$data2.milestones)===null||_res$data2$milestones===void 0?void 0:_res$data2$milestones.forEach(function(item,index){if(index===0){var isActive=item===null||item===void 0?void 0:item.status;var isPrevDone=false;isPrevDone=false;var result=classChecks(isActive,isPrevDone);if([\"check\",\"active\"].includes(result)){setExpandItem(_defineProperty({},item===null||item===void 0?void 0:item.milestoneId,true));}}});}setDetails(res.data);setShowError(false);}else{if((res===null||res===void 0?void 0:res.status)===404){setShowError(true);}}case 6:case\"end\":return _context2.stop();}}},_callee2);}));return function preFetch(){return _ref2.apply(this,arguments);};}();var redirectToInfo=function redirectToInfo(_ref3){var jobId=_ref3.jobId,status=_ref3.status,tradieId=_ref3.tradieId;console.log({jobId:jobId});var props_=props;// let urlEncode: any = window.btoa(`?jobId=${jobId}&status=${status}&tradieId=${tradieId}&edit=true&activeType=active&hide_dipute=${item_detail?.dispute}`)\nvar urlEncode=\"?jobId=\".concat(jobId,\"&status=\").concat(status,\"&tradieId=\").concat(tradieId,\"&edit=true&activeType=active&hide_dipute=\").concat(item_detail===null||item_detail===void 0?void 0:item_detail.dispute);props_.history.push(\"/job-detail?\".concat(urlEncode));};var item_details=itemDetails;if(enableApprove){return/*#__PURE__*/_jsx(MilestoneApprove,{resetStateLocal:resetStateLocal,backToScreen:backToScreen,data:{selectedMile:selectedMile,selectedMilestoneIndex:selectedMilestoneIndex,selectedItem:selectedItem,itemDetails:itemDetails}});}if(toggleSeeDetails){return/*#__PURE__*/_jsx(SeeDetailsComponents,{resetStateLocal:resetStateLocal,backToScreen:backToScreen,data:{selectedMile:selectedMile,selectedMilestoneIndex:selectedMilestoneIndex,selectedItem:selectedItem,itemDetails:itemDetails}});}var backTab=function backTab(name){setToggleItem(function(prev){return _objectSpread(_objectSpread({},prev),{},_defineProperty({},name,false));});setExpandItem({});};if(toggleItem===null||toggleItem===void 0?void 0:toggleItem.edit){var details=itemDetails;if(details&&selectedItem){var _Object$keys;if(details&&((_Object$keys=Object.keys(details))===null||_Object$keys===void 0?void 0:_Object$keys.length)&&Object.keys(selectedItem).length){return/*#__PURE__*/_jsx(EditMilestones,{details:details,item:selectedItem,backTab:backTab});}}}if(toggleItem===null||toggleItem===void 0?void 0:toggleItem.lodge){return/*#__PURE__*/_jsx(LodgeDispute,{item:selectedItem,backTab:backTab});}if(toggleItem===null||toggleItem===void 0?void 0:toggleItem.cancel){return/*#__PURE__*/_jsx(CancelJobs,{item:selectedItem,backTab:backTab});}var item_detail=itemDetails;var item_status=false;if(item_details===null||item_details===void 0?void 0:(_item_details$milesto=item_details.milestones)===null||_item_details$milesto===void 0?void 0:_item_details$milesto.length){var isExist=item_details===null||item_details===void 0?void 0:item_details.milestones.find(function(item){return item.status===1;});if(isExist){item_status=true;}}var dataItems=[];if(item_details===null||item_details===void 0?void 0:(_item_details$milesto2=item_details.milestones)===null||_item_details$milesto2===void 0?void 0:_item_details$milesto2.length){dataItems=item_details===null||item_details===void 0?void 0:item_details.milestones;}console.log({selectedItem:selectedItem});if(showError){return/*#__PURE__*/_jsxs(\"div\",{className:\"flex_row\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex_col_sm_6\",children:/*#__PURE__*/_jsx(\"div\",{className:\"flex_col_sm_8 relative\",children:/*#__PURE__*/_jsx(\"button\",{className:\"back\",onClick:function onClick(){resetStateLocal();}})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"no_record  m-t-vh\",children:[/*#__PURE__*/_jsx(\"figure\",{className:\"no_img\",children:/*#__PURE__*/_jsx(\"img\",{src:noDataFound,alt:\"data not found\"})}),/*#__PURE__*/_jsx(\"span\",{children:'This tradesperson is no longer available.'}),/*#__PURE__*/_jsxs(\"span\",{children:['please contact admin.',\" \"]})]})]});}return/*#__PURE__*/_jsxs(\"div\",{className:\"flex_row\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex_col_sm_6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"relate\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"back\",onClick:function onClick(){// times\nresetStateLocal();}}),/*#__PURE__*/_jsx(\"span\",{className:\"xs_sub_title\",children:item_detail&&Object.keys(item_detail).length?item_detail.jobName:''}),/*#__PURE__*/_jsxs(\"span\",{className:\"dot_menu\",children:[/*#__PURE__*/_jsx(\"img\",{src:editIconBlue,alt:\"edit\"}),/*#__PURE__*/_jsx(\"div\",{className:\"edit_menu\",children:/*#__PURE__*/_jsxs(\"ul\",{children:[/*#__PURE__*/_jsx(\"li\",{onClick:function onClick(){setToggleItem({edit:true,lodge:false,cancel:false});},className:\"icon edit_line\",children:'Edit Milestone'}),!(item_detail===null||item_detail===void 0?void 0:item_detail.dispute)&&/*#__PURE__*/_jsx(\"li\",{onClick:function onClick(){setToggleItem(function(prev){return _objectSpread(_objectSpread({},prev),{},{lodge:true});});},className:\"icon lodge\",children:'Lodge dispute'}),/*#__PURE__*/_jsx(\"li\",{onClick:function onClick(){setToggleItem(function(prev){return _objectSpread(_objectSpread({},prev),{},{cancel:true});});},className:\"icon delete\",children:\"Cancel job\"})]})})]})]}),/*#__PURE__*/_jsx(\"span\",{onClick:function onClick(){props.history.replace(\"/jobs?\".concat(Math.random(),\"=\").concat(Math.random()));},className:\"sub_title\",children:'Job Milestones'}),/*#__PURE__*/_jsx(\"p\",{className:\"commn_para\",children:\"Your job point of contact has indicated they want to be notified when you reach the following milestones. Tap the milestone and Submit when a milestone is completed\"}),/*#__PURE__*/_jsx(\"ul\",{className:\"milestones_check\",children:(_dataItems=dataItems)===null||_dataItems===void 0?void 0:_dataItems.map(function(_ref4,index){var milestoneId=_ref4.milestoneId,milestoneName=_ref4.milestoneName,isPhotoevidence=_ref4.isPhotoevidence,status=_ref4.status,fromDate=_ref4.fromDate,toDate=_ref4.toDate;var isActive=status;var isPrevDone=false;if(index===0){isPrevDone=false;}else{isPrevDone=dataItems[index-1].status;}console.log({isActive:isActive,isPrevDone:isPrevDone,index:index,expandItem:expandItem});return/*#__PURE__*/_jsxs(\"li\",{className:classChecks(isActive,isPrevDone),children:[/*#__PURE__*/_jsx(\"div\",{onClick:function onClick(){setExpandItem(function(prev){return _objectSpread(_objectSpread({},prev),{},_defineProperty({},milestoneId,prev[milestoneId]===undefined?true:!prev[milestoneId]));});},className:\"circle_stepper\",children:/*#__PURE__*/_jsx(\"span\",{})}),/*#__PURE__*/_jsxs(\"div\",{className:\"info\",children:[/*#__PURE__*/_jsx(\"label\",{children:milestoneName}),isPhotoevidence&&/*#__PURE__*/_jsx(\"span\",{children:'Photo evidence required'}),/*#__PURE__*/_jsx(\"span\",{children:renderTime(fromDate,toDate)}),[\"check\"].includes(classChecks(isActive,isPrevDone))&&expandItem[milestoneId]?/*#__PURE__*/_jsx(\"button\",{className:\"fill_btn full_btn btn-effect\",style:{backgroundColor:'#DFE5EF'},onClick:function onClick(e){e.stopPropagation();setMilestoneIndex({index:index,milestoneId:milestoneId,type:'detail',jobId:item_details===null||item_details===void 0?void 0:item_details.jobId});},children:'See Details'}):null]}),[\"active\"].includes(classChecks(isActive,isPrevDone))&&expandItem[milestoneId]?/*#__PURE__*/_jsx(\"button\",{className:\"fill_btn full_btn btn-effect\",onClick:function onClick(){setMilestoneIndex({index:index,milestoneId:milestoneId,type:'approve',jobId:item_details===null||item_details===void 0?void 0:item_details.jobId});},children:'Check and Approve'}):null]},milestoneId);})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex_col_sm_6 col_ruler\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"sub_title\",children:\"Tradesperson\"}),/*#__PURE__*/_jsxs(\"div\",{onClick:function onClick(){var _props$history;props===null||props===void 0?void 0:(_props$history=props.history)===null||_props$history===void 0?void 0:_props$history.push(\"tradie-info?tradeId=\".concat(item_details===null||item_details===void 0?void 0:item_details.tradieId,\"&hideInvite=true&active=true&jobId=\").concat(item_details===null||item_details===void 0?void 0:item_details.jobId));},className:\"tradie_card posted_by\",children:[/*#__PURE__*/_jsx(\"span\",{onClick:function onClick(e){var _storageService$getIt;e.stopPropagation();props.history.push({pathname:\"/chat\",state:{tradieId:item_details===null||item_details===void 0?void 0:item_details.tradieId,builderId:(_storageService$getIt=storageService.getItem('userInfo'))===null||_storageService$getIt===void 0?void 0:_storageService$getIt._id,jobId:item_details===null||item_details===void 0?void 0:item_details.jobId,jobName:item_details===null||item_details===void 0?void 0:item_details.jobName}});},className:\"chat circle\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"user_wrap\",children:[/*#__PURE__*/_jsx(\"figure\",{className:\"u_img\",children:/*#__PURE__*/_jsx(\"img\",{src:(item_details===null||item_details===void 0?void 0:(_item_details$tradie=item_details.tradie)===null||_item_details$tradie===void 0?void 0:_item_details$tradie.tradieImage)||dummy,alt:\"traide-img\",onError:function onError(e){var _e$target,_e$target2;if(e===null||e===void 0?void 0:(_e$target=e.target)===null||_e$target===void 0?void 0:_e$target.onerror){e.target.onerror=null;}if(e===null||e===void 0?void 0:(_e$target2=e.target)===null||_e$target2===void 0?void 0:_e$target2.src){e.target.src=dummy;}}})}),/*#__PURE__*/_jsxs(\"div\",{className:\"details\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"name\",children:(item_details===null||item_details===void 0?void 0:(_item_details$tradie2=item_details.tradie)===null||_item_details$tradie2===void 0?void 0:_item_details$tradie2.tradieName)||''}),(item_details===null||item_details===void 0?void 0:item_details.tradie)&&/*#__PURE__*/_jsxs(\"span\",{className:\"rating\",children:[(item_details===null||item_details===void 0?void 0:(_item_details$tradie3=item_details.tradie)===null||_item_details$tradie3===void 0?void 0:_item_details$tradie3.ratings)||0,\" | \",(item_details===null||item_details===void 0?void 0:(_item_details$tradie4=item_details.tradie)===null||_item_details$tradie4===void 0?void 0:_item_details$tradie4.reviews)||0,\" reviews\"]})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"relate\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"sub_title\",children:'Job details'}),/*#__PURE__*/_jsx(\"span\",{className:\"edit_icon\",title:\"More\",onClick:function onClick(){var _selectedItem2=selectedItem,jobId=_selectedItem2.jobId,tradeId=_selectedItem2.tradeId,specializationId=_selectedItem2.specializationId,tradieId=_selectedItem2.tradieId,status=_selectedItem2.status;redirectToInfo({jobId:jobId,status:status,tradieId:tradieId});},children:/*#__PURE__*/_jsx(\"img\",{src:more,alt:\"more\"})})]})]})]});};export default withRouter(MarkMilestones);","map":{"version":3,"sources":["/home/appinventiv/Documents/Project/tickt/web/src/pages/builderJobDasboard/components/markMilestones.tsx"],"names":["React","useState","useEffect","dummy","editIconBlue","more","MilestoneApprove","withRouter","getMilestoneList","getMilestoneDetails","renderTime","EditMilestones","CancelJobs","LodgeDispute","storageService","noDataFound","SeeDetailsComponents","MarkMilestones","props","resetStateLocal","listData","selectedIndex","enableEditMilestone","enableLodgeDispute","enableCancelJob","pathname","location","search","page","setPage","enableApprove","setEnableApprove","itemDetails","setDetails","showError","setShowError","selectedMilestoneIndex","setMilestoneIndex","selectedMile","setMilestone","expandItem","setExpandItem","toggleSeeDetails","setSeeDetails","edit","cancel","lodge","toggleItem","setToggleItem","backToScreen","preFetch","selectedItem","length","UrlParams","URLSearchParams","isForce","get","active","jobId","markMilestone","history","replace","recallHeaderNotification","fetchMilestoneDetail","Object","keys","milestoneId","response","console","log","success","data","type","classChecks","isActive","isPrevDone","res","milestones","forEach","item","index","status","result","includes","redirectToInfo","tradieId","props_","urlEncode","item_detail","dispute","push","item_details","backTab","name","prev","details","item_status","isExist","find","dataItems","jobName","Math","random","map","milestoneName","isPhotoevidence","fromDate","toDate","undefined","backgroundColor","e","stopPropagation","state","builderId","getItem","_id","tradie","tradieImage","target","onerror","src","tradieName","ratings","reviews","tradeId","specializationId"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useRef } from 'react'\nimport UploadMedia from '../../postJob/components/uploadMedia';\nimport dummy from '../../../assets/images/u_placeholder.jpg';\nimport editIconBlue from '../../../assets/images/ic-edit-blue.png';\nimport more from '../../../assets/images/icon-direction-right.png';\nimport check from '../../../assets/images/checked-2.png';\nimport { format } from 'date-fns';\nimport MilestoneApprove from './milestoneApprove';\nimport { withRouter } from 'react-router-dom';\nimport { connect } from 'react-redux'\nimport { bindActionCreators } from 'redux';\nimport {\n    getHomeJobDetails,\n    getMilestoneList,\n    getMilestoneDetails\n} from '../../../redux/homeSearch/actions';\nimport { setShowToast } from '../../../redux/common/actions';\nimport { renderTime } from '../../../utils/common';\nimport EditMilestones from './editMilestones/index';\nimport CancelJobs from './cancelJobs/cancelJob'\nimport LodgeDispute from './lodgeDispute/lodgeDispute';\nimport { CancelJob } from '../../../redux/jobs/actions';\nimport storageService from '../../../utils/storageService';\nimport noDataFound from '../../../assets/images/no-search-data.png';\nimport SeeDetailsComponents from './seeDetails';\n\ninterface Mile {\n    milestoneId: any,\n    milestoneName: any,\n    isPhotoevidence: any,\n    status: any,\n    fromDate: any,\n    toDate: any,\n    enableEditMilestone: boolean,\n    enableLodgeDispute: boolean,\n    enableCancelJob: boolean\n}\n\nconst MarkMilestones = (props: any) => {\n\n    let resetStateLocal = props?.resetStateLocal;\n    let listData = props?.listData;\n    let selectedIndex = props?.selectedIndex;\n    let enableEditMilestone = props?.enableEditMilestone;\n    let enableLodgeDispute = props?.enableLodgeDispute;\n    let enableCancelJob = props?.enableCancelJob;\n    let pathname = `${props.location.pathname}${props.location.search}`;\n    const [page, setPage] = useState(pathname);\n\n    const [enableApprove, setEnableApprove] = useState(false);\n    const [itemDetails, setDetails] = useState(null);\n    const [showError, setShowError] = useState(false);\n    const [selectedMilestoneIndex, setMilestoneIndex] = useState<any>(null);\n    const [selectedMile, setMilestone] = useState(null);\n    const [expandItem, setExpandItem] = useState<any>({});\n\n    const [toggleSeeDetails, setSeeDetails] = useState(false);\n    const [toggleItem, setToggleItem] = useState<{ [index: string]: boolean }>({ edit: false, cancel: false, lodge: false });\n\n    const backToScreen = () => {\n        preFetch();\n        setEnableApprove(false);\n        setSeeDetails(false);\n    }\n\n    let selectedItem: any = null;\n    if (listData?.length) {\n        selectedItem = listData[selectedIndex];\n    }\n\n    useEffect(() => {\n        let UrlParams = new URLSearchParams(props.location.search);\n        let isForce = UrlParams.get('force');\n        let active = UrlParams.get('active');\n        let jobId = UrlParams.get('jobId');\n        let markMilestone = UrlParams.get('markMilestone');\n        if (isForce) {\n            props.history.replace(`${props.location.pathname}?active=${active}&jobId=${jobId}&markMilestone=${markMilestone}`);\n            props.recallHeaderNotification(true);\n            preFetch();\n        }\n    }, [props]);\n\n    useEffect(() => {\n        fetchMilestoneDetail();\n    }, [selectedMilestoneIndex]);\n\n    const fetchMilestoneDetail = async () => {\n        if (selectedMilestoneIndex && Object.keys(selectedMilestoneIndex).length) {\n            const { milestoneId, jobId } = selectedMilestoneIndex;\n            if (milestoneId && jobId) {\n                let response: any = await getMilestoneDetails({ milestoneId, jobId });\n                console.log({ response })\n                if (response.success) {\n                    setMilestone(response.data);\n                    if (selectedMilestoneIndex?.type === \"detail\") {\n                        setSeeDetails(true);\n                    } else {\n                        setEnableApprove(true);\n                    }\n                }\n            }\n        }\n    }\n\n    useEffect(() => {\n        preFetch();\n    }, []);\n\n    useEffect(() => {\n        if (Object.keys(expandItem).length === 0) {\n            preFetch();\n        }\n    }, [expandItem]);\n\n    useEffect(() => {\n        if (enableEditMilestone) {\n            setToggleItem({\n                edit: true, cancel: false, lodge: false\n            })\n        }\n\n        if (enableLodgeDispute) {\n            setToggleItem({\n                edit: false, cancel: false, lodge: true\n            })\n        }\n\n        if (enableCancelJob) {\n            setToggleItem({\n                edit: false, cancel: true, lodge: false\n            })\n        }\n    }, [enableEditMilestone, enableLodgeDispute, enableCancelJob])\n\n\n    const classChecks = (isActive: any, isPrevDone: any) => {\n        if (isActive === 1 && isPrevDone === false) {\n            return 'active';\n        } else if (isActive === 2 && isPrevDone === false) {\n            return 'check';\n        } else if (isActive === 1 && isPrevDone === 2) {\n            return 'active';\n        } else if (isActive === 2 && isPrevDone === 2) {\n            return 'check';\n        } else {\n            return 'disable'\n        }\n    }\n\n    const preFetch = async () => {\n        let jobId = selectedItem?.jobId;\n        if (getMilestoneList && jobId) {\n            const res: any = await getMilestoneList(jobId);\n            if (res.success) {\n                if (res?.data?.milestones?.length) {\n                    res?.data?.milestones?.forEach((item: any, index: any) => {\n                        if (index === 0) {\n                            const isActive = item?.status;\n                            let isPrevDone: any = false;\n                            isPrevDone = false;\n                            let result = classChecks(isActive, isPrevDone);\n                            if ([\"check\", \"active\"].includes(result)) {\n                                setExpandItem({\n                                    [item?.milestoneId]: true\n                                });\n                            }\n                        }\n                    })\n                }\n                setDetails(res.data);\n                setShowError(false)\n            } else {\n                if (res?.status === 404) {\n                    setShowError(true)\n                }\n            }\n        }\n    }\n\n    const redirectToInfo = ({ jobId, status, tradieId }: any) => {\n        console.log({ jobId });\n        let props_: any = props;\n        // let urlEncode: any = window.btoa(`?jobId=${jobId}&status=${status}&tradieId=${tradieId}&edit=true&activeType=active&hide_dipute=${item_detail?.dispute}`)\n        let urlEncode: any = `?jobId=${jobId}&status=${status}&tradieId=${tradieId}&edit=true&activeType=active&hide_dipute=${item_detail?.dispute}`;\n        props_.history.push(`/job-detail?${urlEncode}`);\n    }\n\n    let item_details: any = itemDetails;\n    if (enableApprove) {\n        return (\n            <MilestoneApprove\n                resetStateLocal={resetStateLocal}\n                backToScreen={backToScreen}\n                data={{ selectedMile, selectedMilestoneIndex, selectedItem, itemDetails }}\n            />)\n    }\n\n    if (toggleSeeDetails) {\n        return (\n            <SeeDetailsComponents\n                resetStateLocal={resetStateLocal}\n                backToScreen={backToScreen}\n                data={{ selectedMile, selectedMilestoneIndex, selectedItem, itemDetails }}\n            />\n        )\n    }\n\n    const backTab = (name: string) => {\n        setToggleItem((prev: any) => ({ ...prev, [name]: false }));\n        setExpandItem({});\n    }\n\n    if (toggleItem?.edit) {\n        let details: any = itemDetails;\n        if (details && selectedItem) {\n            if (details && Object.keys(details)?.length && Object.keys(selectedItem).length) {\n                return (\n                    <EditMilestones\n                        details={details}\n                        item={selectedItem}\n                        backTab={backTab}\n                    />\n                )\n            }\n        }\n    }\n\n    if (toggleItem?.lodge) {\n        return (\n            <LodgeDispute item={selectedItem} backTab={backTab} />\n        )\n    }\n\n    if (toggleItem?.cancel) {\n        return (\n            <CancelJobs item={selectedItem} backTab={backTab} />\n        )\n    }\n\n    let item_detail: any = itemDetails;\n    let item_status = false;\n    if (item_details?.milestones?.length) {\n        let isExist = item_details?.milestones.find((item: any) => item.status === 1);\n        if (isExist) {\n            item_status = true;\n        }\n    }\n    let dataItems: any = [];\n    if (item_details?.milestones?.length) {\n        dataItems = item_details?.milestones;\n    }\n    console.log({ selectedItem })\n\n    if (showError) {\n        return (\n            <div className=\"flex_row\">\n                <div className=\"flex_col_sm_6\">\n                    <div className=\"flex_col_sm_8 relative\">\n                        <button\n                            className=\"back\"\n                            onClick={() => {\n                                resetStateLocal();\n                            }}></button>\n                    </div>\n                </div>\n\n\n                <div className=\"no_record  m-t-vh\">\n                    <figure className=\"no_img\">\n                        <img src={noDataFound} alt=\"data not found\" />\n                    </figure>\n                    <span>{'This tradesperson is no longer available.'}</span>\n                    <span>{'please contact admin.'} </span>\n                </div>\n            </div>\n        )\n    }\n\n    return (\n        <div className=\"flex_row\">\n            <div className=\"flex_col_sm_6\">\n                <div className=\"relate\">\n                    <button\n                        className=\"back\"\n                        onClick={() => {\n                            // times\n                            resetStateLocal();\n                        }}\n                    ></button>\n                    <span className=\"xs_sub_title\">\n                        {item_detail && Object.keys(item_detail).length ? item_detail.jobName : ''}\n                    </span>\n\n                    <span className=\"dot_menu\">\n                        <img src={editIconBlue} alt=\"edit\" />\n                        <div className=\"edit_menu\">\n                            <ul>\n                                {/* {!selectedItem?.quoteJob && ( */}\n                                {(\n                                    <li\n                                        onClick={() => { setToggleItem({ edit: true, lodge: false, cancel: false }) }}\n                                        className=\"icon edit_line\">\n                                        {'Edit Milestone'}\n                                    </li>\n                                )}\n\n                                {!item_detail?.dispute && (\n                                    <li\n                                        onClick={() => { setToggleItem((prev: any) => ({ ...prev, lodge: true })) }}\n                                        className=\"icon lodge\">\n                                        {'Lodge dispute'}\n                                    </li>\n                                )}\n\n                                <li\n                                    onClick={() => { setToggleItem((prev: any) => ({ ...prev, cancel: true })) }}\n                                    className=\"icon delete\">Cancel job</li>\n                            </ul>\n                        </div>\n                    </span>\n\n\n                </div>\n                <span\n                    onClick={() => {\n                        props.history.replace(`/jobs?${Math.random()}=${Math.random()}`)\n                    }}\n                    className=\"sub_title\">\n                    {'Job Milestones'}\n                </span>\n                <p className=\"commn_para\">\n                    {\"Your job point of contact has indicated they want to be notified when you reach the following milestones. Tap the milestone and Submit when a milestone is completed\"}\n                </p>\n\n                <ul className=\"milestones_check\">\n                    {dataItems?.map(({\n                        milestoneId,\n                        milestoneName,\n                        isPhotoevidence,\n                        status,\n                        fromDate,\n                        toDate,\n                    }: Mile,\n                        index: number\n                    ) => {\n                        const isActive = status;\n                        let isPrevDone: any = false;\n                        if (index === 0) {\n                            isPrevDone = false;\n                        } else {\n                            isPrevDone = dataItems[index - 1].status;\n                        }\n                        console.log({ isActive, isPrevDone, index, expandItem })\n                        return (\n                            <li\n                                key={milestoneId}\n                                className={classChecks(isActive, isPrevDone)}>\n                                <div\n                                    onClick={() => {\n                                        setExpandItem((prev: any) => ({\n                                            ...prev,\n                                            [milestoneId]: prev[milestoneId] === undefined ? true : !prev[milestoneId]\n                                        }));\n                                    }}\n                                    className=\"circle_stepper\">\n                                    <span></span>\n                                </div>\n                                <div className=\"info\">\n                                    <label>{milestoneName}</label>\n                                    {isPhotoevidence && (\n                                        <span>{'Photo evidence required'}</span>\n                                    )}\n                                    <span>\n                                        {renderTime(fromDate, toDate)}\n                                    </span>\n\n                                    {[\"check\"].includes(classChecks(isActive, isPrevDone)) && expandItem[milestoneId] ? (\n                                        <button\n                                            className=\"fill_btn full_btn btn-effect\"\n                                            style={{ backgroundColor: '#DFE5EF' }}\n                                            onClick={(e) => {\n                                                e.stopPropagation();\n                                                setMilestoneIndex({\n                                                    index,\n                                                    milestoneId,\n                                                    type: 'detail',\n                                                    jobId: item_details?.jobId\n                                                });\n                                            }}>\n                                            {'See Details'}\n                                        </button>\n                                    ) : null}\n                                </div>\n\n                                {[\"active\"].includes(classChecks(isActive, isPrevDone)) && expandItem[milestoneId] ? (\n                                    <button\n                                        className=\"fill_btn full_btn btn-effect\"\n                                        onClick={() => {\n                                            setMilestoneIndex({\n                                                index,\n                                                milestoneId,\n                                                type: 'approve',\n                                                jobId: item_details?.jobId\n                                            });\n                                        }}>\n                                        {'Check and Approve'}\n                                    </button>\n                                ) : null}\n                            </li>\n                        );\n                    }\n                    )}\n                </ul>\n            </div>\n            <div className=\"flex_col_sm_6 col_ruler\">\n                <span className=\"sub_title\">Tradesperson</span>\n\n                <div\n                    onClick={() => {\n                        props?.history?.push(`tradie-info?tradeId=${item_details?.tradieId}&hideInvite=true&active=true&jobId=${item_details?.jobId}`);\n                    }}\n                    className=\"tradie_card posted_by\">\n                    <span\n                        onClick={(e) => {\n                            e.stopPropagation();\n                            props.history.push({\n                                pathname: `/chat`,\n                                state: {\n                                    tradieId: item_details?.tradieId,\n                                    builderId: storageService.getItem('userInfo')?._id,\n                                    jobId: item_details?.jobId,\n                                    jobName: item_details?.jobName\n                                }\n                            })\n                        }}\n                        className=\"chat circle\" />\n                    <div className=\"user_wrap\">\n                        <figure className=\"u_img\">\n                            <img\n                                src={item_details?.tradie?.tradieImage || dummy}\n                                alt=\"traide-img\"\n                                onError={(e: any) => {\n                                    if (e?.target?.onerror) {\n                                        e.target.onerror = null;\n                                    }\n                                    if (e?.target?.src) {\n                                        e.target.src = dummy;\n                                    }\n                                }}\n                            />\n                        </figure>\n                        <div className=\"details\">\n                            <span className=\"name\">{item_details?.tradie?.tradieName || ''}</span>\n                            {/* <span className=\"prof\">Project Manager</span> */}\n                            {item_details?.tradie && (\n                                <span className=\"rating\">\n                                    {item_details?.tradie?.ratings || 0} | {item_details?.tradie?.reviews || 0} reviews\n                                </span>\n                            )}\n                        </div>\n                    </div>\n                </div>\n\n                <div className=\"relate\">\n                    <span className=\"sub_title\">\n                        {'Job details'}\n                    </span>\n                    <span\n                        className=\"edit_icon\"\n                        title=\"More\"\n                        onClick={() => {\n                            let { jobId, tradeId, specializationId, tradieId, status } = selectedItem;\n                            redirectToInfo({ jobId, status, tradieId })\n                        }}>\n                        <img src={more} alt=\"more\" />\n                    </span>\n                </div>\n            </div>\n        </div>\n\n    )\n}\n\nexport default withRouter(MarkMilestones)\n"]},"metadata":{},"sourceType":"module"}