{"ast":null,"code":"import _regeneratorRuntime from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from'react';import Constants from'../../../../../../utils/constants';import regex from'../../../../../../utils/regex';import{tradieChangeEmail}from'../../../../../../redux/profile/actions';import{verifyEmailOtp}from'../../../../../../redux/profile/actions';import OtpInput from\"react-otp-input\";import cancel from\"../../../../../../assets/images/ic-cancel.png\";import storageService from'../../../../../../utils/storageService';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var VerifyNewEmail=function VerifyNewEmail(props){var _useState=useState({}),_useState2=_slicedToArray(_useState,2),errors=_useState2[0],setErrors=_useState2[1];var _useState3=useState(Constants.OTP_TIMER),_useState4=_slicedToArray(_useState3,2),counter=_useState4[0],setCounter=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),otp=_useState6[0],setOTP=_useState6[1];var changeHandler=function changeHandler(newOtp){setOTP(newOtp);};useEffect(function(){var timer=counter>0&&setInterval(function(){return setCounter(counter-1);},1000);return function(){return clearInterval(timer);};},[counter]);var validateForm=function validateForm(){var newErrors={};if(!otp){newErrors.otp=Constants.errorStrings.otpEmpty;}else{var otpregex=new RegExp(regex.otp);if(!otpregex.test(otp)){newErrors.otp=Constants.errorStrings.otpIncorrect;}}setErrors(newErrors);return!Object.keys(newErrors).length;};var resendHandler=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var data,res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();data={currentEmail:props.currentEmail,newEmail:props.newEmail,password:props.currentPassword,user_type:storageService.getItem('userType')};_context.next=4;return tradieChangeEmail(data);case 4:res=_context.sent;if(res.success){setCounter(Constants.OTP_TIMER);}case 6:case\"end\":return _context.stop();}}},_callee);}));return function resendHandler(_x){return _ref.apply(this,arguments);};}();var onSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(e){var data,res,_props$history;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:e.preventDefault();if(!validateForm()){_context2.next=7;break;}data={newEmail:props.newEmail,otp:otp};_context2.next=5;return verifyEmailOtp(data);case 5:res=_context2.sent;if(res.success){(_props$history=props.history)===null||_props$history===void 0?void 0:_props$history.push('/email-updated-successfully');}case 7:case\"end\":return _context2.stop();}}},_callee2);}));return function onSubmit(_x2){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"heading form_field\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"relate\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"back\",onClick:props.backButtonHandler}),/*#__PURE__*/_jsx(\"div\",{className:\"md_heading\",children:/*#__PURE__*/_jsx(\"span\",{className:\"sub_title\",children:\"Verify your email\"})})]}),/*#__PURE__*/_jsx(\"button\",{className:\"close_btn\",onClick:props.closeModalHandler,children:/*#__PURE__*/_jsx(\"img\",{src:cancel,alt:\"cancel\"})})]}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:onSubmit,children:[/*#__PURE__*/_jsx(\"div\",{className:\"inner_wrap\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"form_wrapper\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"show_label\",children:\"Verification Code\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"form_field\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"otp_input_wrapper\",children:/*#__PURE__*/_jsx(OtpInput,{className:\"sms-no-box\",inputStyle:{\"width\":\"48px\"},value:otp,onChange:changeHandler,numInputs:5,isInputNum:true//separator={<span>-</span>}\n})}),!!errors.otp&&/*#__PURE__*/_jsx(\"span\",{className:\"error_msg\",children:errors.otp})]}),/*#__PURE__*/_jsx(\"div\",{className:\"form_field\",children:/*#__PURE__*/_jsx(\"span\",{className:\"show_label\",children:\"We have sent a verification code to your new email. Please check email and enter the 5-digit code here.\"})}),counter===0&&/*#__PURE__*/_jsxs(\"div\",{className:\"form_field f_spacebw\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"show_label\",children:\"Don\\u2019t you receive any codes?\"}),/*#__PURE__*/_jsx(\"a\",{href:\"#\",className:\"link\",onClick:resendHandler,children:\"Re-send code\"})]}),counter>0&&/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"span\",{className:\"show_label timer\",children:counter>59?\"01 : 00\":\"00 : \".concat(counter)})})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"bottom_btn custom_btn\",children:/*#__PURE__*/_jsx(\"button\",{className:\"fill_btn full_btn btn-effect\",children:\"Next\"})})]})]});};export default VerifyNewEmail;","map":{"version":3,"sources":["/home/appinventiv/Documents/Project/tickt/web/src/pages/tradieEditProfile/components/personalInformation/changeEmailModal/components/verifyNewEmail.tsx"],"names":["React","useState","useEffect","Constants","regex","tradieChangeEmail","verifyEmailOtp","OtpInput","cancel","storageService","VerifyNewEmail","props","errors","setErrors","OTP_TIMER","counter","setCounter","otp","setOTP","changeHandler","newOtp","timer","setInterval","clearInterval","validateForm","newErrors","errorStrings","otpEmpty","otpregex","RegExp","test","otpIncorrect","Object","keys","length","resendHandler","e","preventDefault","data","currentEmail","newEmail","password","currentPassword","user_type","getItem","res","success","onSubmit","history","push","backButtonHandler","closeModalHandler"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport Constants from '../../../../../../utils/constants';\nimport regex from '../../../../../../utils/regex';\nimport { tradieChangeEmail } from '../../../../../../redux/profile/actions';\nimport { verifyEmailOtp } from '../../../../../../redux/profile/actions';\nimport OtpInput from \"react-otp-input\";\n\nimport cancel from \"../../../../../../assets/images/ic-cancel.png\";\nimport storageService from '../../../../../../utils/storageService';\n\ninterface PropsTypes {\n    history: any,\n    currentEmail: string,\n    newEmail: string,\n    currentPassword: string,\n    updateSteps: (step: number, newData?: any) => void,\n    backButtonHandler: () => void,\n    closeModalHandler: () => void,\n}\n\nconst VerifyNewEmail = (props: PropsTypes) => {\n    const [errors, setErrors] = useState<any>({});\n    const [counter, setCounter] = useState(Constants.OTP_TIMER);\n    const [otp, setOTP] = useState('');\n\n    const changeHandler = (newOtp: any) => {\n        setOTP(newOtp);\n    }\n\n    useEffect(() => {\n        const timer: any = counter > 0 && setInterval(() => setCounter(counter - 1), 1000);\n        return () => clearInterval(timer);\n    }, [counter]);\n\n    const validateForm = () => {\n        const newErrors: any = {};\n        if (!otp) {\n            newErrors.otp = Constants.errorStrings.otpEmpty;\n        } else {\n            const otpregex = new RegExp(regex.otp);\n            if (!otpregex.test(otp)) {\n                newErrors.otp = Constants.errorStrings.otpIncorrect;\n            }\n        }\n        setErrors(newErrors);\n        return !Object.keys(newErrors).length;\n    }\n\n    const resendHandler = async (e: any) => {\n        e.preventDefault()\n        const data = {\n            currentEmail: props.currentEmail,\n            newEmail: props.newEmail,\n            password: props.currentPassword,\n            user_type: storageService.getItem('userType'),\n        }\n        const res = await tradieChangeEmail(data);\n        if (res.success) {\n            setCounter(Constants.OTP_TIMER);\n        }\n    }\n\n    const onSubmit = async (e: any) => {\n        e.preventDefault();\n        if (validateForm()) {\n            const data = {\n                newEmail: props.newEmail,\n                otp: otp\n            }\n            const res: any = await verifyEmailOtp(data);\n            if (res.success) {\n                props.history?.push('/email-updated-successfully');\n            }\n        }\n    }\n\n    return (\n        <>\n            <div className=\"heading form_field\">\n                <div className=\"relate\">\n                    <button className=\"back\" onClick={props.backButtonHandler}></button>\n                    <div className=\"md_heading\">\n                        <span className=\"sub_title\">Verify your email</span>\n                    </div>\n                </div>\n                <button className=\"close_btn\" onClick={props.closeModalHandler}>\n                    <img src={cancel} alt=\"cancel\" />\n                </button>\n            </div>\n            <form onSubmit={onSubmit}>\n                <div className=\"inner_wrap\">\n                    <div className=\"form_wrapper\">\n                        <span className=\"show_label\">Verification Code</span>\n                        <div className=\"form_field\">\n                            <div className=\"otp_input_wrapper\">\n                                <OtpInput\n                                    className=\"sms-no-box\"\n                                    inputStyle={{ \"width\": \"48px\" }}\n                                    value={otp}\n                                    onChange={changeHandler}\n                                    numInputs={5}\n                                    isInputNum\n                                //separator={<span>-</span>}\n                                />\n                            </div>\n                            {!!errors.otp && <span className=\"error_msg\">{errors.otp}</span>}\n                        </div>\n                        <div className=\"form_field\">\n                            <span className=\"show_label\">We have sent a verification code to your new email.\n                                Please check email and enter the 5-digit code here.</span>\n                        </div>\n                        {counter === 0 && <div className=\"form_field f_spacebw\">\n                            <span className=\"show_label\">Don’t you receive any codes?</span>\n                            <a href=\"#\" className=\"link\" onClick={resendHandler}>Re-send code</a>\n                        </div>}\n                        {counter > 0 && <div>\n                            <span className=\"show_label timer\">{counter > 59 ? `01 : 00` : `00 : ${counter}`}</span>\n                        </div>}\n\n                    </div>\n                </div>\n                <div className=\"bottom_btn custom_btn\">\n                    <button className=\"fill_btn full_btn btn-effect\">Next</button>\n                </div>\n            </form>\n        </>\n    )\n}\n\nexport default VerifyNewEmail;\n"]},"metadata":{},"sourceType":"module"}